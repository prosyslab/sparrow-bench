/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is false */

#line 131 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off_t;
#line 132 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off64_t;
#line 212 "/usr/lib/gcc/x86_64-linux-gnu/4.8/include/stddef.h"
typedef unsigned long size_t;
#line 44 "/usr/include/stdio.h"
struct _IO_FILE;
#line 44
struct _IO_FILE;
#line 48 "/usr/include/stdio.h"
typedef struct _IO_FILE FILE;
#line 144 "/usr/include/libio.h"
struct _IO_FILE;
#line 154 "/usr/include/libio.h"
typedef void _IO_lock_t;
#line 160 "/usr/include/libio.h"
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
#line 245 "/usr/include/libio.h"
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15UL * sizeof(int ) - 4UL * sizeof(void *)) - sizeof(size_t )] ;
};
#line 779 "/usr/include/unistd.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) isatty)(int __fd ) ;
#line 71 "/usr/include/getopt.h"
extern int optind ;
#line 150
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) getopt)(int ___argc ,
                                                                             char * const  *___argv ,
                                                                             char const   *__shortopts ) ;
#line 169 "/usr/include/stdio.h"
extern struct _IO_FILE *stdout ;
#line 170
extern struct _IO_FILE *stderr ;
#line 237
extern int fclose(FILE *__stream ) ;
#line 283
extern FILE *fopen(char const   * __restrict  __filename , char const   * __restrict  __modes )  __asm__("fopen64")  ;
#line 356
extern int fprintf(FILE * __restrict  __stream , char const   * __restrict  __format 
                   , ...) ;
#line 709
extern size_t fread(void * __restrict  __ptr , size_t __size , size_t __n , FILE * __restrict  __stream ) ;
#line 715
extern size_t fwrite(void const   * __restrict  __ptr , size_t __size , size_t __n ,
                     FILE * __restrict  __s ) ;
#line 749
extern int fseek(FILE *__stream , long __off , int __whence ) ;
#line 754
extern long ftell(FILE *__stream ) ;
#line 858
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) fileno)(FILE *__stream ) ;
#line 543 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__, __noreturn__)) void ( __attribute__((__leaf__)) exit)(int __status ) ;
#line 69 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,2), __leaf__)) memcmp)(void const   *__s1 ,
                                                                                               void const   *__s2 ,
                                                                                               size_t __n )  __attribute__((__pure__)) ;
#line 413
extern  __attribute__((__nothrow__)) char *( __attribute__((__leaf__)) strerror)(int __errnum ) ;
#line 50 "/usr/include/x86_64-linux-gnu/bits/errno.h"
extern  __attribute__((__nothrow__)) int *( __attribute__((__leaf__)) __errno_location)(void)  __attribute__((__const__)) ;
#line 45 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
static char *input_file  =    (char *)0;
#line 45 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
static char *output_file  =    (char *)0;
#line 48 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
char const   ISO_9660_START[8]  = 
#line 48
  {      (char const   )(char)1,      (char const   )(char)67,      (char const   )(char)68,      (char const   )(char)48, 
        (char const   )(char)48,      (char const   )(char)49,      (char const   )(char)1,      (char const   )(char)0};
#line 59 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
char const   ISO_9660[8]  = 
#line 59
  {      (char const   )(char)2,      (char const   )(char)67,      (char const   )(char)68,      (char const   )(char)48, 
        (char const   )(char)48,      (char const   )(char)49,      (char const   )(char)1,      (char const   )(char)0};
#line 70 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
char const   ISO_9660_END[8]  = 
#line 70
  {      (char const   )(char)-1,      (char const   )(char)67,      (char const   )(char)68,      (char const   )(char)48, 
        (char const   )(char)48,      (char const   )(char)49,      (char const   )(char)1,      (char const   )(char)0};
#line 82 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
char const   SYNC_RAW[12]  = 
#line 82
  {      (char const   )(char)0,      (char const   )(char)-1,      (char const   )(char)-1,      (char const   )(char)-1, 
        (char const   )(char)-1,      (char const   )(char)-1,      (char const   )(char)-1,      (char const   )(char)-1, 
        (char const   )(char)-1,      (char const   )(char)-1,      (char const   )(char)-1,      (char const   )(char)0};
#line 97 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
char const   SYNC_RAW_2[8]  = 
#line 97
  {      (char const   )(char)0,      (char const   )(char)0,      (char const   )(char)8,      (char const   )(char)0, 
        (char const   )(char)0,      (char const   )(char)0,      (char const   )(char)8,      (char const   )(char)0};
#line 109 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
long img_size  ;
#line 110 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
int img_detect  =    2;
#line 112 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
int img_header  =    0;
#line 113 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
int img_ecc  =    0;
#line 114 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
int img_size_sector  =    0;
#line 115 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
int img_offset  ;
#line 119 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
FILE *fsource  ;
#line 119 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
FILE *fdest  ;
#line 122 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
int previous_percent  =    -1;
#line 123 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
void main_percent(int percent_bar ) 
{ 
  int tmp ;
  int tmp___0 ;

  {
#line 128
  if (percent_bar == previous_percent) {
#line 128
    return;
  }
  {
#line 130
  tmp = fileno(stderr);
#line 130
  tmp___0 = isatty(tmp);
  }
#line 130
  if (tmp___0) {
    {
#line 132
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"\r%3d%% [:%.*s>%.*s:]",
            percent_bar, percent_bar / 5, "====================", 20 - percent_bar / 5,
            "                    ");
    }
  } else {
#line 142
    if (previous_percent == -1) {
      {
#line 142
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Working ");
      }
    }
#line 143
    if ((percent_bar / 5) * 5 == percent_bar) {
      {
#line 143
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)".");
      }
    }
  }
#line 145
  previous_percent = percent_bar;
#line 146
  return;
}
}
#line 149 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
void usage(void) 
{ 


  {
  {
#line 152
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Web     : http://developer.berlios.de/projects/iat\n");
#line 153
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Email   : salvatore.santagati@gmail.com\n");
#line 154
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Irc     : irc.freenode.net #ignus\n\n");
#line 156
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Usage   : ");
#line 157
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"iat  input_file [output_file.iso]\n\n");
#line 158
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"\tIf output file name is not defined, \n\tthen stdout will be used instead.\n");
#line 165
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"\nOptions :\n");
#line 166
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"\t-h    \t\tDisplay this notice\n\n");
  }
#line 167
  return;
}
}
#line 171 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
int image_convert(void) 
{ 
  long source_length ;
  long i ;
  char buf[2448] ;
  long tmp ;
  int *tmp___0 ;
  char *tmp___1 ;
  size_t tmp___2 ;
  int *tmp___3 ;
  char *tmp___4 ;
  size_t tmp___5 ;
  int tmp___6 ;
  int tmp___7 ;

  {
  {
#line 178
  fseek(fsource, 0L, 2);
#line 179
  tmp = ftell(fsource);
#line 179
  source_length = (tmp - (long )img_offset) / (long )img_size_sector;
#line 182
  fseek(fsource, (long )img_offset, 0);
#line 185
  i = 0L;
  }
  {
#line 185
  while (1) {
    while_continue: /* CIL Label */ ;
#line 185
    if (! (i < source_length)) {
#line 185
      goto while_break;
    }
    {
#line 188
    main_percent((int )((i * 100L) / source_length));
#line 190
    fseek(fsource, (long )img_header, 1);
#line 191
    tmp___2 = fread((void */* __restrict  */)(buf), sizeof(char ), (size_t )2048,
                    (FILE */* __restrict  */)fsource);
    }
#line 191
    if (! tmp___2) {
      {
#line 195
      tmp___0 = __errno_location();
#line 195
      tmp___1 = strerror(*tmp___0);
#line 195
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s\n",
              tmp___1);
#line 196
      exit(1);
      }
    }
    {
#line 198
    tmp___5 = fwrite((void const   */* __restrict  */)(buf), sizeof(char ), (size_t )2048,
                     (FILE */* __restrict  */)fdest);
    }
#line 198
    if (! tmp___5) {
      {
#line 202
      tmp___3 = __errno_location();
#line 202
      tmp___4 = strerror(*tmp___3);
#line 202
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s\n",
              tmp___4);
#line 203
      exit(1);
      }
    }
    {
#line 205
    fseek(fsource, (long )img_ecc, 1);
#line 185
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 208
  tmp___6 = fileno(stderr);
#line 208
  tmp___7 = isatty(tmp___6);
  }
#line 208
  if (tmp___7) {
    {
#line 209
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"\rDone                           \n");
    }
  } else {
    {
#line 211
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)" Done\n");
    }
  }
#line 212
  return (0);
}
}
#line 216 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
int image_detection(void) 
{ 
  char buf[8] ;
  char raw[12] ;
  int i ;
  int block_image_start ;
  int block_image_end ;
  int block_image_temp ;
  int block_image ;
  int block_image_detect ;
  int img_header_temp ;
  int raw_2_check ;
  int raw_check ;
  long tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  int tmp___3 ;
  int tmp___4 ;

  {
  {
#line 221
  block_image_start = 0;
#line 222
  block_image_end = 0;
#line 223
  block_image_temp = 0;
#line 224
  block_image = 0;
#line 225
  block_image_detect = 0;
#line 226
  img_header_temp = 0;
#line 227
  raw_2_check = 0;
#line 228
  raw_check = 0;
#line 231
  fseek(fsource, 0L, 2);
#line 232
  tmp = ftell(fsource);
#line 232
  img_size = tmp / 8L;
#line 233
  i = 0;
  }
  {
#line 233
  while (1) {
    while_continue: /* CIL Label */ ;
#line 233
    if (! (img_detect == 2)) {
#line 233
      goto while_break;
    }
    {
#line 235
    fseek(fsource, 0L, 0);
#line 236
    fseek(fsource, (long )i, 1);
#line 237
    fread((void */* __restrict  */)(buf), sizeof(char ), (size_t )8, (FILE */* __restrict  */)fsource);
#line 238
    fread((void */* __restrict  */)(raw), sizeof(char ), (size_t )12, (FILE */* __restrict  */)fsource);
#line 240
    tmp___0 = memcmp((void const   *)(ISO_9660_START), (void const   *)(buf), (size_t )8);
    }
#line 240
    if (! tmp___0) {
      {
#line 242
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Detect Signature ISO9660 START at %d\n",
              i);
      }
#line 243
      if (block_image_start == 0) {
#line 243
        block_image_start = i;
      }
    }
    {
#line 245
    tmp___1 = memcmp((void const   *)(ISO_9660), (void const   *)(buf), (size_t )8);
    }
#line 245
    if (! tmp___1) {
      {
#line 247
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Detect Signature ISO9660 at %d\n",
              i);
      }
#line 248
      if (block_image_end == 0) {
#line 250
        block_image_end = i;
#line 251
        block_image_temp = block_image_end - block_image_start;
      }
#line 254
      img_detect ++;
    }
    {
#line 257
    tmp___2 = memcmp((void const   *)(ISO_9660_END), (void const   *)(buf), (size_t )8);
    }
#line 257
    if (! tmp___2) {
      {
#line 259
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Detect Signature ISO9660 END at %d\n",
              i);
      }
#line 260
      if (block_image_end == 0) {
#line 262
        block_image_end = i;
#line 263
        block_image_temp = block_image_end - block_image_start;
      }
#line 265
      img_detect ++;
    }
    {
#line 269
    tmp___3 = memcmp((void const   *)(SYNC_RAW_2), (void const   *)(buf), (size_t )8);
    }
#line 269
    if (! tmp___3) {
      {
#line 271
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Detect Signature RAW 2 at %d\n",
              i);
      }
#line 272
      if (raw_2_check == 0) {
#line 274
        img_header += 8;
#line 275
        raw_2_check = 1;
      }
    }
    {
#line 279
    tmp___4 = memcmp((void const   *)(SYNC_RAW), (void const   *)(raw), (size_t )12);
    }
#line 279
    if (! tmp___4) {
      {
#line 281
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Detect Signature RAW at %d\n",
              i);
      }
#line 282
      if (raw_check == 0) {
#line 284
        img_header += 16;
#line 285
        raw_check = 1;
      }
    }
#line 290
    if (img_size * 8L <= (long )i) {
      {
#line 292
      img_detect = -1;
#line 293
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Image is broken\n");
      }
#line 294
      return (0);
    }
#line 233
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 300
  block_image_detect = 1;
  {
#line 300
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 300
    if (! (block_image_detect == 1)) {
#line 300
      goto while_break___0;
    }
#line 302
    if (block_image_temp >= 2048) {
      {
#line 306
      if (block_image_temp == 2048) {
#line 306
        goto case_2048;
      }
#line 309
      if (block_image_temp == 2352) {
#line 309
        goto case_2352;
      }
#line 313
      if (block_image_temp == 2336) {
#line 313
        goto case_2336;
      }
#line 317
      if (block_image_temp == 2448) {
#line 317
        goto case_2448;
      }
#line 321
      goto switch_default;
      case_2048: /* CIL Label */ 
#line 306
      block_image = block_image_temp;
#line 307
      block_image_detect ++;
#line 308
      goto switch_break;
      case_2352: /* CIL Label */ 
#line 310
      block_image = block_image_temp;
#line 311
      block_image_detect ++;
#line 312
      goto switch_break;
      case_2336: /* CIL Label */ 
#line 314
      block_image = block_image_temp;
#line 315
      block_image_detect ++;
#line 316
      goto switch_break;
      case_2448: /* CIL Label */ 
#line 318
      block_image = block_image_temp;
#line 319
      block_image_detect ++;
#line 320
      goto switch_break;
      switch_default: /* CIL Label */ 
#line 322
      goto switch_break;
      switch_break: /* CIL Label */ ;
      }
    } else {
#line 327
      block_image_detect = -1;
    }
#line 300
    block_image_temp /= 2;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 331
  if (! (block_image_detect == -1)) {
#line 333
    img_size_sector = block_image;
  }
#line 337
  img_header_temp = block_image_start - block_image * 16;
#line 339
  if (img_header_temp == 8) {
#line 341
    img_header = img_header_temp;
  } else
#line 339
  if (img_header_temp == 16) {
#line 341
    img_header = img_header_temp;
  } else
#line 339
  if (img_header_temp == 24) {
#line 341
    img_header = img_header_temp;
  }
  {
#line 347
  img_ecc = (block_image - img_header) - 2048;
#line 352
  img_offset = (block_image_start - block_image * 16) - img_header;
#line 355
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"\n Image offset start at %d",
          img_offset);
#line 356
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"\n Sector header %d bit",
          img_header);
#line 357
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"\n Sector ECC %d bit",
          img_ecc);
#line 358
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"\n Block %d\n",
          block_image);
  }
#line 360
  return (1);
}
}
#line 364 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
void parse_options(int argc , char **argv ) 
{ 
  int c ;

  {
  {
#line 368
  c = getopt(argc, (char * const  *)argv, "h");
  }
  {
#line 368
  while (1) {
    while_continue: /* CIL Label */ ;
#line 368
    if (! (c != -1)) {
#line 368
      goto while_break;
    }
    {
#line 374
    if (c == 104) {
#line 374
      goto case_104;
    }
#line 378
    if (c == 63) {
#line 378
      goto case_63;
    }
#line 381
    goto switch_default;
    case_104: /* CIL Label */ 
    {
#line 375
    usage();
#line 376
    exit(0);
    }
    case_63: /* CIL Label */ 
#line 379
    goto switch_break;
    switch_default: /* CIL Label */ 
    {
#line 382
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"?? getopt returned character code 0%o ??\n",
            c);
    }
    switch_break: /* CIL Label */ ;
    }
    {
#line 368
    c = getopt(argc, (char * const  *)argv, "h");
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 387
  if (argc - optind < 1) {
    {
#line 389
    usage();
#line 390
    exit(1);
    }
  } else
#line 387
  if (argc - optind > 2) {
    {
#line 389
    usage();
#line 390
    exit(1);
    }
  }
#line 393
  input_file = *(argv + optind);
#line 394
  if (argc - optind == 2) {
#line 394
    output_file = *(argv + (optind + 1));
  }
#line 395
  return;
}
}
#line 398 "/home/june/repo/benchmarks/collector/temp/iat-0.1.3/src/iat.c"
int main(int argc , char **argv ) 
{ 
  int *tmp ;
  char *tmp___0 ;
  int tmp___1 ;
  int *tmp___2 ;
  char *tmp___3 ;

  {
  {
#line 400
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Iso9660 Analyzer Tool v%s by Salvatore Santagati\n",
          "0.1.3");
#line 402
  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Licensed under GPL v2 or later\n\n");
#line 404
  parse_options(argc, argv);
#line 406
  fsource = fopen((char const   */* __restrict  */)input_file, (char const   */* __restrict  */)"rb");
  }
#line 406
  if ((unsigned long )fsource != (unsigned long )((void *)0)) {
    {
#line 408
    tmp___1 = image_detection();
    }
#line 408
    if (tmp___1 == 0) {
      {
#line 410
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"This image is not CD IMAGE\n");
#line 411
      exit(1);
      }
    } else {
#line 415
      if (output_file) {
        {
#line 417
        fdest = fopen((char const   */* __restrict  */)output_file, (char const   */* __restrict  */)"wb");
        }
#line 417
        if (! fdest) {
          {
#line 419
          tmp = __errno_location();
#line 419
          tmp___0 = strerror(*tmp);
#line 419
          fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s\n",
                  tmp___0);
#line 420
          usage();
#line 421
          exit(1);
          }
        }
      } else {
#line 426
        fdest = stdout;
      }
      {
#line 428
      image_convert();
#line 429
      fclose(fdest);
      }
    }
  } else {
    {
#line 434
    tmp___2 = __errno_location();
#line 434
    tmp___3 = strerror(*tmp___2);
#line 434
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s\n",
            tmp___3);
#line 435
    usage();
#line 436
    exit(1);
    }
  }
#line 439
  return (0);
}
}
