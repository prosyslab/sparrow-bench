/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is false */

#line 212 "/usr/lib/gcc/x86_64-linux-gnu/4.8/include/stddef.h"
typedef unsigned long size_t;
#line 124 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned long __dev_t;
#line 125 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned int __uid_t;
#line 126 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned int __gid_t;
#line 127 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned long __ino_t;
#line 129 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned int __mode_t;
#line 130 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned long __nlink_t;
#line 131 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off_t;
#line 132 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off64_t;
#line 133 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef int __pid_t;
#line 139 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __time_t;
#line 153 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __blksize_t;
#line 158 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __blkcnt_t;
#line 175 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __syscall_slong_t;
#line 44 "/usr/include/stdio.h"
struct _IO_FILE;
#line 44
struct _IO_FILE;
#line 48 "/usr/include/stdio.h"
typedef struct _IO_FILE FILE;
#line 144 "/usr/include/libio.h"
struct _IO_FILE;
#line 154 "/usr/include/libio.h"
typedef void _IO_lock_t;
#line 160 "/usr/include/libio.h"
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
#line 245 "/usr/include/libio.h"
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15UL * sizeof(int ) - 4UL * sizeof(void *)) - sizeof(size_t )] ;
};
#line 61 "/usr/include/signal.h"
typedef __pid_t pid_t;
#line 67 "/usr/include/signal.h"
typedef __uid_t uid_t;
#line 120 "/usr/include/time.h"
struct timespec {
   __time_t tv_sec ;
   __syscall_slong_t tv_nsec ;
};
#line 75 "/usr/include/time.h"
typedef __time_t time_t;
#line 196 "/usr/include/x86_64-linux-gnu/sys/types.h"
typedef int int32_t;
#line 46 "/usr/include/x86_64-linux-gnu/bits/stat.h"
struct stat {
   __dev_t st_dev ;
   __ino_t st_ino ;
   __nlink_t st_nlink ;
   __mode_t st_mode ;
   __uid_t st_uid ;
   __gid_t st_gid ;
   int __pad0 ;
   __dev_t st_rdev ;
   __off_t st_size ;
   __blksize_t st_blksize ;
   __blkcnt_t st_blocks ;
   struct timespec st_atim ;
   struct timespec st_mtim ;
   struct timespec st_ctim ;
   __syscall_slong_t __glibc_reserved[3] ;
};
#line 50 "/usr/include/x86_64-linux-gnu/bits/utmp.h"
struct exit_status {
   short e_termination ;
   short e_exit ;
};
#line 58 "/usr/include/x86_64-linux-gnu/bits/utmp.h"
struct __anonstruct_ut_tv_42 {
   int32_t tv_sec ;
   int32_t tv_usec ;
};
#line 58 "/usr/include/x86_64-linux-gnu/bits/utmp.h"
struct utmp {
   short ut_type ;
   pid_t ut_pid ;
   char ut_line[32] ;
   char ut_id[4] ;
   char ut_user[32] ;
   char ut_host[256] ;
   struct exit_status ut_exit ;
   int32_t ut_session ;
   struct __anonstruct_ut_tv_42 ut_tv ;
   int32_t ut_addr_v6[4] ;
   char __glibc_reserved[20] ;
};
#line 49 "/usr/include/pwd.h"
struct passwd {
   char *pw_name ;
   char *pw_passwd ;
   __uid_t pw_uid ;
   __gid_t pw_gid ;
   char *pw_gecos ;
   char *pw_dir ;
   char *pw_shell ;
};
#line 42 "/usr/include/grp.h"
struct group {
   char *gr_name ;
   char *gr_passwd ;
   __gid_t gr_gid ;
   char **gr_mem ;
};
#line 95 "/home/june/collector/temp/autolog-0.40/autolog.c"
struct __anonstruct_userdata_45 {
   char Name[20] ;
   char Device[20] ;
   uid_t UserID ;
   int IdleTime ;
   int SessStrt ;
   int Ban_Ends ;
   int WarnEnds ;
};
#line 95 "/home/june/collector/temp/autolog-0.40/autolog.c"
typedef struct __anonstruct_userdata_45 userdata;
#line 126 "/home/june/collector/temp/autolog-0.40/autolog.c"
struct conf {
   char *name ;
   char *group ;
   char *line ;
   int idle ;
   int grace ;
   int ban ;
   int hard ;
   int mail ;
   int clear ;
   int warn ;
   int log ;
};
#line 126 "/home/june/collector/temp/autolog-0.40/autolog.c"
typedef struct conf conf_el;
#line 170 "/usr/include/stdio.h"
extern struct _IO_FILE *stderr ;
#line 237
extern int fclose(FILE *__stream ) ;
#line 272
extern FILE *fopen(char const   * __restrict  __filename , char const   * __restrict  __modes ) ;
#line 356
extern int fprintf(FILE * __restrict  __stream , char const   * __restrict  __format 
                   , ...) ;
#line 362
extern int printf(char const   * __restrict  __format  , ...) ;
#line 364
extern  __attribute__((__nothrow__)) int sprintf(char * __restrict  __s , char const   * __restrict  __format 
                                                 , ...) ;
#line 386
extern  __attribute__((__nothrow__)) int ( /* format attribute */  snprintf)(char * __restrict  __s ,
                                                                             size_t __maxlen ,
                                                                             char const   * __restrict  __format 
                                                                             , ...) ;
#line 425
extern int fscanf(FILE * __restrict  __stream , char const   * __restrict  __format 
                  , ...)  __asm__("__isoc99_fscanf")  ;
#line 622
extern char *fgets(char * __restrict  __s , int __n , FILE * __restrict  __stream ) ;
#line 873
extern FILE *popen(char const   *__command , char const   *__modes ) ;
#line 127 "/usr/include/signal.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) kill)(__pid_t __pid ,
                                                                           int __sig ) ;
#line 129 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strcpy)(char * __restrict  __dest ,
                                                                                                 char const   * __restrict  __src ) ;
#line 132
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strncpy)(char * __restrict  __dest ,
                                                                                                  char const   * __restrict  __src ,
                                                                                                  size_t __n ) ;
#line 144
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,2), __leaf__)) strcmp)(char const   *__s1 ,
                                                                                               char const   *__s2 )  __attribute__((__pure__)) ;
#line 147
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,2), __leaf__)) strncmp)(char const   *__s1 ,
                                                                                                char const   *__s2 ,
                                                                                                size_t __n )  __attribute__((__pure__)) ;
#line 342
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strstr)(char const   *__haystack ,
                                                                                                 char const   *__needle )  __attribute__((__pure__)) ;
#line 348
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(2), __leaf__)) strtok)(char * __restrict  __s ,
                                                                                               char const   * __restrict  __delim ) ;
#line 399
extern  __attribute__((__nothrow__)) size_t ( __attribute__((__nonnull__(1), __leaf__)) strlen)(char const   *__s )  __attribute__((__pure__)) ;
#line 209 "/usr/include/x86_64-linux-gnu/sys/stat.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,2), __leaf__)) stat)(char const   * __restrict  __file ,
                                                                                             struct stat * __restrict  __buf ) ;
#line 62 "/usr/include/utmp.h"
extern  __attribute__((__nothrow__)) struct utmp *( __attribute__((__leaf__)) getutent)(void) ;
#line 65
extern  __attribute__((__nothrow__)) void ( __attribute__((__leaf__)) setutent)(void) ;
#line 192 "/usr/include/time.h"
extern  __attribute__((__nothrow__)) time_t ( __attribute__((__leaf__)) time)(time_t *__timer ) ;
#line 264
extern  __attribute__((__nothrow__)) char *( __attribute__((__leaf__)) ctime)(time_t const   *__timer ) ;
#line 110 "/usr/include/pwd.h"
extern struct passwd *getpwuid(__uid_t __uid ) ;
#line 116
extern struct passwd *getpwnam(char const   *__name ) ;
#line 105 "/usr/include/grp.h"
extern struct group *getgrgid(__gid_t __gid ) ;
#line 38 "/usr/include/malloc.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) malloc)(size_t __size )  __attribute__((__malloc__)) ;
#line 41
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) calloc)(size_t __nmemb ,
                                                                               size_t __size )  __attribute__((__malloc__)) ;
#line 49
extern  __attribute__((__nothrow__)) void *( __attribute__((__warn_unused_result__,
__leaf__)) realloc)(void *__ptr , size_t __size ) ;
#line 53
extern  __attribute__((__nothrow__)) void ( __attribute__((__leaf__)) free)(void *__ptr ) ;
#line 107 "/home/june/collector/temp/autolog-0.40/autolog.c"
struct utmp *utmpp  ;
#line 108 "/home/june/collector/temp/autolog-0.40/autolog.c"
char delims[4]  = {      (char )'\n',      (char )'\t',      (char )' ',      (char )'\000'};
#line 109 "/home/june/collector/temp/autolog-0.40/autolog.c"
char anystrg[3]  = {      (char )'.',      (char )'+',      (char )'\000'};
#line 111 "/home/june/collector/temp/autolog-0.40/autolog.c"
int debug  =    0;
#line 112 "/home/june/collector/temp/autolog-0.40/autolog.c"
int resist  =    1;
#line 113 "/home/june/collector/temp/autolog-0.40/autolog.c"
int do_bite  =    1;
#line 114 "/home/june/collector/temp/autolog-0.40/autolog.c"
int listall  =    0;
#line 115 "/home/june/collector/temp/autolog-0.40/autolog.c"
char *confname  =    (char *)"/etc/autolog.conf";
#line 116 "/home/june/collector/temp/autolog-0.40/autolog.c"
char *logfname  =    (char *)"/var/log/autolog.log";
#line 117 "/home/june/collector/temp/autolog-0.40/autolog.c"
char *datfname  =    (char *)"/var/lib/autolog/autolog.data";
#line 118 "/home/june/collector/temp/autolog-0.40/autolog.c"
int g_idle  =    30;
#line 119 "/home/june/collector/temp/autolog-0.40/autolog.c"
int g_grace  =    120;
#line 120 "/home/june/collector/temp/autolog-0.40/autolog.c"
int g_hard  =    0;
#line 121 "/home/june/collector/temp/autolog-0.40/autolog.c"
int g_mail  =    1;
#line 122 "/home/june/collector/temp/autolog-0.40/autolog.c"
int g_clear  =    0;
#line 123 "/home/june/collector/temp/autolog-0.40/autolog.c"
int g_warn  =    1;
#line 124 "/home/june/collector/temp/autolog-0.40/autolog.c"
int g_log  =    1;
#line 140 "/home/june/collector/temp/autolog-0.40/autolog.c"
conf_el c_arr[512]  ;
#line 142 "/home/june/collector/temp/autolog-0.40/autolog.c"
int sleeptime  =    1800;
#line 143 "/home/june/collector/temp/autolog-0.40/autolog.c"
int sleep_max  =    1800;
#line 144 "/home/june/collector/temp/autolog-0.40/autolog.c"
int c_idx  =    0;
#line 146 "/home/june/collector/temp/autolog-0.40/autolog.c"
int userfill  =    0;
#line 147 "/home/june/collector/temp/autolog-0.40/autolog.c"
int usermax  =    0;
#line 148 "/home/june/collector/temp/autolog-0.40/autolog.c"
userdata *userlst  ;
#line 150 "/home/june/collector/temp/autolog-0.40/autolog.c"
int ids_fill  ;
#line 151 "/home/june/collector/temp/autolog-0.40/autolog.c"
int ids_max  ;
#line 152 "/home/june/collector/temp/autolog-0.40/autolog.c"
int *ids_lst  ;
#line 155 "/home/june/collector/temp/autolog-0.40/autolog.c"
time_t pres_time  ;
#line 156 "/home/june/collector/temp/autolog-0.40/autolog.c"
time_t chck_pid  =    (time_t )0;
#line 157 "/home/june/collector/temp/autolog-0.40/autolog.c"
int lostkill  =    1;
#line 159 "/home/june/collector/temp/autolog-0.40/autolog.c"
char *ps_cmd  ;
#line 166
extern int ( /* missing proto */  tolower)() ;
#line 176
extern int ( /* missing proto */  atoi)() ;
#line 191
int log_msg(char *message ) ;
#line 192
int eat_confile(void) ;
#line 194
extern int ( /* missing proto */  exit)() ;
#line 194
extern int ( /* missing proto */  fork)() ;
#line 202
int load_users(void) ;
#line 207
int show_results(void) ;
#line 219
int check_utmp(void) ;
#line 223
int check_idle(userdata *akt_usr ) ;
#line 234
int kill_lost_PIDs(void) ;
#line 246
extern int ( /* missing proto */  sleep)() ;
#line 249
int save_users(void) ;
#line 161 "/home/june/collector/temp/autolog-0.40/autolog.c"
int main(int argc , char **argv ) 
{ 
  int i ;
  int tmp ;
  int tmp___0 ;
  void *tmp___1 ;
  int tmp___2 ;

  {
#line 164
  i = 1;
  {
#line 164
  while (1) {
    while_continue: /* CIL Label */ ;
#line 164
    if (! (i < argc)) {
#line 164
      goto while_break;
    }
#line 165
    if ((int )*(*(argv + i) + 0) == 45) {
      {
#line 166
      tmp = tolower((int )*(*(argv + i) + 1));
      }
      {
#line 167
      if (tmp == 114) {
#line 167
        goto case_114;
      }
#line 168
      if (tmp == 111) {
#line 168
        goto case_111;
      }
#line 169
      if (tmp == 97) {
#line 169
        goto case_97;
      }
#line 170
      if (tmp == 98) {
#line 170
        goto case_98;
      }
#line 171
      if (tmp == 100) {
#line 171
        goto case_100;
      }
#line 172
      if (tmp == 104) {
#line 172
        goto case_104;
      }
#line 173
      if (tmp == 110) {
#line 173
        goto case_110;
      }
#line 174
      if (tmp == 108) {
#line 174
        goto case_108;
      }
#line 175
      if (tmp == 102) {
#line 175
        goto case_102;
      }
#line 176
      if (tmp == 116) {
#line 176
        goto case_116;
      }
#line 177
      if (tmp == 103) {
#line 177
        goto case_103;
      }
#line 178
      if (tmp == 109) {
#line 178
        goto case_109;
      }
#line 179
      if (tmp == 99) {
#line 179
        goto case_99;
      }
#line 180
      if (tmp == 119) {
#line 180
        goto case_119;
      }
#line 181
      if (tmp == 76) {
#line 181
        goto case_76;
      }
#line 182
      goto switch_default;
      case_114: /* CIL Label */ 
#line 167
      resist = 1;
#line 167
      goto switch_break;
      case_111: /* CIL Label */ 
#line 168
      resist = 0;
#line 168
      goto switch_break;
      case_97: /* CIL Label */ 
#line 169
      listall = 1;
#line 169
      goto switch_break;
      case_98: /* CIL Label */ 
#line 170
      do_bite = 0;
#line 170
      goto switch_break;
      case_100: /* CIL Label */ 
#line 171
      debug = 1;
#line 171
      goto switch_break;
      case_104: /* CIL Label */ 
#line 172
      g_hard = 1;
#line 172
      goto switch_break;
      case_110: /* CIL Label */ 
#line 173
      do_bite = 0;
#line 173
      goto switch_break;
      case_108: /* CIL Label */ 
#line 174
      i ++;
#line 174
      logfname = *(argv + i);
#line 174
      goto switch_break;
      case_102: /* CIL Label */ 
#line 175
      i ++;
#line 175
      confname = *(argv + i);
#line 175
      goto switch_break;
      case_116: /* CIL Label */ 
      {
#line 176
      i ++;
#line 176
      g_idle = atoi(*(argv + i));
      }
#line 176
      goto switch_break;
      case_103: /* CIL Label */ 
      {
#line 177
      i ++;
#line 177
      g_grace = atoi(*(argv + i));
      }
#line 177
      goto switch_break;
      case_109: /* CIL Label */ 
#line 178
      i ++;
#line 178
      g_mail = (int )*(*(argv + i) + 0) == 121;
#line 178
      goto switch_break;
      case_99: /* CIL Label */ 
#line 179
      i ++;
#line 179
      g_clear = (int )*(*(argv + i) + 0) == 121;
#line 179
      goto switch_break;
      case_119: /* CIL Label */ 
#line 180
      i ++;
#line 180
      g_warn = (int )*(*(argv + i) + 0) == 121;
#line 180
      goto switch_break;
      case_76: /* CIL Label */ 
#line 181
      i ++;
#line 181
      g_log = (int )*(*(argv + i) + 0) == 121;
#line 181
      goto switch_break;
      switch_default: /* CIL Label */ 
      {
#line 183
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"autologout: illegal switch: %s\n",
              *(argv + i));
      }
      switch_break: /* CIL Label */ ;
      }
    } else {
      {
#line 186
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"autologout: illegal parameter: %s\n",
              *(argv + i));
      }
    }
#line 164
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 188
  ps_cmd = (char *)"ps aux";
#line 190
  time(& pres_time);
#line 191
  log_msg("Starting Service");
#line 192
  eat_confile();
  }
#line 193
  if (! debug) {
    {
#line 194
    tmp___0 = fork();
    }
#line 194
    if (tmp___0) {
      {
#line 194
      exit(0);
      }
    }
  }
  {
#line 198
  userfill = 0;
#line 199
  usermax = 8;
#line 200
  tmp___1 = calloc(sizeof(userdata ), (size_t )(1 + usermax));
#line 200
  userlst = (userdata *)tmp___1;
#line 202
  load_users();
  }
#line 203
  if (debug) {
    {
#line 204
    printf((char const   */* __restrict  */)"\n");
#line 205
    printf((char const   */* __restrict  */)"From the datafile:\n");
#line 206
    printf((char const   */* __restrict  */)"==================\n");
#line 207
    show_results();
#line 208
    printf((char const   */* __restrict  */)"Done reading datafile\n");
    }
  }
  {
#line 212
  while (1) {
    while_continue___0: /* CIL Label */ ;
    {
#line 213
    time(& pres_time);
#line 214
    sleeptime = sleep_max;
#line 215
    setutent();
    }
#line 216
    if (debug) {
      {
#line 217
      printf((char const   */* __restrict  */)"\n");
      }
    }
    {
#line 218
    while (1) {
      while_continue___1: /* CIL Label */ ;
      {
#line 218
      utmpp = getutent();
      }
#line 218
      if (! ((unsigned long )utmpp != (unsigned long )((struct utmp *)((void *)0)))) {
#line 218
        goto while_break___1;
      }
      {
#line 219
      check_utmp();
      }
    }
    while_break___1: /* CIL Label */ ;
    }
#line 220
    if (debug) {
      {
#line 221
      show_results();
      }
    }
#line 222
    i = 1;
    {
#line 222
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 222
      if (! (i <= userfill)) {
#line 222
        goto while_break___2;
      }
      {
#line 223
      tmp___2 = check_idle(userlst + i);
      }
#line 223
      if (tmp___2 == 2) {
#line 224
        if (debug) {
          {
#line 224
          printf((char const   */* __restrict  */)"knock out.\n");
          }
        }
#line 225
        *(userlst + i) = *(userlst + userfill);
#line 226
        userfill --;
      }
#line 222
      i ++;
    }
    while_break___2: /* CIL Label */ ;
    }
#line 231
    if (lostkill) {
#line 231
      if (pres_time > chck_pid) {
#line 232
        if (debug) {
          {
#line 233
          printf((char const   */* __restrict  */)"check for dead processes.\n");
          }
        }
        {
#line 234
        kill_lost_PIDs();
#line 235
        chck_pid = pres_time + 600L;
        }
#line 237
        if (debug) {
          {
#line 238
          printf((char const   */* __restrict  */)"next check for processes after %10d.\n",
                 chck_pid);
          }
        }
      }
    }
#line 241
    if (debug) {
      {
#line 243
      printf((char const   */* __restrict  */)"daemons maximum sleeptime %7d seconds, today.\n",
             sleep_max);
#line 244
      printf((char const   */* __restrict  */)"daemon is falling asleep for%5d seconds, now.\n",
             sleeptime);
      }
    }
#line 246
    if (resist) {
      {
#line 246
      sleep(sleeptime);
      }
    } else
#line 246
    if (sleeptime < sleep_max) {
      {
#line 246
      sleep(sleeptime);
      }
    }
#line 212
    if (! resist) {
#line 212
      if (! (sleeptime < sleep_max)) {
#line 212
        goto while_break___0;
      }
    }
  }
  while_break___0: /* CIL Label */ ;
  }
  {
#line 249
  save_users();
#line 250
  log_msg("Stopped service");
  }
#line 251
  return (0);
}
}
#line 284
int bailout(char *message , int status ) ;
#line 259 "/home/june/collector/temp/autolog-0.40/autolog.c"
int check_utmp(void) 
{ 
  char dev[64] ;
  char name[64] ;
  char prname[64] ;
  char *msg ;
  char tmp_str[80] ;
  struct stat status ;
  time_t idle ;
  time_t atime ;
  int userpos ;
  int tmp ;
  char *tmp___0 ;
  size_t tmp___1 ;
  int tmp___2 ;
  char *tmp___3 ;
  int tmp___4 ;
  void *tmp___5 ;

  {
  {
#line 267
  userpos = 0;
#line 269
  sprintf((char */* __restrict  */)(prname), (char const   */* __restrict  */)"/proc/%d",
          utmpp->ut_pid);
#line 270
  sprintf((char */* __restrict  */)(dev), (char const   */* __restrict  */)"/dev/%s",
          utmpp->ut_line);
#line 271
  msg = (char *)"";
#line 274
  tmp = stat((char const   */* __restrict  */)(prname), (struct stat */* __restrict  */)(& status));
  }
#line 274
  if (tmp) {
#line 274
    msg = (char *)"Dead process:    ";
  }
#line 275
  if ((int )utmpp->ut_type != 7) {
#line 275
    msg = (char *)"Non-user process:";
  }
  {
#line 276
  tmp___1 = strlen((char const   *)msg);
  }
#line 276
  if (tmp___1) {
#line 277
    if (listall) {
      {
#line 278
      tmp___0 = ctime((time_t const   *)(& utmpp->ut_tv.tv_sec));
#line 278
      printf((char const   */* __restrict  */)"%s N:%-8s P:%5d Login:%s", msg, utmpp->ut_user,
             utmpp->ut_pid, tmp___0);
      }
    }
#line 280
    return (0);
  }
#line 282
  if ((int )dev[5] != 58) {
    {
#line 282
    tmp___2 = stat((char const   */* __restrict  */)(dev), (struct stat */* __restrict  */)(& status));
    }
#line 282
    if (tmp___2) {
      {
#line 283
      snprintf((char */* __restrict  */)(tmp_str), (size_t )79, (char const   */* __restrict  */)"Can\'t get status of user\'s terminal: %s",
               dev);
#line 284
      bailout(tmp_str, 1);
      }
#line 285
      return (0);
    }
  }
#line 289
  if ((__time_t )utmpp->ut_tv.tv_sec > status.st_atim.tv_sec) {
#line 290
    atime = (time_t )utmpp->ut_tv.tv_sec;
  } else {
#line 291
    atime = status.st_atim.tv_sec;
  }
  {
#line 292
  idle = (pres_time - atime) / 60L;
#line 295
  strncpy((char */* __restrict  */)(name), (char const   */* __restrict  */)(utmpp->ut_user),
          (size_t )32);
#line 296
  name[32] = (char )'\000';
  }
#line 298
  if (listall) {
    {
#line 299
    tmp___3 = ctime((time_t const   *)(& utmpp->ut_tv.tv_sec));
#line 299
    printf((char const   */* __restrict  */)"Checking: %-11s on %-12s I:%4d  T:%d Login: %s",
           name, dev, idle, (int )utmpp->ut_type, tmp___3);
    }
  }
  {
#line 302
  strcpy((char */* __restrict  */)((userlst + 0)->Name), (char const   */* __restrict  */)(name));
#line 303
  strcpy((char */* __restrict  */)((userlst + 0)->Device), (char const   */* __restrict  */)(utmpp->ut_line));
#line 304
  (userlst + 0)->IdleTime = (int )idle;
#line 307
  userpos = userfill;
  }
  {
#line 308
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 308
    tmp___4 = strcmp((char const   *)((userlst + userpos)->Name), (char const   *)(name));
    }
#line 308
    if (! tmp___4) {
#line 308
      goto while_break;
    }
#line 308
    userpos --;
  }
  while_break: /* CIL Label */ ;
  }
#line 311
  if (userpos == 0) {
#line 312
    userfill ++;
#line 313
    if (userfill > usermax) {
      {
#line 314
      usermax = 2 * usermax;
#line 315
      tmp___5 = realloc((void *)userlst, sizeof(userdata ) * (unsigned long )(1 + usermax));
#line 315
      userlst = (userdata *)tmp___5;
      }
    }
    {
#line 318
    strcpy((char */* __restrict  */)((userlst + userfill)->Name), (char const   */* __restrict  */)(name));
#line 319
    strcpy((char */* __restrict  */)((userlst + userfill)->Device), (char const   */* __restrict  */)(utmpp->ut_line));
#line 320
    (userlst + userfill)->IdleTime = (int )idle;
#line 321
    (userlst + userfill)->UserID = status.st_uid;
#line 322
    (userlst + userfill)->SessStrt = utmpp->ut_tv.tv_sec;
#line 323
    (userlst + userfill)->WarnEnds = 0;
    }
  } else {
#line 326
    if ((time_t )(userlst + userpos)->IdleTime > idle) {
      {
#line 327
      (userlst + userpos)->IdleTime = (int )idle;
#line 328
      strcpy((char */* __restrict  */)((userlst + userpos)->Device), (char const   */* __restrict  */)(utmpp->ut_line));
      }
    }
#line 330
    if ((userlst + userpos)->SessStrt > utmpp->ut_tv.tv_sec) {
#line 331
      (userlst + userpos)->SessStrt = utmpp->ut_tv.tv_sec;
    }
  }
#line 334
  return (0);
}
}
#line 336 "/home/june/collector/temp/autolog-0.40/autolog.c"
int show_results(void) 
{ 
  int userpos ;

  {
  {
#line 337
  userpos = 0;
#line 339
  printf((char const   */* __restrict  */)"\nfound: %2d\n\n", userfill);
#line 340
  printf((char const   */* __restrict  */)"     Username  UserID Terminal     idle Starttime  BanningEnd WarningEnd\n");
#line 342
  userpos = 1;
  }
  {
#line 342
  while (1) {
    while_continue: /* CIL Label */ ;
#line 342
    if (! (userpos <= userfill)) {
#line 342
      goto while_break;
    }
    {
#line 343
    printf((char const   */* __restrict  */)" -->  %-10s %4d  %-10s %5d %10d %10d %10d\n",
           (userlst + userpos)->Name, (userlst + userpos)->UserID, (userlst + userpos)->Device,
           (userlst + userpos)->IdleTime, (userlst + userpos)->SessStrt, (userlst + userpos)->Ban_Ends,
           (userlst + userpos)->WarnEnds);
#line 342
    userpos ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 349
  return (0);
}
}
#line 351 "/home/june/collector/temp/autolog-0.40/autolog.c"
int save_users(void) 
{ 
  int userpos ;
  FILE *f ;

  {
  {
#line 352
  userpos = 0;
#line 356
  f = fopen((char const   */* __restrict  */)datfname, (char const   */* __restrict  */)"w+");
  }
#line 356
  if (! f) {
    {
#line 357
    bailout("Can\'t create data-file.", 6);
    }
#line 358
    return;
  }
  {
#line 361
  fprintf((FILE */* __restrict  */)f, (char const   */* __restrict  */)"%d\n", userfill);
#line 363
  userpos = 1;
  }
  {
#line 363
  while (1) {
    while_continue: /* CIL Label */ ;
#line 363
    if (! (userpos <= userfill)) {
#line 363
      goto while_break;
    }
    {
#line 364
    fprintf((FILE */* __restrict  */)f, (char const   */* __restrict  */)" %-10s %4d %-10s %5d %10d %10d %10d\n",
            (userlst + userpos)->Name, (userlst + userpos)->UserID, (userlst + userpos)->Device,
            (userlst + userpos)->IdleTime, (userlst + userpos)->SessStrt, (userlst + userpos)->Ban_Ends,
            (userlst + userpos)->WarnEnds);
#line 363
    userpos ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 370
  fclose(f);
  }
#line 371
  return (0);
}
}
#line 373 "/home/june/collector/temp/autolog-0.40/autolog.c"
int load_users(void) 
{ 
  int userpos ;
  FILE *f ;
  void *tmp ;

  {
  {
#line 374
  userpos = 0;
#line 379
  f = fopen((char const   */* __restrict  */)datfname, (char const   */* __restrict  */)"r");
  }
#line 379
  if (! f) {
#line 379
    return;
  }
  {
#line 382
  fscanf((FILE */* __restrict  */)f, (char const   */* __restrict  */)"%d", & userfill);
  }
#line 385
  if (userfill > usermax) {
    {
#line 386
    usermax = 2 * userfill;
#line 387
    tmp = realloc((void *)userlst, sizeof(userdata ) * (unsigned long )(1 + usermax));
#line 387
    userlst = (userdata *)tmp;
    }
  }
#line 392
  userpos = 1;
  {
#line 392
  while (1) {
    while_continue: /* CIL Label */ ;
#line 392
    if (! (userpos <= userfill)) {
#line 392
      goto while_break;
    }
    {
#line 393
    fscanf((FILE */* __restrict  */)f, (char const   */* __restrict  */)" %s %d %s %d %d %d %d",
           & (userlst + userpos)->Name, & (userlst + userpos)->UserID, & (userlst + userpos)->Device,
           & (userlst + userpos)->IdleTime, & (userlst + userpos)->SessStrt, & (userlst + userpos)->Ban_Ends,
           & (userlst + userpos)->WarnEnds);
#line 392
    userpos ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 399
  fclose(f);
  }
#line 400
  return (0);
}
}
#line 406 "/home/june/collector/temp/autolog-0.40/autolog.c"
int set_defs(int i ) 
{ 


  {
#line 407
  c_arr[i].name = anystrg;
#line 408
  c_arr[i].group = anystrg;
#line 409
  c_arr[i].line = anystrg;
#line 410
  c_arr[i].idle = g_idle;
#line 411
  c_arr[i].ban = 0;
#line 412
  c_arr[i].grace = g_grace;
#line 413
  c_arr[i].hard = g_hard;
#line 414
  c_arr[i].mail = g_mail;
#line 415
  c_arr[i].clear = g_clear;
#line 416
  c_arr[i].warn = g_warn;
#line 417
  c_arr[i].log = g_log;
#line 418
  return (0);
}
}
#line 420 "/home/june/collector/temp/autolog-0.40/autolog.c"
int eat_confile(void) 
{ 
  FILE *f ;
  char *s ;
  char iline[256] ;
  int i ;
  int lev ;
  int idle ;
  size_t tmp ;
  size_t tmp___0 ;
  void *tmp___1 ;
  size_t tmp___2 ;
  void *tmp___3 ;
  size_t tmp___4 ;
  void *tmp___5 ;
  size_t tmp___6 ;
  void *tmp___7 ;
  int tmp___8 ;
  int tmp___9 ;
  int tmp___10 ;
  int tmp___11 ;
  int tmp___12 ;
  int tmp___13 ;
  int tmp___14 ;
  int tmp___15 ;
  int tmp___16 ;
  int tmp___17 ;
  int tmp___18 ;
  int tmp___19 ;
  char *tmp___20 ;
  int tmp___21 ;

  {
  {
#line 427
  f = fopen((char const   */* __restrict  */)confname, (char const   */* __restrict  */)"r");
  }
#line 427
  if (f) {
    {
#line 432
    while (1) {
      while_continue: /* CIL Label */ ;
      {
#line 432
      tmp___20 = fgets((char */* __restrict  */)(iline), 256, (FILE */* __restrict  */)f);
      }
#line 432
      if (! tmp___20) {
#line 432
        goto while_break;
      }
#line 433
      if ((int )iline[0] == 35) {
#line 434
        goto while_continue;
      } else {
        {
#line 433
        tmp = strlen((char const   *)(iline));
        }
#line 433
        if (tmp <= 1UL) {
#line 434
          goto while_continue;
        }
      }
      {
#line 437
      s = strstr((char const   *)(iline), "ps=");
      }
#line 438
      if (s) {
        {
#line 439
        tmp___0 = strlen((char const   *)s);
#line 439
        tmp___1 = malloc(tmp___0 + 1UL);
#line 439
        ps_cmd = strcpy((char */* __restrict  */)((char *)tmp___1), (char const   */* __restrict  */)(s + 3));
        }
#line 440
        goto while_continue;
      }
      {
#line 442
      s = strstr((char const   *)(iline), "nolostkill");
      }
#line 443
      if (s) {
#line 444
        lostkill = 0;
#line 445
        goto while_continue;
      }
      {
#line 447
      set_defs(c_idx);
#line 448
      s = strtok((char */* __restrict  */)(iline), (char const   */* __restrict  */)(delims));
      }
      {
#line 449
      while (1) {
        while_continue___0: /* CIL Label */ ;
        {
#line 450
        lev = 1;
#line 451
        tmp___19 = strncmp((char const   *)s, "name=", (size_t )5);
        }
#line 451
        if (tmp___19) {
          _L___4: /* CIL Label */ 
          {
#line 453
          tmp___18 = strncmp((char const   *)s, "group=", (size_t )6);
          }
#line 453
          if (tmp___18) {
            _L___3: /* CIL Label */ 
            {
#line 455
            tmp___17 = strncmp((char const   *)s, "line=", (size_t )5);
            }
#line 455
            if (tmp___17) {
              _L___2: /* CIL Label */ 
              {
#line 457
              tmp___16 = strncmp((char const   *)s, "idle=", (size_t )5);
              }
#line 457
              if (tmp___16) {
                _L___1: /* CIL Label */ 
                {
#line 459
                tmp___15 = strncmp((char const   *)s, "grace=", (size_t )6);
                }
#line 459
                if (tmp___15) {
                  _L___0: /* CIL Label */ 
                  {
#line 461
                  tmp___14 = strncmp((char const   *)s, "ban=", (size_t )4);
                  }
#line 461
                  if (tmp___14) {
                    _L: /* CIL Label */ 
                    {
#line 464
                    tmp___8 = strncmp((char const   *)s, "no", (size_t )2);
                    }
#line 464
                    if (! tmp___8) {
#line 465
                      lev = 0;
#line 466
                      s += 2;
                    }
                    {
#line 468
                    tmp___13 = strcmp((char const   *)s, "hard");
                    }
#line 468
                    if (tmp___13) {
                      {
#line 470
                      tmp___12 = strcmp((char const   *)s, "clear");
                      }
#line 470
                      if (tmp___12) {
                        {
#line 472
                        tmp___11 = strcmp((char const   *)s, "mail");
                        }
#line 472
                        if (tmp___11) {
                          {
#line 474
                          tmp___10 = strcmp((char const   *)s, "warn");
                          }
#line 474
                          if (tmp___10) {
                            {
#line 476
                            tmp___9 = strcmp((char const   *)s, "log");
                            }
#line 476
                            if (tmp___9) {
#line 478
                              if (debug) {
                                {
#line 479
                                printf((char const   */* __restrict  */)"Unknown token in file: %s: %s\n",
                                       confname, s);
                                }
                              }
                            } else {
#line 477
                              c_arr[c_idx].log = lev;
                            }
                          } else {
#line 475
                            c_arr[c_idx].warn = lev;
                          }
                        } else {
#line 473
                          c_arr[c_idx].mail = lev;
                        }
                      } else {
#line 471
                        c_arr[c_idx].clear = lev;
                      }
                    } else {
#line 469
                      c_arr[c_idx].hard = lev;
                    }
                  } else {
#line 461
                    s += 4;
#line 461
                    if (*s) {
                      {
#line 462
                      c_arr[c_idx].ban = atoi(s);
                      }
                    } else {
#line 461
                      goto _L;
                    }
                  }
                } else {
#line 459
                  s += 6;
#line 459
                  if (*s) {
                    {
#line 460
                    c_arr[c_idx].grace = atoi(s);
                    }
                  } else {
#line 459
                    goto _L___0;
                  }
                }
              } else {
#line 457
                s += 5;
#line 457
                if (*s) {
                  {
#line 458
                  c_arr[c_idx].idle = atoi(s);
                  }
                } else {
#line 457
                  goto _L___1;
                }
              }
            } else {
#line 455
              s += 5;
#line 455
              if (*s) {
                {
#line 456
                tmp___6 = strlen((char const   *)s);
#line 456
                tmp___7 = malloc(tmp___6 + 1UL);
#line 456
                c_arr[c_idx].line = strcpy((char */* __restrict  */)((char *)tmp___7),
                                           (char const   */* __restrict  */)s);
                }
              } else {
#line 455
                goto _L___2;
              }
            }
          } else {
#line 453
            s += 6;
#line 453
            if (*s) {
              {
#line 454
              tmp___4 = strlen((char const   *)s);
#line 454
              tmp___5 = malloc(tmp___4 + 1UL);
#line 454
              c_arr[c_idx].group = strcpy((char */* __restrict  */)((char *)tmp___5),
                                          (char const   */* __restrict  */)s);
              }
            } else {
#line 453
              goto _L___3;
            }
          }
        } else {
#line 451
          s += 5;
#line 451
          if (*s) {
            {
#line 452
            tmp___2 = strlen((char const   *)s);
#line 452
            tmp___3 = malloc(tmp___2 + 1UL);
#line 452
            c_arr[c_idx].name = strcpy((char */* __restrict  */)((char *)tmp___3),
                                       (char const   */* __restrict  */)s);
            }
          } else {
#line 451
            goto _L___4;
          }
        }
        {
#line 449
        s = strtok((char */* __restrict  */)0, (char const   */* __restrict  */)(delims));
        }
#line 449
        if (! s) {
#line 449
          goto while_break___0;
        }
      }
      while_break___0: /* CIL Label */ ;
      }
#line 483
      idle = c_arr[c_idx].idle;
#line 486
      if (0 < idle) {
#line 487
        if (60 * idle < sleep_max) {
#line 487
          sleep_max = 60 * idle;
        }
      }
#line 488
      c_idx ++;
    }
    while_break: /* CIL Label */ ;
    }
    {
#line 490
    fclose(f);
    }
  } else
#line 428
  if (debug) {
    {
#line 429
    printf((char const   */* __restrict  */)"Can\'t find file: %s\n", confname);
    }
  }
#line 492
  if (! c_idx) {
    {
#line 493
    tmp___21 = c_idx;
#line 493
    c_idx ++;
#line 493
    set_defs(tmp___21);
    }
  }
#line 494
  if (debug) {
    {
#line 495
    printf((char const   */* __restrict  */)"\nConfig File:\n");
#line 496
    printf((char const   */* __restrict  */)"name     group    line  idle grace mail warn log hard  ban\n");
#line 497
    printf((char const   */* __restrict  */)"----------------------------------------------------------\n");
#line 498
    i = 0;
    }
    {
#line 498
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 498
      if (! (i < c_idx)) {
#line 498
        goto while_break___1;
      }
      {
#line 499
      printf((char const   */* __restrict  */)"%-8s %-8s %-6s %3d %5d %4d %4d %3d %4d %4d\n",
             c_arr[i].name, c_arr[i].group, c_arr[i].line, c_arr[i].idle, c_arr[i].grace,
             c_arr[i].mail, c_arr[i].warn, c_arr[i].log, c_arr[i].hard, c_arr[i].ban);
#line 498
      i ++;
      }
    }
    while_break___1: /* CIL Label */ ;
    }
    {
#line 503
    printf((char const   */* __restrict  */)"\n");
#line 504
    printf((char const   */* __restrict  */)"[%s]\n", ps_cmd);
    }
#line 505
    if (lostkill) {
      {
#line 505
      printf((char const   */* __restrict  */)"Lost processes will be killed.\n");
      }
    } else {
      {
#line 506
      printf((char const   */* __restrict  */)"Lost processes stay alive.\n");
      }
    }
  }
#line 509
  return (0);
}
}
#line 541
extern int ( /* missing proto */  re_comp)() ;
#line 542
extern int ( /* missing proto */  re_exec)() ;
#line 539 "/home/june/collector/temp/autolog-0.40/autolog.c"
int pat_match(char *pattern , char *strg ) 
{ 
  int tmp ;

  {
  {
#line 541
  re_comp(pattern);
#line 542
  tmp = re_exec(strg);
  }
#line 542
  return (tmp);
}
}
#line 626
int lower_sleep(int sleep_left ) ;
#line 690
int mesg(int flag , char *name , char *dev , int stime___0 , int idle , conf_el *ce ) ;
#line 689
int kill_PIDs(char *u_name , char *u_dev ) ;
#line 550 "/home/june/collector/temp/autolog-0.40/autolog.c"
int check_idle(userdata *akt_usr ) 
{ 
  char ddev[64] ;
  char *gn ;
  char dev[64] ;
  char name[64] ;
  int idle ;
  struct stat status ;
  time_t stime___0 ;
  struct passwd *passwd_entry ;
  struct group *group_entry ;
  conf_el *ce ;
  int i ;
  char *tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  int tmp___3 ;
  int tmp___4 ;
  int time_left ;
  int tmp___5 ;
  int tmp___6 ;
  int tmp___7 ;

  {
  {
#line 552
  gn = (char *)".*";
#line 562
  strcpy((char */* __restrict  */)(name), (char const   */* __restrict  */)(akt_usr->Name));
#line 563
  strcpy((char */* __restrict  */)(dev), (char const   */* __restrict  */)(akt_usr->Device));
#line 564
  idle = akt_usr->IdleTime;
#line 565
  stime___0 = pres_time - (time_t )akt_usr->SessStrt;
#line 567
  akt_usr->IdleTime = 30000;
  }
#line 569
  if (debug) {
    {
#line 570
    printf((char const   */* __restrict  */)"\nuser: %-10s %-10s %-d\n", name, dev,
           idle);
    }
  }
#line 572
  if ((int )dev[0] == 58) {
#line 573
    return (0);
  }
  {
#line 575
  sprintf((char */* __restrict  */)(ddev), (char const   */* __restrict  */)"/dev/%s",
          dev);
  }
#line 579
  if (debug) {
    {
#line 580
    tmp = ctime((time_t const   *)(& pres_time));
#line 580
    printf((char const   */* __restrict  */)"now:  %d = %s", pres_time, tmp);
    }
  }
#line 582
  if (listall) {
    {
#line 583
    printf((char const   */* __restrict  */)"\nChecking: %-11s on %-12s I:%-4d\n",
           name, dev, idle);
    }
  }
  {
#line 588
  passwd_entry = getpwnam((char const   *)(name));
  }
#line 588
  if (! passwd_entry) {
    {
#line 589
    passwd_entry = getpwuid(akt_usr->UserID);
    }
  }
#line 590
  if (passwd_entry) {
    {
#line 591
    strcpy((char */* __restrict  */)(name), (char const   */* __restrict  */)passwd_entry->pw_name);
#line 592
    group_entry = getgrgid(passwd_entry->pw_gid);
    }
#line 592
    if (group_entry) {
#line 593
      gn = group_entry->gr_name;
    } else
#line 594
    if (debug) {
      {
#line 595
      printf((char const   */* __restrict  */)"Can\'t find group entry for user: %s\n",
             name);
      }
    }
  } else
#line 597
  if (debug) {
    {
#line 597
    printf((char const   */* __restrict  */)"Can\'t find password entry for user: %s\n",
           name);
    }
  }
#line 599
  i = 0;
  {
#line 599
  while (1) {
    while_continue: /* CIL Label */ ;
#line 599
    if (! (i < c_idx)) {
#line 599
      goto while_break;
    }
    {
#line 600
    tmp___0 = pat_match(c_arr[i].name, name);
    }
#line 600
    if (tmp___0) {
      {
#line 600
      tmp___1 = pat_match(c_arr[i].group, gn);
      }
#line 600
      if (tmp___1) {
        {
#line 600
        tmp___2 = pat_match(c_arr[i].line, dev);
        }
#line 600
        if (tmp___2) {
#line 606
          if (c_arr[i].idle < 0) {
#line 607
            if (debug) {
              {
#line 607
              printf((char const   */* __restrict  */)"User exempt\n");
              }
            }
#line 608
            return (0);
          }
#line 610
          ce = & c_arr[i];
#line 611
          goto while_break;
        }
      }
    }
#line 599
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 614
  if (i >= c_idx) {
#line 615
    if (debug) {
      {
#line 615
      printf((char const   */* __restrict  */)"No match for process\n");
      }
    }
#line 616
    return (0);
  }
  {
#line 620
  tmp___4 = stat((char const   */* __restrict  */)(ddev), (struct stat */* __restrict  */)(& status));
  }
#line 620
  if (tmp___4) {
#line 620
    goto _L;
  } else
#line 620
  if (status.st_uid != akt_usr->UserID) {
    _L: /* CIL Label */ 
#line 621
    if (pres_time > (time_t )akt_usr->Ban_Ends) {
#line 622
      akt_usr->SessStrt = (int )pres_time;
#line 623
      akt_usr->Ban_Ends = 0;
#line 624
      akt_usr->WarnEnds = 0;
#line 625
      return (2);
    } else {
      {
#line 626
      lower_sleep(90);
      }
    }
    {
#line 628
    strcpy((char */* __restrict  */)(akt_usr->Device), (char const   */* __restrict  */)".");
    }
#line 630
    if (debug) {
      {
#line 631
      tmp___3 = stat((char const   */* __restrict  */)(ddev), (struct stat */* __restrict  */)(& status));
      }
#line 631
      if (tmp___3) {
        {
#line 632
        printf((char const   */* __restrict  */)"user has logged out.\n");
        }
      } else
#line 633
      if (status.st_uid != akt_usr->UserID) {
        {
#line 634
        printf((char const   */* __restrict  */)"%4d <> %4d\n", status.st_uid, akt_usr->UserID);
#line 635
        printf((char const   */* __restrict  */)"user has changed -> do not disturb.\n");
        }
      }
    }
#line 638
    return (0);
  }
#line 642
  if (! c_arr[i].hard) {
#line 643
    if ((time_t )akt_usr->Ban_Ends < pres_time) {
#line 644
      if (idle < ce->idle) {
#line 645
        akt_usr->WarnEnds = 0;
#line 646
        return (0);
      }
#line 648
      if (debug) {
        {
#line 649
        printf((char const   */* __restrict  */)"Subject to logout   Idle time: %4d (%2d allowed)\n",
               idle, ce->idle);
        }
      }
    } else
#line 652
    if (debug) {
      {
#line 652
      printf((char const   */* __restrict  */)"User temporary banned.\n");
      }
    }
  } else {
#line 659
    akt_usr->Ban_Ends = (int )(pres_time + (time_t )(60 * ce->ban));
#line 660
    if (debug) {
      {
#line 660
      printf((char const   */* __restrict  */)"Banning should end: %10d\n", akt_usr->Ban_Ends);
      }
    }
#line 663
    if (debug) {
      {
#line 663
      printf((char const   */* __restrict  */)"idle-state: %3d / %d:\n", idle, ce->idle);
      }
    }
#line 664
    if (debug) {
      {
#line 664
      printf((char const   */* __restrict  */)"sess-state: %3d / %d:\n", stime___0 / 60L,
             ce->idle);
      }
    }
#line 666
    time_left = (int )((time_t )(60 * ce->idle) - stime___0);
#line 667
    if (debug) {
      {
#line 668
      printf((char const   */* __restrict  */)"time left: %4d sec.\n", time_left);
      }
    }
#line 669
    if (0 < time_left) {
      {
#line 670
      lower_sleep(time_left);
      }
#line 670
      return (0);
    } else {
      {
#line 671
      lower_sleep(ce->grace);
      }
    }
#line 673
    if (debug) {
      {
#line 674
      printf((char const   */* __restrict  */)"Subject to logout   Total time: %4d (%2d allowed)\n",
             stime___0 / 60L, ce->idle);
      }
    }
  }
  {
#line 677
  tmp___5 = stat((char const   */* __restrict  */)(ddev), (struct stat */* __restrict  */)(& status));
  }
#line 677
  if (tmp___5) {
    {
#line 678
    bailout("Can\'t get status of user\'s terminal", 2);
    }
#line 679
    return (0);
  }
#line 685
  if (0 < akt_usr->WarnEnds) {
#line 685
    if (pres_time > (time_t )akt_usr->WarnEnds) {
#line 686
      if (debug) {
        {
#line 687
        printf((char const   */* __restrict  */)"Killing user, now.\n");
        }
      }
      {
#line 689
      tmp___6 = kill_PIDs(name, dev);
      }
#line 689
      if (tmp___6 == 1) {
        {
#line 690
        mesg(2, name, ddev, stime___0 / 60L, idle, ce);
        }
      } else {
        {
#line 691
        mesg(3, name, ddev, stime___0 / 60L, idle, ce);
        }
      }
#line 692
      if (ce->hard) {
#line 693
        akt_usr->WarnEnds = -1;
      } else {
        {
#line 694
        akt_usr->WarnEnds = -2;
#line 695
        akt_usr->Ban_Ends = (int )(pres_time + 120L);
#line 697
        lower_sleep(90);
        }
      }
    } else {
#line 685
      goto _L___0;
    }
  } else
  _L___0: /* CIL Label */ 
#line 700
  if (akt_usr->WarnEnds == -2) {
    {
#line 701
    mesg(5, name, ddev, stime___0 / 60L, idle, ce);
#line 702
    akt_usr->WarnEnds = (int )(pres_time + 5L);
#line 703
    lower_sleep(5);
    }
#line 704
    if (debug) {
      {
#line 705
      printf((char const   */* __restrict  */)"idle-punish\n");
      }
    }
  } else
#line 707
  if (akt_usr->WarnEnds == -1) {
    {
#line 708
    mesg(4, name, ddev, stime___0 / 60L, idle, ce);
    }
#line 709
    if (debug) {
      {
#line 710
      printf((char const   */* __restrict  */)"I am angry, user returned...\n");
      }
    }
    {
#line 711
    tmp___7 = kill_PIDs(name, dev);
    }
#line 711
    if (tmp___7 == 1) {
      {
#line 712
      mesg(2, name, ddev, stime___0 / 60L, idle, ce);
      }
    } else {
      {
#line 713
      mesg(3, name, ddev, stime___0 / 60L, idle, ce);
      }
    }
  } else {
#line 716
    if (akt_usr->WarnEnds == 0) {
      {
#line 717
      mesg(1, name, ddev, stime___0 / 60L, idle, ce);
#line 718
      akt_usr->WarnEnds = (int )(pres_time + (time_t )ce->grace);
      }
#line 719
      if (debug) {
        {
#line 720
        printf((char const   */* __restrict  */)"Warning user:%s Line:%s  Sleep %d sec\n",
               name, dev, ce->grace);
        }
      }
    }
    {
#line 722
    lower_sleep(ce->grace);
    }
  }
#line 724
  return (0);
}
}
#line 732 "/home/june/collector/temp/autolog-0.40/autolog.c"
void get_PIDs(char *u_name , char *u_dev ) 
{ 
  char prname[256] ;
  char iline[256] ;
  char *ps_name ;
  char *ps_pid ;
  char *ps_dev ;
  struct stat status ;
  FILE *ps ;
  int i ;
  int pid ;
  int uid ;
  int tmp ;
  void *tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  char *tmp___3 ;

  {
  {
#line 747
  ps = popen((char const   *)ps_cmd, "r");
  }
#line 747
  if (! ps) {
    {
#line 748
    bailout("Can\'t use ps program", 6);
    }
#line 749
    return;
  }
  {
#line 751
  fgets((char */* __restrict  */)(iline), 256, (FILE */* __restrict  */)ps);
#line 753
  ids_fill = 0;
  }
  {
#line 754
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 754
    tmp___3 = fgets((char */* __restrict  */)(iline), 256, (FILE */* __restrict  */)ps);
    }
#line 754
    if (! tmp___3) {
#line 754
      goto while_break;
    }
    {
#line 755
    ps_name = strtok((char */* __restrict  */)(iline), (char const   */* __restrict  */)(delims));
#line 756
    ps_pid = strtok((char */* __restrict  */)0, (char const   */* __restrict  */)(delims));
#line 757
    pid = atoi(ps_pid);
#line 758
    i = 0;
    }
    {
#line 758
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 758
      if (! (i < 5)) {
#line 758
        goto while_break___0;
      }
      {
#line 758
      ps_dev = strtok((char */* __restrict  */)0, (char const   */* __restrict  */)(delims));
#line 758
      i ++;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 759
    sprintf((char */* __restrict  */)(prname), (char const   */* __restrict  */)"/proc/%d",
            pid);
#line 760
    tmp = stat((char const   */* __restrict  */)(prname), (struct stat */* __restrict  */)(& status));
    }
#line 760
    if (tmp) {
      {
#line 761
      printf((char const   */* __restrict  */)"Dead process:    \n");
      }
    }
#line 762
    uid = (int )status.st_uid;
#line 763
    if (debug) {
      {
#line 764
      printf((char const   */* __restrict  */)"%-8s/%s -> %5s %5d %5d\n", ps_name,
             ps_dev, ps_pid, pid, uid);
      }
    }
    {
#line 765
    tmp___1 = strcmp((char const   *)u_name, (char const   *)ps_name);
    }
#line 765
    if (tmp___1 == 0) {
      {
#line 765
      tmp___2 = strcmp((char const   *)u_dev, (char const   *)ps_dev);
      }
#line 765
      if (tmp___2 == 0) {
#line 766
        if (debug) {
          {
#line 767
          printf((char const   */* __restrict  */)"     -> ok, Name = %s, dev = %s  => kill.\n",
                 u_name, u_dev);
          }
        }
#line 768
        ids_fill ++;
#line 769
        if (ids_fill > ids_max) {
          {
#line 770
          ids_max = 2 * ids_max;
#line 771
          tmp___0 = realloc((void *)ids_lst, sizeof(int ) * (unsigned long )(1 + ids_max));
#line 771
          ids_lst = (int *)tmp___0;
          }
        }
#line 774
        *(ids_lst + ids_fill) = pid;
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 777
  fclose(ps);
  }
#line 779
  if (debug) {
    {
#line 780
    printf((char const   */* __restrict  */)" |-> ");
#line 781
    i = 1;
    }
    {
#line 781
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 781
      if (! (i <= ids_fill)) {
#line 781
        goto while_break___1;
      }
      {
#line 782
      printf((char const   */* __restrict  */)" %5d", *(ids_lst + i));
#line 781
      i ++;
      }
    }
    while_break___1: /* CIL Label */ ;
    }
    {
#line 783
    printf((char const   */* __restrict  */)"\n");
    }
  }
#line 785
  return;
}
}
#line 804
int kill_HUP(int pid ) ;
#line 812
int kill_KILL(int pid ) ;
#line 817
int kill_Res(int pid ) ;
#line 791 "/home/june/collector/temp/autolog-0.40/autolog.c"
int kill_PIDs(char *u_name , char *u_dev ) 
{ 
  int i ;
  int ok ;
  void *tmp ;
  int tmp___0 ;

  {
  {
#line 792
  ok = 1;
#line 794
  ids_max = 50;
#line 795
  tmp = calloc(sizeof(int ), (size_t )(1 + ids_max));
#line 795
  ids_lst = (int *)tmp;
  }
#line 797
  if (debug) {
    {
#line 798
    printf((char const   */* __restrict  */)"\nget PIDs for %s\n", u_name);
    }
  }
  {
#line 802
  get_PIDs(u_name, u_dev);
  }
#line 803
  if (do_bite) {
#line 804
    i = 1;
    {
#line 804
    while (1) {
      while_continue: /* CIL Label */ ;
#line 804
      if (! (i <= ids_fill)) {
#line 804
        goto while_break;
      }
      {
#line 804
      kill_HUP(*(ids_lst + i));
#line 804
      i ++;
      }
    }
    while_break: /* CIL Label */ ;
    }
  }
  {
#line 805
  sleep(20);
#line 809
  ids_fill = 0;
#line 810
  get_PIDs(u_name, u_dev);
  }
#line 811
  if (do_bite) {
#line 812
    i = 1;
    {
#line 812
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 812
      if (! (i <= ids_fill)) {
#line 812
        goto while_break___0;
      }
      {
#line 812
      kill_KILL(*(ids_lst + i));
#line 812
      i ++;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
  }
  {
#line 813
  sleep(3);
  }
#line 816
  if (do_bite) {
#line 817
    i = 1;
    {
#line 817
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 817
      if (! (i <= ids_fill)) {
#line 817
        goto while_break___1;
      }
      {
#line 817
      tmp___0 = kill_Res(*(ids_lst + i));
      }
#line 817
      if (tmp___0) {
#line 817
        ok = 0;
      }
#line 817
      i ++;
    }
    while_break___1: /* CIL Label */ ;
    }
  }
  {
#line 819
  free((void *)ids_lst);
  }
#line 820
  return (ok);
}
}
#line 823 "/home/june/collector/temp/autolog-0.40/autolog.c"
int kill_HUP(int pid ) 
{ 


  {
  {
#line 824
  kill(pid, 1);
  }
#line 825
  return (0);
}
}
#line 827 "/home/june/collector/temp/autolog-0.40/autolog.c"
int kill_KILL(int pid ) 
{ 


  {
  {
#line 828
  kill(pid, 9);
  }
#line 829
  return (0);
}
}
#line 831 "/home/june/collector/temp/autolog-0.40/autolog.c"
int kill_Res(int pid ) 
{ 
  int tmp ;

  {
  {
#line 832
  tmp = kill(pid, 0);
  }
#line 832
  if (tmp) {
#line 834
    return (0);
  } else {
#line 833
    return (1);
  }
}
}
#line 858
extern int ( /* missing proto */  system)() ;
#line 841 "/home/june/collector/temp/autolog-0.40/autolog.c"
int mesg(int flag , char *name , char *dev , int stime___0 , int idle , conf_el *ce ) 
{ 
  char mbuf[256] ;
  char *hint ;
  time_t tvec ;
  FILE *fp ;
  FILE *mprog ;
  char *tmp ;
  char *tmp___0 ;
  char msg[100] ;

  {
  {
#line 848
  time(& tvec);
  }
#line 849
  if (flag == 5) {
#line 849
    if (ce->warn) {
      {
#line 850
      hint = (char *)"** IDLE-PUNISH **";
#line 851
      fp = fopen((char const   */* __restrict  */)dev, (char const   */* __restrict  */)"w");
      }
#line 851
      if (! fp) {
        {
#line 852
        bailout("Can\'t open user\'s terminal", 5);
        }
#line 853
        return (0);
      }
#line 856
      if (ce->clear) {
        {
#line 857
        sprintf((char */* __restrict  */)(mbuf), (char const   */* __restrict  */)"clear >%s",
                dev);
#line 858
        system(mbuf);
        }
      }
      {
#line 860
      fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\n\n\r");
#line 861
      fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)".--------------------------------------------.\n\r");
#line 862
      fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"|  %10s, you have been idle too long.  |\n\r",
              name);
#line 863
      fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"|  Punishment: Log out for %3d seconds!      |\n\r",
              120);
#line 864
      fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"`--------------------------------------------\'\n\r");
#line 865
      fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n");
#line 866
      sleep(1);
#line 866
      fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n");
#line 867
      sleep(1);
#line 867
      fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n\r");
#line 868
      sleep(10);
#line 869
      fclose(fp);
      }
    }
  }
#line 871
  if (flag == 4) {
#line 871
    if (ce->warn) {
      {
#line 872
      hint = (char *)" ** ANGRY **";
#line 873
      fp = fopen((char const   */* __restrict  */)dev, (char const   */* __restrict  */)"w");
      }
#line 873
      if (! fp) {
        {
#line 874
        bailout("Can\'t open user\'s terminal", 5);
        }
#line 875
        return (0);
      }
#line 877
      if (ce->clear) {
        {
#line 878
        sprintf((char */* __restrict  */)(mbuf), (char const   */* __restrict  */)"clear >%s",
                dev);
#line 879
        system(mbuf);
        }
      }
#line 881
      if (ce->hard) {
        {
#line 882
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\n\n\r");
#line 883
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)".--------------------------------------------------.\n\r");
#line 884
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"|  %10s, you have just been kicked off.      |\n\r",
                name);
#line 886
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"|  Make off, don\'t try it again, today.            |\n\r");
#line 887
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"`--------------------------------------------------\'\n\r");
#line 888
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n");
#line 889
        sleep(1);
#line 889
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n");
#line 890
        sleep(1);
#line 890
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n\r");
#line 891
        sleep(10);
        }
      }
      {
#line 893
      fclose(fp);
      }
    }
  }
#line 895
  if (flag == 1) {
#line 895
    if (ce->warn) {
      {
#line 896
      hint = (char *)"** NOTIFIED **";
#line 897
      fp = fopen((char const   */* __restrict  */)dev, (char const   */* __restrict  */)"w");
      }
#line 897
      if (! fp) {
        {
#line 898
        bailout("Can\'t open user\'s terminal", 5);
        }
#line 899
        return (0);
      }
#line 901
      if (ce->clear) {
        {
#line 902
        sprintf((char */* __restrict  */)(mbuf), (char const   */* __restrict  */)"clear >%s",
                dev);
#line 903
        system(mbuf);
        }
      }
#line 905
      if (ce->hard) {
        {
#line 906
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\n\n\r");
#line 907
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)".--------------------------------------------------.\n\r");
#line 908
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"|  %10s: You\'ve been on for %3d min.         |\n\r",
                name, stime___0);
#line 910
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"|  You\'ll be logged off in %3d sec. so finish up.  |\n\r",
                ce->grace);
#line 912
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"`--------------------------------------------------\'\n\r");
#line 913
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n");
#line 914
        sleep(1);
#line 914
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n");
#line 915
        sleep(1);
#line 915
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n\r");
        }
      } else {
        {
#line 918
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\n\n\r");
#line 919
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)".----------------------------------------------.\n\r");
#line 920
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"| %10s: You\'ve been idle for %3d min.    |\n\r",
                name, idle);
#line 922
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"|        You\'ll be logged off in %3d sec       |\n\r",
                ce->grace);
#line 924
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"|             unless you hit a key.            |\n\r");
#line 925
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"`----------------------------------------------\'\n\r");
#line 928
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n");
#line 929
        sleep(1);
#line 929
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n");
#line 930
        sleep(1);
#line 930
        fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"\a\n\r");
        }
      }
      {
#line 932
      fclose(fp);
      }
#line 933
      if (ce->mail) {
        {
#line 934
        sprintf((char */* __restrict  */)(mbuf), (char const   */* __restrict  */)"/usr/bin/mail -s \"++WARNING - LOG-OFF ++\" %s",
                name);
#line 936
        mprog = popen((char const   *)(mbuf), "w");
        }
#line 936
        if (! mprog) {
          {
#line 937
          bailout("Can\'t use /usr/bin/mail program", 6);
          }
#line 938
          return (0);
        }
#line 940
        if (ce->hard) {
          {
#line 941
          fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"Your session-limit will be reached soon.\n");
#line 942
          fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"   %s: You\'ve been on for %3d min.\n",
                  name, stime___0);
#line 943
          fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"   You\'ll be logged off in %3d sec.\n",
                  ce->grace);
#line 944
          fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"   So finish up, please.\n");
          }
        } else {
          {
#line 947
          fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"You have been idle for quite a long time.\n");
#line 948
          fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"   %s: You\'ve been idle for %3d min.\n",
                  name, stime___0);
#line 949
          fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"   You\'ll be logged off in %3d sec.\n",
                  ce->grace);
#line 950
          fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"   Please: Type something into a terminal \n");
#line 951
          fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"           or you\'ll be kicked off.\n");
          }
        }
        {
#line 953
        fclose(mprog);
        }
      }
    }
  }
#line 956
  if (flag == 2) {
#line 957
    hint = (char *)"** LOGOFF **";
#line 958
    if (ce->mail) {
      {
#line 959
      sprintf((char */* __restrict  */)(mbuf), (char const   */* __restrict  */)"/usr/bin/mail -s \"Logged off, you were idle\" %s",
              name);
#line 961
      mprog = popen((char const   *)(mbuf), "w");
      }
#line 961
      if (! mprog) {
        {
#line 962
        bailout("Can\'t use /usr/bin/mail program", 6);
        }
#line 963
        return (0);
      }
      {
#line 965
      fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"Subject: Excess Idle Time\n\n");
#line 966
      tmp = ctime((time_t const   *)(& tvec));
#line 966
      fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"  Logged off - %s - %s\n",
              name, tmp);
#line 967
      fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"    - excess idle time - \n");
#line 968
      fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"      on tty = %s\n",
              dev + 5);
#line 969
      fclose(mprog);
      }
    }
  }
#line 972
  if (flag == 3) {
#line 973
    hint = (char *)"** LOGOFF FAILED **";
#line 974
    if (ce->mail) {
      {
#line 975
      sprintf((char */* __restrict  */)(mbuf), (char const   */* __restrict  */)"/usr/bin/mail -s \"Couldn\'t log out [%s] \" root",
              name);
#line 976
      mprog = popen((char const   *)(mbuf), "w");
      }
#line 976
      if ((unsigned long )mprog == (unsigned long )((FILE *)((void *)0))) {
        {
#line 977
        bailout("Can\'t use /usr/bin/mail program", 7);
        }
#line 978
        return (0);
      }
      {
#line 980
      fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"Subject: Can\'t logoff %s\n",
              name);
#line 981
      tmp___0 = ctime((time_t const   *)(& tvec));
#line 981
      fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"Can\'t Log off - %s %s\n",
              name, tmp___0);
#line 982
      fprintf((FILE */* __restrict  */)mprog, (char const   */* __restrict  */)"tty = %s\n",
              dev + 5);
#line 983
      fclose(mprog);
      }
    }
  }
#line 986
  if (ce->log) {
    {
#line 988
    sprintf((char */* __restrict  */)(msg), (char const   */* __restrict  */)"%-20s %-8s %-5s idle:%3d sess:%3d",
            hint, name, dev + 5, idle, stime___0);
#line 990
    log_msg(msg);
    }
  }
#line 992
  return (0);
}
}
#line 995 "/home/june/collector/temp/autolog-0.40/autolog.c"
int log_msg(char *message ) 
{ 
  FILE *log ;
  struct stat status ;
  char str_time[30] ;
  char *tmp ;
  size_t tmp___0 ;
  int tmp___1 ;

  {
  {
#line 996
  log = (FILE *)0;
#line 1000
  tmp___1 = stat((char const   */* __restrict  */)logfname, (struct stat */* __restrict  */)(& status));
  }
#line 1000
  if (tmp___1 >= 0) {
    {
#line 1001
    log = fopen((char const   */* __restrict  */)logfname, (char const   */* __restrict  */)"a");
    }
#line 1002
    if ((unsigned long )log == (unsigned long )((void *)0)) {
#line 1002
      return (1);
    }
    {
#line 1003
    tmp = ctime((time_t const   *)(& pres_time));
#line 1003
    sprintf((char */* __restrict  */)(str_time), (char const   */* __restrict  */)"%s",
            tmp + 3);
#line 1004
    tmp___0 = strlen((char const   *)(str_time));
#line 1004
    str_time[tmp___0 - 1UL] = (char)0;
#line 1006
    fprintf((FILE */* __restrict  */)log, (char const   */* __restrict  */)"%s - %s\n",
            str_time, message);
#line 1007
    fclose(log);
    }
#line 1008
    return (0);
  }
#line 1010
  return (0);
}
}
#line 1012 "/home/june/collector/temp/autolog-0.40/autolog.c"
int bailout(char *message , int status ) 
{ 
  char msg[100] ;

  {
  {
#line 1014
  sprintf((char */* __restrict  */)(msg), (char const   */* __restrict  */)"** ERROR ** %s",
          message);
#line 1015
  log_msg(msg);
  }
#line 1016
  return (0);
}
}
#line 1019 "/home/june/collector/temp/autolog-0.40/autolog.c"
int lower_sleep(int sleep_left ) 
{ 


  {
#line 1020
  if (0 < sleep_left) {
#line 1020
    if (sleep_left < sleeptime) {
#line 1021
      sleeptime = sleep_left;
    }
  }
#line 1022
  return (0);
}
}
#line 1028 "/home/june/collector/temp/autolog-0.40/autolog.c"
int kill_lost_PIDs(void) 
{ 
  char prname[256] ;
  char iline[256] ;
  char *ps_name ;
  char *ps_pid ;
  struct stat status ;
  FILE *ps ;
  int i ;
  int pid ;
  int uid ;
  char mbuf[256] ;
  int userpos ;
  int tmp ;
  size_t tmp___0 ;
  int tmp___1 ;
  size_t tmp___2 ;
  char *tmp___3 ;
  size_t tmp___4 ;
  char *tmp___5 ;

  {
  {
#line 1039
  userpos = 0;
#line 1042
  ps = popen((char const   *)ps_cmd, "r");
  }
#line 1042
  if (! ps) {
    {
#line 1043
    bailout((char *)"Can\'t use ps program", 6);
    }
#line 1044
    return;
  }
  {
#line 1046
  fgets((char */* __restrict  */)(iline), 256, (FILE */* __restrict  */)ps);
#line 1048
  ids_fill = 0;
  }
  {
#line 1049
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 1049
    tmp___5 = fgets((char */* __restrict  */)(iline), 256, (FILE */* __restrict  */)ps);
    }
#line 1049
    if (! tmp___5) {
#line 1049
      goto while_break;
    }
    {
#line 1050
    ps_name = strtok((char */* __restrict  */)(iline), (char const   */* __restrict  */)(delims));
#line 1051
    ps_pid = strtok((char */* __restrict  */)0, (char const   */* __restrict  */)(delims));
#line 1052
    pid = atoi(ps_pid);
#line 1054
    sprintf((char */* __restrict  */)(prname), (char const   */* __restrict  */)"/proc/%d",
            pid);
#line 1055
    tmp___1 = stat((char const   */* __restrict  */)(prname), (struct stat */* __restrict  */)(& status));
    }
#line 1055
    if (tmp___1) {
#line 1056
      userpos = -1;
#line 1057
      if (do_bite) {
        {
#line 1057
        kill(pid, 9);
        }
      }
      {
#line 1058
      sprintf((char */* __restrict  */)(mbuf), (char const   */* __restrict  */)"Dead , killed: %-10s %5d : %5d",
              ps_name, uid, pid);
#line 1059
      log_msg(mbuf);
      }
    } else {
#line 1062
      uid = (int )status.st_uid;
#line 1063
      if (debug) {
        {
#line 1064
        printf((char const   */* __restrict  */)"%-8s -> %5s %5d %5d\n", ps_name,
               ps_pid, pid, uid);
        }
      }
#line 1066
      if (500 <= uid) {
#line 1066
        if (uid <= 60000) {
          {
#line 1069
          strcpy((char */* __restrict  */)((userlst + 0)->Name), (char const   */* __restrict  */)ps_name);
#line 1070
          userpos = userfill;
          }
          {
#line 1071
          while (1) {
            while_continue___0: /* CIL Label */ ;
            {
#line 1071
            tmp = strcmp((char const   *)((userlst + userpos)->Name), (char const   *)ps_name);
            }
#line 1071
            if (! tmp) {
#line 1071
              goto while_break___0;
            }
#line 1071
            userpos --;
          }
          while_break___0: /* CIL Label */ ;
          }
#line 1073
          if (userpos == 0) {
#line 1074
            if (do_bite) {
              {
#line 1074
              kill(pid, 9);
              }
            }
            {
#line 1075
            sprintf((char */* __restrict  */)(mbuf), (char const   */* __restrict  */)"Lost, killed: %-10s %5d : %5d",
                    ps_name, uid, pid);
#line 1076
            log_msg(mbuf);
            }
          } else {
            {
#line 1078
            tmp___0 = strlen((char const   *)((userlst + userpos)->Device));
            }
#line 1078
            if (tmp___0 == 1UL) {
#line 1079
              if (do_bite) {
                {
#line 1079
                kill(pid, 9);
                }
              }
              {
#line 1080
              sprintf((char */* __restrict  */)(mbuf), (char const   */* __restrict  */)"Left, killed: %-10s %5d : %5d",
                      ps_name, uid, pid);
#line 1081
              log_msg(mbuf);
              }
            }
          }
        }
      }
    }
    {
#line 1088
    tmp___2 = strlen((char const   *)(iline));
#line 1088
    i = (int )tmp___2;
    }
    {
#line 1089
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 1089
      if (! ((int )iline[i - 1] != 10)) {
#line 1089
        goto while_break___1;
      }
      {
#line 1090
      tmp___3 = fgets((char */* __restrict  */)(iline), 256, (FILE */* __restrict  */)ps);
      }
#line 1090
      if (! tmp___3) {
        {
#line 1092
        fclose(ps);
        }
#line 1093
        return;
      }
      {
#line 1095
      tmp___4 = strlen((char const   *)(iline));
#line 1095
      i = (int )tmp___4;
      }
    }
    while_break___1: /* CIL Label */ ;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 1098
  fclose(ps);
  }
#line 1099
  return (0);
}
}
