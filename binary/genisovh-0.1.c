/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is false */

#line 212 "/usr/lib/gcc/x86_64-linux-gnu/4.8/include/stddef.h"
typedef unsigned long size_t;
#line 124 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned long __dev_t;
#line 125 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned int __uid_t;
#line 126 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned int __gid_t;
#line 127 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned long __ino_t;
#line 129 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned int __mode_t;
#line 130 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned long __nlink_t;
#line 131 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off_t;
#line 139 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __time_t;
#line 153 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __blksize_t;
#line 158 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __blkcnt_t;
#line 172 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __ssize_t;
#line 175 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __syscall_slong_t;
#line 102 "/usr/include/stdio.h"
typedef __ssize_t ssize_t;
#line 194 "/usr/include/x86_64-linux-gnu/sys/types.h"
typedef signed char int8_t;
#line 195 "/usr/include/x86_64-linux-gnu/sys/types.h"
typedef short int16_t;
#line 196 "/usr/include/x86_64-linux-gnu/sys/types.h"
typedef int int32_t;
#line 120 "/usr/include/time.h"
struct timespec {
   __time_t tv_sec ;
   __syscall_slong_t tv_nsec ;
};
#line 48 "/usr/include/stdint.h"
typedef unsigned char uint8_t;
#line 49 "/usr/include/stdint.h"
typedef unsigned short uint16_t;
#line 51 "/usr/include/stdint.h"
typedef unsigned int uint32_t;
#line 46 "/usr/include/x86_64-linux-gnu/bits/stat.h"
struct stat {
   __dev_t st_dev ;
   __ino_t st_ino ;
   __nlink_t st_nlink ;
   __mode_t st_mode ;
   __uid_t st_uid ;
   __gid_t st_gid ;
   int __pad0 ;
   __dev_t st_rdev ;
   __off_t st_size ;
   __blksize_t st_blksize ;
   __blkcnt_t st_blocks ;
   struct timespec st_atim ;
   struct timespec st_mtim ;
   struct timespec st_ctim ;
   __syscall_slong_t __glibc_reserved[3] ;
};
#line 51 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/dvh.h"
struct device_parameters {
   uint8_t dp_skew ;
   uint8_t dp_gap1 ;
   uint8_t dp_gap2 ;
   uint8_t dp_spares_cyl ;
   uint16_t dp_cyls ;
   uint16_t dp_shd0 ;
   uint16_t dp_trks0 ;
   uint8_t dp_ctq_depth ;
   uint8_t dp_cylshi ;
   uint16_t dp_unused ;
   uint16_t dp_secs ;
   uint16_t dp_secbytes ;
   uint16_t dp_interleave ;
   int32_t dp_flags ;
   int32_t dp_datarate ;
   int32_t dp_nretries ;
   int32_t dp_mspw ;
   uint16_t dp_xgap1 ;
   uint16_t dp_xsync ;
   uint16_t dp_xrdly ;
   uint16_t dp_xgap2 ;
   uint16_t dp_xrgate ;
   uint16_t dp_xwcont ;
};
#line 104 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/dvh.h"
struct volume_directory {
   int8_t vd_name[8] ;
   int32_t vd_lbn ;
   int32_t vd_nbytes ;
};
#line 118 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/dvh.h"
struct partition_table {
   int32_t pt_nblks ;
   int32_t pt_firstlbn ;
   int32_t pt_type ;
};
#line 159 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/dvh.h"
struct volume_header {
   int32_t vh_magic ;
   int16_t vh_rootpt ;
   int16_t vh_swappt ;
   int8_t vh_bootfile[16] ;
   struct device_parameters vh_dp ;
   struct volume_directory vh_vd[15] ;
   struct partition_table vh_pt[16] ;
   int32_t vh_csum ;
   int32_t vh_fill ;
};
#line 362 "/usr/include/stdio.h"
extern int printf(char const   * __restrict  __format  , ...) ;
#line 147 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1), __leaf__)) atoi)(char const   *__nptr )  __attribute__((__pure__)) ;
#line 543
extern  __attribute__((__nothrow__, __noreturn__)) void ( __attribute__((__leaf__)) exit)(int __status ) ;
#line 66 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__nonnull__(1), __leaf__)) memset)(void *__s ,
                                                                                               int __c ,
                                                                                               size_t __n ) ;
#line 132
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strncpy)(char * __restrict  __dest ,
                                                                                                  char const   * __restrict  __src ,
                                                                                                  size_t __n ) ;
#line 236
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1), __leaf__)) strchr)(char const   *__s ,
                                                                                               int __c )  __attribute__((__pure__)) ;
#line 353 "/usr/include/unistd.h"
extern int close(int __fd ) ;
#line 366
extern ssize_t write(int __fd , void const   *__buf , size_t __n ) ;
#line 146 "/usr/include/fcntl.h"
extern int ( __attribute__((__nonnull__(1))) open)(char const   *__file , int __oflag 
                                                   , ...) ;
#line 214 "/usr/include/x86_64-linux-gnu/sys/stat.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(2), __leaf__)) fstat)(int __fd ,
                                                                                            struct stat *__buf ) ;
#line 62 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/main.c"
static void vh_calc_checksum(struct volume_header *vh ) 
{ 
  uint32_t newsum ;
  uint32_t *buffer ;
  unsigned int i ;
  uint32_t __x ;
  uint32_t __x___0 ;

  {
#line 64
  newsum = (uint32_t )0;
#line 65
  buffer = (uint32_t *)vh;
#line 68
  vh->vh_csum = 0;
#line 70
  i = 0U;
  {
#line 70
  while (1) {
    while_continue: /* CIL Label */ ;
#line 70
    if (! ((unsigned long )i < sizeof(struct volume_header ) / sizeof(uint32_t ))) {
#line 70
      goto while_break;
    }
#line 71
    __x = *(buffer + i);
#line 71
    newsum -= ((((__x & 255U) << 24) | ((__x & 65280U) << 8)) | ((__x & 16711680U) >> 8)) | ((__x & 4278190080U) >> 24);
#line 70
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 73
  __x___0 = newsum;
#line 73
  vh->vh_csum = (int32_t )(((((__x___0 & 255U) << 24) | ((__x___0 & 65280U) << 8)) | ((__x___0 & 16711680U) >> 8)) | ((__x___0 & 4278190080U) >> 24));
#line 74
  return;
}
}
#line 76 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/main.c"
static void swap_dp_out(struct device_parameters *dp ) 
{ 
  uint16_t __x ;
  uint16_t __x___0 ;
  uint16_t __x___1 ;
  uint16_t __x___2 ;
  uint16_t __x___3 ;
  uint16_t __x___4 ;
  uint16_t __x___5 ;
  uint32_t __x___6 ;
  uint32_t __x___7 ;
  uint32_t __x___8 ;
  uint32_t __x___9 ;
  uint32_t __x___10 ;
  uint32_t __x___11 ;
  uint32_t __x___12 ;
  uint32_t __x___13 ;
  uint32_t __x___14 ;
  uint32_t __x___15 ;

  {
#line 78
  __x = dp->dp_cyls;
#line 79
  __x___0 = dp->dp_shd0;
#line 80
  __x___1 = dp->dp_trks0;
#line 81
  __x___2 = dp->dp_unused;
#line 82
  __x___3 = dp->dp_secs;
#line 83
  __x___4 = dp->dp_secbytes;
#line 84
  __x___5 = dp->dp_interleave;
#line 85
  __x___6 = (uint32_t )dp->dp_flags;
#line 86
  __x___7 = (uint32_t )dp->dp_datarate;
#line 87
  __x___8 = (uint32_t )dp->dp_nretries;
#line 88
  __x___9 = (uint32_t )dp->dp_mspw;
#line 89
  __x___10 = (uint32_t )dp->dp_xgap1;
#line 90
  __x___11 = (uint32_t )dp->dp_xsync;
#line 91
  __x___12 = (uint32_t )dp->dp_xrdly;
#line 92
  __x___13 = (uint32_t )dp->dp_xgap2;
#line 93
  __x___14 = (uint32_t )dp->dp_xrgate;
#line 94
  __x___15 = (uint32_t )dp->dp_xwcont;
#line 95
  return;
}
}
#line 97 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/main.c"
static void swap_vd_out(struct volume_directory *vd ) 
{ 
  uint32_t __x ;
  uint32_t __x___0 ;

  {
#line 99
  __x = (uint32_t )vd->vd_lbn;
#line 100
  __x___0 = (uint32_t )vd->vd_nbytes;
#line 101
  return;
}
}
#line 103 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/main.c"
static void swap_pt_out(struct partition_table *pt ) 
{ 
  uint32_t __x ;
  uint32_t __x___0 ;
  uint32_t __x___1 ;

  {
#line 105
  __x = (uint32_t )pt->pt_nblks;
#line 106
  __x___0 = (uint32_t )pt->pt_firstlbn;
#line 107
  __x___1 = (uint32_t )pt->pt_type;
#line 108
  return;
}
}
#line 110 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/main.c"
static void swap_vh_out(struct volume_header *vh ) 
{ 
  uint32_t __x ;
  uint16_t __x___0 ;
  uint16_t __x___1 ;
  uint32_t __x___2 ;
  uint32_t __x___3 ;

  {
  {
#line 112
  __x = (uint32_t )vh->vh_magic;
#line 113
  __x___0 = (uint16_t )vh->vh_rootpt;
#line 114
  __x___1 = (uint16_t )vh->vh_swappt;
#line 115
  swap_dp_out(& vh->vh_dp);
#line 116
  swap_vd_out(vh->vh_vd);
#line 117
  swap_pt_out(vh->vh_pt);
#line 118
  __x___2 = (uint32_t )vh->vh_csum;
#line 119
  __x___3 = (uint32_t )vh->vh_fill;
  }
#line 120
  return;
}
}
#line 122 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/main.c"
static void usage(void) 
{ 


  {
  {
#line 124
  printf((char const   */* __restrict  */)"Usage:\ngenisovh <isofile> [<name:sblock,size> ...]\n");
#line 125
  exit(1);
  }
}
}
#line 128 "/home/june/repo/benchmarks/collector/temp/genisovh-0.1/main.c"
int main(int argc , char **argv ) 
{ 
  int fd ;
  int i ;
  int v ;
  int block ;
  int size ;
  char *isoname ;
  char *pos ;
  struct stat st ;
  struct volume_header vh ;
  int tmp ;
  char *cline ;
  long tmp___0 ;
  ssize_t tmp___1 ;

  {
#line 140
  if (argc < 2) {
    {
#line 141
    usage();
    }
  }
  {
#line 143
  isoname = *(argv + 1);
#line 145
  fd = open((char const   *)isoname, 2);
  }
#line 145
  if (! fd) {
    {
#line 146
    printf((char const   */* __restrict  */)"File not found %s\n", isoname);
    }
#line 147
    return (1);
  }
  {
#line 150
  tmp = fstat(fd, & st);
  }
#line 150
  if (tmp) {
    {
#line 151
    printf((char const   */* __restrict  */)"Failed to stat file %s\n", isoname);
#line 152
    close(fd);
    }
#line 153
    return (1);
  }
  {
#line 156
  memset((void *)(& vh), 0, sizeof(vh));
#line 158
  vh.vh_magic = 199600449;
#line 161
  vh.vh_dp.dp_secbytes = (uint16_t )512;
#line 162
  vh.vh_dp.dp_secs = (uint16_t )32;
#line 163
  vh.vh_dp.dp_flags = 52;
#line 164
  vh.vh_dp.dp_trks0 = (uint16_t )1;
#line 166
  vh.vh_dp.dp_cyls = (uint16_t )(((st.st_size + 512L) - 1L) / 16384L);
#line 169
  i = 2;
#line 169
  v = 0;
  }
  {
#line 169
  while (1) {
    while_continue: /* CIL Label */ ;
#line 169
    if (! (i < argc)) {
#line 169
      goto while_break;
    }
    {
#line 170
    cline = *(argv + i);
#line 173
    pos = strchr((char const   *)cline, ':');
    }
#line 173
    if (! pos) {
      {
#line 174
      printf((char const   */* __restrict  */)"Couldn\'t find : in parameter %s\n",
             cline);
#line 175
      usage();
      }
    }
#line 179
    if (8L < pos - cline) {
#line 179
      tmp___0 = 8L;
    } else {
#line 179
      tmp___0 = pos - cline;
    }
    {
#line 179
    strncpy((char */* __restrict  */)(vh.vh_vd[v].vd_name), (char const   */* __restrict  */)cline,
            (size_t )tmp___0);
#line 181
    cline = pos + 1;
#line 183
    pos = strchr((char const   *)cline, ',');
    }
#line 183
    if (! pos) {
      {
#line 184
      printf((char const   */* __restrict  */)"Couldn\'t find , in parameter %s\n",
             cline);
#line 185
      usage();
      }
    }
    {
#line 188
    block = atoi((char const   *)cline);
#line 189
    vh.vh_vd[v].vd_lbn = block;
#line 191
    cline = pos + 1;
#line 193
    size = atoi((char const   *)cline);
#line 194
    vh.vh_vd[v].vd_nbytes = size;
#line 169
    i ++;
#line 169
    v ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 198
  vh.vh_pt[10].pt_nblks = (int32_t )((st.st_size + 511L) / 512L);
#line 200
  vh.vh_pt[10].pt_firstlbn = 0;
#line 201
  vh.vh_pt[10].pt_type = 6;
#line 204
  vh.vh_pt[8].pt_nblks = (int32_t )((st.st_size + 511L) / 512L);
#line 206
  vh.vh_pt[8].pt_firstlbn = 0;
#line 207
  vh.vh_pt[8].pt_type = 0;
#line 209
  swap_vh_out(& vh);
#line 212
  vh_calc_checksum(& vh);
#line 214
  tmp___1 = write(fd, (void const   *)(& vh), sizeof(vh));
  }
#line 214
  if ((unsigned long )tmp___1 != sizeof(vh)) {
    {
#line 215
    printf((char const   */* __restrict  */)"Failed to write volume header to iso image");
#line 216
    close(fd);
    }
#line 217
    return (1);
  }
  {
#line 220
  close(fd);
  }
#line 221
  return (0);
}
}
