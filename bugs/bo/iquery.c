/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is false */

#line 212 "/usr/lib/gcc/x86_64-linux-gnu/4.6/include/stddef.h"
typedef unsigned long size_t;
#line 30 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned char __u_char;
#line 131 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off_t;
#line 132 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off64_t;
#line 44 "/usr/include/stdio.h"
struct _IO_FILE;
#line 44
struct _IO_FILE;
#line 48 "/usr/include/stdio.h"
typedef struct _IO_FILE FILE;
#line 144 "/usr/include/libio.h"
struct _IO_FILE;
#line 154 "/usr/include/libio.h"
typedef void _IO_lock_t;
#line 160 "/usr/include/libio.h"
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
#line 245 "/usr/include/libio.h"
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15UL * sizeof(int ) - 4UL * sizeof(void *)) - sizeof(size_t )] ;
};
#line 33 "/usr/include/x86_64-linux-gnu/sys/types.h"
typedef __u_char u_char;
#line 201 "/usr/include/x86_64-linux-gnu/sys/types.h"
typedef unsigned short u_int16_t;
#line 48 "/usr/include/arpa/nameser_compat.h"
struct __anonstruct_HEADER_42 {
   unsigned int id : 16 ;
   unsigned int rd : 1 ;
   unsigned int tc : 1 ;
   unsigned int aa : 1 ;
   unsigned int opcode : 4 ;
   unsigned int qr : 1 ;
   unsigned int rcode : 4 ;
   unsigned int cd : 1 ;
   unsigned int ad : 1 ;
   unsigned int unused : 1 ;
   unsigned int ra : 1 ;
   unsigned int qdcount : 16 ;
   unsigned int ancount : 16 ;
   unsigned int nscount : 16 ;
   unsigned int arcount : 16 ;
};
#line 48 "/usr/include/arpa/nameser_compat.h"
typedef struct __anonstruct_HEADER_42 HEADER;
#line 84 "iquery-bad.c"
enum req_action {
    Finish = 0,
    Refuse = 1,
    Return = 2
} ;
#line 237 "/usr/include/stdio.h"
extern int fclose(FILE *__stream ) ;
#line 272
extern FILE *fopen(char const   * __restrict  __filename , char const   * __restrict  __modes ) ;
#line 362
extern int printf(char const   * __restrict  __format  , ...) ;
#line 425
extern int fscanf(FILE * __restrict  __stream , char const   * __restrict  __format 
                  , ...)  __asm__("__isoc99_fscanf")  ;
#line 531
extern int fgetc(FILE *__stream ) ;
#line 466 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) malloc)(size_t __size )  __attribute__((__malloc__)) ;
#line 46 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__nonnull__(1,2), __leaf__)) memcpy)(void * __restrict  __dest ,
                                                                                                 void const   * __restrict  __src ,
                                                                                                 size_t __n ) ;
#line 339 "/usr/include/resolv.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) __dn_skipname)(u_char const   * ,
                                                                                    u_char const   * ) ;
#line 69 "/usr/include/assert.h"
extern  __attribute__((__nothrow__, __noreturn__)) void ( __attribute__((__leaf__)) __assert_fail)(char const   *__assertion ,
                                                                                                   char const   *__file ,
                                                                                                   unsigned int __line ,
                                                                                                   char const   *__function ) ;
#line 86 "iquery-bad.c"
int something  ;
#line 89 "iquery-bad.c"
static enum req_action req_iquery(HEADER *hp , u_char **cpp , u_char *eom , int *buflenp ,
                                  u_char *msg ) 
{ 
  int dlen ;
  int alen ;
  int n ;
  int type ;
  int class ;
  int count ;
  char anbuf[2] ;
  char *data ;
  char *fname ;
  u_char const   *t_cp ;
  u_char const   *t_cp___0 ;
  u_char const   *t_cp___1 ;
  void *__cil_tmp18 ;
  char *__cil_tmp19 ;
  char *__cil_tmp20 ;
  char *__cil_tmp21 ;
  char *__cil_tmp22 ;

  {
  {
#line 98
  n = __dn_skipname((u_char const   *)*cpp, (u_char const   *)eom);
  }
#line 98
  if (n < 0) {
    {
#line 99
    printf((char const   */* __restrict  */)"FORMERR IQuery packet name problem\n");
#line 100
    hp->rcode = 1U;
    }
#line 101
    return ((enum req_action )0);
  }
#line 103
  *cpp += n;
  {
#line 104
  while (1) {
    while_continue: /* CIL Label */ ;
#line 104
    t_cp = (u_char const   *)*cpp;
#line 104
    type = ((int )((u_int16_t )*(t_cp + 0)) << 8) | (int )((u_int16_t )*(t_cp + 1));
#line 104
    *cpp += 2;
#line 104
    goto while_break;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 105
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 105
    t_cp___0 = (u_char const   *)*cpp;
#line 105
    class = ((int )((u_int16_t )*(t_cp___0 + 0)) << 8) | (int )((u_int16_t )*(t_cp___0 + 1));
#line 105
    *cpp += 2;
#line 105
    goto while_break___0;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 106
  *cpp += 4;
  {
#line 107
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 107
    t_cp___1 = (u_char const   *)*cpp;
#line 107
    dlen = ((int )((u_int16_t )*(t_cp___1 + 0)) << 8) | (int )((u_int16_t )*(t_cp___1 + 1));
#line 107
    *cpp += 2;
#line 107
    goto while_break___1;
  }
  while_break___1: /* CIL Label */ ;
  }
#line 108
  *cpp += dlen;
#line 109
  if ((unsigned long )*cpp != (unsigned long )eom) {
    {
#line 110
    printf((char const   */* __restrict  */)"FORMERR IQuery message length off\n");
#line 111
    hp->rcode = 1U;
    }
#line 112
    return ((enum req_action )0);
  }
  {
#line 121
  if (type == 1) {
#line 121
    goto case_1;
  }
#line 125
  goto switch_default;
  case_1: /* CIL Label */ 
#line 122
  if (something == 0) {
#line 123
    return ((enum req_action )1);
  }
#line 124
  goto switch_break;
  switch_default: /* CIL Label */ 
#line 126
  return ((enum req_action )1);
  switch_break: /* CIL Label */ ;
  }
  {
#line 128
  printf((char const   */* __restrict  */)"req: IQuery class %d type %d\n", class,
         type);
#line 130
  fname = (char *)msg + 12;
#line 131
  alen = (int )((char *)*cpp - fname);
#line 133
  printf((char const   */* __restrict  */)"Copying %d bytes from fname to anbuf which can store %d bytes\n",
         alen, sizeof(anbuf));
#line 135
  memcpy((void */* __restrict  */)(anbuf), (void const   */* __restrict  */)fname,
         (size_t )alen);
#line 136
  data = (anbuf + alen) - dlen;
#line 137
  *cpp = (u_char *)fname;
#line 138
  *buflenp -= 12;
#line 139
  count = 0;
  }
#line 144
  return ((enum req_action )0);
}
}
#line 148 "iquery-bad.c"
int create_msg(u_char *msg , int len ) 
{ 
  FILE *f ;
  int i ;
  int c ;
  u_char *tmp ;
  char *__cil_tmp7 ;
  char *__cil_tmp8 ;
  char *__cil_tmp9 ;

  {
  {
#line 151
  i = 0;
#line 154
  f = fopen((char const   */* __restrict  */)"iquery-file", (char const   */* __restrict  */)"r");
  }
#line 154
  if ((unsigned long )f == (unsigned long )((void *)0)) {
    {
#line 156
    printf((char const   */* __restrict  */)"iquery-file not found!\n");
    }
#line 157
    return (-1);
  }
  {
#line 160
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 160
    c = fgetc(f);
    }
#line 160
    if (c != -1) {
#line 160
      if (! (i < len)) {
#line 160
        goto while_break;
      }
    } else {
#line 160
      goto while_break;
    }
#line 161
    tmp = msg;
#line 161
    msg ++;
#line 161
    *tmp = (u_char )c;
#line 162
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 165
  fclose(f);
  }
#line 167
  return (i);
}
}
#line 172 "iquery-bad.c"
int main(int argc , char **argv ) 
{ 
  HEADER *hp ;
  u_char *msg ;
  u_char *cp ;
  u_char *eom ;
  int msglen ;
  FILE *f ;
  int tmp ;
  void *tmp___0 ;
  char *__cil_tmp11 ;
  char *__cil_tmp12 ;
  char *__cil_tmp13 ;
  char *__cil_tmp14 ;
  char *__cil_tmp15 ;
  char *__cil_tmp16 ;
  char *__cil_tmp17 ;
  char *__cil_tmp18 ;
  char *__cil_tmp19 ;
  char *__cil_tmp20 ;
  char *__cil_tmp21 ;
  char *__cil_tmp22 ;
  char *__cil_tmp23 ;

  {
#line 179
  if (! (argc == 2)) {
    {
#line 179
    __assert_fail("argc==2", "iquery-bad.c", 179U, "main");
    }
  }
  {
#line 180
  f = fopen((char const   */* __restrict  */)*(argv + 1), (char const   */* __restrict  */)"r");
  }
#line 181
  if (! ((unsigned long )f != (unsigned long )((void *)0))) {
    {
#line 181
    __assert_fail("f!=((void *)0)", "iquery-bad.c", 181U, "main");
    }
  }
  {
#line 182
  tmp = fscanf((FILE */* __restrict  */)f, (char const   */* __restrict  */)"%d",
               & something);
  }
#line 182
  if (! (tmp != 0)) {
    {
#line 182
    __assert_fail("(fscanf(f, \"%d\", &something)) != 0", "iquery-bad.c", 182U, "main");
    }
  }
  {
#line 185
  tmp___0 = malloc(10000UL * sizeof(u_char ));
#line 185
  msg = (u_char *)tmp___0;
#line 186
  msglen = create_msg(msg, 10000);
#line 188
  hp = (HEADER *)msg;
#line 195
  cp = msg + sizeof(HEADER );
#line 196
  eom = msg + msglen;
#line 198
  printf((char const   */* __restrict  */)"opcode = %d\n", hp->opcode);
  }
  {
#line 201
  if (hp->opcode == 1U) {
#line 201
    goto case_1;
  }
#line 204
  goto switch_default;
  case_1: /* CIL Label */ 
  {
#line 202
  req_iquery(hp, & cp, eom, & msglen, msg);
  }
#line 203
  goto switch_break;
  switch_default: /* CIL Label */ 
  {
#line 205
  printf((char const   */* __restrict  */)"We only support inverse queries!\n");
  }
  switch_break: /* CIL Label */ ;
  }
#line 208
  return (0);
}
}
