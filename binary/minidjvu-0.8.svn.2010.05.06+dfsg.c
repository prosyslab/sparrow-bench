/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is false */

#line 37 "/usr/include/stdint.h"
typedef short int16_t;
#line 38 "/usr/include/stdint.h"
typedef int int32_t;
#line 49 "/usr/include/stdint.h"
typedef unsigned short uint16_t;
#line 51 "/usr/include/stdint.h"
typedef unsigned int uint32_t;
#line 37 "../include/minidjvu/base/0porting.h"
typedef int32_t int32;
#line 38 "../include/minidjvu/base/0porting.h"
typedef uint32_t uint32;
#line 39 "../include/minidjvu/base/0porting.h"
typedef int16_t int16;
#line 40 "../include/minidjvu/base/0porting.h"
typedef uint16_t uint16;
#line 212 "/usr/lib/gcc/x86_64-linux-gnu/4.8/include/stddef.h"
typedef unsigned long size_t;
#line 131 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off_t;
#line 132 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off64_t;
#line 44 "/usr/include/stdio.h"
struct _IO_FILE;
#line 48 "/usr/include/stdio.h"
typedef struct _IO_FILE FILE;
#line 154 "/usr/include/libio.h"
typedef void _IO_lock_t;
#line 160 "/usr/include/libio.h"
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
#line 245 "/usr/include/libio.h"
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15UL * sizeof(int ) - 4UL * sizeof(void *)) - sizeof(size_t )] ;
};
#line 5 "../include/minidjvu/base/4bitmap.h"
struct MinidjvuBitmap;
#line 5 "../include/minidjvu/base/4bitmap.h"
typedef struct MinidjvuBitmap *mdjvu_bitmap_t;
#line 5 "../include/minidjvu/base/5image.h"
struct MinidjvuImage;
#line 5 "../include/minidjvu/base/5image.h"
typedef struct MinidjvuImage *mdjvu_image_t;
#line 5 "../include/minidjvu/alg/split.h"
struct MinidjvuSplitOptions;
#line 5 "../include/minidjvu/alg/split.h"
typedef struct MinidjvuSplitOptions *mdjvu_split_options_t;
#line 14 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/blitsort.c"
struct __anonstruct_BlitPassport_22 {
   int32 left ;
   int32 top ;
   int32 right ;
   int32 bottom ;
   int32 original_index ;
};
#line 14 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/blitsort.c"
typedef struct __anonstruct_BlitPassport_22 BlitPassport;
#line 5 "../include/minidjvu/base/1error.h"
struct MinidjvuError;
#line 5 "../include/minidjvu/base/1error.h"
typedef struct MinidjvuError  const  *mdjvu_error_t;
#line 9
enum __anonenum_MinidjvuErrorType_1 {
    mdjvu_error_fopen_write = 0,
    mdjvu_error_fopen_read = 1,
    mdjvu_error_io = 2,
    mdjvu_error_corrupted_pbm = 3,
    mdjvu_error_corrupted_bmp = 4,
    mdjvu_error_corrupted_djvu = 5,
    mdjvu_error_corrupted_jb2 = 6,
    mdjvu_error_corrupted_tiff = 7,
    mdjvu_error_wrong_djvu_type = 8,
    mdjvu_error_djvu_no_Sjbz = 9,
    mdjvu_error_recursive_prototypes = 10,
    mdjvu_error_tiff_support_disabled = 11,
    mdjvu_error_png_support_disabled = 12
} ;
#line 9 "../include/minidjvu/base/1error.h"
typedef enum __anonenum_MinidjvuErrorType_1 MinidjvuErrorType;
#line 18 "../include/minidjvu/base/2io.h"
struct MinidjvuFile;
#line 18 "../include/minidjvu/base/2io.h"
typedef struct MinidjvuFile *mdjvu_file_t;
#line 29 "../include/minidjvu/djvu/iff.h"
struct MdjvuNonexistentIffStruct;
#line 29 "../include/minidjvu/djvu/iff.h"
typedef struct MdjvuNonexistentIffStruct *mdjvu_iff_t;
#line 76 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c"
typedef unsigned char byte;
#line 315 "/usr/include/libio.h"
typedef struct _IO_FILE _IO_FILE;
#line 9 "../include/minidjvu/alg/../matcher.h"
struct MinidjvuMatcherOptions;
#line 9 "../include/minidjvu/alg/../matcher.h"
typedef struct MinidjvuMatcherOptions *mdjvu_matcher_options_t;
#line 32
struct MinidjvuPattern;
#line 32 "../include/minidjvu/alg/../matcher.h"
typedef struct MinidjvuPattern *mdjvu_pattern_t;
#line 27 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
struct __anonstruct_Options_28 {
   double pithdiff1_threshold ;
   double pithdiff2_threshold ;
   double shiftdiff1_threshold ;
   double shiftdiff2_threshold ;
   double shiftdiff3_threshold ;
   int aggression ;
   int method ;
};
#line 27 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
typedef struct __anonstruct_Options_28 Options;
#line 111 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
struct ComparableImageData {
   byte **pixels ;
   byte **pith2_inner ;
   byte **pith2_outer ;
   int32 width ;
   int32 height ;
   int32 mass ;
   int32 mass_center_x ;
   int32 mass_center_y ;
   byte signature[32] ;
   byte signature2[32] ;
};
#line 111 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
typedef struct ComparableImageData Image;
#line 11 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
struct __anonstruct_Bitmap_22 {
   unsigned char **data ;
   int32 width ;
   int32 height ;
   int32 index ;
};
#line 11 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
typedef struct __anonstruct_Bitmap_22 Bitmap;
#line 33 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
struct ClassNode {
   mdjvu_pattern_t ptr ;
   struct ClassNode *next ;
   struct ClassNode *global_next ;
   int32 tag ;
};
#line 33 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
typedef struct ClassNode ClassNode;
#line 42 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
struct Class {
   ClassNode *first ;
   ClassNode *last ;
   struct Class *prev_class ;
   struct Class *next_class ;
   int32 last_page ;
};
#line 42 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
typedef struct Class Class;
#line 51 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
struct Classification {
   Class *first_class ;
   ClassNode *first_node ;
   ClassNode *last_node ;
};
#line 51 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
typedef struct Classification Classification;
#line 24 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
struct __anonstruct_Chunk_26 {
   int32 id ;
   uint32 start ;
   uint32 length ;
   int write ;
};
#line 24 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
typedef struct __anonstruct_Chunk_26 Chunk;
#line 19 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
struct IFFChunk {
   uint32 id ;
   uint32 length ;
   uint32 skipped ;
   struct IFFChunk *parent ;
};
#line 19 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
typedef struct IFFChunk IFFChunk;
#line 25 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
enum __anonenum_mdjvu_artifact_type_enum_26 {
    mdjvu_artifact_prototype = 0,
    mdjvu_artifact_substitution = 1,
    mdjvu_artifact_not_a_letter_flag = 2,
    mdjvu_artifact_suspiciously_big_flag = 3,
    mdjvu_artifact_mass = 4,
    mdjvu_artifact_dictionary_index = 5,
    mdjvu_artifact_center = 6,
    mdjvu_artifacts_count = 7
} ;
#line 25 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
typedef enum __anonenum_mdjvu_artifact_type_enum_26 mdjvu_artifact_type_enum;
#line 37 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
struct __anonstruct_Point_27 {
   int32 x ;
   int32 y ;
};
#line 37 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
typedef struct __anonstruct_Point_27 Point;
#line 59 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
struct __anonstruct_Image_28 {
   int32 width ;
   int32 height ;
   mdjvu_bitmap_t *bitmaps ;
   int32 bitmaps_count ;
   int32 bitmaps_allocated ;
   int32 *x ;
   int32 *y ;
   mdjvu_bitmap_t *blits ;
   int32 blits_count ;
   int32 blits_allocated ;
   mdjvu_image_t dictionary ;
   int32 resolution ;
   void *artifacts[7] ;
};
#line 59 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
typedef struct __anonstruct_Image_28 Image___0;
#line 5 "../include/minidjvu/alg/compress.h"
struct MinidjvuCompressionOptions;
#line 5 "../include/minidjvu/alg/compress.h"
typedef struct MinidjvuCompressionOptions *mdjvu_compression_options_t;
#line 12 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
struct MinidjvuCompressionOptions {
   int clean ;
   int verbose ;
   int no_prototypes ;
   int averaging ;
   int report ;
   int report_start_page ;
   int report_total_pages ;
   mdjvu_matcher_options_t matcher_options ;
};
#line 11 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
struct __anonstruct_Header_26 {
   uint32 file_size ;
   uint32 reserved ;
   uint32 offset ;
   uint32 size ;
   uint32 width ;
   uint32 height ;
   uint16 planes ;
   uint16 bits ;
   uint32 compression ;
   uint32 imagesize ;
   uint32 xresolution ;
   uint32 yresolution ;
   uint32 ncolors ;
   uint32 importantcolors ;
   uint32 color_0 ;
   uint32 color_1 ;
};
#line 11 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
typedef struct __anonstruct_Header_26 Header;
#line 86 "/usr/include/libintl.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__leaf__)) bindtextdomain)(char const   *__domainname ,
                                                                                       char const   *__dirname ) ;
#line 46 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/../base/mdjvucfg.h"
void mdjvu_init(void) ;
#line 105 "../include/minidjvu/base/0porting.h"
char const   *mdjvu_check_sanity(void) ;
#line 170 "/usr/include/stdio.h"
extern struct _IO_FILE *stderr ;
#line 356
extern int fprintf(FILE * __restrict  __stream , char const   * __restrict  __format 
                   , ...) ;
#line 543 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__, __noreturn__)) void ( __attribute__((__leaf__)) exit)(int __status ) ;
#line 14 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/0porting.c"
char const   *mdjvu_check_sanity(void) 
{ 


  {
#line 16
  if (sizeof(int32 ) != 4UL) {
#line 17
    return ("mdjvu_check_sanity(): sizeof(int32) != 4");
  }
#line 19
  if (sizeof(uint32 ) != 4UL) {
#line 20
    return ("mdjvu_check_sanity(): sizeof(uint32) != 4");
  }
#line 22
  if (sizeof(int16 ) != 2UL) {
#line 23
    return ("mdjvu_check_sanity(): sizeof(int16) != 2");
  }
#line 25
  if (sizeof(uint16 ) != 2UL) {
#line 26
    return ("mdjvu_check_sanity(): sizeof(uint16) != 2");
  }
#line 28
  return ((char const   *)((void *)0));
}
}
#line 32 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/0porting.c"
static int initialized  =    0;
#line 34 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/0porting.c"
void mdjvu_init(void) 
{ 
  char const   *sanity_error_message ;

  {
#line 38
  if (initialized) {
#line 39
    return;
  }
  {
#line 42
  bindtextdomain("minidjvu", "/usr/local/share/locale");
#line 46
  sanity_error_message = mdjvu_check_sanity();
  }
#line 47
  if (sanity_error_message) {
    {
#line 49
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s\n",
            sanity_error_message);
#line 50
    exit(1);
    }
  }
#line 53
  initialized = 1;
#line 54
  return;
}
}
#line 20 "../include/minidjvu/base/3graymap.h"
unsigned char **mdjvu_create_2d_array(int32 w , int32 h ) ;
#line 23
void mdjvu_destroy_2d_array(unsigned char **p ) ;
#line 16 "../include/minidjvu/base/4bitmap.h"
mdjvu_bitmap_t mdjvu_bitmap_create(int32 width , int32 height ) ;
#line 19
void mdjvu_bitmap_destroy(mdjvu_bitmap_t bmp ) ;
#line 22
int32 mdjvu_bitmap_get_width(mdjvu_bitmap_t b ) ;
#line 23
int32 mdjvu_bitmap_get_height(mdjvu_bitmap_t b ) ;
#line 51
void mdjvu_bitmap_unpack_row(mdjvu_bitmap_t b , unsigned char *bytes , int32 y ) ;
#line 61
void mdjvu_bitmap_pack_row(mdjvu_bitmap_t b , unsigned char *bytes , int32 y ) ;
#line 76
mdjvu_bitmap_t mdjvu_bitmap_crop(mdjvu_bitmap_t b , int32 left , int32 top , int32 w ,
                                 int32 h ) ;
#line 11 "../include/minidjvu/base/5image.h"
mdjvu_image_t mdjvu_image_create(int32 width , int32 height ) ;
#line 47
int32 mdjvu_image_add_blit(mdjvu_image_t image , int32 x , int32 y , mdjvu_bitmap_t bitmap ) ;
#line 69
int32 mdjvu_image_add_bitmap(mdjvu_image_t image , mdjvu_bitmap_t bmp ) ;
#line 98
void mdjvu_image_set_resolution(mdjvu_image_t image , int32 dpi___0 ) ;
#line 142
void mdjvu_image_enable_suspiciously_big_flags(mdjvu_image_t image ) ;
#line 146
void mdjvu_image_set_suspiciously_big_flag(mdjvu_image_t image , mdjvu_bitmap_t b ,
                                           int v ) ;
#line 8 "../include/minidjvu/alg/split.h"
mdjvu_split_options_t mdjvu_split_options_create(void) ;
#line 12
void mdjvu_split_options_set_maximum_shape_size(mdjvu_split_options_t opt , int32 size ) ;
#line 13
void mdjvu_split_options_destroy(mdjvu_split_options_t opt ) ;
#line 16
mdjvu_image_t mdjvu_split(mdjvu_bitmap_t bitmap , int32 dpi___0 , mdjvu_split_options_t opt ) ;
#line 69 "/usr/include/assert.h"
extern  __attribute__((__nothrow__, __noreturn__)) void ( __attribute__((__leaf__)) __assert_fail)(char const   *__assertion ,
                                                                                                   char const   *__file ,
                                                                                                   unsigned int __line ,
                                                                                                   char const   *__function ) ;
#line 466 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) malloc)(size_t __size )  __attribute__((__malloc__)) ;
#line 483
extern  __attribute__((__nothrow__)) void ( __attribute__((__leaf__)) free)(void *__ptr ) ;
#line 66 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__nonnull__(1), __leaf__)) memset)(void *__s ,
                                                                                               int __c ,
                                                                                               size_t __n ) ;
#line 13 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
mdjvu_split_options_t mdjvu_split_options_create(void) 
{ 
  int32 *p ;
  void *tmp ;

  {
  {
#line 15
  tmp = malloc(sizeof(int32 ));
#line 15
  p = (int32 *)tmp;
#line 16
  mdjvu_init();
#line 17
  *p = 0;
  }
#line 18
  return ((mdjvu_split_options_t )p);
}
}
#line 21 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
void mdjvu_split_options_set_maximum_shape_size(mdjvu_split_options_t opt , int32 size ) 
{ 


  {
#line 23
  if (! (size > 0)) {
    {
#line 23
    __assert_fail("size > 0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c",
                  23U, "mdjvu_split_options_set_maximum_shape_size");
    }
  }
#line 24
  *((int32 *)opt) = size;
#line 25
  return;
}
}
#line 27 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
void mdjvu_split_options_destroy(mdjvu_split_options_t opt ) 
{ 


  {
  {
#line 29
  free((void *)opt);
  }
#line 30
  return;
}
}
#line 57 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
static void interpret_runs_in_a_line(int32 min_x , int32 max_x , unsigned char *map ,
                                     unsigned char *result_line , unsigned char *line ) 
{ 
  int32 i ;

  {
  {
#line 62
  i = min_x;
#line 63
  memset((void *)result_line, 0, (size_t )((max_x - min_x) + 1));
#line 64
  *(map + (max_x + 1)) = (unsigned char)0;
  }
  {
#line 65
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 68
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 68
      if (! ((int )*(map + i) != 1)) {
#line 68
        goto while_break___0;
      }
#line 70
      i ++;
#line 70
      if (i > max_x) {
#line 70
        return;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 73
    *(map + i) = (unsigned char)0;
    {
#line 76
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 76
      if (! ((int )*(map + i) != 2)) {
#line 76
        goto while_break___1;
      }
#line 78
      *(result_line + (i - min_x)) = *(line + i);
#line 79
      *(line + i) = (unsigned char)0;
#line 80
      i ++;
#line 80
      if (i > max_x) {
#line 80
        return;
      }
    }
    while_break___1: /* CIL Label */ ;
    }
#line 83
    *(map + i) = (unsigned char)0;
  }
  while_break: /* CIL Label */ ;
  }
}
}
#line 93 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
static mdjvu_bitmap_t interpret_runs(int32 min_x , int32 max_x , int32 min_y , int32 max_y ,
                                     unsigned char **map , unsigned char **pixels ) 
{ 
  int32 w ;
  int32 h ;
  unsigned char *line_buf ;
  void *tmp ;
  mdjvu_bitmap_t bmp ;
  mdjvu_bitmap_t tmp___0 ;
  int32 y ;

  {
  {
#line 98
  w = (max_x - min_x) + 1;
#line 99
  h = (max_y - min_y) + 1;
#line 100
  tmp = malloc((size_t )w);
#line 100
  line_buf = (unsigned char *)tmp;
#line 101
  tmp___0 = mdjvu_bitmap_create(w, h);
#line 101
  bmp = tmp___0;
#line 103
  y = min_y;
  }
  {
#line 103
  while (1) {
    while_continue: /* CIL Label */ ;
#line 103
    if (! (y <= max_y)) {
#line 103
      goto while_break;
    }
    {
#line 105
    interpret_runs_in_a_line(min_x, max_x, *(map + y), line_buf, *(pixels + y));
#line 106
    mdjvu_bitmap_pack_row(bmp, line_buf, y - min_y);
#line 103
    y ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 108
  free((void *)line_buf);
  }
#line 109
  return (bmp);
}
}
#line 119 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
static void walk_around_a_black_contour(unsigned char **pixels , unsigned char **map ,
                                        int32 start_x , int32 start_y , int32 *pmin_x ,
                                        int32 *pmax_x , int32 *pmin_y , int32 *pmax_y ) 
{ 
  int32 x ;
  int32 y ;
  int32 dx ;
  int32 dy ;
  int32 min_x ;
  int32 max_x ;
  int32 max_y ;
  int32 x4 ;
  int32 y4 ;
  int32 old_dx ;
  int32 old_dx___0 ;

  {
#line 125
  x = start_x;
#line 125
  y = start_y;
#line 126
  dx = 0;
#line 126
  dy = 1;
#line 133
  min_x = start_x;
#line 134
  max_x = start_x;
#line 135
  max_y = start_y;
  {
#line 161
  while (1) {
    while_continue: /* CIL Label */ ;
#line 161
    if (! (x != start_x)) {
#line 161
      if (! (y != start_y)) {
#line 161
        if (! (dx != -1)) {
#line 161
          goto while_break;
        }
      }
    }
#line 163
    if (! *(*(pixels + y) + x)) {
      {
#line 163
      __assert_fail("pixels[y][x]", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c",
                    163U, "walk_around_a_black_contour");
      }
    }
#line 166
    if (x < min_x) {
#line 166
      min_x = x;
    } else
#line 166
    if (x > max_x) {
#line 166
      max_x = x;
    }
#line 167
    if (y > max_y) {
#line 167
      max_y = y;
    }
#line 170
    if (dx == 0) {
#line 172
      if (dy > 0) {
#line 173
        *(*(map + y) + x) = (unsigned char)1;
      } else {
#line 175
        *(*(map + y) + (x + 1)) = (unsigned char)2;
      }
    }
#line 179
    if (*(*(pixels + (y + dy)) + (x + dx))) {
#line 181
      x4 = (x + dx) - dy;
#line 181
      y4 = (y + dy) + dx;
#line 183
      if (*(*(pixels + y4) + x4)) {
#line 188
        old_dx = dx;
#line 189
        dx = - dy;
#line 190
        dy = old_dx;
#line 191
        x = x4;
#line 191
        y = y4;
      } else {
#line 196
        x += dx;
#line 196
        y += dy;
      }
    } else {
#line 203
      old_dx___0 = dx;
#line 204
      dx = dy;
#line 205
      dy = - old_dx___0;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 208
  *pmin_x = min_x;
#line 209
  *pmax_x = max_x;
#line 210
  *pmin_y = start_y;
#line 211
  *pmax_y = max_y;
#line 212
  return;
}
}
#line 216
static void add_to_image(mdjvu_image_t image , mdjvu_bitmap_t bitmap , int32 dpi___0 ,
                         mdjvu_split_options_t opt , int32 blit_shift_x , int32 blit_shift_y ,
                         int big ) ;
#line 227 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
static void process_row(unsigned char **pixels , unsigned char **map , int32 y , int32 w ,
                        int32 h , mdjvu_image_t image , int32 shift_x , int32 shift_y ,
                        int32 max_shape_width , int32 blit_shift_x , int32 blit_shift_y ,
                        int32 dpi___0 , mdjvu_split_options_t opt , int big ) 
{ 
  unsigned char *row ;
  int32 i ;
  int32 min_x ;
  int32 max_x ;
  int32 min_y ;
  int32 max_y ;
  int32 shape_width ;
  mdjvu_bitmap_t bitmap ;
  int32 tmp ;
  int32 number_of_chunks ;
  int32 j ;
  int32 shape_height ;
  int32 tmp___0 ;
  int32 chunk_x ;
  mdjvu_bitmap_t chunk ;
  mdjvu_bitmap_t tmp___1 ;

  {
#line 235
  row = *(pixels + y);
#line 237
  i = 0;
  {
#line 237
  while (1) {
    while_continue: /* CIL Label */ ;
#line 237
    if (! (i < w)) {
#line 237
      goto while_break;
    }
#line 239
    if (*(row + i)) {
      {
#line 245
      walk_around_a_black_contour(pixels, map, i, y, & min_x, & max_x, & min_y, & max_y);
#line 247
      bitmap = interpret_runs(min_x, max_x, min_y, max_y, map, pixels);
#line 250
      shape_width = mdjvu_bitmap_get_width(bitmap);
      }
#line 251
      if (! (shape_width == (max_x - min_x) + 1)) {
        {
#line 251
        __assert_fail("shape_width == max_x - min_x + 1", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c",
                      251U, "process_row");
        }
      }
      {
#line 252
      tmp = mdjvu_bitmap_get_height(bitmap);
      }
#line 252
      if (! (tmp == (max_y - min_y) + 1)) {
        {
#line 252
        __assert_fail("mdjvu_bitmap_get_height(bitmap) == max_y - min_y + 1", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c",
                      252U, "process_row");
        }
      }
#line 253
      if (shape_width <= max_shape_width) {
        {
#line 255
        mdjvu_image_add_bitmap(image, bitmap);
#line 256
        mdjvu_image_add_blit(image, (shift_x + min_x) + blit_shift_x, (y + shift_y) + blit_shift_y,
                             bitmap);
#line 258
        mdjvu_image_set_suspiciously_big_flag(image, bitmap, big);
        }
      } else {
        {
#line 263
        number_of_chunks = ((shape_width + max_shape_width) - 1) / max_shape_width;
#line 267
        tmp___0 = mdjvu_bitmap_get_height(bitmap);
#line 267
        shape_height = tmp___0;
#line 268
        j = 0;
        }
        {
#line 268
        while (1) {
          while_continue___0: /* CIL Label */ ;
#line 268
          if (! (j < number_of_chunks)) {
#line 268
            goto while_break___0;
          }
          {
#line 270
          chunk_x = (shape_width * j) / number_of_chunks;
#line 271
          tmp___1 = mdjvu_bitmap_crop(bitmap, chunk_x, 0, (shape_width * (j + 1)) / number_of_chunks - chunk_x,
                                      shape_height);
#line 271
          chunk = tmp___1;
#line 280
          add_to_image(image, chunk, dpi___0, opt, ((shift_x + chunk_x) + min_x) + blit_shift_x,
                       (y + shift_y) + blit_shift_y, 1);
#line 283
          mdjvu_bitmap_destroy(chunk);
#line 268
          j ++;
          }
        }
        while_break___0: /* CIL Label */ ;
        }
        {
#line 285
        mdjvu_bitmap_destroy(bitmap);
        }
      }
    }
#line 237
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 289
  return;
}
}
#line 295 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
static void add_to_image(mdjvu_image_t image , mdjvu_bitmap_t bitmap , int32 dpi___0 ,
                         mdjvu_split_options_t opt , int32 blit_shift_x , int32 blit_shift_y ,
                         int big ) 
{ 
  int32 max_shape_size ;
  int32 tmp ;
  int32 width ;
  int32 tmp___0 ;
  int32 height ;
  int32 tmp___1 ;
  unsigned char **buf ;
  unsigned char **window_base ;
  unsigned char **window_buf ;
  unsigned char **map ;
  int32 window_shift ;
  int32 y ;
  int32 i ;
  void *tmp___2 ;
  unsigned char *tmp___3 ;
  unsigned char *tmp___4 ;
  unsigned char *top_margin_save ;
  unsigned char *bot_margin_save ;
  int32 old_window_shift ;

  {
#line 303
  if (opt) {
#line 303
    tmp = *((int32 *)opt);
  } else {
#line 303
    tmp = 0;
  }
  {
#line 303
  max_shape_size = tmp;
#line 304
  tmp___0 = mdjvu_bitmap_get_width(bitmap);
#line 304
  width = tmp___0;
#line 305
  tmp___1 = mdjvu_bitmap_get_height(bitmap);
#line 305
  height = tmp___1;
#line 307
  window_shift = 0;
#line 307
  y = 0;
  }
#line 309
  if (! max_shape_size) {
#line 310
    max_shape_size = dpi___0;
  }
#line 311
  if (max_shape_size > height) {
#line 312
    max_shape_size = height;
  }
  {
#line 327
  map = mdjvu_create_2d_array(width + 1, max_shape_size);
#line 330
  buf = mdjvu_create_2d_array(width + 2, max_shape_size + 1);
#line 331
  tmp___2 = malloc((unsigned long )(2 * (max_shape_size + 2)) * sizeof(unsigned char *));
#line 331
  window_buf = (unsigned char **)tmp___2;
#line 333
  window_base = window_buf + 1;
#line 336
  i = 0;
  }
  {
#line 336
  while (1) {
    while_continue: /* CIL Label */ ;
#line 336
    if (! (i < max_shape_size)) {
#line 336
      goto while_break;
    }
    {
#line 338
    tmp___3 = *(buf + i) + 1;
#line 338
    *(window_base + (max_shape_size + i)) = tmp___3;
#line 338
    *(window_base + i) = tmp___3;
#line 339
    mdjvu_bitmap_unpack_row(bitmap, *(buf + i) + 1, i);
#line 336
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 343
  tmp___4 = *(buf + max_shape_size) + 1;
#line 343
  *(window_base + (2 * max_shape_size - 1)) = tmp___4;
#line 343
  *(window_base + -1) = tmp___4;
  {
#line 350
  while (1) {
    while_continue___0: /* CIL Label */ ;
    {
#line 356
    top_margin_save = *(window_base + (window_shift - 1));
#line 358
    bot_margin_save = *(window_base + (window_shift + max_shape_size));
#line 361
    *(window_base + (window_shift - 1)) = *(buf + max_shape_size) + 1;
#line 362
    *(window_base + (window_shift + max_shape_size)) = *(buf + max_shape_size) + 1;
#line 364
    process_row(window_base + window_shift, map, 0, width, max_shape_size, image,
                0, y, max_shape_size, blit_shift_x, blit_shift_y, dpi___0, opt, big);
#line 369
    *(window_base + (window_shift - 1)) = top_margin_save;
#line 370
    *(window_base + (window_shift + max_shape_size)) = bot_margin_save;
#line 373
    y ++;
#line 374
    old_window_shift = window_shift;
#line 375
    window_shift = y % max_shape_size;
    }
#line 376
    if (y + max_shape_size > height) {
#line 377
      goto while_break___0;
    }
    {
#line 380
    mdjvu_bitmap_unpack_row(bitmap, *(buf + old_window_shift) + 1, (y + max_shape_size) - 1);
    }
  }
  while_break___0: /* CIL Label */ ;
  }
#line 385
  i = 0;
  {
#line 385
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 385
    if (! (y + i < height)) {
#line 385
      goto while_break___1;
    }
    {
#line 387
    process_row(window_base + window_shift, map, i, width, max_shape_size, image,
                0, y, max_shape_size, blit_shift_x, blit_shift_y, dpi___0, opt, big);
#line 385
    i ++;
    }
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 394
  free((void *)window_buf);
#line 395
  mdjvu_destroy_2d_array(map);
#line 396
  mdjvu_destroy_2d_array(buf);
  }
#line 397
  return;
}
}
#line 399 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
mdjvu_image_t mdjvu_split(mdjvu_bitmap_t bitmap , int32 dpi___0 , mdjvu_split_options_t opt ) 
{ 
  int32 width ;
  int32 tmp ;
  int32 height ;
  int32 tmp___0 ;
  mdjvu_image_t result ;
  mdjvu_image_t tmp___1 ;

  {
  {
#line 402
  tmp = mdjvu_bitmap_get_width(bitmap);
#line 402
  width = tmp;
#line 403
  tmp___0 = mdjvu_bitmap_get_height(bitmap);
#line 403
  height = tmp___0;
#line 404
  tmp___1 = mdjvu_image_create(width, height);
#line 404
  result = tmp___1;
#line 405
  mdjvu_image_enable_suspiciously_big_flags(result);
#line 406
  mdjvu_image_set_resolution(result, dpi___0);
#line 407
  add_to_image(result, bitmap, dpi___0, opt, 0, 0, 0);
  }
#line 408
  return (result);
}
}
#line 28 "../include/minidjvu/base/4bitmap.h"
int32 mdjvu_bitmap_get_index(mdjvu_bitmap_t b ) ;
#line 35 "../include/minidjvu/base/5image.h"
int32 mdjvu_image_get_blit_count(mdjvu_image_t image ) ;
#line 37
int32 mdjvu_image_get_blit_x(mdjvu_image_t image , int32 i ) ;
#line 38
int32 mdjvu_image_get_blit_y(mdjvu_image_t image , int32 i ) ;
#line 40
mdjvu_bitmap_t mdjvu_image_get_blit_bitmap(mdjvu_image_t image , int32 i ) ;
#line 42
void mdjvu_image_set_blit_x(mdjvu_image_t image , int32 i , int32 x ) ;
#line 43
void mdjvu_image_set_blit_y(mdjvu_image_t image , int32 i , int32 y ) ;
#line 45
void mdjvu_image_set_blit_bitmap(mdjvu_image_t image , int32 i , mdjvu_bitmap_t b ) ;
#line 60
int32 mdjvu_image_get_bitmap_count(mdjvu_image_t image ) ;
#line 63
mdjvu_bitmap_t mdjvu_image_get_bitmap(mdjvu_image_t image , int32 i ) ;
#line 66
int mdjvu_image_has_bitmap(mdjvu_image_t image , mdjvu_bitmap_t bitmap ) ;
#line 122
mdjvu_bitmap_t mdjvu_image_get_substitution(mdjvu_image_t image , mdjvu_bitmap_t b ) ;
#line 132
int mdjvu_image_has_not_a_letter_flags(mdjvu_image_t image ) ;
#line 135
int mdjvu_image_get_not_a_letter_flag(mdjvu_image_t image , mdjvu_bitmap_t b ) ;
#line 10 "../include/minidjvu/alg/adjust_y.h"
void mdjvu_adjust(mdjvu_image_t image ) ;
#line 17
void mdjvu_multipage_adjust(mdjvu_image_t dict , int32 npages , mdjvu_image_t *pages ) ;
#line 468 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) calloc)(size_t __nmemb ,
                                                                               size_t __size )  __attribute__((__malloc__)) ;
#line 775
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) abs)(int __x )  __attribute__((__const__)) ;
#line 26 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
static int32 compute_baseline(mdjvu_bitmap_t bitmap ) 
{ 
  int32 w ;
  int32 tmp ;
  int32 h ;
  int32 tmp___0 ;
  int32 *mass ;
  void *tmp___1 ;
  unsigned char *row ;
  void *tmp___2 ;
  int32 i ;
  int32 j ;
  int32 m ;
  int32 tm ;

  {
  {
#line 28
  tmp = mdjvu_bitmap_get_width(bitmap);
#line 28
  w = tmp;
#line 29
  tmp___0 = mdjvu_bitmap_get_height(bitmap);
#line 29
  h = tmp___0;
#line 30
  tmp___1 = malloc((unsigned long )h * sizeof(int32 ));
#line 30
  mass = (int32 *)tmp___1;
#line 31
  tmp___2 = malloc((size_t )w);
#line 31
  row = (unsigned char *)tmp___2;
#line 33
  tm = 0;
#line 34
  i = 0;
  }
  {
#line 34
  while (1) {
    while_continue: /* CIL Label */ ;
#line 34
    if (! (i < h)) {
#line 34
      goto while_break;
    }
    {
#line 36
    mdjvu_bitmap_unpack_row(bitmap, row, i);
#line 37
    j = 0;
    }
    {
#line 37
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 37
      if (! (j < w)) {
#line 37
        goto while_break___0;
      }
#line 39
      if (*(row + j)) {
#line 40
        goto while_break___0;
      }
#line 37
      j ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 42
    m = w - j;
    {
#line 42
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 42
      if (! (m > 0)) {
#line 42
        goto while_break___1;
      }
#line 44
      if (*(row + ((j + m) - 1))) {
#line 45
        goto while_break___1;
      }
#line 42
      m --;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 47
    *(mass + ((h - i) - 1)) = m;
#line 48
    tm += m;
#line 34
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 51
  m = 0;
#line 52
  i = 0;
  {
#line 54
  while (1) {
    while_continue___2: /* CIL Label */ ;
#line 54
    if (! (m * 6 < tm * 4)) {
#line 54
      goto while_break___2;
    }
#line 56
    m += *(mass + i / 4);
#line 57
    i ++;
  }
  while_break___2: /* CIL Label */ ;
  }
  {
#line 60
  free((void *)row);
#line 61
  free((void *)mass);
  }
#line 63
  return (4 * (h - 1) - i);
}
}
#line 70 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
static void update_blits(mdjvu_image_t image , int32 *x_adjust , int32 *y_adjust ) 
{ 
  int32 b ;
  int32 tmp ;
  int32 i ;
  int32 x ;
  int32 tmp___0 ;
  int32 y ;
  int32 tmp___1 ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___2 ;
  mdjvu_bitmap_t subst ;
  mdjvu_bitmap_t tmp___3 ;
  int32 k ;
  int32 tmp___4 ;

  {
  {
#line 72
  tmp = mdjvu_image_get_blit_count(image);
#line 72
  b = tmp;
#line 74
  i = 0;
  }
  {
#line 74
  while (1) {
    while_continue: /* CIL Label */ ;
#line 74
    if (! (i < b)) {
#line 74
      goto while_break;
    }
    {
#line 76
    tmp___0 = mdjvu_image_get_blit_x(image, i);
#line 76
    x = tmp___0;
#line 77
    tmp___1 = mdjvu_image_get_blit_y(image, i);
#line 77
    y = tmp___1;
#line 78
    tmp___2 = mdjvu_image_get_blit_bitmap(image, i);
#line 78
    bitmap = tmp___2;
#line 79
    tmp___3 = mdjvu_image_get_substitution(image, bitmap);
#line 79
    subst = tmp___3;
#line 80
    tmp___4 = mdjvu_bitmap_get_index(bitmap);
#line 80
    k = tmp___4;
#line 82
    mdjvu_image_set_blit_x(image, i, x + *(x_adjust + k));
#line 83
    mdjvu_image_set_blit_y(image, i, y + *(y_adjust + k));
#line 84
    mdjvu_image_set_blit_bitmap(image, i, subst);
#line 74
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 86
  return;
}
}
#line 91 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
static int32 *get_baselines(mdjvu_image_t image ) 
{ 
  int32 i ;
  int32 n ;
  int32 tmp ;
  int32 *baseline ;
  void *tmp___0 ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___1 ;
  int tmp___2 ;
  int tmp___3 ;

  {
  {
#line 94
  tmp = mdjvu_image_get_bitmap_count(image);
#line 94
  n = tmp;
#line 95
  tmp___0 = malloc((unsigned long )n * sizeof(int32 ));
#line 95
  baseline = (int32 *)tmp___0;
#line 96
  i = 0;
  }
  {
#line 96
  while (1) {
    while_continue: /* CIL Label */ ;
#line 96
    if (! (i < n)) {
#line 96
      goto while_break;
    }
    {
#line 98
    tmp___1 = mdjvu_image_get_bitmap(image, i);
#line 98
    bitmap = tmp___1;
#line 99
    tmp___2 = mdjvu_image_has_not_a_letter_flags(image);
    }
#line 99
    if (tmp___2) {
      {
#line 99
      tmp___3 = mdjvu_image_get_not_a_letter_flag(image, bitmap);
      }
#line 99
      if (tmp___3) {
#line 102
        *(baseline + i) = -10000;
      } else {
        {
#line 100
        *(baseline + i) = compute_baseline(bitmap);
        }
      }
    } else {
#line 102
      *(baseline + i) = -10000;
    }
#line 96
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 104
  return (baseline);
}
}
#line 112 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
static void compute_adjustments(mdjvu_bitmap_t bitmap , mdjvu_bitmap_t subst , int32 b_base ,
                                int32 s_base , int32 *dx , int32 *dy ) 
{ 
  int32 w ;
  int32 h ;
  int32 subst_w ;
  int32 subst_h ;
  int32 adjust ;
  int tmp ;

  {
  {
#line 119
  w = mdjvu_bitmap_get_width(bitmap);
#line 120
  h = mdjvu_bitmap_get_height(bitmap);
#line 121
  subst_w = mdjvu_bitmap_get_width(subst);
#line 122
  subst_h = mdjvu_bitmap_get_height(subst);
#line 123
  *dx = (w - subst_w) / 2;
#line 124
  *dy = (h - subst_h) / 2;
#line 127
  adjust = b_base - s_base;
  }
#line 129
  if (adjust < 0) {
#line 130
    adjust = - (2 - adjust) / 4;
  } else {
#line 132
    adjust = (2 + adjust) / 4;
  }
  {
#line 134
  tmp = abs(adjust - *dy);
  }
#line 134
  if (tmp <= 1 + w / 16) {
#line 135
    *dy = adjust;
  }
#line 136
  return;
}
}
#line 138 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
void mdjvu_adjust(mdjvu_image_t image ) 
{ 
  int32 b ;
  int32 tmp ;
  int32 n ;
  int32 tmp___0 ;
  int32 *baseline ;
  int32 *tmp___1 ;
  int32 i ;
  int32 *x_adjust ;
  void *tmp___2 ;
  int32 *y_adjust ;
  void *tmp___3 ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___4 ;
  mdjvu_bitmap_t subst ;
  mdjvu_bitmap_t tmp___5 ;
  int32 tmp___6 ;

  {
  {
#line 140
  tmp = mdjvu_image_get_blit_count(image);
#line 140
  b = tmp;
#line 141
  tmp___0 = mdjvu_image_get_bitmap_count(image);
#line 141
  n = tmp___0;
#line 142
  tmp___1 = get_baselines(image);
#line 142
  baseline = tmp___1;
#line 145
  tmp___2 = calloc((size_t )n, sizeof(int32 ));
#line 145
  x_adjust = (int32 *)tmp___2;
#line 146
  tmp___3 = calloc((size_t )n, sizeof(int32 ));
#line 146
  y_adjust = (int32 *)tmp___3;
#line 148
  i = 0;
  }
  {
#line 148
  while (1) {
    while_continue: /* CIL Label */ ;
#line 148
    if (! (i < b)) {
#line 148
      goto while_break;
    }
    {
#line 150
    tmp___4 = mdjvu_image_get_blit_bitmap(image, i);
#line 150
    bitmap = tmp___4;
#line 151
    tmp___5 = mdjvu_image_get_substitution(image, bitmap);
#line 151
    subst = tmp___5;
    }
#line 152
    if (! subst) {
      {
#line 152
      __assert_fail("subst", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c",
                    152U, "mdjvu_adjust");
      }
    }
#line 154
    if ((unsigned long )subst == (unsigned long )bitmap) {
#line 154
      goto __Cont;
    }
    {
#line 156
    tmp___6 = mdjvu_bitmap_get_index(subst);
#line 156
    compute_adjustments(bitmap, subst, *(baseline + i), *(baseline + tmp___6), x_adjust + i,
                        y_adjust + i);
    }
    __Cont: /* CIL Label */ 
#line 148
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 162
  free((void *)baseline);
#line 164
  update_blits(image, x_adjust, y_adjust);
#line 166
  free((void *)x_adjust);
#line 167
  free((void *)y_adjust);
  }
#line 168
  return;
}
}
#line 170 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
static void adjust_page(mdjvu_image_t dict , int32 *dict_baselines , mdjvu_image_t image ) 
{ 
  int32 b ;
  int32 tmp ;
  int32 n ;
  int32 tmp___0 ;
  int32 *baseline ;
  int32 *tmp___1 ;
  int32 i ;
  int32 *x_adjust ;
  void *tmp___2 ;
  int32 *y_adjust ;
  void *tmp___3 ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___4 ;
  mdjvu_bitmap_t subst ;
  mdjvu_bitmap_t tmp___5 ;
  int32 subst_baseline ;
  int32 tmp___6 ;
  int tmp___7 ;
  int32 tmp___8 ;
  int tmp___9 ;

  {
  {
#line 174
  tmp = mdjvu_image_get_blit_count(image);
#line 174
  b = tmp;
#line 175
  tmp___0 = mdjvu_image_get_bitmap_count(image);
#line 175
  n = tmp___0;
#line 176
  tmp___1 = get_baselines(image);
#line 176
  baseline = tmp___1;
#line 179
  tmp___2 = calloc((size_t )n, sizeof(int32 ));
#line 179
  x_adjust = (int32 *)tmp___2;
#line 180
  tmp___3 = calloc((size_t )n, sizeof(int32 ));
#line 180
  y_adjust = (int32 *)tmp___3;
#line 182
  i = 0;
  }
  {
#line 182
  while (1) {
    while_continue: /* CIL Label */ ;
#line 182
    if (! (i < b)) {
#line 182
      goto while_break;
    }
    {
#line 184
    tmp___4 = mdjvu_image_get_blit_bitmap(image, i);
#line 184
    bitmap = tmp___4;
#line 185
    tmp___5 = mdjvu_image_get_substitution(image, bitmap);
#line 185
    subst = tmp___5;
    }
#line 188
    if ((unsigned long )subst == (unsigned long )bitmap) {
#line 188
      goto __Cont;
    } else
#line 188
    if (*(baseline + i) == -10000) {
#line 188
      goto __Cont;
    }
    {
#line 190
    tmp___9 = mdjvu_image_has_bitmap(dict, subst);
    }
#line 190
    if (tmp___9) {
      {
#line 191
      tmp___6 = mdjvu_bitmap_get_index(subst);
#line 191
      subst_baseline = *(dict_baselines + tmp___6);
      }
    } else {
      {
#line 194
      tmp___7 = mdjvu_image_has_bitmap(image, subst);
      }
#line 194
      if (! tmp___7) {
        {
#line 194
        __assert_fail("mdjvu_image_has_bitmap(image, subst)", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c",
                      194U, "adjust_page");
        }
      }
      {
#line 195
      tmp___8 = mdjvu_bitmap_get_index(subst);
#line 195
      subst_baseline = *(baseline + tmp___8);
      }
    }
    {
#line 198
    compute_adjustments(bitmap, subst, *(baseline + i), subst_baseline, x_adjust + i,
                        y_adjust + i);
    }
    __Cont: /* CIL Label */ 
#line 182
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 204
  free((void *)baseline);
#line 206
  update_blits(image, x_adjust, y_adjust);
#line 208
  free((void *)x_adjust);
#line 209
  free((void *)y_adjust);
  }
#line 210
  return;
}
}
#line 213 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
void mdjvu_multipage_adjust(mdjvu_image_t dict , int32 npages , mdjvu_image_t *pages ) 
{ 
  int32 *dict_baselines ;
  int32 *tmp ;
  int32 i ;

  {
  {
#line 217
  tmp = get_baselines(dict);
#line 217
  dict_baselines = tmp;
#line 219
  i = 0;
  }
  {
#line 219
  while (1) {
    while_continue: /* CIL Label */ ;
#line 219
    if (! (i < npages)) {
#line 219
      goto while_break;
    }
    {
#line 220
    adjust_page(dict, dict_baselines, *(pages + i));
#line 219
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 221
  free((void *)dict_baselines);
  }
#line 222
  return;
}
}
#line 5 "../include/minidjvu/base/6string.h"
int mdjvu_ends_with_ignore_case(char const   *s , char const   *prefix ) ;
#line 399 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) size_t ( __attribute__((__nonnull__(1), __leaf__)) strlen)(char const   *__s )  __attribute__((__pure__)) ;
#line 124 "/usr/include/ctype.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) tolower)(int __c ) ;
#line 16 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/6string.c"
static int my_strcasecmp(char const   *s1 , char const   *s2 ) 
{ 
  int c1 ;
  int c2 ;
  int d ;
  char const   *tmp ;
  char const   *tmp___0 ;

  {
  {
#line 19
  while (1) {
    while_continue: /* CIL Label */ ;
#line 19
    if (! *s1) {
#line 19
      goto while_break;
    }
    {
#line 22
    tmp = s1;
#line 22
    s1 ++;
#line 22
    c1 = tolower((int )*tmp);
#line 22
    tmp___0 = s2;
#line 22
    s2 ++;
#line 22
    c2 = tolower((int )*tmp___0);
#line 23
    d = c1 - c2;
    }
#line 24
    if (d) {
#line 24
      return (d);
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 26
  return ((int )*s2);
}
}
#line 29 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/6string.c"
int mdjvu_ends_with_ignore_case(char const   *s , char const   *prefix ) 
{ 
  size_t sl ;
  size_t tmp ;
  size_t pl ;
  size_t tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;

  {
  {
#line 31
  tmp = strlen(s);
#line 31
  sl = tmp;
#line 32
  tmp___0 = strlen(prefix);
#line 32
  pl = tmp___0;
  }
#line 33
  if (sl < pl) {
#line 33
    return (0);
  }
  {
#line 34
  tmp___1 = my_strcasecmp((s + sl) - pl, prefix);
  }
#line 34
  if (tmp___1) {
#line 34
    tmp___2 = 0;
  } else {
#line 34
    tmp___2 = 1;
  }
#line 34
  return (tmp___2);
}
}
#line 17 "../include/minidjvu/base/5image.h"
int32 mdjvu_image_get_width(mdjvu_image_t image ) ;
#line 49
void mdjvu_image_exchange_blits(mdjvu_image_t image , int32 i , int32 j ) ;
#line 18 "../include/minidjvu/alg/nosubst.h"
void mdjvu_calculate_not_a_letter_flags(mdjvu_image_t image ) ;
#line 5 "../include/minidjvu/alg/blitsort.h"
void mdjvu_sort_blits(mdjvu_image_t img ) ;
#line 765 "/usr/include/stdlib.h"
extern void ( __attribute__((__nonnull__(1,4))) qsort)(void *__base , size_t __nmemb ,
                                                       size_t __size , int (*__compar)(void const   * ,
                                                                                       void const   * ) ) ;
#line 21 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/blitsort.c"
static int compare_top_edges_downward(void const   *p1 , void const   *p2 ) 
{ 
  BlitPassport const   *bp1 ;
  BlitPassport const   *bp2 ;
  int32 d ;

  {
#line 23
  bp1 = (BlitPassport const   *)p1;
#line 24
  bp2 = (BlitPassport const   *)p2;
#line 26
  d = (int32 )(bp1->top - bp2->top);
#line 27
  if (d) {
#line 27
    return (d);
  }
#line 28
  d = (int32 )(bp1->left - bp2->left);
#line 29
  if (d) {
#line 29
    return (d);
  }
#line 30
  return (0);
}
}
#line 33 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/blitsort.c"
static int compare_left_edges_rightward(void const   *p1 , void const   *p2 ) 
{ 
  BlitPassport const   *bp1 ;
  BlitPassport const   *bp2 ;
  int32 d ;

  {
#line 35
  bp1 = (BlitPassport const   *)p1;
#line 36
  bp2 = (BlitPassport const   *)p2;
#line 38
  d = (int32 )(bp1->left - bp2->left);
#line 39
  if (d) {
#line 39
    return (d);
  }
#line 40
  d = (int32 )(bp1->top - bp2->top);
#line 41
  if (d) {
#line 41
    return (d);
  }
#line 42
  return (0);
}
}
#line 45 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/blitsort.c"
static int compare_integers_reversed(void const   *p1 , void const   *p2 ) 
{ 
  int32 d ;
  int tmp ;
  int tmp___0 ;

  {
#line 47
  if (sizeof(int ) == sizeof(int32 )) {
#line 49
    return ((int )(*((int const   *)p2) - *((int const   *)p1)));
  } else {
#line 53
    d = (int32 )(*((int32 const   *)p2) - *((int32 const   *)p1));
#line 54
    if (d > 0) {
#line 54
      tmp___0 = 1;
    } else {
#line 54
      if (d < 0) {
#line 54
        tmp = -1;
      } else {
#line 54
        tmp = 0;
      }
#line 54
      tmp___0 = tmp;
    }
#line 54
    return (tmp___0);
  }
}
}
#line 60 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/blitsort.c"
void mdjvu_sort_blits(mdjvu_image_t img ) 
{ 
  int32 char_blit_count ;
  int32 blit_count ;
  int32 i ;
  int32 j ;
  int32 maxtopchange ;
  int32 ccno ;
  BlitPassport *bps ;
  int32 *bottoms ;
  int32 *passport_of_blit ;
  int tmp ;
  mdjvu_bitmap_t bmp ;
  mdjvu_bitmap_t tmp___0 ;
  int tmp___1 ;
  void *tmp___2 ;
  void *tmp___3 ;
  mdjvu_bitmap_t bmp___0 ;
  mdjvu_bitmap_t tmp___4 ;
  int32 x ;
  int32 tmp___5 ;
  int32 y ;
  int32 tmp___6 ;
  int32 tmp___7 ;
  int32 tmp___8 ;
  int tmp___9 ;
  int32 tmp___10 ;
  int32 sublist_top ;
  int32 sublist_bottom ;
  int32 nccno ;
  int32 bottom ;
  int32 bottom___0 ;
  void *tmp___11 ;
  int32 blit_to_put_here ;

  {
  {
#line 64
  char_blit_count = 0;
#line 69
  tmp = mdjvu_image_has_not_a_letter_flags(img);
  }
#line 69
  if (! tmp) {
    {
#line 70
    mdjvu_calculate_not_a_letter_flags(img);
    }
  }
  {
#line 73
  blit_count = mdjvu_image_get_blit_count(img);
#line 74
  i = 0;
  }
  {
#line 74
  while (1) {
    while_continue: /* CIL Label */ ;
#line 74
    if (! (i < blit_count)) {
#line 74
      goto while_break;
    }
    {
#line 76
    tmp___0 = mdjvu_image_get_blit_bitmap(img, i);
#line 76
    bmp = tmp___0;
#line 77
    tmp___1 = mdjvu_image_get_not_a_letter_flag(img, bmp);
    }
#line 77
    if (! tmp___1) {
#line 78
      char_blit_count ++;
    }
#line 74
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 81
  if (char_blit_count < 2) {
#line 81
    return;
  }
  {
#line 84
  tmp___2 = malloc((unsigned long )char_blit_count * sizeof(BlitPassport ));
#line 84
  bps = (BlitPassport *)tmp___2;
#line 85
  tmp___3 = malloc((unsigned long )char_blit_count * sizeof(int32 ));
#line 85
  bottoms = (int32 *)tmp___3;
#line 88
  j = 0;
#line 89
  i = 0;
  }
  {
#line 89
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 89
    if (! (i < blit_count)) {
#line 89
      goto while_break___0;
    }
    {
#line 91
    tmp___4 = mdjvu_image_get_blit_bitmap(img, i);
#line 91
    bmp___0 = tmp___4;
#line 92
    tmp___9 = mdjvu_image_get_not_a_letter_flag(img, bmp___0);
    }
#line 92
    if (! tmp___9) {
      {
#line 94
      tmp___5 = mdjvu_image_get_blit_x(img, i);
#line 94
      (bps + j)->left = tmp___5;
#line 94
      x = tmp___5;
#line 95
      tmp___6 = mdjvu_image_get_blit_y(img, i);
#line 95
      (bps + j)->top = tmp___6;
#line 95
      y = tmp___6;
#line 96
      tmp___7 = mdjvu_bitmap_get_width(bmp___0);
#line 96
      (bps + j)->right = (x + tmp___7) - 1;
#line 97
      tmp___8 = mdjvu_bitmap_get_height(bmp___0);
#line 97
      (bps + j)->bottom = (y + tmp___8) - 1;
#line 98
      (bps + j)->original_index = i;
#line 99
      j ++;
      }
    }
#line 89
    i ++;
  }
  while_break___0: /* CIL Label */ ;
  }
  {
#line 104
  qsort((void *)bps, (size_t )char_blit_count, sizeof(BlitPassport ), & compare_top_edges_downward);
#line 109
  tmp___10 = mdjvu_image_get_width(img);
#line 109
  maxtopchange = tmp___10 / 40;
  }
#line 110
  if (maxtopchange < 32) {
#line 110
    maxtopchange = 32;
  }
#line 113
  ccno = 0;
  {
#line 114
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 114
    if (! (ccno < char_blit_count)) {
#line 114
      goto while_break___1;
    }
#line 117
    sublist_top = (bps + ccno)->top;
#line 118
    sublist_bottom = (bps + ccno)->bottom;
#line 125
    nccno = ccno;
    {
#line 125
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 125
      if (! (nccno < char_blit_count)) {
#line 125
        goto while_break___2;
      }
#line 128
      if ((bps + nccno)->top > sublist_bottom) {
#line 128
        goto while_break___2;
      }
#line 129
      if ((bps + nccno)->top > sublist_top + maxtopchange) {
#line 129
        goto while_break___2;
      }
#line 130
      bottom = (bps + nccno)->bottom;
#line 131
      *(bottoms + (nccno - ccno)) = bottom;
#line 132
      if (bottom > sublist_bottom) {
#line 133
        sublist_bottom = bottom;
      }
#line 125
      nccno ++;
    }
    while_break___2: /* CIL Label */ ;
    }
#line 137
    if (nccno > ccno + 1) {
      {
#line 141
      qsort((void *)bottoms, (size_t )(nccno - ccno), sizeof(int32 ), & compare_integers_reversed);
#line 143
      bottom___0 = *(bottoms + ((nccno - ccno) - 1) / 2);
#line 146
      nccno = ccno;
      }
      {
#line 146
      while (1) {
        while_continue___3: /* CIL Label */ ;
#line 146
        if (! (nccno < char_blit_count)) {
#line 146
          goto while_break___3;
        }
#line 147
        if ((bps + nccno)->top > bottom___0) {
#line 148
          goto while_break___3;
        }
#line 146
        nccno ++;
      }
      while_break___3: /* CIL Label */ ;
      }
      {
#line 151
      qsort((void *)(bps + ccno), (size_t )(nccno - ccno), sizeof(BlitPassport ),
            & compare_left_edges_rightward);
      }
    }
#line 156
    ccno = nccno;
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 160
  tmp___11 = malloc((unsigned long )blit_count * sizeof(int32 ));
#line 160
  passport_of_blit = (int32 *)tmp___11;
#line 161
  i = 0;
  }
  {
#line 161
  while (1) {
    while_continue___4: /* CIL Label */ ;
#line 161
    if (! (i < blit_count)) {
#line 161
      goto while_break___4;
    }
#line 162
    *(passport_of_blit + i) = -1;
#line 161
    i ++;
  }
  while_break___4: /* CIL Label */ ;
  }
#line 163
  i = 0;
  {
#line 163
  while (1) {
    while_continue___5: /* CIL Label */ ;
#line 163
    if (! (i < char_blit_count)) {
#line 163
      goto while_break___5;
    }
#line 164
    *(passport_of_blit + (bps + i)->original_index) = i;
#line 163
    i ++;
  }
  while_break___5: /* CIL Label */ ;
  }
#line 167
  i = 0;
  {
#line 167
  while (1) {
    while_continue___6: /* CIL Label */ ;
#line 167
    if (! (i < char_blit_count)) {
#line 167
      goto while_break___6;
    }
    {
#line 169
    blit_to_put_here = (bps + i)->original_index;
#line 170
    mdjvu_image_exchange_blits(img, blit_to_put_here, i);
    }
#line 171
    if (*(passport_of_blit + i) != -1) {
#line 172
      (bps + *(passport_of_blit + i))->original_index = blit_to_put_here;
    }
#line 173
    *(passport_of_blit + blit_to_put_here) = *(passport_of_blit + i);
#line 167
    i ++;
  }
  while_break___6: /* CIL Label */ ;
  }
  {
#line 176
  free((void *)passport_of_blit);
#line 177
  free((void *)bps);
#line 178
  free((void *)bottoms);
  }
#line 179
  return;
}
}
#line 37 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.h"
unsigned char **allocate_bitmap(int w , int h ) ;
#line 38
void free_bitmap(unsigned char **p ) ;
#line 39
void assign_bitmap(unsigned char **dst , unsigned char **src , int w , int h ) ;
#line 40
unsigned char **copy_bitmap(unsigned char **src , int w , int h ) ;
#line 47
unsigned char **allocate_bitmap_with_margins(int w , int h ) ;
#line 48
void free_bitmap_with_margins(unsigned char **pixels ) ;
#line 51
unsigned char **allocate_bitmap_with_white_margins(int w , int h ) ;
#line 54
void print_bitmap(unsigned char **pixels , int w , int h ) ;
#line 60
unsigned char **provide_margins(unsigned char **pixels , int w , int h , int make_it_0_or_1 ) ;
#line 63
void make_bitmap_0_or_1(unsigned char **pixels , int w , int h ) ;
#line 66
void invert_bitmap(unsigned char **pixels , int w , int h , int first_make_it_0_or_1 ) ;
#line 68
void clear_bitmap(unsigned char **pixels , int w , int h ) ;
#line 78
void strip_endpoints_4(unsigned char **result , unsigned char **pixels , int w , int h ) ;
#line 79
void strip_endpoints_8(unsigned char **result , unsigned char **pixels , int w , int h ) ;
#line 46 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__nonnull__(1,2), __leaf__)) memcpy)(void * __restrict  __dest ,
                                                                                                 void const   * __restrict  __src ,
                                                                                                 size_t __n ) ;
#line 580 "/usr/include/stdio.h"
extern int putchar(int __c ) ;
#line 7 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
unsigned char **allocate_bitmap(int w , int h ) 
{ 
  unsigned char *data ;
  unsigned char **result ;
  int i ;
  void *tmp ;
  void *tmp___0 ;

  {
#line 12
  if (w > 0) {
#line 12
    if (! (h > 0)) {
      {
#line 12
      __assert_fail("w > 0 && h > 0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c",
                    12U, "allocate_bitmap");
      }
    }
  } else {
    {
#line 12
    __assert_fail("w > 0 && h > 0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c",
                  12U, "allocate_bitmap");
    }
  }
  {
#line 14
  tmp = malloc((unsigned long )(w * h) * sizeof(unsigned char ));
#line 14
  data = (unsigned char *)tmp;
  }
#line 15
  if (! data) {
#line 15
    return ((unsigned char **)((void *)0));
  }
  {
#line 17
  tmp___0 = malloc((unsigned long )h * sizeof(unsigned char *));
#line 17
  result = (unsigned char **)tmp___0;
  }
#line 18
  if (! result) {
    {
#line 20
    free((void *)data);
    }
#line 21
    return ((unsigned char **)((void *)0));
  }
#line 24
  i = 0;
  {
#line 24
  while (1) {
    while_continue: /* CIL Label */ ;
#line 24
    if (! (i < h)) {
#line 24
      goto while_break;
    }
#line 26
    *(result + i) = data + w * i;
#line 24
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 29
  return (result);
}
}
#line 33 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
void free_bitmap(unsigned char **p ) 
{ 


  {
#line 35
  if (! p) {
    {
#line 35
    __assert_fail("p", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c",
                  35U, "free_bitmap");
    }
  }
  {
#line 36
  free((void *)*(p + 0));
#line 37
  free((void *)p);
  }
#line 38
  return;
}
}
#line 41 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
unsigned char **allocate_bitmap_with_margins(int w , int h ) 
{ 
  unsigned char **result ;
  unsigned char **tmp ;
  int y ;

  {
  {
#line 43
  tmp = allocate_bitmap(w + 2, h + 2);
#line 43
  result = tmp;
  }
#line 46
  if (! result) {
#line 47
    return ((unsigned char **)((void *)0));
  }
#line 50
  y = 0;
  {
#line 50
  while (1) {
    while_continue: /* CIL Label */ ;
#line 50
    if (! (y < h + 2)) {
#line 50
      goto while_break;
    }
#line 52
    (*(result + y)) ++;
#line 50
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 54
  result ++;
#line 55
  return (result);
}
}
#line 62 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
unsigned char **provide_margins(unsigned char **pixels , int w , int h , int make_it_0_or_1 ) 
{ 
  unsigned char **result ;
  unsigned char **tmp ;
  int y ;
  unsigned char *src_row ;
  unsigned char *dst_row ;
  int x ;

  {
  {
#line 66
  tmp = allocate_bitmap_with_margins(w, h);
#line 66
  result = tmp;
  }
#line 69
  if (! result) {
#line 70
    return ((unsigned char **)((void *)0));
  }
  {
#line 73
  memset((void *)(*(result + -1) - 1), 0, (size_t )(w + 2));
#line 74
  memset((void *)(*(result + h) - 1), 0, (size_t )(w + 2));
#line 76
  y = 0;
  }
  {
#line 76
  while (1) {
    while_continue: /* CIL Label */ ;
#line 76
    if (! (y < h)) {
#line 76
      goto while_break;
    }
#line 78
    src_row = *(pixels + y);
#line 79
    dst_row = *(result + y);
#line 82
    *(dst_row + -1) = (unsigned char)0;
#line 83
    *(dst_row + w) = (unsigned char)0;
#line 85
    if (! make_it_0_or_1) {
      {
#line 86
      memcpy((void */* __restrict  */)dst_row, (void const   */* __restrict  */)src_row,
             (size_t )w);
      }
    } else {
#line 90
      x = 0;
      {
#line 90
      while (1) {
        while_continue___0: /* CIL Label */ ;
#line 90
        if (! (x < w)) {
#line 90
          goto while_break___0;
        }
#line 91
        if (*(src_row + x)) {
#line 91
          *(dst_row + x) = (unsigned char)1;
        } else {
#line 91
          *(dst_row + x) = (unsigned char)0;
        }
#line 90
        x ++;
      }
      while_break___0: /* CIL Label */ ;
      }
    }
#line 76
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 95
  return (result);
}
}
#line 100 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
void free_bitmap_with_margins(unsigned char **pixels ) 
{ 


  {
#line 102
  if (! pixels) {
    {
#line 102
    __assert_fail("pixels", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c",
                  102U, "free_bitmap_with_margins");
    }
  }
  {
#line 103
  free((void *)(*(pixels + -1) + -1));
#line 104
  free((void *)(pixels - 1));
  }
#line 105
  return;
}
}
#line 108 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
void assign_bitmap(unsigned char **dst , unsigned char **src , int w , int h ) 
{ 
  int i ;

  {
#line 111
  i = 0;
  {
#line 111
  while (1) {
    while_continue: /* CIL Label */ ;
#line 111
    if (! (i < h)) {
#line 111
      goto while_break;
    }
    {
#line 112
    memcpy((void */* __restrict  */)*(dst + i), (void const   */* __restrict  */)*(src + i),
           (size_t )w);
#line 111
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 113
  return;
}
}
#line 116 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
unsigned char **copy_bitmap(unsigned char **src , int w , int h ) 
{ 
  unsigned char **result ;
  unsigned char **tmp ;

  {
  {
#line 118
  tmp = allocate_bitmap(w, h);
#line 118
  result = tmp;
#line 119
  assign_bitmap(result, src, w, h);
  }
#line 120
  return (result);
}
}
#line 124 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
void strip_endpoints_4(unsigned char **result , unsigned char **pixels , int w , int h ) 
{ 
  int x ;
  int y ;
  int degree ;

  {
#line 128
  if (! ((unsigned long )result != (unsigned long )pixels)) {
    {
#line 128
    __assert_fail("result != pixels", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c",
                  128U, "strip_endpoints_4");
    }
  }
#line 130
  y = 0;
  {
#line 130
  while (1) {
    while_continue: /* CIL Label */ ;
#line 130
    if (! (y < h)) {
#line 130
      goto while_break;
    }
#line 130
    x = 0;
    {
#line 130
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 130
      if (! (x < w)) {
#line 130
        goto while_break___0;
      }
#line 130
      if (*(*(pixels + y) + x)) {
#line 132
        degree = (((int )*(*(pixels + (y - 1)) + x) + (int )*(*(pixels + (y + 1)) + x)) + (int )*(*(pixels + y) + (x - 1))) + (int )*(*(pixels + y) + (x + 1));
#line 135
        if (degree != 1) {
#line 136
          *(*(result + y) + x) = (unsigned char)1;
        }
      }
#line 130
      x ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 130
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 138
  return;
}
}
#line 140 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
void strip_endpoints_8(unsigned char **result , unsigned char **pixels , int w , int h ) 
{ 
  int x ;
  int y ;
  int degree ;

  {
#line 144
  if (! ((unsigned long )result != (unsigned long )pixels)) {
    {
#line 144
    __assert_fail("result != pixels", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c",
                  144U, "strip_endpoints_8");
    }
  }
#line 146
  y = 0;
  {
#line 146
  while (1) {
    while_continue: /* CIL Label */ ;
#line 146
    if (! (y < h)) {
#line 146
      goto while_break;
    }
#line 146
    x = 0;
    {
#line 146
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 146
      if (! (x < w)) {
#line 146
        goto while_break___0;
      }
#line 146
      if (*(*(pixels + y) + x)) {
#line 148
        degree = (((((((int )*(*(pixels + (y - 1)) + (x - 1)) + (int )*(*(pixels + (y - 1)) + x)) + (int )*(*(pixels + (y - 1)) + (x + 1))) + (int )*(*(pixels + y) + (x - 1))) + (int )*(*(pixels + y) + (x + 1))) + (int )*(*(pixels + (y + 1)) + (x - 1))) + (int )*(*(pixels + (y + 1)) + x)) + (int )*(*(pixels + (y + 1)) + (x + 1));
#line 152
        if (degree != 1) {
#line 153
          *(*(result + y) + x) = (unsigned char)1;
        }
      }
#line 146
      x ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 146
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 155
  return;
}
}
#line 158 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
void print_bitmap(unsigned char **pixels , int w , int h ) 
{ 
  int x ;
  int y ;
  int tmp ;

  {
#line 161
  y = 0;
  {
#line 161
  while (1) {
    while_continue: /* CIL Label */ ;
#line 161
    if (! (y < h)) {
#line 161
      goto while_break;
    }
#line 163
    x = 0;
    {
#line 163
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 163
      if (! (x < w)) {
#line 163
        goto while_break___0;
      }
#line 165
      if (*(*(pixels + y) + x)) {
#line 165
        tmp = '@';
      } else {
#line 165
        tmp = '.';
      }
      {
#line 165
      putchar(tmp);
#line 163
      x ++;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 167
    putchar('\n');
#line 161
    y ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 169
  return;
}
}
#line 172 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
void make_bitmap_0_or_1(unsigned char **pixels , int w , int h ) 
{ 
  int x ;
  int y ;
  unsigned char *row ;

  {
#line 176
  y = 0;
  {
#line 176
  while (1) {
    while_continue: /* CIL Label */ ;
#line 176
    if (! (y < h)) {
#line 176
      goto while_break;
    }
#line 178
    row = *(pixels + y);
#line 180
    x = 0;
    {
#line 180
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 180
      if (! (x < w)) {
#line 180
        goto while_break___0;
      }
#line 181
      if (*(row + x)) {
#line 181
        *(row + x) = (unsigned char)1;
      } else {
#line 181
        *(row + x) = (unsigned char)0;
      }
#line 180
      x ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 176
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 183
  return;
}
}
#line 186 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
void invert_bitmap(unsigned char **pixels , int w , int h , int first_make_it_0_or_1 ) 
{ 
  int x ;
  int y ;
  unsigned char *row ;

  {
#line 190
  y = 0;
  {
#line 190
  while (1) {
    while_continue: /* CIL Label */ ;
#line 190
    if (! (y < h)) {
#line 190
      goto while_break;
    }
#line 192
    row = *(pixels + y);
#line 194
    if (first_make_it_0_or_1) {
#line 196
      x = 0;
      {
#line 196
      while (1) {
        while_continue___0: /* CIL Label */ ;
#line 196
        if (! (x < w)) {
#line 196
          goto while_break___0;
        }
#line 197
        if (*(row + x)) {
#line 197
          *(row + x) = (unsigned char)0;
        } else {
#line 197
          *(row + x) = (unsigned char)1;
        }
#line 196
        x ++;
      }
      while_break___0: /* CIL Label */ ;
      }
    } else {
#line 201
      x = 0;
      {
#line 201
      while (1) {
        while_continue___1: /* CIL Label */ ;
#line 201
        if (! (x < w)) {
#line 201
          goto while_break___1;
        }
#line 202
        *(row + x) = (unsigned char )(1 - (int )*(row + x));
#line 201
        x ++;
      }
      while_break___1: /* CIL Label */ ;
      }
    }
#line 190
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 205
  return;
}
}
#line 208 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
unsigned char **allocate_bitmap_with_white_margins(int w , int h ) 
{ 
  unsigned char **result ;
  unsigned char **tmp ;
  int y ;

  {
  {
#line 210
  tmp = allocate_bitmap_with_margins(w, h);
#line 210
  result = tmp;
#line 213
  memset((void *)(*(result + -1) - 1), 0, (size_t )(w + 2));
#line 214
  memset((void *)(*(result + h) - 1), 0, (size_t )(w + 2));
#line 215
  y = 0;
  }
  {
#line 215
  while (1) {
    while_continue: /* CIL Label */ ;
#line 215
    if (! (y < h)) {
#line 215
      goto while_break;
    }
#line 217
    *(*(result + y) + -1) = (unsigned char)0;
#line 218
    *(*(result + y) + w) = (unsigned char)0;
#line 215
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 221
  return (result);
}
}
#line 225 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/bitmaps.c"
void clear_bitmap(unsigned char **pixels , int w , int h ) 
{ 
  int y ;

  {
#line 229
  y = 0;
  {
#line 229
  while (1) {
    while_continue: /* CIL Label */ ;
#line 229
    if (! (y < h)) {
#line 229
      goto while_break;
    }
    {
#line 230
    memset((void *)*(pixels + y), 0, (size_t )w);
#line 229
    y ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 231
  return;
}
}
#line 27 "../include/minidjvu/base/1error.h"
mdjvu_error_t mdjvu_get_error(MinidjvuErrorType e ) ;
#line 30 "../include/minidjvu/base/2io.h"
void mdjvu_write_big_endian_int32(int32 i , mdjvu_file_t file ) ;
#line 43 "../include/minidjvu/djvu/iff.h"
mdjvu_iff_t mdjvu_iff_write_chunk(int32 id , mdjvu_file_t file ) ;
#line 54
void mdjvu_iff_close_chunk(mdjvu_iff_t iff , mdjvu_file_t file ) ;
#line 23 "../include/minidjvu/djvu/djvu.h"
int mdjvu_file_save_djvu_dir(char **elements , int *sizes , int n , mdjvu_file_t file ,
                             mdjvu_file_t tempfile , mdjvu_error_t *perr ) ;
#line 25
int mdjvu_save_djvu_dir(char **elements , int *sizes , int n , char const   *path ,
                        mdjvu_error_t *perr ) ;
#line 27
int mdjvu_file_save_djvu_page(mdjvu_image_t image , mdjvu_file_t file , char const   *dict_name ,
                              int indirect___0 , mdjvu_error_t *perr , int erosion___0 ) ;
#line 29
int mdjvu_save_djvu_page(mdjvu_image_t image , char const   *path , char const   *dict ,
                         mdjvu_error_t *perr , int erosion___0 ) ;
#line 31
int mdjvu_file_save_djvu_dictionary(mdjvu_image_t image , mdjvu_file_t file , int indirect___0 ,
                                    mdjvu_error_t *perr , int erosion___0 ) ;
#line 33
int mdjvu_save_djvu_dictionary(mdjvu_image_t image , char const   *path , mdjvu_error_t *perr ,
                               int erosion___0 ) ;
#line 35
extern void mdjvu_write_dirm_bundled(char **elements , int *sizes , int n , mdjvu_file_t f ,
                                     mdjvu_error_t *perr ) ;
#line 36
extern void mdjvu_write_dirm_indirect(char **elements , int *sizes , int n , mdjvu_file_t f ,
                                      mdjvu_error_t *perr ) ;
#line 42
void mdjvu_write_info_chunk(mdjvu_file_t f , mdjvu_image_t image ) ;
#line 18 "../include/minidjvu/jb2.h"
extern int mdjvu_file_save_jb2(mdjvu_image_t  , mdjvu_file_t  , mdjvu_error_t * ,
                               int erosion ) ;
#line 21
extern int mdjvu_file_save_jb2_dictionary(mdjvu_image_t  , mdjvu_file_t  , mdjvu_error_t * ,
                                          int erosion ) ;
#line 237 "/usr/include/stdio.h"
extern int fclose(FILE *__stream ) ;
#line 272
extern FILE *fopen(char const   * __restrict  __filename , char const   * __restrict  __modes ) ;
#line 531
extern int fgetc(FILE *__stream ) ;
#line 573
extern int fputc(int __c , FILE *__stream ) ;
#line 715
extern size_t fwrite(void const   * __restrict  __ptr , size_t __size , size_t __n ,
                     FILE * __restrict  __s ) ;
#line 754
extern long ftell(FILE *__stream ) ;
#line 759
extern void rewind(FILE *__stream ) ;
#line 11 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvusave.c"
int mdjvu_file_save_djvu_dir(char **elements , int *sizes , int n , mdjvu_file_t file ,
                             mdjvu_file_t tempfile , mdjvu_error_t *perr ) 
{ 
  mdjvu_iff_t FORM ;
  mdjvu_iff_t DIRM ;
  int i ;
  int fpos ;
  int tpos ;
  long tmp ;
  long tmp___0 ;
  char ch ;
  int tmp___1 ;

  {
  {
#line 16
  mdjvu_write_big_endian_int32((int32 )(((((int const   )*("AT&T" + 0) << 24) | ((int const   )*("AT&T" + 1) << 16)) | ((int const   )*("AT&T" + 2) << 8)) | (int const   )*("AT&T" + 3)),
                               file);
#line 17
  FORM = mdjvu_iff_write_chunk((int32 )(((((int const   )*("FORM" + 0) << 24) | ((int const   )*("FORM" + 1) << 16)) | ((int const   )*("FORM" + 2) << 8)) | (int const   )*("FORM" + 3)),
                               file);
#line 18
  mdjvu_write_big_endian_int32((int32 )(((((int const   )*("DJVM" + 0) << 24) | ((int const   )*("DJVM" + 1) << 16)) | ((int const   )*("DJVM" + 2) << 8)) | (int const   )*("DJVM" + 3)),
                               file);
#line 20
  DIRM = mdjvu_iff_write_chunk((int32 )(((((int const   )*("DIRM" + 0) << 24) | ((int const   )*("DIRM" + 1) << 16)) | ((int const   )*("DIRM" + 2) << 8)) | (int const   )*("DIRM" + 3)),
                               file);
  }
#line 21
  if (tempfile) {
    {
#line 22
    mdjvu_write_dirm_bundled(elements, sizes, n, file, perr);
    }
  } else {
    {
#line 24
    mdjvu_write_dirm_indirect(elements, sizes, n, file, perr);
    }
  }
  {
#line 25
  mdjvu_iff_close_chunk(DIRM, file);
  }
#line 27
  if (tempfile) {
    {
#line 30
    tmp = ftell((FILE *)tempfile);
#line 30
    tpos = (int )tmp;
#line 31
    tmp___0 = ftell((FILE *)file);
#line 31
    fpos = (int )tmp___0;
    }
#line 33
    if (fpos & 1) {
      {
#line 33
      fputc('\000', (FILE *)file);
      }
    }
    {
#line 34
    rewind((FILE *)tempfile);
#line 36
    i = 0;
    }
    {
#line 36
    while (1) {
      while_continue: /* CIL Label */ ;
#line 36
      if (! (i < tpos)) {
#line 36
        goto while_break;
      }
      {
#line 38
      tmp___1 = fgetc((FILE *)tempfile);
#line 38
      ch = (char )tmp___1;
#line 39
      fputc((int )ch, (FILE *)file);
#line 36
      i ++;
      }
    }
    while_break: /* CIL Label */ ;
    }
  }
  {
#line 43
  mdjvu_iff_close_chunk(FORM, file);
  }
#line 45
  return (1);
}
}
#line 48 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvusave.c"
int mdjvu_file_save_djvu_page(mdjvu_image_t image , mdjvu_file_t file , char const   *dict_name ,
                              int indirect___0 , mdjvu_error_t *perr , int erosion___0 ) 
{ 
  mdjvu_iff_t FORM ;
  mdjvu_iff_t INFO ;
  mdjvu_iff_t INCL ;
  mdjvu_iff_t Sjbz ;
  int pos ;
  long tmp ;
  size_t tmp___0 ;
  int tmp___1 ;
  long tmp___2 ;

  {
  {
#line 52
  tmp = ftell((FILE *)file);
#line 52
  pos = (int )tmp;
  }
#line 53
  if (pos & 1) {
#line 53
    pos ++;
  }
#line 55
  if (indirect___0) {
    {
#line 56
    mdjvu_write_big_endian_int32((int32 )(((((int const   )*("AT&T" + 0) << 24) | ((int const   )*("AT&T" + 1) << 16)) | ((int const   )*("AT&T" + 2) << 8)) | (int const   )*("AT&T" + 3)),
                                 file);
    }
  }
  {
#line 57
  FORM = mdjvu_iff_write_chunk((int32 )(((((int const   )*("FORM" + 0) << 24) | ((int const   )*("FORM" + 1) << 16)) | ((int const   )*("FORM" + 2) << 8)) | (int const   )*("FORM" + 3)),
                               file);
#line 58
  mdjvu_write_big_endian_int32((int32 )(((((int const   )*("DJVU" + 0) << 24) | ((int const   )*("DJVU" + 1) << 16)) | ((int const   )*("DJVU" + 2) << 8)) | (int const   )*("DJVU" + 3)),
                               file);
#line 60
  INFO = mdjvu_iff_write_chunk((int32 )(((((int const   )*("INFO" + 0) << 24) | ((int const   )*("INFO" + 1) << 16)) | ((int const   )*("INFO" + 2) << 8)) | (int const   )*("INFO" + 3)),
                               file);
#line 61
  mdjvu_write_info_chunk(file, image);
#line 62
  mdjvu_iff_close_chunk(INFO, file);
  }
#line 64
  if (dict_name) {
    {
#line 66
    INCL = mdjvu_iff_write_chunk((int32 )(((((int const   )*("INCL" + 0) << 24) | ((int const   )*("INCL" + 1) << 16)) | ((int const   )*("INCL" + 2) << 8)) | (int const   )*("INCL" + 3)),
                                 file);
#line 67
    tmp___0 = strlen(dict_name);
#line 67
    fwrite((void const   */* __restrict  */)dict_name, (size_t )1, tmp___0, (FILE */* __restrict  */)((FILE *)file));
#line 68
    mdjvu_iff_close_chunk(INCL, file);
    }
  }
  {
#line 71
  Sjbz = mdjvu_iff_write_chunk((int32 )(((((int const   )*("Sjbz" + 0) << 24) | ((int const   )*("Sjbz" + 1) << 16)) | ((int const   )*("Sjbz" + 2) << 8)) | (int const   )*("Sjbz" + 3)),
                               file);
#line 72
  tmp___1 = mdjvu_file_save_jb2(image, file, perr, erosion___0);
  }
#line 72
  if (! tmp___1) {
#line 72
    return (0);
  }
  {
#line 73
  mdjvu_iff_close_chunk(Sjbz, file);
#line 74
  mdjvu_iff_close_chunk(FORM, file);
#line 76
  tmp___2 = ftell((FILE *)file);
#line 76
  pos = (int )(tmp___2 - (long )pos);
  }
#line 77
  return (pos);
}
}
#line 81 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvusave.c"
int mdjvu_file_save_djvu_dictionary(mdjvu_image_t image , mdjvu_file_t file , int indirect___0 ,
                                    mdjvu_error_t *perr , int erosion___0 ) 
{ 
  mdjvu_iff_t FORM ;
  mdjvu_iff_t Djbz ;
  int pos ;
  long tmp ;
  int tmp___0 ;
  long tmp___1 ;

  {
  {
#line 85
  tmp = ftell((FILE *)file);
#line 85
  pos = (int )tmp;
  }
#line 86
  if (pos & 1) {
#line 86
    pos ++;
  }
#line 88
  if (indirect___0) {
    {
#line 89
    mdjvu_write_big_endian_int32((int32 )(((((int const   )*("AT&T" + 0) << 24) | ((int const   )*("AT&T" + 1) << 16)) | ((int const   )*("AT&T" + 2) << 8)) | (int const   )*("AT&T" + 3)),
                                 file);
    }
  }
  {
#line 90
  FORM = mdjvu_iff_write_chunk((int32 )(((((int const   )*("FORM" + 0) << 24) | ((int const   )*("FORM" + 1) << 16)) | ((int const   )*("FORM" + 2) << 8)) | (int const   )*("FORM" + 3)),
                               file);
#line 91
  mdjvu_write_big_endian_int32((int32 )(((((int const   )*("DJVI" + 0) << 24) | ((int const   )*("DJVI" + 1) << 16)) | ((int const   )*("DJVI" + 2) << 8)) | (int const   )*("DJVI" + 3)),
                               file);
#line 93
  Djbz = mdjvu_iff_write_chunk((int32 )(((((int const   )*("Djbz" + 0) << 24) | ((int const   )*("Djbz" + 1) << 16)) | ((int const   )*("Djbz" + 2) << 8)) | (int const   )*("Djbz" + 3)),
                               file);
#line 94
  tmp___0 = mdjvu_file_save_jb2_dictionary(image, file, perr, erosion___0);
  }
#line 94
  if (! tmp___0) {
#line 95
    return (0);
  }
  {
#line 96
  mdjvu_iff_close_chunk(Djbz, file);
#line 97
  mdjvu_iff_close_chunk(FORM, file);
#line 99
  tmp___1 = ftell((FILE *)file);
#line 99
  pos = (int )(tmp___1 - (long )pos);
  }
#line 100
  return (pos);
}
}
#line 103 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvusave.c"
int mdjvu_save_djvu_dir(char **elements , int *sizes , int n , char const   *path ,
                        mdjvu_error_t *perr ) 
{ 
  int result ;
  FILE *f ;
  FILE *tmp ;

  {
  {
#line 106
  tmp = fopen((char const   */* __restrict  */)path, (char const   */* __restrict  */)"wb");
#line 106
  f = tmp;
  }
#line 107
  if (perr) {
#line 107
    *perr = (mdjvu_error_t )((void *)0);
  }
#line 108
  if (! f) {
#line 110
    if (perr) {
      {
#line 110
      *perr = mdjvu_get_error((MinidjvuErrorType )0);
      }
    }
#line 111
    return (0);
  }
  {
#line 113
  result = mdjvu_file_save_djvu_dir(elements, sizes, n, (mdjvu_file_t )f, (mdjvu_file_t )((void *)0),
                                    perr);
#line 114
  fclose(f);
  }
#line 115
  return (result);
}
}
#line 118 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvusave.c"
int mdjvu_save_djvu_page(mdjvu_image_t image , char const   *path , char const   *dict ,
                         mdjvu_error_t *perr , int erosion___0 ) 
{ 
  int result ;
  FILE *f ;
  FILE *tmp ;

  {
  {
#line 121
  tmp = fopen((char const   */* __restrict  */)path, (char const   */* __restrict  */)"wb");
#line 121
  f = tmp;
  }
#line 122
  if (perr) {
#line 122
    *perr = (mdjvu_error_t )((void *)0);
  }
#line 123
  if (! f) {
#line 125
    if (perr) {
      {
#line 125
      *perr = mdjvu_get_error((MinidjvuErrorType )0);
      }
    }
#line 126
    return (0);
  }
  {
#line 128
  result = mdjvu_file_save_djvu_page(image, (mdjvu_file_t )f, dict, 0, perr, erosion___0);
#line 129
  fclose(f);
  }
#line 130
  return (result);
}
}
#line 133 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvusave.c"
int mdjvu_save_djvu_dictionary(mdjvu_image_t image , char const   *path , mdjvu_error_t *perr ,
                               int erosion___0 ) 
{ 
  int result ;
  FILE *f ;
  FILE *tmp ;

  {
  {
#line 136
  tmp = fopen((char const   */* __restrict  */)path, (char const   */* __restrict  */)"wb");
#line 136
  f = tmp;
  }
#line 137
  if (perr) {
#line 137
    *perr = (mdjvu_error_t )((void *)0);
  }
#line 138
  if (! f) {
#line 140
    if (perr) {
      {
#line 140
      *perr = mdjvu_get_error((MinidjvuErrorType )0);
      }
    }
#line 141
    return (0);
  }
  {
#line 143
  result = mdjvu_file_save_djvu_dictionary(image, (mdjvu_file_t )f, 0, perr, erosion___0);
#line 144
  fclose(f);
  }
#line 145
  return (result);
}
}
#line 13 "../include/minidjvu/base/version.h"
char const   *mdjvu_get_version(void) ;
#line 8 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/version.c"
char const   *mdjvu_get_version(void) 
{ 


  {
#line 10
  return ("0.9");
}
}
#line 35 "../include/minidjvu/base/4bitmap.h"
int32 mdjvu_bitmap_get_packed_row_size(mdjvu_bitmap_t b ) ;
#line 43
unsigned char *mdjvu_bitmap_access_packed_row(mdjvu_bitmap_t b , int32 i ) ;
#line 8 "../include/minidjvu/image-io/pbm.h"
int mdjvu_save_pbm(mdjvu_bitmap_t b , char const   *path , mdjvu_error_t *perr ) ;
#line 9
int mdjvu_file_save_pbm(mdjvu_bitmap_t b , mdjvu_file_t f , mdjvu_error_t *perr ) ;
#line 14
mdjvu_bitmap_t mdjvu_load_pbm(char const   *path , mdjvu_error_t *perr ) ;
#line 15
mdjvu_bitmap_t mdjvu_file_load_pbm(mdjvu_file_t f , mdjvu_error_t *perr ) ;
#line 425 "/usr/include/stdio.h"
extern int fscanf(FILE * __restrict  __stream , char const   * __restrict  __format 
                  , ...)  __asm__("__isoc99_fscanf")  ;
#line 702
extern int ungetc(int __c , FILE *__stream ) ;
#line 709
extern size_t fread(void * __restrict  __ptr , size_t __size , size_t __n , FILE * __restrict  __stream ) ;
#line 9 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/pbm.c"
static void skip_to_the_end_of_line(FILE *file ) 
{ 
  int tmp ;

  {
  {
#line 11
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 13
    tmp = fgetc(file);
    }
    {
#line 15
    if (tmp == 10) {
#line 15
      goto case_10;
    }
#line 15
    if (tmp == 13) {
#line 15
      goto case_10;
    }
#line 15
    if (tmp == -1) {
#line 15
      goto case_10;
    }
#line 13
    goto switch_break;
    case_10: /* CIL Label */ 
    case_13: /* CIL Label */ 
    case_neg_1: /* CIL Label */ 
#line 16
    return;
    switch_break: /* CIL Label */ ;
    }
  }
  while_break: /* CIL Label */ ;
  }
}
}
#line 21 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/pbm.c"
static void mdjvu_skip_pbm_whitespace_and_comments(mdjvu_file_t f ) 
{ 
  FILE *file ;
  int c ;
  int tmp ;

  {
  {
#line 23
  file = (FILE *)f;
#line 24
  tmp = fgetc(file);
#line 24
  c = tmp;
  }
  {
#line 25
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 29
    if (c == 10) {
#line 29
      goto case_10;
    }
#line 29
    if (c == 13) {
#line 29
      goto case_10;
    }
#line 29
    if (c == 9) {
#line 29
      goto case_10;
    }
#line 29
    if (c == 32) {
#line 29
      goto case_10;
    }
#line 32
    if (c == 35) {
#line 32
      goto case_35;
    }
#line 36
    goto switch_default;
    case_10: /* CIL Label */ 
    case_13: /* CIL Label */ 
    case_9: /* CIL Label */ 
    case_32: /* CIL Label */ 
    {
#line 30
    c = fgetc(file);
    }
#line 31
    goto switch_break;
    case_35: /* CIL Label */ 
    {
#line 33
    skip_to_the_end_of_line(file);
#line 34
    c = fgetc(file);
    }
#line 35
    goto switch_break;
    switch_default: /* CIL Label */ 
    {
#line 37
    ungetc(c, file);
    }
#line 38
    return;
    switch_break: /* CIL Label */ ;
    }
  }
  while_break: /* CIL Label */ ;
  }
}
}
#line 43 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/pbm.c"
int mdjvu_save_pbm(mdjvu_bitmap_t b , char const   *path , mdjvu_error_t *perr ) 
{ 
  FILE *file ;
  FILE *tmp ;
  int result ;

  {
  {
#line 45
  tmp = fopen((char const   */* __restrict  */)path, (char const   */* __restrict  */)"wb");
#line 45
  file = tmp;
  }
#line 47
  if (perr) {
#line 47
    *perr = (mdjvu_error_t )((void *)0);
  }
#line 48
  if (! file) {
#line 50
    if (perr) {
      {
#line 50
      *perr = mdjvu_get_error((MinidjvuErrorType )0);
      }
    }
#line 51
    return (0);
  }
  {
#line 53
  result = mdjvu_file_save_pbm(b, (mdjvu_file_t )file, perr);
#line 54
  fclose(file);
  }
#line 55
  return (result);
}
}
#line 58 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/pbm.c"
int mdjvu_file_save_pbm(mdjvu_bitmap_t b , mdjvu_file_t f , mdjvu_error_t *perr ) 
{ 
  FILE *file ;
  int32 bytes_per_row ;
  int32 tmp ;
  int32 width ;
  int32 tmp___0 ;
  int32 height ;
  int32 tmp___1 ;
  int32 i ;
  unsigned char *row ;
  unsigned char *tmp___2 ;
  size_t tmp___3 ;

  {
  {
#line 60
  file = (FILE *)f;
#line 61
  tmp = mdjvu_bitmap_get_packed_row_size(b);
#line 61
  bytes_per_row = tmp;
#line 62
  tmp___0 = mdjvu_bitmap_get_width(b);
#line 62
  width = tmp___0;
#line 63
  tmp___1 = mdjvu_bitmap_get_height(b);
#line 63
  height = tmp___1;
  }
#line 66
  if (perr) {
#line 66
    *perr = (mdjvu_error_t )((void *)0);
  }
  {
#line 68
  fprintf((FILE */* __restrict  */)file, (char const   */* __restrict  */)"P4\n%d %d\n",
          width, height);
#line 71
  i = 0;
  }
  {
#line 71
  while (1) {
    while_continue: /* CIL Label */ ;
#line 71
    if (! (i < height)) {
#line 71
      goto while_break;
    }
    {
#line 73
    tmp___2 = mdjvu_bitmap_access_packed_row(b, i);
#line 73
    row = tmp___2;
#line 74
    tmp___3 = fwrite((void const   */* __restrict  */)row, (size_t )bytes_per_row,
                     (size_t )1, (FILE */* __restrict  */)file);
    }
#line 74
    if (tmp___3 != 1UL) {
#line 76
      if (perr) {
        {
#line 76
        *perr = mdjvu_get_error((MinidjvuErrorType )2);
        }
      }
#line 77
      return (0);
    }
#line 71
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 80
  return (1);
}
}
#line 83 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/pbm.c"
mdjvu_bitmap_t mdjvu_load_pbm(char const   *path , mdjvu_error_t *perr ) 
{ 
  FILE *file ;
  FILE *tmp ;
  mdjvu_bitmap_t result ;

  {
  {
#line 85
  tmp = fopen((char const   */* __restrict  */)path, (char const   */* __restrict  */)"rb");
#line 85
  file = tmp;
  }
#line 87
  if (perr) {
#line 87
    *perr = (mdjvu_error_t )((void *)0);
  }
#line 88
  if (! file) {
#line 90
    if (perr) {
      {
#line 90
      *perr = mdjvu_get_error((MinidjvuErrorType )1);
      }
    }
#line 91
    return ((mdjvu_bitmap_t )((void *)0));
  }
  {
#line 93
  result = mdjvu_file_load_pbm((mdjvu_file_t )file, perr);
#line 94
  fclose(file);
  }
#line 95
  return (result);
}
}
#line 103 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/pbm.c"
mdjvu_bitmap_t mdjvu_file_load_pbm(mdjvu_file_t f , mdjvu_error_t *perr ) 
{ 
  FILE *file ;
  int32 width ;
  int32 height ;
  int32 bytes_per_row ;
  int32 i ;
  mdjvu_bitmap_t result ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  unsigned char *current_row ;
  unsigned char *tmp___3 ;
  size_t tmp___4 ;

  {
#line 105
  file = (FILE *)f;
#line 108
  if (perr) {
#line 108
    *perr = (mdjvu_error_t )((void *)0);
  }
  {
#line 109
  tmp = fgetc(file);
  }
#line 109
  if (tmp != 80) {
#line 109
    if (perr) {
      {
#line 109
      *perr = mdjvu_get_error((MinidjvuErrorType )3);
      }
    }
#line 109
    return ((mdjvu_bitmap_t )((void *)0));
  }
  {
#line 110
  tmp___0 = fgetc(file);
  }
#line 110
  if (tmp___0 != 52) {
#line 110
    if (perr) {
      {
#line 110
      *perr = mdjvu_get_error((MinidjvuErrorType )3);
      }
    }
#line 110
    return ((mdjvu_bitmap_t )((void *)0));
  }
  {
#line 111
  mdjvu_skip_pbm_whitespace_and_comments((mdjvu_file_t )file);
#line 112
  tmp___1 = fscanf((FILE */* __restrict  */)file, (char const   */* __restrict  */)"%d %d",
                   & width, & height);
  }
#line 112
  if (tmp___1 != 2) {
#line 115
    if (perr) {
      {
#line 115
      *perr = mdjvu_get_error((MinidjvuErrorType )3);
      }
    }
#line 115
    return ((mdjvu_bitmap_t )((void *)0));
  }
  {
#line 119
  tmp___2 = fgetc(file);
  }
  {
#line 121
  if (tmp___2 == 10) {
#line 121
    goto case_10;
  }
#line 121
  if (tmp___2 == 13) {
#line 121
    goto case_10;
  }
#line 121
  if (tmp___2 == 9) {
#line 121
    goto case_10;
  }
#line 121
  if (tmp___2 == 32) {
#line 121
    goto case_10;
  }
#line 123
  goto switch_default;
  case_10: /* CIL Label */ 
  case_13: /* CIL Label */ 
  case_9: /* CIL Label */ 
  case_32: /* CIL Label */ 
#line 122
  goto switch_break;
  switch_default: /* CIL Label */ 
#line 124
  if (perr) {
    {
#line 124
    *perr = mdjvu_get_error((MinidjvuErrorType )3);
    }
  }
#line 124
  return ((mdjvu_bitmap_t )((void *)0));
  switch_break: /* CIL Label */ ;
  }
  {
#line 127
  result = mdjvu_bitmap_create(width, height);
#line 128
  bytes_per_row = mdjvu_bitmap_get_packed_row_size(result);
#line 129
  i = 0;
  }
  {
#line 129
  while (1) {
    while_continue: /* CIL Label */ ;
#line 129
    if (! (i < height)) {
#line 129
      goto while_break;
    }
    {
#line 131
    tmp___3 = mdjvu_bitmap_access_packed_row(result, i);
#line 131
    current_row = tmp___3;
#line 132
    tmp___4 = fread((void */* __restrict  */)current_row, (size_t )bytes_per_row,
                    (size_t )1, (FILE */* __restrict  */)file);
    }
#line 132
    if (tmp___4 != 1UL) {
      {
#line 134
      mdjvu_bitmap_destroy(result);
      }
#line 135
      if (perr) {
        {
#line 135
        *perr = mdjvu_get_error((MinidjvuErrorType )3);
        }
      }
#line 135
      return ((mdjvu_bitmap_t )((void *)0));
    }
#line 129
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 138
  return (result);
}
}
#line 8 "../include/minidjvu/image-io/tiff.h"
int mdjvu_save_tiff(mdjvu_bitmap_t bitmap , char const   *path , mdjvu_error_t *perr ) ;
#line 69 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/tiffsave.c"
int mdjvu_save_tiff(mdjvu_bitmap_t bitmap , char const   *path , mdjvu_error_t *perr ) 
{ 


  {
  {
#line 74
  *perr = mdjvu_get_error((MinidjvuErrorType )11);
  }
#line 75
  return (0);
}
}
#line 79 "../include/minidjvu/alg/../matcher.h"
void mdjvu_soften_pattern(unsigned char **result , unsigned char **pixels , int32 w ,
                          int32 h ) ;
#line 153 "/usr/include/x86_64-linux-gnu/bits/mathcalls.h"
extern  __attribute__((__nothrow__)) double ( __attribute__((__leaf__)) pow)(double __x ,
                                                                             double __y ) ;
#line 78 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c"
static int donut_connectivity_test(byte *upper , byte *row , byte *lower ) 
{ 
  int sum ;
  int l ;
  int u ;
  int d ;
  int r ;
  int x ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  int s ;
  int tmp___3 ;
  int tmp___4 ;
  int tmp___5 ;
  int tmp___6 ;

  {
#line 95
  if (*upper) {
#line 95
    u = 1;
  } else {
#line 95
    u = 0;
  }
#line 95
  if (*lower) {
#line 95
    d = 1;
  } else {
#line 95
    d = 0;
  }
#line 95
  if (*(row + -1)) {
#line 95
    l = 1;
  } else {
#line 95
    l = 0;
  }
#line 95
  if (*(row + 1)) {
#line 95
    r = 1;
  } else {
#line 95
    r = 0;
  }
#line 95
  sum = ((u + d) + l) + r;
  {
#line 100
  if (sum == 3) {
#line 100
    goto case_3;
  }
#line 117
  if (sum == 2) {
#line 117
    goto case_2___0;
  }
#line 151
  if (sum == 4) {
#line 151
    goto case_4;
  }
#line 151
  if (sum == 0) {
#line 151
    goto case_4;
  }
#line 153
  if (sum == 1) {
#line 153
    goto case_1___0;
  }
#line 155
  goto switch_default___0;
  case_3: /* CIL Label */ 
#line 102
  x = 6 - (((u + (l << 1)) + d) + (d << 1));
  {
#line 105
  if (x == 0) {
#line 105
    goto case_0;
  }
#line 107
  if (x == 1) {
#line 107
    goto case_1;
  }
#line 109
  if (x == 2) {
#line 109
    goto case_2;
  }
#line 111
  if (x == 3) {
#line 111
    goto case_3___0;
  }
#line 113
  goto switch_default;
  case_0: /* CIL Label */ 
#line 106
  if (*(upper + -1)) {
#line 106
    if (*(lower + -1)) {
#line 106
      tmp = 0;
    } else {
#line 106
      tmp = 1;
    }
  } else {
#line 106
    tmp = 1;
  }
#line 106
  return (tmp);
  case_1: /* CIL Label */ 
#line 108
  if (*(lower + -1)) {
#line 108
    if (*(lower + 1)) {
#line 108
      tmp___0 = 0;
    } else {
#line 108
      tmp___0 = 1;
    }
  } else {
#line 108
    tmp___0 = 1;
  }
#line 108
  return (tmp___0);
  case_2: /* CIL Label */ 
#line 110
  if (*(upper + 1)) {
#line 110
    if (*(lower + 1)) {
#line 110
      tmp___1 = 0;
    } else {
#line 110
      tmp___1 = 1;
    }
  } else {
#line 110
    tmp___1 = 1;
  }
#line 110
  return (tmp___1);
  case_3___0: /* CIL Label */ 
#line 112
  if (*(upper + -1)) {
#line 112
    if (*(upper + 1)) {
#line 112
      tmp___2 = 0;
    } else {
#line 112
      tmp___2 = 1;
    }
  } else {
#line 112
    tmp___2 = 1;
  }
#line 112
  return (tmp___2);
  switch_default: /* CIL Label */ 
  {
#line 113
  __assert_fail("0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                113U, "donut_connectivity_test");
  }
#line 113
  return (0);
  switch_break___0: /* CIL Label */ ;
  }
#line 116
  goto switch_break;
  case_2___0: /* CIL Label */ 
#line 119
  s = l + r;
#line 120
  if (s & 1) {
#line 126
    if (l) {
#line 128
      if (u) {
#line 129
        if (*(upper + -1)) {
#line 129
          tmp___3 = 0;
        } else {
#line 129
          tmp___3 = 1;
        }
#line 129
        return (tmp___3);
      } else {
#line 131
        if (*(lower + -1)) {
#line 131
          tmp___4 = 0;
        } else {
#line 131
          tmp___4 = 1;
        }
#line 131
        return (tmp___4);
      }
    } else
#line 135
    if (u) {
#line 136
      if (*(upper + 1)) {
#line 136
        tmp___5 = 0;
      } else {
#line 136
        tmp___5 = 1;
      }
#line 136
      return (tmp___5);
    } else {
#line 138
      if (*(lower + 1)) {
#line 138
        tmp___6 = 0;
      } else {
#line 138
        tmp___6 = 1;
      }
#line 138
      return (tmp___6);
    }
  } else {
#line 147
    return (1);
  }
#line 150
  goto switch_break;
  case_4: /* CIL Label */ 
  case_0___0: /* CIL Label */ 
#line 152
  return (1);
  case_1___0: /* CIL Label */ 
#line 154
  return (0);
  switch_default___0: /* CIL Label */ 
  {
#line 155
  __assert_fail("0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                155U, "donut_connectivity_test");
  }
#line 155
  return (0);
  switch_break: /* CIL Label */ ;
  }
#line 157
  return (0);
}
}
#line 158 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c"
static byte donut_transform_pixel(byte *upper , byte *row , byte *lower ) 
{ 
  int sum ;
  int l ;
  int u ;
  int d ;
  int r ;
  int x ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  int s ;
  int tmp___3 ;
  int tmp___4 ;
  int tmp___5 ;
  int tmp___6 ;

  {
#line 189
  if (! *row) {
#line 189
    return ((byte )0);
  }
#line 191
  if (*upper) {
#line 191
    u = 1;
  } else {
#line 191
    u = 0;
  }
#line 191
  if (*lower) {
#line 191
    d = 1;
  } else {
#line 191
    d = 0;
  }
#line 191
  if (*(row + -1)) {
#line 191
    l = 1;
  } else {
#line 191
    l = 0;
  }
#line 191
  if (*(row + 1)) {
#line 191
    r = 1;
  } else {
#line 191
    r = 0;
  }
#line 191
  sum = ((u + d) + l) + r;
  {
#line 196
  if (sum == 3) {
#line 196
    goto case_3;
  }
#line 196
  if (sum == 1) {
#line 196
    goto case_3;
  }
#line 214
  if (sum == 2) {
#line 214
    goto case_2___0;
  }
#line 248
  if (sum == 4) {
#line 248
    goto case_4;
  }
#line 248
  if (sum == 0) {
#line 248
    goto case_4;
  }
#line 250
  goto switch_default___0;
  case_3: /* CIL Label */ 
  case_1: /* CIL Label */ 
#line 198
  x = ((u + (l << 1)) + d) + (d << 1);
#line 199
  if (sum == 3) {
#line 199
    x = (6 - x) ^ 2;
  }
  {
#line 202
  if (x == 0) {
#line 202
    goto case_0;
  }
#line 204
  if (x == 1) {
#line 204
    goto case_1___0;
  }
#line 206
  if (x == 2) {
#line 206
    goto case_2;
  }
#line 208
  if (x == 3) {
#line 208
    goto case_3___0;
  }
#line 210
  goto switch_default;
  case_0: /* CIL Label */ 
#line 203
  if (*(upper + 1)) {
#line 203
    if (*(lower + 1)) {
#line 203
      tmp = 0;
    } else {
#line 203
      tmp = 1;
    }
  } else {
#line 203
    tmp = 1;
  }
#line 203
  return ((byte )tmp);
  case_1___0: /* CIL Label */ 
#line 205
  if (*(upper + -1)) {
#line 205
    if (*(upper + 1)) {
#line 205
      tmp___0 = 0;
    } else {
#line 205
      tmp___0 = 1;
    }
  } else {
#line 205
    tmp___0 = 1;
  }
#line 205
  return ((byte )tmp___0);
  case_2: /* CIL Label */ 
#line 207
  if (*(upper + -1)) {
#line 207
    if (*(lower + -1)) {
#line 207
      tmp___1 = 0;
    } else {
#line 207
      tmp___1 = 1;
    }
  } else {
#line 207
    tmp___1 = 1;
  }
#line 207
  return ((byte )tmp___1);
  case_3___0: /* CIL Label */ 
#line 209
  if (*(lower + -1)) {
#line 209
    if (*(lower + 1)) {
#line 209
      tmp___2 = 0;
    } else {
#line 209
      tmp___2 = 1;
    }
  } else {
#line 209
    tmp___2 = 1;
  }
#line 209
  return ((byte )tmp___2);
  switch_default: /* CIL Label */ 
  {
#line 210
  __assert_fail("0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                210U, "donut_transform_pixel");
  }
#line 210
  return ((byte )0);
  switch_break___0: /* CIL Label */ ;
  }
#line 213
  goto switch_break;
  case_2___0: /* CIL Label */ 
#line 216
  s = l + r;
#line 217
  if (s & 1) {
#line 223
    if (l) {
#line 225
      if (u) {
#line 226
        if (*(upper + -1)) {
#line 226
          tmp___3 = 0;
        } else {
#line 226
          tmp___3 = 1;
        }
#line 226
        return ((byte )tmp___3);
      } else {
#line 228
        if (*(lower + -1)) {
#line 228
          tmp___4 = 0;
        } else {
#line 228
          tmp___4 = 1;
        }
#line 228
        return ((byte )tmp___4);
      }
    } else
#line 232
    if (u) {
#line 233
      if (*(upper + 1)) {
#line 233
        tmp___5 = 0;
      } else {
#line 233
        tmp___5 = 1;
      }
#line 233
      return ((byte )tmp___5);
    } else {
#line 235
      if (*(lower + 1)) {
#line 235
        tmp___6 = 0;
      } else {
#line 235
        tmp___6 = 1;
      }
#line 235
      return ((byte )tmp___6);
    }
  } else {
#line 244
    return ((byte )1);
  }
#line 247
  goto switch_break;
  case_4: /* CIL Label */ 
  case_0___0: /* CIL Label */ 
#line 249
  return ((byte )1);
  switch_default___0: /* CIL Label */ 
  {
#line 250
  __assert_fail("0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                250U, "donut_transform_pixel");
  }
#line 250
  return ((byte )0);
  switch_break: /* CIL Label */ ;
  }
#line 252
  return ((unsigned char)0);
}
}
#line 257 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c"
static int flay(byte **pixels , int w , int h , int rank , int **ranks ) 
{ 
  int i ;
  int j ;
  int result ;
  byte *buf ;
  void *tmp ;
  byte *up ;
  byte *row ;
  byte *dn ;
  byte *buf_row ;
  int *rank_row ;
  int tmp___0 ;

  {
  {
#line 259
  result = 0;
#line 261
  tmp = malloc(sizeof(byte ) * (unsigned long )(w * h));
#line 261
  buf = (byte *)tmp;
  }
#line 263
  if (! pixels) {
    {
#line 263
    __assert_fail("pixels", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                  263U, "flay");
    }
  }
#line 264
  if (! w) {
    {
#line 264
    __assert_fail("w", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                  264U, "flay");
    }
  }
#line 265
  if (! h) {
    {
#line 265
    __assert_fail("h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                  265U, "flay");
    }
  }
#line 267
  i = 0;
  {
#line 267
  while (1) {
    while_continue: /* CIL Label */ ;
#line 267
    if (! (i < h)) {
#line 267
      goto while_break;
    }
#line 267
    j = 0;
    {
#line 267
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 267
      if (! (j < w)) {
#line 267
        goto while_break___0;
      }
      {
#line 269
      *(buf + (w * i + j)) = donut_transform_pixel(*(pixels + (i - 1)) + j, *(pixels + i) + j,
                                                   *(pixels + (i + 1)) + j);
#line 267
      j ++;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 267
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 273
  i = 0;
  {
#line 273
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 273
    if (! (i < h)) {
#line 273
      goto while_break___1;
    }
#line 275
    up = *(pixels + (i - 1));
#line 275
    row = *(pixels + i);
#line 275
    dn = *(pixels + (i + 1));
#line 276
    buf_row = buf + w * i;
#line 277
    rank_row = (int *)((void *)0);
#line 278
    if (ranks) {
#line 278
      rank_row = *(ranks + i);
    }
#line 279
    j = 0;
    {
#line 279
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 279
      if (! (j < w)) {
#line 279
        goto while_break___2;
      }
#line 281
      if (*(row + j)) {
#line 281
        if (! *(buf_row + j)) {
          {
#line 283
          tmp___0 = donut_connectivity_test(up + j, row + j, dn + j);
          }
#line 283
          if (! tmp___0) {
#line 285
            *(row + j) = *(buf_row + j);
#line 286
            if (rank) {
#line 286
              *(rank_row + j) = rank;
            }
#line 287
            result = 1;
          }
        } else {
#line 291
          *(row + j) = *(buf_row + j);
        }
      } else {
#line 291
        *(row + j) = *(buf_row + j);
      }
#line 279
      j ++;
    }
    while_break___2: /* CIL Label */ ;
    }
#line 273
    i ++;
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 295
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 295
    if (buf) {
      {
#line 295
      free((void *)buf);
      }
    }
#line 295
    goto while_break___3;
  }
  while_break___3: /* CIL Label */ ;
  }
#line 296
  return (result);
}
}
#line 300 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c"
void mdjvu_soften_pattern(unsigned char **result , unsigned char **pixels , int32 w ,
                          int32 h ) 
{ 
  byte *r ;
  void *tmp ;
  byte **pointers ;
  void *tmp___0 ;
  int *ranks_buf ;
  void *tmp___1 ;
  int **ranks ;
  void *tmp___2 ;
  int i ;
  int j ;
  int passes ;
  double level ;
  double falloff ;
  byte *colors ;
  int tmp___3 ;
  void *tmp___4 ;

  {
  {
#line 302
  tmp = malloc(sizeof(byte ) * (unsigned long )((w + 2) * (h + 2)));
#line 302
  r = (byte *)tmp;
#line 303
  tmp___0 = malloc(sizeof(byte *) * (unsigned long )(h + 2));
#line 303
  pointers = (byte **)tmp___0;
#line 304
  tmp___1 = malloc(sizeof(int ) * (unsigned long )(w * h));
#line 304
  ranks_buf = (int *)tmp___1;
#line 305
  tmp___2 = malloc(sizeof(int *) * (unsigned long )h);
#line 305
  ranks = (int **)tmp___2;
#line 307
  passes = 1;
#line 308
  level = (double )1;
#line 311
  memset((void *)r, 0, (size_t )((w + 2) * (h + 2)));
#line 312
  memset((void *)ranks_buf, 0, (unsigned long )(w * h) * sizeof(int ));
#line 314
  i = 0;
  }
  {
#line 314
  while (1) {
    while_continue: /* CIL Label */ ;
#line 314
    if (! (i < h + 2)) {
#line 314
      goto while_break;
    }
#line 315
    *(pointers + i) = (r + (w + 2) * i) + 1;
#line 314
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 317
  i = 0;
  {
#line 317
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 317
    if (! (i < h)) {
#line 317
      goto while_break___0;
    }
    {
#line 318
    memcpy((void */* __restrict  */)*(pointers + (i + 1)), (void const   */* __restrict  */)*(pixels + i),
           (size_t )w);
#line 317
    i ++;
    }
  }
  while_break___0: /* CIL Label */ ;
  }
#line 320
  i = 0;
  {
#line 320
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 320
    if (! (i < h)) {
#line 320
      goto while_break___1;
    }
#line 321
    *(ranks + i) = ranks_buf + w * i;
#line 320
    i ++;
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 323
  while (1) {
    while_continue___2: /* CIL Label */ ;
    {
#line 323
    tmp___3 = flay(pointers + 1, w, h, passes, ranks);
    }
#line 323
    if (! tmp___3) {
#line 323
      goto while_break___2;
    }
#line 323
    passes ++;
  }
  while_break___2: /* CIL Label */ ;
  }
  {
#line 325
  tmp___4 = malloc(sizeof(byte ) * (unsigned long )(passes + 1));
#line 325
  colors = (byte *)tmp___4;
#line 327
  falloff = pow(.7, 1. / (double )passes);
#line 329
  i = 0;
  }
  {
#line 329
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 329
    if (! (i < passes)) {
#line 329
      goto while_break___3;
    }
#line 331
    *(colors + i) = (byte )(level * (double )255);
#line 332
    level *= falloff;
#line 329
    i ++;
  }
  while_break___3: /* CIL Label */ ;
  }
#line 336
  *(colors + passes) = (byte )0;
#line 338
  pointers ++;
#line 339
  i = 0;
  {
#line 339
  while (1) {
    while_continue___4: /* CIL Label */ ;
#line 339
    if (! (i < h)) {
#line 339
      goto while_break___4;
    }
#line 341
    j = 0;
    {
#line 341
    while (1) {
      while_continue___5: /* CIL Label */ ;
#line 341
      if (! (j < w)) {
#line 341
        goto while_break___5;
      }
#line 343
      if (*(*(pointers + i) + j)) {
#line 345
        *(*(result + i) + j) = (unsigned char)255;
      } else {
#line 349
        *(*(result + i) + j) = *(colors + (passes - *(*(ranks + i) + j)));
      }
#line 341
      j ++;
    }
    while_break___5: /* CIL Label */ ;
    }
#line 339
    i ++;
  }
  while_break___4: /* CIL Label */ ;
  }
#line 353
  pointers --;
  {
#line 355
  while (1) {
    while_continue___6: /* CIL Label */ ;
#line 355
    if (colors) {
      {
#line 355
      free((void *)colors);
      }
    }
#line 355
    goto while_break___6;
  }
  while_break___6: /* CIL Label */ ;
  }
  {
#line 356
  while (1) {
    while_continue___7: /* CIL Label */ ;
#line 356
    if (ranks) {
      {
#line 356
      free((void *)ranks);
      }
    }
#line 356
    goto while_break___7;
  }
  while_break___7: /* CIL Label */ ;
  }
  {
#line 357
  while (1) {
    while_continue___8: /* CIL Label */ ;
#line 357
    if (ranks_buf) {
      {
#line 357
      free((void *)ranks_buf);
      }
    }
#line 357
    goto while_break___8;
  }
  while_break___8: /* CIL Label */ ;
  }
  {
#line 358
  while (1) {
    while_continue___9: /* CIL Label */ ;
#line 358
    if (r) {
      {
#line 358
      free((void *)r);
      }
    }
#line 358
    goto while_break___9;
  }
  while_break___9: /* CIL Label */ ;
  }
  {
#line 359
  while (1) {
    while_continue___10: /* CIL Label */ ;
#line 359
    if (pointers) {
      {
#line 359
      free((void *)pointers);
      }
    }
#line 359
    goto while_break___10;
  }
  while_break___10: /* CIL Label */ ;
  }
#line 360
  return;
}
}
#line 164 "../include/minidjvu/base/5image.h"
void mdjvu_image_disable_centers(mdjvu_image_t image ) ;
#line 165
void mdjvu_image_get_center(mdjvu_image_t image , mdjvu_bitmap_t b , int32 *px , int32 *py ) ;
#line 11 "../include/minidjvu/alg/average.h"
mdjvu_bitmap_t mdjvu_average(mdjvu_bitmap_t *bitmaps , int32 n , int32 *cx , int32 *cy ) ;
#line 5 "../include/minidjvu/alg/delegate.h"
void mdjvu_multipage_choose_representatives(int32 npages , mdjvu_image_t *pages ,
                                            int32 max_tag , int32 *tags , mdjvu_bitmap_t *representatives ) ;
#line 12
mdjvu_image_t mdjvu_multipage_choose_average_representatives(int32 npages , mdjvu_image_t *pages ,
                                                             int32 total_count , int32 max_tag ,
                                                             int32 *tags , mdjvu_bitmap_t *representatives ,
                                                             unsigned char *dictionary_flags ) ;
#line 11 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/delegate.c"
void mdjvu_multipage_choose_representatives(int32 npages , mdjvu_image_t *pages ,
                                            int32 max_tag , int32 *tags , mdjvu_bitmap_t *representatives ) 
{ 
  int page_number ;
  int32 total_bitmaps_passed ;
  mdjvu_image_t page ;
  int32 bitmap_count ;
  int32 tmp ;
  int32 i ;
  int32 tag ;
  int32 tmp___0 ;

  {
  {
#line 19
  total_bitmaps_passed = 0;
#line 20
  memset((void *)representatives, 0, (unsigned long )(max_tag + 1) * sizeof(mdjvu_bitmap_t ));
#line 21
  page_number = 0;
  }
  {
#line 21
  while (1) {
    while_continue: /* CIL Label */ ;
#line 21
    if (! (page_number < npages)) {
#line 21
      goto while_break;
    }
    {
#line 23
    page = *(pages + page_number);
#line 24
    tmp = mdjvu_image_get_bitmap_count(page);
#line 24
    bitmap_count = tmp;
#line 27
    i = 0;
    }
    {
#line 27
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 27
      if (! (i < bitmap_count)) {
#line 27
        goto while_break___0;
      }
#line 29
      tmp___0 = total_bitmaps_passed;
#line 29
      total_bitmaps_passed ++;
#line 29
      tag = *(tags + tmp___0);
#line 30
      if (! tag) {
#line 30
        goto __Cont;
      }
#line 31
      if (! *(representatives + tag)) {
        {
#line 32
        *(representatives + tag) = mdjvu_image_get_bitmap(page, i);
        }
      }
      __Cont: /* CIL Label */ 
#line 27
      i ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 21
    page_number ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 35
  return;
}
}
#line 37 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/delegate.c"
mdjvu_image_t mdjvu_multipage_choose_average_representatives(int32 npages , mdjvu_image_t *pages ,
                                                             int32 total_count , int32 max_tag ,
                                                             int32 *tags , mdjvu_bitmap_t *representatives ,
                                                             unsigned char *dictionary_flags ) 
{ 
  int32 page_number ;
  int32 tag ;
  mdjvu_bitmap_t *sources ;
  int32 *cx ;
  int32 *cy ;
  mdjvu_image_t dictionary ;
  mdjvu_image_t tmp ;
  void *tmp___0 ;
  void *tmp___1 ;
  void *tmp___2 ;
  int32 sources_found ;
  int32 total_bitmaps_passed ;
  mdjvu_bitmap_t rep ;
  mdjvu_image_t page ;
  int32 bitmap_count ;
  int32 tmp___3 ;
  int32 i ;
  int32 tmp___4 ;
  mdjvu_bitmap_t rep___0 ;

  {
  {
#line 49
  tmp = mdjvu_image_create(0, 0);
#line 49
  dictionary = tmp;
#line 51
  memset((void *)representatives, 0, (unsigned long )(max_tag + 1) * sizeof(mdjvu_bitmap_t ));
#line 53
  tmp___0 = malloc((unsigned long )total_count * sizeof(mdjvu_bitmap_t ));
#line 53
  sources = (mdjvu_bitmap_t *)tmp___0;
#line 54
  tmp___1 = malloc((unsigned long )total_count * sizeof(int32 ));
#line 54
  cx = (int32 *)tmp___1;
#line 55
  tmp___2 = malloc((unsigned long )total_count * sizeof(int32 ));
#line 55
  cy = (int32 *)tmp___2;
#line 57
  tag = 1;
  }
  {
#line 57
  while (1) {
    while_continue: /* CIL Label */ ;
#line 57
    if (! (tag < max_tag)) {
#line 57
      goto while_break;
    }
#line 59
    sources_found = 0;
#line 59
    total_bitmaps_passed = 0;
#line 61
    if (! *(dictionary_flags + tag)) {
#line 61
      goto __Cont;
    }
    {
#line 63
    memset((void *)sources, 0, (unsigned long )total_count * sizeof(mdjvu_bitmap_t ));
#line 64
    memset((void *)cx, 0, (unsigned long )total_count * sizeof(int32 ));
#line 65
    memset((void *)cy, 0, (unsigned long )total_count * sizeof(int32 ));
#line 66
    page_number = 0;
    }
    {
#line 66
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 66
      if (! (page_number < npages)) {
#line 66
        goto while_break___0;
      }
      {
#line 68
      page = *(pages + page_number);
#line 69
      tmp___3 = mdjvu_image_get_bitmap_count(page);
#line 69
      bitmap_count = tmp___3;
#line 72
      i = 0;
      }
      {
#line 72
      while (1) {
        while_continue___1: /* CIL Label */ ;
#line 72
        if (! (i < bitmap_count)) {
#line 72
          goto while_break___1;
        }
#line 74
        tmp___4 = total_bitmaps_passed;
#line 74
        total_bitmaps_passed ++;
#line 74
        if (*(tags + tmp___4) == tag) {
          {
#line 76
          *(sources + sources_found) = mdjvu_image_get_bitmap(page, i);
#line 77
          mdjvu_image_get_center(page, *(sources + sources_found), cx + sources_found,
                                 cy + sources_found);
#line 78
          sources_found ++;
          }
        }
#line 72
        i ++;
      }
      while_break___1: /* CIL Label */ ;
      }
#line 66
      page_number ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 83
    if (sources_found) {
      {
#line 85
      rep = mdjvu_average(sources, sources_found, cx, cy);
#line 86
      *(representatives + tag) = rep;
      }
    }
    __Cont: /* CIL Label */ 
#line 57
    tag ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 89
  free((void *)cx);
#line 90
  free((void *)cy);
#line 91
  free((void *)sources);
#line 93
  page_number = 0;
  }
  {
#line 93
  while (1) {
    while_continue___2: /* CIL Label */ ;
#line 93
    if (! (page_number < npages)) {
#line 93
      goto while_break___2;
    }
    {
#line 94
    mdjvu_image_disable_centers(*(pages + page_number));
#line 93
    page_number ++;
    }
  }
  while_break___2: /* CIL Label */ ;
  }
#line 96
  tag = 1;
  {
#line 96
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 96
    if (! (tag <= max_tag)) {
#line 96
      goto while_break___3;
    }
#line 100
    if (! *(dictionary_flags + tag)) {
#line 100
      goto __Cont___0;
    } else {
#line 100
      rep___0 = *(representatives + tag);
#line 100
      if ((unsigned long )rep___0 == (unsigned long )((void *)0)) {
#line 100
        goto __Cont___0;
      }
    }
    {
#line 101
    mdjvu_image_add_bitmap(dictionary, rep___0);
    }
    __Cont___0: /* CIL Label */ 
#line 96
    tag ++;
  }
  while_break___3: /* CIL Label */ ;
  }
#line 103
  return (dictionary);
}
}
#line 9 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/3graymap.c"
unsigned char **mdjvu_create_2d_array(int32 w , int32 h ) 
{ 
  int32 i ;
  unsigned char *data ;
  unsigned char **result ;
  void *tmp ;

  {
  {
#line 13
  tmp = calloc((size_t )h, sizeof(unsigned char *) + (unsigned long )w);
#line 13
  result = (unsigned char **)tmp;
#line 14
  data = (unsigned char *)(result + h);
#line 16
  i = 0;
  }
  {
#line 16
  while (1) {
    while_continue: /* CIL Label */ ;
#line 16
    if (! (i < h)) {
#line 16
      goto while_break;
    }
#line 18
    *(result + i) = data + w * i;
#line 16
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 21
  return (result);
}
}
#line 24 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/3graymap.c"
void mdjvu_destroy_2d_array(unsigned char **p ) 
{ 


  {
  {
#line 26
  free((void *)p);
  }
#line 27
  return;
}
}
#line 22 "../include/minidjvu/base/2io.h"
mdjvu_file_t mdjvu_fopen(char const   *path , char const   *mode ) ;
#line 23
void mdjvu_fclose(mdjvu_file_t f ) ;
#line 25
int32 mdjvu_fread(void *p , int32 size , int32 n , mdjvu_file_t f ) ;
#line 27
int32 mdjvu_fwrite(void const   *p , int32 size , int32 n , mdjvu_file_t f ) ;
#line 31
void mdjvu_write_little_endian_int32(int32 i , mdjvu_file_t file ) ;
#line 32
int32 mdjvu_read_big_endian_int32(mdjvu_file_t file ) ;
#line 33
int32 mdjvu_read_little_endian_int32(mdjvu_file_t file ) ;
#line 34
void mdjvu_write_big_endian_int16(int16 i , mdjvu_file_t file ) ;
#line 35
void mdjvu_write_little_endian_int16(int16 i , mdjvu_file_t file ) ;
#line 36
int16 mdjvu_read_big_endian_int16(mdjvu_file_t file ) ;
#line 37
int16 mdjvu_read_little_endian_int16(mdjvu_file_t file ) ;
#line 434 "/usr/include/libio.h"
extern int _IO_getc(_IO_FILE *__fp ) ;
#line 435
extern int _IO_putc(int __c , _IO_FILE *__fp ) ;
#line 9 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
mdjvu_file_t mdjvu_fopen(char const   *path , char const   *mode ) 
{ 
  FILE *tmp ;

  {
  {
#line 10
  tmp = fopen((char const   */* __restrict  */)path, (char const   */* __restrict  */)mode);
  }
#line 10
  return ((mdjvu_file_t )tmp);
}
}
#line 12 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
void mdjvu_fclose(mdjvu_file_t f ) 
{ 


  {
  {
#line 13
  fclose((FILE *)f);
  }
#line 13
  return;
}
}
#line 15 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
int32 mdjvu_fread(void *p , int32 size , int32 n , mdjvu_file_t f ) 
{ 
  size_t tmp ;

  {
  {
#line 16
  tmp = fread((void */* __restrict  */)p, (size_t )size, (size_t )n, (FILE */* __restrict  */)((FILE *)f));
  }
#line 16
  return ((int32 )tmp);
}
}
#line 18 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
int32 mdjvu_fwrite(void const   *p , int32 size , int32 n , mdjvu_file_t f ) 
{ 
  size_t tmp ;

  {
  {
#line 20
  tmp = fwrite((void const   */* __restrict  */)p, (size_t )size, (size_t )n, (FILE */* __restrict  */)((FILE *)f));
  }
#line 20
  return ((int32 )tmp);
}
}
#line 22 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
void mdjvu_write_big_endian_int32(int32 i , mdjvu_file_t file ) 
{ 
  FILE *f ;

  {
  {
#line 24
  f = (FILE *)file;
#line 25
  _IO_putc(i >> 24, f);
#line 26
  _IO_putc(i >> 16, f);
#line 27
  _IO_putc(i >> 8, f);
#line 28
  _IO_putc(i, f);
  }
#line 29
  return;
}
}
#line 31 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
void mdjvu_write_little_endian_int32(int32 i , mdjvu_file_t file ) 
{ 
  FILE *f ;

  {
  {
#line 33
  f = (FILE *)file;
#line 34
  _IO_putc(i, f);
#line 35
  _IO_putc(i >> 8, f);
#line 36
  _IO_putc(i >> 16, f);
#line 37
  _IO_putc(i >> 24, f);
  }
#line 38
  return;
}
}
#line 40 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
void mdjvu_write_big_endian_int16(int16 i , mdjvu_file_t file ) 
{ 
  FILE *f ;

  {
  {
#line 42
  f = (FILE *)file;
#line 43
  _IO_putc((int )i >> 8, f);
#line 44
  _IO_putc((int )i, f);
  }
#line 45
  return;
}
}
#line 47 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
void mdjvu_write_little_endian_int16(int16 i , mdjvu_file_t file ) 
{ 
  FILE *f ;

  {
  {
#line 49
  f = (FILE *)file;
#line 50
  _IO_putc((int )i, f);
#line 51
  _IO_putc((int )i >> 8, f);
  }
#line 52
  return;
}
}
#line 54 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
int32 mdjvu_read_big_endian_int32(mdjvu_file_t file ) 
{ 
  FILE *f ;
  int32 r ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;

  {
  {
#line 56
  f = (FILE *)file;
#line 57
  tmp = _IO_getc(f);
#line 57
  r = tmp << 24;
#line 58
  tmp___0 = _IO_getc(f);
#line 58
  r |= tmp___0 << 16;
#line 59
  tmp___1 = _IO_getc(f);
#line 59
  r |= tmp___1 << 8;
#line 60
  tmp___2 = _IO_getc(f);
#line 60
  r |= tmp___2;
  }
#line 61
  return (r);
}
}
#line 64 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
int16 mdjvu_read_big_endian_int16(mdjvu_file_t file ) 
{ 
  FILE *f ;
  int16 r ;
  int tmp ;
  int tmp___0 ;

  {
  {
#line 66
  f = (FILE *)file;
#line 67
  tmp = _IO_getc(f);
#line 67
  r = (int16 )(tmp << 8);
#line 68
  tmp___0 = _IO_getc(f);
#line 68
  r = (int16 )((int )r | tmp___0);
  }
#line 69
  return (r);
}
}
#line 72 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
int32 mdjvu_read_little_endian_int32(mdjvu_file_t file ) 
{ 
  FILE *f ;
  int32 r ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;

  {
  {
#line 74
  f = (FILE *)file;
#line 75
  tmp = _IO_getc(f);
#line 75
  r = tmp;
#line 76
  tmp___0 = _IO_getc(f);
#line 76
  r |= tmp___0 << 8;
#line 77
  tmp___1 = _IO_getc(f);
#line 77
  r |= tmp___1 << 16;
#line 78
  tmp___2 = _IO_getc(f);
#line 78
  r |= tmp___2 << 24;
  }
#line 79
  return (r);
}
}
#line 82 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/2io.c"
int16 mdjvu_read_little_endian_int16(mdjvu_file_t file ) 
{ 
  FILE *f ;
  int32 r ;
  int tmp ;
  int tmp___0 ;

  {
  {
#line 84
  f = (FILE *)file;
#line 85
  tmp = _IO_getc(f);
#line 85
  r = tmp;
#line 86
  tmp___0 = _IO_getc(f);
#line 86
  r |= tmp___0 << 8;
  }
#line 87
  return ((int16 )r);
}
}
#line 68 "../include/minidjvu/base/4bitmap.h"
void mdjvu_bitmap_unpack_all(mdjvu_bitmap_t b , unsigned char **data ) ;
#line 11 "../include/minidjvu/alg/../matcher.h"
mdjvu_matcher_options_t mdjvu_matcher_options_create(void) ;
#line 12
void mdjvu_set_aggression(mdjvu_matcher_options_t opt , int level ) ;
#line 20
void mdjvu_use_matcher_method(mdjvu_matcher_options_t opt , int method ) ;
#line 22
void mdjvu_matcher_options_destroy(mdjvu_matcher_options_t opt ) ;
#line 41
mdjvu_pattern_t mdjvu_pattern_create(mdjvu_matcher_options_t opt , mdjvu_bitmap_t bitmap ) ;
#line 47
mdjvu_pattern_t mdjvu_pattern_create_from_array(mdjvu_matcher_options_t m_opt , unsigned char **pixels ,
                                                int32 w , int32 h ) ;
#line 53
void mdjvu_pattern_destroy(mdjvu_pattern_t p ) ;
#line 57
void mdjvu_pattern_get_center(mdjvu_pattern_t p , int32 *cx , int32 *cy ) ;
#line 71
int mdjvu_match_patterns(mdjvu_pattern_t ptr1 , mdjvu_pattern_t ptr2 , int32 dpi___0 ,
                         mdjvu_matcher_options_t options ) ;
#line 82
void mdjvu_get_gray_signature(unsigned char **data , int32 w , int32 h , unsigned char *result ,
                              int32 size ) ;
#line 86
void mdjvu_get_black_and_white_signature(unsigned char **data , int32 w , int32 h ,
                                         unsigned char *result , int32 size ) ;
#line 40 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   pithdiff1_veto_threshold  =    (double const   )23;
#line 41 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   pithdiff2_veto_threshold  =    (double const   )4;
#line 42 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff1_veto_threshold  =    (double const   )1000;
#line 43 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff2_veto_threshold  =    (double const   )1500;
#line 44 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff3_veto_threshold  =    (double const   )2000;
#line 46 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   size_difference_threshold  =    (double const   )10;
#line 47 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   mass_difference_threshold  =    (double const   )15;
#line 49 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff1_falloff  =    (double const   ).9;
#line 50 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff2_falloff  =    (double const   )1;
#line 51 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff3_falloff  =    (double const   )1.15;
#line 53 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static void interpolate(Options *opt , double const   *v1 , double const   *v2 , int l ,
                        int r , int x ) 
{ 
  double w1 ;
  double w2 ;

  {
#line 56
  w1 = (double )(r - x) / (double )(r - l);
#line 57
  w2 = (double )1 - w1;
#line 58
  opt->pithdiff1_threshold = (double )(*(v1 + 0) * (double const   )w1 + *(v2 + 0) * (double const   )w2);
#line 59
  opt->pithdiff2_threshold = (double )(*(v1 + 1) * (double const   )w1 + *(v2 + 1) * (double const   )w2);
#line 60
  opt->shiftdiff1_threshold = (double )(*(v1 + 2) * (double const   )w1 + *(v2 + 2) * (double const   )w2);
#line 61
  opt->shiftdiff2_threshold = (double )(*(v1 + 3) * (double const   )w1 + *(v2 + 3) * (double const   )w2);
#line 62
  opt->shiftdiff3_threshold = (double )(*(v1 + 4) * (double const   )w1 + *(v2 + 4) * (double const   )w2);
#line 63
  return;
}
}
#line 70 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
void mdjvu_set_aggression(mdjvu_matcher_options_t opt , int level ) 
{ 
  double set200[5] ;
  double set120[5] ;
  double set0[5] ;

  {
#line 72
  set200[0] = (double )9;
#line 72
  set200[1] = 1.2;
#line 72
  set200[2] = (double )70;
#line 72
  set200[3] = (double )90;
#line 72
  set200[4] = (double )180;
#line 73
  set120[0] = (double )5;
#line 73
  set120[1] = .2;
#line 73
  set120[2] = (double )50;
#line 73
  set120[3] = (double )70;
#line 73
  set120[4] = (double )150;
#line 74
  set0[0] = (double )0;
#line 74
  set0[1] = (double )0;
#line 74
  set0[2] = (double )0;
#line 74
  set0[3] = (double )0;
#line 74
  set0[4] = (double )0;
#line 76
  if (level < 0) {
#line 76
    level = 0;
  }
#line 78
  ((Options *)opt)->aggression = level;
#line 80
  if (level > 120) {
    {
#line 81
    interpolate((Options *)opt, (double const   *)(set120), (double const   *)(set200),
                120, 200, level);
    }
  } else {
    {
#line 83
    interpolate((Options *)opt, (double const   *)(set0), (double const   *)(set120),
                0, 120, level);
    }
  }
#line 84
  return;
}
}
#line 88 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
mdjvu_matcher_options_t mdjvu_matcher_options_create(void) 
{ 
  mdjvu_matcher_options_t options ;
  void *tmp ;

  {
  {
#line 90
  tmp = malloc(sizeof(Options ));
#line 90
  options = (mdjvu_matcher_options_t )((Options *)tmp);
#line 91
  mdjvu_init();
#line 92
  mdjvu_set_aggression(options, 100);
#line 93
  ((Options *)options)->method = 0;
  }
#line 94
  return (options);
}
}
#line 97 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
void mdjvu_use_matcher_method(mdjvu_matcher_options_t opt , int method ) 
{ 


  {
#line 99
  ((Options *)opt)->method |= method;
#line 100
  return;
}
}
#line 102 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
void mdjvu_matcher_options_destroy(mdjvu_matcher_options_t opt ) 
{ 


  {
  {
#line 104
  free((void *)((Options *)opt));
  }
#line 105
  return;
}
}
#line 139 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int simple_tests(Image *i1 , Image *i2 ) 
{ 
  int32 w1 ;
  int32 h1 ;
  int32 m1 ;
  int32 w2 ;
  int32 h2 ;
  int32 m2 ;

  {
#line 141
  w1 = i1->width;
#line 141
  h1 = i1->height;
#line 141
  m1 = i1->mass;
#line 142
  w2 = i2->width;
#line 142
  h2 = i2->height;
#line 142
  m2 = i2->mass;
#line 144
  if (100. * (double )w1 > (100. + (double )size_difference_threshold) * (double )w2) {
#line 144
    return (-1);
  }
#line 145
  if (100. * (double )w2 > (100. + (double )size_difference_threshold) * (double )w1) {
#line 145
    return (-1);
  }
#line 146
  if (100. * (double )h1 > (100. + (double )size_difference_threshold) * (double )h2) {
#line 146
    return (-1);
  }
#line 147
  if (100. * (double )h2 > (100. + (double )size_difference_threshold) * (double )h1) {
#line 147
    return (-1);
  }
#line 148
  if (100. * (double )m1 > (100. + (double )mass_difference_threshold) * (double )m2) {
#line 148
    return (-1);
  }
#line 149
  if (100. * (double )m2 > (100. + (double )mass_difference_threshold) * (double )m1) {
#line 149
    return (-1);
  }
#line 151
  return (0);
}
}
#line 171 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 distance_by_pixeldiff_functions_by_shift(Image *i1 , Image *i2 , int32 (*compare_row)(byte * ,
                                                                                                   byte * ,
                                                                                                   int32  ) ,
                                                      int32 (*compare_1_with_white)(byte * ,
                                                                                    int32  ) ,
                                                      int32 (*compare_2_with_white)(byte * ,
                                                                                    int32  ) ,
                                                      int32 ceiling , int32 shift_x ,
                                                      int32 shift_y ) 
{ 
  int32 w1 ;
  int32 w2 ;
  int32 h1 ;
  int32 h2 ;
  int32 min_y ;
  int32 tmp ;
  int32 right1 ;
  int32 max_y_plus_1 ;
  int32 tmp___0 ;
  int32 i ;
  int32 min_overlap_x ;
  int32 tmp___1 ;
  int32 max_overlap_x_plus_1 ;
  int32 tmp___2 ;
  int32 min_overlap_x_for_i1 ;
  int32 max_overlap_x_plus_1_for_i1 ;
  int32 overlap_length ;
  int32 score ;
  int32 y1___0 ;
  int32 tmp___3 ;
  int32 tmp___4 ;
  int32 tmp___5 ;
  int32 tmp___6 ;
  int32 tmp___7 ;
  int32 tmp___8 ;
  int32 tmp___9 ;

  {
#line 178
  w1 = i1->width;
#line 178
  w2 = i2->width;
#line 178
  h1 = i1->height;
#line 178
  h2 = i2->height;
#line 179
  if (shift_y < 0) {
#line 179
    tmp = shift_y;
  } else {
#line 179
    tmp = 0;
  }
#line 179
  min_y = tmp;
#line 180
  right1 = shift_x + w1;
#line 181
  if (h2 > shift_y + h1) {
#line 181
    tmp___0 = h2;
  } else {
#line 181
    tmp___0 = shift_y + h1;
  }
#line 181
  max_y_plus_1 = tmp___0;
#line 183
  if (shift_x > 0) {
#line 183
    tmp___1 = shift_x;
  } else {
#line 183
    tmp___1 = 0;
  }
#line 183
  min_overlap_x = tmp___1;
#line 184
  if (w2 < right1) {
#line 184
    tmp___2 = w2;
  } else {
#line 184
    tmp___2 = right1;
  }
#line 184
  max_overlap_x_plus_1 = tmp___2;
#line 185
  min_overlap_x_for_i1 = min_overlap_x - shift_x;
#line 186
  max_overlap_x_plus_1_for_i1 = max_overlap_x_plus_1 - shift_x;
#line 187
  overlap_length = max_overlap_x_plus_1 - min_overlap_x;
#line 188
  score = 0;
#line 190
  if (overlap_length <= 0) {
#line 190
    return (2147483647);
  }
#line 192
  i = min_y;
  {
#line 192
  while (1) {
    while_continue: /* CIL Label */ ;
#line 192
    if (! (i < max_y_plus_1)) {
#line 192
      goto while_break;
    }
#line 194
    y1___0 = i - shift_y;
#line 198
    if (i < 0) {
      {
#line 201
      tmp___3 = (*compare_1_with_white)(*(i1->pixels + y1___0), w1);
#line 201
      score += tmp___3;
      }
    } else
#line 198
    if (i >= h2) {
      {
#line 201
      tmp___3 = (*compare_1_with_white)(*(i1->pixels + y1___0), w1);
#line 201
      score += tmp___3;
      }
    } else
#line 203
    if (i < shift_y) {
      {
#line 206
      tmp___4 = (*compare_2_with_white)(*(i2->pixels + i), w2);
#line 206
      score += tmp___4;
      }
    } else
#line 203
    if (i >= shift_y + h1) {
      {
#line 206
      tmp___4 = (*compare_2_with_white)(*(i2->pixels + i), w2);
#line 206
      score += tmp___4;
      }
    } else {
      {
#line 211
      tmp___5 = (*compare_row)(*(i1->pixels + y1___0) + min_overlap_x_for_i1, *(i2->pixels + i) + min_overlap_x,
                               overlap_length);
#line 211
      score += tmp___5;
      }
#line 217
      if (min_overlap_x > 0) {
        {
#line 218
        tmp___6 = (*compare_2_with_white)(*(i2->pixels + i), min_overlap_x);
#line 218
        score += tmp___6;
        }
      } else {
        {
#line 220
        tmp___7 = (*compare_1_with_white)(*(i1->pixels + y1___0), min_overlap_x_for_i1);
#line 220
        score += tmp___7;
        }
      }
#line 223
      if (max_overlap_x_plus_1 < w2) {
        {
#line 225
        tmp___8 = (*compare_2_with_white)(*(i2->pixels + i) + max_overlap_x_plus_1,
                                          w2 - max_overlap_x_plus_1);
#line 225
        score += tmp___8;
        }
      } else {
        {
#line 231
        tmp___9 = (*compare_1_with_white)(*(i1->pixels + y1___0) + max_overlap_x_plus_1_for_i1,
                                          w1 - max_overlap_x_plus_1_for_i1);
#line 231
        score += tmp___9;
        }
      }
    }
#line 238
    if (score >= ceiling) {
#line 238
      return (2147483647);
    }
#line 192
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 240
  return (score);
}
}
#line 243 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 distance_by_pixeldiff_functions(Image *i1 , Image *i2 , int32 (*compare_row)(byte * ,
                                                                                          byte * ,
                                                                                          int32  ) ,
                                             int32 (*compare_1_with_white)(byte * ,
                                                                           int32  ) ,
                                             int32 (*compare_2_with_white)(byte * ,
                                                                           int32  ) ,
                                             int32 ceiling ) 
{ 
  byte **p1 ;
  byte **p2 ;
  int32 w1 ;
  int32 w2 ;
  int32 h1 ;
  int32 h2 ;
  int32 shift_x ;
  int32 shift_y ;
  Image *img ;
  int32 tmp ;

  {
#line 256
  if (i1->width > i2->width) {
#line 258
    img = i1;
#line 259
    i1 = i2;
#line 260
    i2 = img;
  }
#line 263
  w1 = i1->width;
#line 263
  h1 = i1->height;
#line 263
  p1 = i1->pixels;
#line 264
  w2 = i2->width;
#line 264
  h2 = i2->height;
#line 264
  p2 = i2->pixels;
#line 268
  shift_x = (w2 - w2 / 2) - (w1 - w1 / 2);
#line 269
  shift_y = h2 / 2 - h1 / 2;
#line 271
  shift_x = i2->mass_center_x - i1->mass_center_x;
#line 272
  if (shift_x < 0) {
#line 273
    shift_x = (shift_x - 4) / 8;
  } else {
#line 275
    shift_x = (shift_x + 4) / 8;
  }
#line 277
  shift_y = i2->mass_center_y - i1->mass_center_y;
#line 278
  if (shift_y < 0) {
#line 279
    shift_y = (shift_y - 4) / 8;
  } else {
#line 281
    shift_y = (shift_y + 4) / 8;
  }
  {
#line 283
  tmp = distance_by_pixeldiff_functions_by_shift(i1, i2, compare_row, compare_1_with_white,
                                                 compare_2_with_white, ceiling, shift_x,
                                                 shift_y);
  }
#line 283
  return (tmp);
}
}
#line 302 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pithdiff_compare_row(byte *row1 , byte *row2 , int32 n ) 
{ 
  int32 i ;
  int32 s ;
  int32 k ;
  int32 l ;

  {
#line 304
  s = 0;
#line 305
  i = 0;
  {
#line 305
  while (1) {
    while_continue: /* CIL Label */ ;
#line 305
    if (! (i < n)) {
#line 305
      goto while_break;
    }
#line 307
    k = (int32 )*(row1 + i);
#line 307
    l = (int32 )*(row2 + i);
#line 308
    if (k == 255) {
#line 309
      s += 255 - l;
    } else
#line 310
    if (l == 255) {
#line 311
      s += 255 - k;
    }
#line 305
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 313
  return (s);
}
}
#line 316 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pithdiff_compare_with_white(byte *row , int32 n ) 
{ 
  int32 i ;
  int32 s ;

  {
#line 318
  s = 0;
#line 319
  i = 0;
  {
#line 319
  while (1) {
    while_continue: /* CIL Label */ ;
#line 319
    if (! (i < n)) {
#line 319
      goto while_break;
    }
#line 319
    if ((int )*(row + i) == 255) {
#line 319
      s += 255;
    }
#line 319
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 320
  return (s);
}
}
#line 323 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pithdiff_distance(Image *i1 , Image *i2 , int32 ceiling ) 
{ 
  int32 tmp ;

  {
  {
#line 325
  tmp = distance_by_pixeldiff_functions(i1, i2, & pithdiff_compare_row, & pithdiff_compare_with_white,
                                        & pithdiff_compare_with_white, ceiling);
  }
#line 325
  return (tmp);
}
}
#line 332 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int pithdiff_equivalence(Image *i1 , Image *i2 , double threshold , int32 dpi___0 ) 
{ 
  int32 perimeter ;
  int32 ceiling ;
  int32 d ;
  int32 tmp ;

  {
  {
#line 334
  perimeter = ((i1->width + i1->height) + i2->width) + i2->height;
#line 335
  ceiling = (int32 )(((pithdiff1_veto_threshold * (double const   )dpi___0) * (double const   )perimeter) / (double const   )100);
#line 336
  tmp = pithdiff_distance(i1, i2, ceiling);
#line 336
  d = tmp;
  }
#line 337
  if (d == 2147483647) {
#line 337
    return (-1);
  }
#line 338
  if ((double )d < ((threshold * (double )dpi___0) * (double )perimeter) / (double )100) {
#line 338
    return (1);
  }
#line 339
  return (0);
}
}
#line 353 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int shiftdiff_equivalence(byte *s1 , byte *s2 , double falloff , double veto ,
                                 double threshold ) 
{ 
  int i ;
  int delay_before_falloff ;
  int delay_counter ;
  double penalty ;
  double weight ;
  int difference ;

  {
#line 355
  delay_before_falloff = 1;
#line 355
  delay_counter = 1;
#line 356
  penalty = (double )0;
#line 357
  weight = (double )1;
#line 359
  i = 1;
  {
#line 359
  while (1) {
    while_continue: /* CIL Label */ ;
#line 359
    if (! (i < 32)) {
#line 359
      goto while_break;
    }
#line 361
    difference = (int )*(s1 + i) - (int )*(s2 + i);
#line 362
    penalty += (double )(difference * difference) * weight;
#line 363
    delay_counter --;
#line 363
    if (! delay_counter) {
#line 365
      weight *= falloff;
#line 366
      delay_before_falloff <<= 1;
#line 366
      delay_counter = delay_before_falloff;
    }
#line 359
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 370
  if (penalty >= veto * (double )32) {
#line 370
    return (-1);
  }
#line 371
  if (penalty <= threshold * (double )32) {
#line 371
    return (1);
  }
#line 372
  return (0);
}
}
#line 378 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
mdjvu_pattern_t mdjvu_pattern_create(mdjvu_matcher_options_t opt , mdjvu_bitmap_t bitmap ) 
{ 
  int32 w ;
  int32 tmp ;
  int32 h ;
  int32 tmp___0 ;
  mdjvu_pattern_t pattern ;
  byte **pixels ;
  unsigned char **tmp___1 ;

  {
  {
#line 381
  tmp = mdjvu_bitmap_get_width(bitmap);
#line 381
  w = tmp;
#line 382
  tmp___0 = mdjvu_bitmap_get_height(bitmap);
#line 382
  h = tmp___0;
#line 384
  tmp___1 = mdjvu_create_2d_array(w, h);
#line 384
  pixels = tmp___1;
#line 385
  mdjvu_bitmap_unpack_all(bitmap, pixels);
#line 386
  pattern = mdjvu_pattern_create_from_array(opt, pixels, w, h);
#line 387
  mdjvu_destroy_2d_array(pixels);
  }
#line 388
  return (pattern);
}
}
#line 394 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static void get_mass_center(unsigned char **pixels , int32 w , int32 h , int32 *pmass_center_x ,
                            int32 *pmass_center_y ) 
{ 
  double x_sum ;
  double y_sum ;
  double mass ;
  int32 i ;
  int32 j ;
  unsigned char *row ;
  unsigned char pixel ;

  {
#line 397
  x_sum = (double )0;
#line 397
  y_sum = (double )0;
#line 397
  mass = (double )0;
#line 400
  i = 0;
  {
#line 400
  while (1) {
    while_continue: /* CIL Label */ ;
#line 400
    if (! (i < h)) {
#line 400
      goto while_break;
    }
#line 402
    row = *(pixels + i);
#line 403
    j = 0;
    {
#line 403
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 403
      if (! (j < w)) {
#line 403
        goto while_break___0;
      }
#line 405
      pixel = *(row + j);
#line 406
      x_sum += (double )((int )pixel * j);
#line 407
      y_sum += (double )((int )pixel * i);
#line 408
      mass += (double )pixel;
#line 403
      j ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 400
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 412
  *pmass_center_x = (int32 )((x_sum * (double )8) / mass);
#line 413
  *pmass_center_y = (int32 )((y_sum * (double )8) / mass);
#line 414
  return;
}
}
#line 420 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
void mdjvu_pattern_get_center(mdjvu_pattern_t p , int32 *cx , int32 *cy ) 
{ 


  {
#line 422
  *cx = ((Image *)p)->mass_center_x;
#line 423
  *cy = ((Image *)p)->mass_center_y;
#line 424
  return;
}
}
#line 426 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static void sweep(unsigned char **pixels , unsigned char **source , int w , int h ) 
{ 
  int x ;
  int y ;
  unsigned char *row ;
  unsigned char *srow ;
  unsigned char *supper ;
  unsigned char *slower ;

  {
#line 430
  y = 0;
  {
#line 430
  while (1) {
    while_continue: /* CIL Label */ ;
#line 430
    if (! (y < h)) {
#line 430
      goto while_break;
    }
#line 432
    row = *(pixels + y);
#line 433
    srow = *(source + y);
#line 434
    supper = *(source + (y - 1));
#line 435
    slower = *(source + (y + 1));
#line 437
    x = 0;
    {
#line 437
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 437
      if (! (x < w)) {
#line 437
        goto while_break___0;
      }
#line 439
      *(row + x) = (unsigned char )(((((int )*(supper + x) | (int )*(srow + (x - 1))) | (int )*(srow + x)) | (int )*(srow + (x + 1))) | (int )*(slower + x));
#line 437
      x ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 430
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 444
  return;
}
}
#line 446 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static unsigned char **quick_thin(unsigned char **pixels , int w , int h , int N ) 
{ 
  unsigned char **aux ;
  unsigned char **tmp ;
  unsigned char **buf ;
  unsigned char **tmp___0 ;
  int tmp___1 ;

  {
  {
#line 448
  tmp = provide_margins(pixels, w, h, 1);
#line 448
  aux = tmp;
#line 449
  tmp___0 = allocate_bitmap_with_white_margins(w, h);
#line 449
  buf = tmp___0;
#line 451
  clear_bitmap(buf, w, h);
#line 452
  invert_bitmap(aux, w, h, 0);
  }
  {
#line 454
  while (1) {
    while_continue: /* CIL Label */ ;
#line 454
    tmp___1 = N;
#line 454
    N --;
#line 454
    if (! tmp___1) {
#line 454
      goto while_break;
    }
    {
#line 456
    sweep(buf, aux, w, h);
#line 457
    assign_bitmap(aux, buf, w, h);
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 460
  invert_bitmap(buf, w, h, 0);
#line 462
  free_bitmap_with_margins(aux);
  }
#line 463
  return (buf);
}
}
#line 466 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static unsigned char **quick_thicken(unsigned char **pixels , int w , int h , int N ) 
{ 
  int r_w ;
  int r_h ;
  int y ;
  int x ;
  unsigned char **aux ;
  unsigned char **tmp ;
  unsigned char **buf ;
  unsigned char **tmp___0 ;
  int tmp___1 ;

  {
  {
#line 468
  r_w = w + N * 2;
#line 469
  r_h = h + N * 2;
#line 471
  tmp = allocate_bitmap_with_white_margins(r_w, r_h);
#line 471
  aux = tmp;
#line 472
  tmp___0 = allocate_bitmap_with_white_margins(r_w, r_h);
#line 472
  buf = tmp___0;
#line 474
  clear_bitmap(buf, r_w, r_h);
#line 475
  clear_bitmap(aux, r_w, r_h);
#line 476
  y = 0;
  }
  {
#line 476
  while (1) {
    while_continue: /* CIL Label */ ;
#line 476
    if (! (y < h)) {
#line 476
      goto while_break;
    }
#line 476
    x = 0;
    {
#line 476
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 476
      if (! (x < w)) {
#line 476
        goto while_break___0;
      }
#line 478
      *(*(aux + (y + N)) + (x + N)) = *(*(pixels + y) + x);
#line 476
      x ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 476
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 481
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 481
    tmp___1 = N;
#line 481
    N --;
#line 481
    if (! tmp___1) {
#line 481
      goto while_break___1;
    }
    {
#line 483
    sweep(buf, aux, r_w, r_h);
#line 484
    assign_bitmap(aux, buf, r_w, r_h);
    }
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 487
  free_bitmap_with_margins(aux);
  }
#line 488
  return (buf);
}
}
#line 491 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
mdjvu_pattern_t mdjvu_pattern_create_from_array(mdjvu_matcher_options_t m_opt , unsigned char **pixels ,
                                                int32 w , int32 h ) 
{ 
  Options *opt ;
  int32 i ;
  int32 mass ;
  Image *img ;
  void *tmp ;
  int32 j ;

  {
  {
#line 493
  opt = (Options *)m_opt;
#line 495
  tmp = malloc(sizeof(Image ));
#line 495
  img = (Image *)tmp;
#line 497
  mdjvu_init();
#line 499
  img->width = w;
#line 500
  img->height = h;
#line 502
  img->pixels = allocate_bitmap(w, h);
#line 503
  memset((void *)*(img->pixels + 0), 0, (size_t )(w * h));
#line 505
  mass = 0;
#line 506
  i = 0;
  }
  {
#line 506
  while (1) {
    while_continue: /* CIL Label */ ;
#line 506
    if (! (i < h)) {
#line 506
      goto while_break;
    }
#line 509
    j = 0;
    {
#line 509
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 509
      if (! (j < w)) {
#line 509
        goto while_break___0;
      }
#line 510
      if (*(*(pixels + i) + j)) {
#line 512
        *(*(img->pixels + i) + j) = (byte )255;
#line 513
        mass ++;
      }
#line 509
      j ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 506
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 516
  img->mass = mass;
#line 518
  mdjvu_soften_pattern(img->pixels, img->pixels, w, h);
#line 520
  get_mass_center(img->pixels, w, h, & img->mass_center_x, & img->mass_center_y);
#line 522
  mdjvu_get_gray_signature(img->pixels, w, h, img->signature, 32);
#line 525
  mdjvu_get_black_and_white_signature(img->pixels, w, h, img->signature2, 32);
  }
#line 528
  if (! opt->aggression) {
    {
#line 530
    free_bitmap(img->pixels);
#line 531
    img->pixels = (byte **)((void *)0);
    }
  }
#line 534
  if (opt->method & 1) {
    {
#line 536
    img->pith2_inner = quick_thin(pixels, w, h, 1);
#line 537
    img->pith2_outer = quick_thicken(pixels, w, h, 1);
    }
#line 538
    if (! img->pith2_inner) {
      {
#line 538
      __assert_fail("img->pith2_inner", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c",
                    538U, "mdjvu_pattern_create_from_array");
      }
    }
#line 539
    if (! img->pith2_outer) {
      {
#line 539
      __assert_fail("img->pith2_outer", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c",
                    539U, "mdjvu_pattern_create_from_array");
      }
    }
  } else {
#line 543
    img->pith2_inner = (byte **)((void *)0);
#line 544
    img->pith2_outer = (byte **)((void *)0);
  }
#line 547
  return ((mdjvu_pattern_t )img);
}
}
#line 552 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pith2_row_subset(byte *A , byte *B , int32 length ) 
{ 
  int32 i ;
  int32 s ;

  {
#line 554
  s = 0;
#line 555
  i = 0;
  {
#line 555
  while (1) {
    while_continue: /* CIL Label */ ;
#line 555
    if (! (i < length)) {
#line 555
      goto while_break;
    }
#line 557
    if ((int )*(A + i) & ! *(B + i)) {
#line 558
      s += 255;
    }
#line 555
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 560
  return (s);
}
}
#line 563 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pith2_row_has_black(byte *row , int32 length ) 
{ 
  int32 i ;
  int32 s ;

  {
#line 565
  s = 0;
#line 566
  i = 0;
  {
#line 566
  while (1) {
    while_continue: /* CIL Label */ ;
#line 566
    if (! (i < length)) {
#line 566
      goto while_break;
    }
#line 568
    if (*(row + i)) {
#line 569
      s += 255;
    }
#line 566
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 571
  return (s);
}
}
#line 574 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pith2_return_0(byte *A , int32 length ) 
{ 


  {
#line 576
  return (0);
}
}
#line 579 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int pith2_is_subset(mdjvu_pattern_t ptr1 , mdjvu_pattern_t ptr2 , double threshold ,
                           int32 dpi___0 ) 
{ 
  Image *i1 ;
  Image *i2 ;
  Image ptr1_inner ;
  Image ptr2_outer ;
  int32 perimeter ;
  int32 ceiling ;
  int32 d ;

  {
#line 581
  i1 = (Image *)ptr1;
#line 582
  i2 = (Image *)ptr2;
#line 585
  perimeter = ((i1->width + i1->height) + i2->width) + i2->height;
#line 586
  ceiling = (int32 )(((pithdiff2_veto_threshold * (double const   )dpi___0) * (double const   )perimeter) / (double const   )100);
#line 587
  d = 0;
#line 589
  ptr1_inner.pixels = i1->pith2_inner;
#line 590
  if (! i1->pith2_inner) {
    {
#line 590
    __assert_fail("i1->pith2_inner", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c",
                  590U, "pith2_is_subset");
    }
  }
#line 591
  ptr1_inner.width = i1->width;
#line 592
  ptr1_inner.height = i1->height;
#line 593
  ptr1_inner.mass_center_x = i1->mass_center_x;
#line 594
  ptr1_inner.mass_center_y = i1->mass_center_y;
#line 596
  ptr2_outer.pixels = i2->pith2_outer;
#line 597
  if (! i2->pith2_outer) {
    {
#line 597
    __assert_fail("i2->pith2_outer", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c",
                  597U, "pith2_is_subset");
    }
  }
  {
#line 598
  ptr2_outer.width = i2->width + 2;
#line 599
  ptr2_outer.height = i2->height + 2;
#line 600
  ptr2_outer.mass_center_x = i2->mass_center_x + 8;
#line 601
  ptr2_outer.mass_center_y = i2->mass_center_y + 8;
#line 603
  d = distance_by_pixeldiff_functions(& ptr1_inner, & ptr2_outer, & pith2_row_subset,
                                      & pith2_row_has_black, & pith2_return_0, ceiling);
  }
#line 609
  if (d == 2147483647) {
#line 609
    return (-1);
  } else
#line 610
  if ((double )d < ((threshold * (double )dpi___0) * (double )perimeter) / (double )100) {
#line 610
    return (1);
  }
#line 611
  return (0);
}
}
#line 615 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int compare_patterns(mdjvu_pattern_t ptr1 , mdjvu_pattern_t ptr2 , int32 dpi___0 ,
                            Options *opt ) 
{ 
  Image *i1 ;
  Image *i2 ;
  int i ;
  int state ;
  int tmp ;

  {
  {
#line 619
  i1 = (Image *)ptr1;
#line 619
  i2 = (Image *)ptr2;
#line 620
  state = 0;
#line 622
  tmp = simple_tests(i1, i2);
  }
#line 622
  if (tmp) {
#line 622
    return (-1);
  }
  {
#line 625
  i = shiftdiff_equivalence(i1->signature, i2->signature, (double )shiftdiff1_falloff,
                            (double )shiftdiff1_veto_threshold, opt->shiftdiff1_threshold);
  }
#line 627
  if (i == -1) {
#line 627
    return (-1);
  }
  {
#line 628
  state |= i;
#line 632
  i = shiftdiff_equivalence(i1->signature2, i2->signature2, (double )shiftdiff2_falloff,
                            (double )shiftdiff2_veto_threshold, opt->shiftdiff2_threshold);
  }
#line 634
  if (i == -1) {
#line 634
    return (-1);
  }
  {
#line 635
  state |= i;
#line 639
  i = shiftdiff_equivalence(i1->signature, i2->signature, (double )shiftdiff3_falloff,
                            (double )shiftdiff3_veto_threshold, opt->shiftdiff3_threshold);
  }
#line 641
  if (i == -1) {
#line 641
    return (-1);
  }
  {
#line 642
  state |= i;
#line 645
  i = pith2_is_subset(ptr1, ptr2, opt->pithdiff2_threshold, dpi___0);
  }
#line 646
  if (i < 1) {
#line 646
    return (i);
  }
  {
#line 647
  i = pith2_is_subset(ptr2, ptr1, opt->pithdiff2_threshold, dpi___0);
  }
#line 648
  if (i < 1) {
#line 648
    return (i);
  }
#line 650
  if (opt->method & 2) {
#line 651
    return (1);
  }
#line 654
  if (opt->aggression > 0) {
    {
#line 656
    i = pithdiff_equivalence(i1, i2, opt->pithdiff1_threshold, dpi___0);
    }
#line 657
    if (i == -1) {
#line 657
      return (0);
    }
#line 658
    state |= i;
  }
#line 671
  return (state);
}
}
#line 674 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
int mdjvu_match_patterns(mdjvu_pattern_t ptr1 , mdjvu_pattern_t ptr2 , int32 dpi___0 ,
                         mdjvu_matcher_options_t options ) 
{ 
  Options *opt ;
  int result ;
  mdjvu_matcher_options_t tmp ;

  {
#line 679
  if (options) {
#line 680
    opt = (Options *)options;
  } else {
    {
#line 682
    tmp = mdjvu_matcher_options_create();
#line 682
    opt = (Options *)tmp;
    }
  }
  {
#line 684
  result = compare_patterns(ptr1, ptr2, dpi___0, opt);
  }
#line 686
  if (! options) {
    {
#line 687
    mdjvu_matcher_options_destroy((mdjvu_matcher_options_t )opt);
    }
  }
#line 689
  return (result);
}
}
#line 693 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
void mdjvu_pattern_destroy(mdjvu_pattern_t p ) 
{ 
  Image *img ;

  {
#line 695
  img = (Image *)p;
#line 696
  if (img->pixels) {
    {
#line 697
    free_bitmap(img->pixels);
    }
  }
#line 699
  if (img->pith2_inner) {
    {
#line 700
    free_bitmap_with_margins(img->pith2_inner);
    }
  }
#line 702
  if (img->pith2_outer) {
    {
#line 703
    free_bitmap_with_margins(img->pith2_outer);
    }
  }
  {
#line 705
  free((void *)img);
  }
#line 706
  return;
}
}
#line 55 "../include/minidjvu/base/4bitmap.h"
void mdjvu_bitmap_unpack_row_0_or_1(mdjvu_bitmap_t b , unsigned char *bytes , int32 y ) ;
#line 6 "../include/minidjvu/alg/erosion.h"
mdjvu_bitmap_t mdjvu_get_erosion_mask(mdjvu_bitmap_t bmp ) ;
#line 30 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/erosion.c"
static void get_erosion_candidates_in_a_row(unsigned char *r , unsigned char *u ,
                                            unsigned char *t , unsigned char *l ,
                                            int32 n ) 
{ 
  int32 i ;
  int score_4 ;
  int score_d ;

  {
#line 38
  n --;
#line 39
  *(r + 0) = (unsigned char)0;
#line 40
  *(r + n) = (unsigned char)0;
#line 41
  i = 1;
  {
#line 41
  while (1) {
    while_continue: /* CIL Label */ ;
#line 41
    if (! (i < n)) {
#line 41
      goto while_break;
    }
#line 43
    score_4 = ((((int )*(u + i) + (int )*(l + i)) + (int )*(t + (i - 1))) + (int )*(t + (i + 1))) - 2;
#line 44
    score_d = ((((int )*(u + (i - 1)) + (int )*(l + (i - 1))) + (int )*(u + (i + 1))) + (int )*(l + (i + 1))) - 2;
#line 46
    if (! score_4) {
#line 46
      if (! score_d) {
#line 46
        *(r + i) = (unsigned char)1;
      } else {
#line 46
        *(r + i) = (unsigned char)0;
      }
    } else {
#line 46
      *(r + i) = (unsigned char)0;
    }
#line 41
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 48
  return;
}
}
#line 50 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/erosion.c"
mdjvu_bitmap_t mdjvu_get_erosion_mask(mdjvu_bitmap_t bmp ) 
{ 
  int32 w ;
  int32 tmp ;
  int32 h ;
  int32 tmp___0 ;
  mdjvu_bitmap_t result ;
  mdjvu_bitmap_t tmp___1 ;
  int32 i ;
  unsigned char *u ;
  unsigned char *t ;
  unsigned char *l ;
  unsigned char *r ;
  void *tmp___2 ;
  void *tmp___3 ;
  void *tmp___4 ;
  void *tmp___5 ;
  unsigned char *tmp___6 ;

  {
  {
#line 52
  tmp = mdjvu_bitmap_get_width(bmp);
#line 52
  w = tmp;
#line 53
  tmp___0 = mdjvu_bitmap_get_height(bmp);
#line 53
  h = tmp___0;
#line 54
  tmp___1 = mdjvu_bitmap_create(w, h);
#line 54
  result = tmp___1;
  }
#line 58
  if (h < 3) {
#line 58
    return (result);
  }
  {
#line 60
  tmp___2 = malloc((size_t )w);
#line 60
  u = (unsigned char *)tmp___2;
#line 61
  tmp___3 = malloc((size_t )w);
#line 61
  t = (unsigned char *)tmp___3;
#line 62
  tmp___4 = malloc((size_t )w);
#line 62
  l = (unsigned char *)tmp___4;
#line 63
  tmp___5 = malloc((size_t )w);
#line 63
  r = (unsigned char *)tmp___5;
#line 65
  mdjvu_bitmap_unpack_row_0_or_1(bmp, t, 0);
#line 66
  mdjvu_bitmap_unpack_row_0_or_1(bmp, l, 1);
#line 67
  i = 1;
  }
  {
#line 67
  while (1) {
    while_continue: /* CIL Label */ ;
#line 67
    if (! (i < h - 1)) {
#line 67
      goto while_break;
    }
    {
#line 69
    tmp___6 = u;
#line 70
    u = t;
#line 71
    t = l;
#line 72
    l = tmp___6;
#line 74
    mdjvu_bitmap_unpack_row_0_or_1(bmp, l, i + 1);
#line 76
    get_erosion_candidates_in_a_row(r, u, t, l, w);
#line 77
    mdjvu_bitmap_pack_row(result, r, i);
#line 67
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 80
  free((void *)u);
#line 81
  free((void *)t);
#line 82
  free((void *)l);
#line 83
  free((void *)r);
  }
#line 85
  return (result);
}
}
#line 67 "../include/minidjvu/base/4bitmap.h"
void mdjvu_bitmap_pack_all(mdjvu_bitmap_t b , unsigned char **data ) ;
#line 20 "../include/minidjvu/base/5image.h"
int32 mdjvu_image_get_height(mdjvu_image_t image ) ;
#line 5 "../include/minidjvu/alg/render.h"
mdjvu_bitmap_t mdjvu_render(mdjvu_image_t img ) ;
#line 10 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/render.c"
mdjvu_bitmap_t mdjvu_render(mdjvu_image_t img ) 
{ 
  int32 width ;
  int32 tmp ;
  int32 height ;
  int32 tmp___0 ;
  unsigned char **b ;
  unsigned char **tmp___1 ;
  unsigned char *row_buffer ;
  void *tmp___2 ;
  int32 blit_count ;
  int32 tmp___3 ;
  int32 i ;
  mdjvu_bitmap_t result ;
  mdjvu_bitmap_t tmp___4 ;
  int32 x ;
  int32 tmp___5 ;
  int32 y ;
  int32 tmp___6 ;
  mdjvu_bitmap_t current_bitmap ;
  mdjvu_bitmap_t tmp___7 ;
  int32 w ;
  int32 tmp___8 ;
  int32 h ;
  int32 tmp___9 ;
  int32 min_col ;
  int tmp___10 ;
  int32 max_col_plus_one ;
  int32 tmp___11 ;
  int32 min_row ;
  int tmp___12 ;
  int32 max_row_plus_one ;
  int32 tmp___13 ;
  int32 row ;
  int32 col ;
  unsigned char *target ;

  {
  {
#line 12
  tmp = mdjvu_image_get_width(img);
#line 12
  width = tmp;
#line 13
  tmp___0 = mdjvu_image_get_height(img);
#line 13
  height = tmp___0;
#line 14
  tmp___1 = mdjvu_create_2d_array(width, height);
#line 14
  b = tmp___1;
#line 15
  tmp___2 = malloc((size_t )width);
#line 15
  row_buffer = (unsigned char *)tmp___2;
#line 16
  tmp___3 = mdjvu_image_get_blit_count(img);
#line 16
  blit_count = tmp___3;
#line 18
  tmp___4 = mdjvu_bitmap_create(width, height);
#line 18
  result = tmp___4;
#line 21
  i = 0;
  }
  {
#line 21
  while (1) {
    while_continue: /* CIL Label */ ;
#line 21
    if (! (i < height)) {
#line 21
      goto while_break;
    }
    {
#line 22
    memset((void *)*(b + i), 0, (size_t )width);
#line 21
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 25
  i = 0;
  {
#line 25
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 25
    if (! (i < blit_count)) {
#line 25
      goto while_break___0;
    }
    {
#line 27
    tmp___5 = mdjvu_image_get_blit_x(img, i);
#line 27
    x = tmp___5;
#line 28
    tmp___6 = mdjvu_image_get_blit_y(img, i);
#line 28
    y = tmp___6;
#line 29
    tmp___7 = mdjvu_image_get_blit_bitmap(img, i);
#line 29
    current_bitmap = tmp___7;
#line 30
    tmp___8 = mdjvu_bitmap_get_width(current_bitmap);
#line 30
    w = tmp___8;
#line 31
    tmp___9 = mdjvu_bitmap_get_height(current_bitmap);
#line 31
    h = tmp___9;
    }
#line 37
    if (x >= 0) {
#line 37
      tmp___10 = 0;
    } else {
#line 37
      tmp___10 = - x;
    }
#line 37
    min_col = tmp___10;
#line 38
    if (x + w <= width) {
#line 38
      tmp___11 = w;
    } else {
#line 38
      tmp___11 = width - x;
    }
#line 38
    max_col_plus_one = tmp___11;
#line 40
    if (y >= 0) {
#line 40
      tmp___12 = 0;
    } else {
#line 40
      tmp___12 = - y;
    }
#line 40
    min_row = tmp___12;
#line 41
    if (y + h <= height) {
#line 41
      tmp___13 = h;
    } else {
#line 41
      tmp___13 = height - y;
    }
#line 41
    max_row_plus_one = tmp___13;
#line 46
    row = min_row;
    {
#line 46
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 46
      if (! (row < max_row_plus_one)) {
#line 46
        goto while_break___1;
      }
      {
#line 49
      target = *(b + (y + row)) + x;
#line 50
      mdjvu_bitmap_unpack_row(current_bitmap, row_buffer, row);
#line 51
      col = min_col;
      }
      {
#line 51
      while (1) {
        while_continue___2: /* CIL Label */ ;
#line 51
        if (! (col < max_col_plus_one)) {
#line 51
          goto while_break___2;
        }
#line 52
        *(target + col) = (unsigned char )((int )*(target + col) | (int )*(row_buffer + col));
#line 51
        col ++;
      }
      while_break___2: /* CIL Label */ ;
      }
#line 46
      row ++;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 25
    i ++;
  }
  while_break___0: /* CIL Label */ ;
  }
  {
#line 56
  free((void *)row_buffer);
#line 59
  mdjvu_bitmap_pack_all(result, b);
#line 60
  mdjvu_destroy_2d_array(b);
  }
#line 61
  return (result);
}
}
#line 32 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/0porting.c"
static int initialized___0  =    0;
#line 9 "../include/minidjvu/base/4bitmap.h"
int32 alive_bitmap_counter ;
#line 29
void mdjvu_bitmap_set_index(mdjvu_bitmap_t b , int32 v ) ;
#line 69
void mdjvu_bitmap_unpack_all_0_or_1(mdjvu_bitmap_t b , unsigned char **data ) ;
#line 73
void mdjvu_bitmap_assign(mdjvu_bitmap_t dst , mdjvu_bitmap_t b ) ;
#line 74
void mdjvu_bitmap_exchange(mdjvu_bitmap_t d , mdjvu_bitmap_t src ) ;
#line 75
void mdjvu_bitmap_clear(mdjvu_bitmap_t b ) ;
#line 78
mdjvu_bitmap_t mdjvu_bitmap_clone(mdjvu_bitmap_t b ) ;
#line 80
void mdjvu_bitmap_get_bounding_box(mdjvu_bitmap_t b , int32 *pl , int32 *pt , int32 *pw ,
                                   int32 *ph ) ;
#line 88
void mdjvu_bitmap_remove_margins(mdjvu_bitmap_t b , int32 *px , int32 *py ) ;
#line 94
int32 mdjvu_bitmap_get_mass(mdjvu_bitmap_t b ) ;
#line 20 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
int32 alive_bitmap_counter  =    0;
#line 27 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
mdjvu_bitmap_t mdjvu_bitmap_create(int32 width , int32 height ) 
{ 
  Bitmap *b ;
  void *tmp ;

  {
  {
#line 29
  tmp = malloc(sizeof(Bitmap ));
#line 29
  b = (Bitmap *)tmp;
#line 30
  mdjvu_init();
#line 32
  alive_bitmap_counter ++;
#line 34
  b->width = width;
#line 35
  b->height = height;
#line 36
  b->index = -1;
#line 37
  b->data = mdjvu_create_2d_array((width + 7) >> 3, height);
  }
#line 38
  return ((mdjvu_bitmap_t )b);
}
}
#line 41 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_destroy(mdjvu_bitmap_t bmp ) 
{ 
  Bitmap *b ;

  {
  {
#line 43
  b = (Bitmap *)bmp;
#line 45
  alive_bitmap_counter --;
#line 47
  mdjvu_destroy_2d_array(b->data);
#line 48
  free((void *)b);
  }
#line 49
  return;
}
}
#line 56 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
mdjvu_bitmap_t mdjvu_bitmap_clone(mdjvu_bitmap_t b ) 
{ 
  mdjvu_bitmap_t result ;
  mdjvu_bitmap_t tmp ;

  {
  {
#line 58
  tmp = mdjvu_bitmap_create(((Bitmap *)b)->width, ((Bitmap *)b)->height);
#line 58
  result = tmp;
#line 61
  memcpy((void */* __restrict  */)*(((Bitmap *)result)->data + 0), (void const   */* __restrict  */)*(((Bitmap *)b)->data + 0),
         (size_t )(((((Bitmap *)b)->width + 7) >> 3) * ((Bitmap *)b)->height));
  }
#line 62
  return (result);
}
}
#line 65 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_assign(mdjvu_bitmap_t dst , mdjvu_bitmap_t b ) 
{ 


  {
  {
#line 67
  mdjvu_destroy_2d_array(((Bitmap *)dst)->data);
#line 68
  ((Bitmap *)dst)->data = mdjvu_create_2d_array((((Bitmap *)b)->width + 7) >> 3, ((Bitmap *)b)->height);
#line 70
  ((Bitmap *)dst)->width = ((Bitmap *)b)->width;
#line 71
  ((Bitmap *)dst)->height = ((Bitmap *)b)->height;
#line 72
  memcpy((void */* __restrict  */)*(((Bitmap *)dst)->data + 0), (void const   */* __restrict  */)*(((Bitmap *)b)->data + 0),
         (size_t )(((((Bitmap *)b)->width + 7) >> 3) * ((Bitmap *)b)->height));
  }
#line 73
  return;
}
}
#line 75 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_exchange(mdjvu_bitmap_t d , mdjvu_bitmap_t src ) 
{ 
  int32 d_index_backup ;
  int32 s_index_backup ;
  Bitmap tmp ;

  {
#line 77
  d_index_backup = ((Bitmap *)d)->index;
#line 78
  s_index_backup = ((Bitmap *)src)->index;
#line 79
  tmp = *((Bitmap *)d);
#line 80
  *((Bitmap *)d) = *((Bitmap *)src);
#line 81
  *((Bitmap *)src) = tmp;
#line 82
  ((Bitmap *)d)->index = d_index_backup;
#line 83
  ((Bitmap *)src)->index = s_index_backup;
#line 84
  return;
}
}
#line 90 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
int32 mdjvu_bitmap_get_width(mdjvu_bitmap_t b ) 
{ 


  {
#line 92
  return (((Bitmap *)b)->width);
}
}
#line 95 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
int32 mdjvu_bitmap_get_height(mdjvu_bitmap_t b ) 
{ 


  {
#line 97
  return (((Bitmap *)b)->height);
}
}
#line 100 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
int32 mdjvu_bitmap_get_index(mdjvu_bitmap_t b ) 
{ 


  {
#line 102
  if (b) {
#line 103
    return (((Bitmap *)b)->index);
  } else {
#line 105
    return (-1);
  }
}
}
#line 108 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_set_index(mdjvu_bitmap_t b , int32 v ) 
{ 


  {
#line 110
  ((Bitmap *)b)->index = v;
#line 111
  return;
}
}
#line 113 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
int32 mdjvu_bitmap_get_packed_row_size(mdjvu_bitmap_t b ) 
{ 


  {
#line 115
  return ((((Bitmap *)b)->width + 7) >> 3);
}
}
#line 118 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
unsigned char *mdjvu_bitmap_access_packed_row(mdjvu_bitmap_t b , int32 i ) 
{ 


  {
#line 121
  return (*(((Bitmap *)b)->data + i));
}
}
#line 124 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_clear(mdjvu_bitmap_t b ) 
{ 


  {
  {
#line 126
  memset((void *)*(((Bitmap *)b)->data + 0), 0, (size_t )(((Bitmap *)b)->height * ((((Bitmap *)b)->width + 7) >> 3)));
  }
#line 127
  return;
}
}
#line 133 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_pack_row(mdjvu_bitmap_t b , unsigned char *bytes , int32 y ) 
{ 
  unsigned char *bits ;
  int coef ;
  int a ;
  int32 i ;
  unsigned char *tmp ;
  unsigned char *tmp___0 ;
  int32 tmp___1 ;

  {
#line 136
  bits = *(((Bitmap *)b)->data + y);
#line 137
  coef = 128;
#line 138
  a = 0;
#line 139
  i = ((Bitmap *)b)->width;
  {
#line 140
  while (1) {
    while_continue: /* CIL Label */ ;
#line 140
    tmp___1 = i;
#line 140
    i --;
#line 140
    if (! tmp___1) {
#line 140
      goto while_break;
    }
#line 142
    tmp = bytes;
#line 142
    bytes ++;
#line 142
    if (*tmp) {
#line 142
      a |= coef;
    }
#line 144
    coef >>= 1;
#line 145
    if (! coef) {
#line 147
      coef = 128;
#line 148
      tmp___0 = bits;
#line 148
      bits ++;
#line 148
      *tmp___0 = (unsigned char )a;
#line 149
      a = 0;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 153
  if (((Bitmap *)b)->width & 7) {
#line 153
    *bits = (unsigned char )a;
  }
#line 154
  return;
}
}
#line 156 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_unpack_row(mdjvu_bitmap_t b , unsigned char *bytes , int32 y ) 
{ 
  unsigned char *bits ;
  int coef ;
  int a ;
  int32 i ;
  unsigned char *tmp ;
  int32 tmp___0 ;

  {
#line 159
  bits = *(((Bitmap *)b)->data + y);
#line 160
  coef = 128;
#line 161
  a = (int )*bits;
#line 162
  i = ((Bitmap *)b)->width;
  {
#line 163
  while (1) {
    while_continue: /* CIL Label */ ;
#line 163
    tmp___0 = i;
#line 163
    i --;
#line 163
    if (! tmp___0) {
#line 163
      goto while_break;
    }
#line 165
    tmp = bytes;
#line 165
    bytes ++;
#line 165
    *tmp = (unsigned char )(a & coef);
#line 167
    coef >>= 1;
#line 168
    if (! coef) {
#line 170
      coef = 128;
#line 171
      if (! i) {
#line 171
        goto while_break;
      }
#line 172
      bits ++;
#line 172
      a = (int )*bits;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 175
  return;
}
}
#line 178 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_unpack_row_0_or_1(mdjvu_bitmap_t b , unsigned char *bytes , int32 y ) 
{ 
  unsigned char *bits ;
  int coef ;
  int a ;
  int32 i ;
  unsigned char *tmp ;
  int32 tmp___0 ;

  {
#line 181
  bits = *(((Bitmap *)b)->data + y);
#line 182
  coef = 128;
#line 183
  a = (int )*bits;
#line 184
  i = ((Bitmap *)b)->width;
  {
#line 185
  while (1) {
    while_continue: /* CIL Label */ ;
#line 185
    tmp___0 = i;
#line 185
    i --;
#line 185
    if (! tmp___0) {
#line 185
      goto while_break;
    }
#line 187
    tmp = bytes;
#line 187
    bytes ++;
#line 187
    if (a & coef) {
#line 187
      *tmp = (unsigned char)1;
    } else {
#line 187
      *tmp = (unsigned char)0;
    }
#line 189
    coef >>= 1;
#line 190
    if (! coef) {
#line 192
      coef = 128;
#line 193
      if (! i) {
#line 193
        goto while_break;
      }
#line 194
      bits ++;
#line 194
      a = (int )*bits;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 197
  return;
}
}
#line 199 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_pack_all(mdjvu_bitmap_t b , unsigned char **data ) 
{ 
  int32 i ;
  int32 h ;

  {
#line 202
  i = 0;
#line 202
  h = ((Bitmap *)b)->height;
#line 203
  i = 0;
  {
#line 203
  while (1) {
    while_continue: /* CIL Label */ ;
#line 203
    if (! (i < h)) {
#line 203
      goto while_break;
    }
    {
#line 205
    mdjvu_bitmap_pack_row(b, *(data + i), i);
#line 203
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 207
  return;
}
}
#line 209 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_unpack_all(mdjvu_bitmap_t b , unsigned char **data ) 
{ 
  int32 i ;
  int32 h ;

  {
#line 212
  i = 0;
#line 212
  h = ((Bitmap *)b)->height;
#line 213
  i = 0;
  {
#line 213
  while (1) {
    while_continue: /* CIL Label */ ;
#line 213
    if (! (i < h)) {
#line 213
      goto while_break;
    }
    {
#line 215
    mdjvu_bitmap_unpack_row(b, *(data + i), i);
#line 213
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 217
  return;
}
}
#line 219 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_unpack_all_0_or_1(mdjvu_bitmap_t b , unsigned char **data ) 
{ 
  int32 i ;
  int32 h ;

  {
#line 222
  i = 0;
#line 222
  h = ((Bitmap *)b)->height;
#line 223
  i = 0;
  {
#line 223
  while (1) {
    while_continue: /* CIL Label */ ;
#line 223
    if (! (i < h)) {
#line 223
      goto while_break;
    }
    {
#line 225
    mdjvu_bitmap_unpack_row_0_or_1(b, *(data + i), i);
#line 223
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 227
  return;
}
}
#line 231 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
mdjvu_bitmap_t mdjvu_bitmap_crop(mdjvu_bitmap_t b , int32 left , int32 top , int32 w ,
                                 int32 h ) 
{ 
  mdjvu_bitmap_t tmp ;
  mdjvu_bitmap_t result ;
  int32 i ;
  int32 count ;
  unsigned char *buf ;
  void *tmp___0 ;
  int32 tmp___1 ;

  {
#line 234
  if (left == 0) {
#line 234
    if (top == 0) {
#line 234
      if (w == ((Bitmap *)b)->width) {
#line 234
        if (h == ((Bitmap *)b)->height) {
          {
#line 236
          tmp = mdjvu_bitmap_clone(b);
          }
#line 236
          return (tmp);
        } else {
#line 234
          goto _L___1;
        }
      } else {
#line 234
        goto _L___1;
      }
    } else {
#line 234
      goto _L___1;
    }
  } else {
    _L___1: /* CIL Label */ 
#line 241
    i = top;
#line 241
    count = h;
#line 244
    if (! (left >= 0)) {
      {
#line 244
      __assert_fail("left >= 0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c",
                    244U, "mdjvu_bitmap_crop");
      }
    }
#line 245
    if (! (left + w <= ((Bitmap *)b)->width)) {
      {
#line 245
      __assert_fail("left + w <= ((Bitmap *) b)->width", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c",
                    245U, "mdjvu_bitmap_crop");
      }
    }
#line 246
    if (! (top >= 0)) {
      {
#line 246
      __assert_fail("top >= 0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c",
                    246U, "mdjvu_bitmap_crop");
      }
    }
#line 247
    if (! (top + h <= ((Bitmap *)b)->height)) {
      {
#line 247
      __assert_fail("top + h <= ((Bitmap *) b)->height", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c",
                    247U, "mdjvu_bitmap_crop");
      }
    }
    {
#line 249
    result = mdjvu_bitmap_create(w, h);
#line 250
    tmp___0 = malloc((size_t )((Bitmap *)b)->width);
#line 250
    buf = (unsigned char *)tmp___0;
    }
    {
#line 251
    while (1) {
      while_continue: /* CIL Label */ ;
#line 251
      tmp___1 = count;
#line 251
      count --;
#line 251
      if (! tmp___1) {
#line 251
        goto while_break;
      }
      {
#line 253
      mdjvu_bitmap_unpack_row(b, buf, i);
#line 254
      mdjvu_bitmap_pack_row(result, buf + left, i - top);
#line 255
      i ++;
      }
    }
    while_break: /* CIL Label */ ;
    }
    {
#line 257
    free((void *)buf);
    }
#line 258
    return (result);
  }
}
}
#line 264 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
static int row_is_empty(Bitmap *bmp , int32 y ) 
{ 
  unsigned char *row ;
  int32 bytes_to_check ;
  int32 bits_to_check ;
  int32 mask ;
  int32 i ;

  {
#line 266
  row = *(bmp->data + y);
#line 267
  bytes_to_check = ((bmp->width + 7) >> 3) - 1;
#line 268
  bits_to_check = bmp->width - (bytes_to_check << 3);
#line 269
  mask = 255 << (8 - bits_to_check);
#line 272
  i = 0;
  {
#line 272
  while (1) {
    while_continue: /* CIL Label */ ;
#line 272
    if (! (i < bytes_to_check)) {
#line 272
      goto while_break;
    }
#line 273
    if (*(row + i)) {
#line 273
      return (0);
    }
#line 272
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 275
  if ((int )*(row + bytes_to_check) & mask) {
#line 275
    return (0);
  }
#line 276
  return (1);
}
}
#line 279 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
static int column_is_empty(Bitmap *bmp , int32 x ) 
{ 
  int32 byte_offset ;
  int mask ;
  int32 bytes_per_row ;
  unsigned char *p ;
  int32 i ;
  int32 tmp ;

  {
#line 281
  byte_offset = x >> 3;
#line 282
  mask = 1 << (7 - (x & 7));
#line 283
  bytes_per_row = (bmp->width + 7) >> 3;
#line 284
  p = *(bmp->data + 0) + byte_offset;
#line 285
  i = bmp->height;
  {
#line 287
  while (1) {
    while_continue: /* CIL Label */ ;
#line 287
    tmp = i;
#line 287
    i --;
#line 287
    if (! tmp) {
#line 287
      goto while_break;
    }
#line 289
    if ((int )*p & mask) {
#line 289
      return (0);
    }
#line 290
    p += bytes_per_row;
  }
  while_break: /* CIL Label */ ;
  }
#line 293
  return (1);
}
}
#line 296 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_get_bounding_box(mdjvu_bitmap_t b , int32 *pl , int32 *pt , int32 *pw ,
                                   int32 *ph ) 
{ 
  int32 right ;
  int32 left ;
  int32 bottom ;
  int32 top ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;

  {
#line 299
  right = ((Bitmap *)b)->width - 1;
#line 300
  left = 0;
#line 301
  bottom = ((Bitmap *)b)->height - 1;
#line 302
  top = 0;
  {
#line 304
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 304
    tmp = column_is_empty((Bitmap *)b, right);
    }
#line 304
    if (tmp) {
#line 304
      if (! right) {
#line 304
        goto while_break;
      }
    } else {
#line 304
      goto while_break;
    }
#line 304
    right --;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 305
  while (1) {
    while_continue___0: /* CIL Label */ ;
    {
#line 305
    tmp___0 = column_is_empty((Bitmap *)b, left);
    }
#line 305
    if (tmp___0) {
#line 305
      if (! (left < right)) {
#line 305
        goto while_break___0;
      }
    } else {
#line 305
      goto while_break___0;
    }
#line 305
    left ++;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 307
  *pl = left;
#line 308
  *pw = (right - left) + 1;
  {
#line 310
  while (1) {
    while_continue___1: /* CIL Label */ ;
    {
#line 310
    tmp___1 = row_is_empty((Bitmap *)b, bottom);
    }
#line 310
    if (tmp___1) {
#line 310
      if (! bottom) {
#line 310
        goto while_break___1;
      }
    } else {
#line 310
      goto while_break___1;
    }
#line 310
    bottom --;
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 311
  while (1) {
    while_continue___2: /* CIL Label */ ;
    {
#line 311
    tmp___2 = row_is_empty((Bitmap *)b, top);
    }
#line 311
    if (tmp___2) {
#line 311
      if (! (top < bottom)) {
#line 311
        goto while_break___2;
      }
    } else {
#line 311
      goto while_break___2;
    }
#line 311
    top ++;
  }
  while_break___2: /* CIL Label */ ;
  }
#line 313
  *pt = top;
#line 314
  *ph = (bottom - top) + 1;
#line 315
  return;
}
}
#line 317 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
void mdjvu_bitmap_remove_margins(mdjvu_bitmap_t b , int32 *px , int32 *py ) 
{ 
  int32 w ;
  int32 h ;
  mdjvu_bitmap_t cropped ;

  {
  {
#line 322
  mdjvu_bitmap_get_bounding_box(b, px, py, & w, & h);
  }
#line 323
  if (! *px) {
#line 323
    if (! *py) {
#line 323
      if (w == ((Bitmap *)b)->width) {
#line 323
        if (h == ((Bitmap *)b)->height) {
#line 324
          return;
        }
      }
    }
  }
  {
#line 325
  cropped = mdjvu_bitmap_crop(b, *px, *py, w, h);
#line 326
  mdjvu_bitmap_exchange(b, cropped);
#line 327
  mdjvu_bitmap_destroy(cropped);
  }
#line 328
  return;
}
}
#line 335 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
int32 mdjvu_bitmap_get_mass(mdjvu_bitmap_t b ) 
{ 
  int32 m ;
  int32 w ;
  int32 h ;
  unsigned char *buf ;
  void *tmp ;
  int32 y ;
  int x ;

  {
  {
#line 337
  m = 0;
#line 338
  w = ((Bitmap *)b)->width;
#line 339
  h = ((Bitmap *)b)->height;
#line 340
  tmp = malloc((size_t )w);
#line 340
  buf = (unsigned char *)tmp;
#line 342
  y = 0;
  }
  {
#line 342
  while (1) {
    while_continue: /* CIL Label */ ;
#line 342
    if (! (y < h)) {
#line 342
      goto while_break;
    }
    {
#line 345
    mdjvu_bitmap_unpack_row_0_or_1(b, buf, y);
#line 346
    x = 0;
    }
    {
#line 346
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 346
      if (! (x < w)) {
#line 346
        goto while_break___0;
      }
#line 347
      m += (int32 )*(buf + x);
#line 346
      x ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 342
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 349
  free((void *)buf);
  }
#line 350
  return (m);
}
}
#line 97 "../include/minidjvu/base/5image.h"
int32 mdjvu_image_get_resolution(mdjvu_image_t image ) ;
#line 163
void mdjvu_image_enable_centers(mdjvu_image_t image ) ;
#line 166
void mdjvu_image_set_center(mdjvu_image_t image , mdjvu_bitmap_t b , int32 x , int32 y ) ;
#line 16 "../include/minidjvu/alg/classify.h"
int32 mdjvu_classify_patterns(mdjvu_pattern_t *b , int32 *r , int32 n , int32 dpi___0 ,
                              mdjvu_matcher_options_t options ) ;
#line 25
int32 mdjvu_classify_bitmaps(mdjvu_image_t image , int32 *result , mdjvu_matcher_options_t options ,
                             int centers_needed ) ;
#line 43
int32 mdjvu_multipage_classify_patterns(int32 npages , int32 total_patterns_count ,
                                        int32 *npatterns , mdjvu_pattern_t **patterns ,
                                        int32 *result , int32 *dpi___0 , mdjvu_matcher_options_t options ,
                                        void (*report___0)(void * , int  ) , void *param ) ;
#line 48
int32 mdjvu_multipage_classify_bitmaps(int32 npages , int32 total_patterns_count ,
                                       mdjvu_image_t *pages , int32 *result , mdjvu_matcher_options_t options ,
                                       void (*report___0)(void * , int  ) , void *param ,
                                       int centers_needed ) ;
#line 61
void mdjvu_multipage_get_dictionary_flags(int32 n , int32 *npatterns , int32 max_tag ,
                                          int32 *tags , unsigned char *dictionary_flags ) ;
#line 58 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static Class *new_class(Classification *cl ) 
{ 
  Class *c ;
  void *tmp ;
  ClassNode *tmp___0 ;

  {
  {
#line 60
  tmp = malloc(sizeof(Class ));
#line 60
  c = (Class *)tmp;
#line 61
  tmp___0 = (ClassNode *)((void *)0);
#line 61
  c->last = tmp___0;
#line 61
  c->first = tmp___0;
#line 62
  c->prev_class = (struct Class *)((void *)0);
#line 63
  c->next_class = cl->first_class;
#line 64
  c->last_page = 0;
  }
#line 65
  if (cl->first_class) {
#line 65
    (cl->first_class)->prev_class = c;
  }
#line 66
  cl->first_class = c;
#line 67
  return (c);
}
}
#line 71 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static void delete_class(Classification *cl , Class *c ) 
{ 
  Class *prev ;
  Class *next ;

  {
#line 73
  prev = c->prev_class;
#line 73
  next = c->next_class;
#line 75
  if (prev) {
#line 76
    prev->next_class = next;
  } else {
#line 78
    cl->first_class = next;
  }
#line 80
  if (next) {
#line 81
    next->prev_class = prev;
  }
  {
#line 83
  while (1) {
    while_continue: /* CIL Label */ ;
#line 83
    if (c) {
      {
#line 83
      free((void *)c);
      }
    }
#line 83
    goto while_break;
  }
  while_break: /* CIL Label */ ;
  }
#line 84
  return;
}
}
#line 87 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static ClassNode *new_node(Classification *cl , Class *c , mdjvu_pattern_t ptr ) 
{ 
  ClassNode *n ;
  void *tmp ;

  {
  {
#line 89
  tmp = malloc(sizeof(ClassNode ));
#line 89
  n = (ClassNode *)tmp;
#line 90
  n->ptr = ptr;
#line 91
  n->next = c->first;
#line 92
  c->first = n;
  }
#line 93
  if (! c->last) {
#line 93
    c->last = n;
  }
#line 94
  n->global_next = (struct ClassNode *)((void *)0);
#line 96
  if (cl->last_node) {
#line 97
    (cl->last_node)->global_next = n;
  } else {
#line 99
    cl->first_node = n;
  }
#line 101
  cl->last_node = n;
#line 102
  return (n);
}
}
#line 106 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static Class *merge(Classification *cl , Class *c1 , Class *c2 ) 
{ 


  {
#line 108
  if (! c1->first) {
    {
#line 110
    delete_class(cl, c1);
    }
#line 111
    return (c2);
  }
#line 113
  if (c2->first) {
#line 115
    (c1->last)->next = c2->first;
#line 116
    c1->last = c2->last;
  }
  {
#line 118
  delete_class(cl, c2);
  }
#line 119
  return (c1);
}
}
#line 123 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static unsigned int put_tags(Classification *cl ) 
{ 
  int32 tag ;
  Class *c ;
  ClassNode *n ;

  {
#line 125
  tag = 1;
#line 126
  c = cl->first_class;
  {
#line 127
  while (1) {
    while_continue: /* CIL Label */ ;
#line 127
    if (! c) {
#line 127
      goto while_break;
    }
#line 129
    n = c->first;
    {
#line 130
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 130
      if (! n) {
#line 130
        goto while_break___0;
      }
#line 132
      n->tag = tag;
#line 133
      n = n->next;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 135
    c = c->next_class;
#line 136
    tag ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 138
  return ((unsigned int )(tag - 1));
}
}
#line 142 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static void delete_all_classes(Classification *cl ) 
{ 
  Class *c ;
  Class *t ;

  {
#line 144
  c = cl->first_class;
  {
#line 145
  while (1) {
    while_continue: /* CIL Label */ ;
#line 145
    if (! c) {
#line 145
      goto while_break;
    }
#line 147
    t = c;
#line 148
    c = c->next_class;
    {
#line 149
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 149
      if (t) {
        {
#line 149
        free((void *)t);
        }
      }
#line 149
      goto while_break___0;
    }
    while_break___0: /* CIL Label */ ;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 151
  return;
}
}
#line 154 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static int compare_to_class(mdjvu_pattern_t p , Class *c , int32 dpi___0 , mdjvu_matcher_options_t options ,
                            int flag ) 
{ 
  int r ;
  ClassNode *n ;

  {
#line 157
  r = 0;
#line 158
  n = c->first;
  {
#line 159
  while (1) {
    while_continue: /* CIL Label */ ;
#line 159
    if (! n) {
#line 159
      goto while_break;
    }
    {
#line 161
    r = mdjvu_match_patterns(p, n->ptr, dpi___0, options);
    }
#line 162
    if (r == flag) {
#line 162
      return (1);
    }
#line 163
    n = n->next;
  }
  while_break: /* CIL Label */ ;
  }
#line 165
  return (0);
}
}
#line 168 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static void classify(Classification *cl , mdjvu_pattern_t p , int32 dpi___0 , mdjvu_matcher_options_t options ,
                     int32 page ) 
{ 
  Class *class_of_this ;
  Class *c ;
  Class *next_c ;
  int tmp ;
  int tmp___0 ;

  {
#line 172
  class_of_this = (Class *)((void *)0);
#line 173
  next_c = (Class *)((void *)0);
#line 174
  c = cl->first_class;
  {
#line 174
  while (1) {
    while_continue: /* CIL Label */ ;
#line 174
    if (! c) {
#line 174
      goto while_break;
    }
#line 176
    next_c = c->next_class;
#line 178
    if ((unsigned long )class_of_this == (unsigned long )c) {
#line 178
      goto __Cont;
    }
#line 179
    if (c->last_page < page - 1) {
#line 179
      goto __Cont;
    }
    {
#line 180
    tmp = compare_to_class(p, c, dpi___0, options, -1);
    }
#line 180
    if (tmp) {
#line 181
      goto __Cont;
    } else {
      {
#line 180
      tmp___0 = compare_to_class(p, c, dpi___0, options, 1);
      }
#line 180
      if (! tmp___0) {
#line 181
        goto __Cont;
      }
    }
#line 183
    if (class_of_this) {
      {
#line 184
      class_of_this = merge(cl, class_of_this, c);
      }
    } else {
#line 186
      class_of_this = c;
    }
    __Cont: /* CIL Label */ 
#line 174
    c = next_c;
  }
  while_break: /* CIL Label */ ;
  }
#line 188
  if (! class_of_this) {
    {
#line 188
    class_of_this = new_class(cl);
    }
  }
#line 189
  if (page > class_of_this->last_page) {
#line 190
    class_of_this->last_page = page;
  }
  {
#line 191
  new_node(cl, class_of_this, p);
  }
#line 192
  return;
}
}
#line 194 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static int32 get_tags_from_classification(mdjvu_pattern_t *b , int32 *r , int32 n ,
                                          Classification *cl ) 
{ 
  int32 i ;
  int32 max_tag ;
  unsigned int tmp ;
  ClassNode *node ;
  ClassNode *t ;
  int32 tmp___0 ;
  int32 tmp___1 ;
  int32 tmp___2 ;

  {
  {
#line 197
  tmp = put_tags(cl);
#line 197
  max_tag = (int32 )tmp;
#line 200
  delete_all_classes(cl);
#line 202
  i = 0;
#line 203
  node = cl->first_node;
  }
  {
#line 204
  while (1) {
    while_continue: /* CIL Label */ ;
#line 204
    if (! node) {
#line 204
      goto while_break;
    }
    {
#line 207
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 207
      if (! (! *(b + i))) {
#line 207
        goto while_break___0;
      }
#line 209
      tmp___0 = i;
#line 209
      i ++;
#line 209
      *(r + tmp___0) = 0;
#line 210
      if (! (i < n)) {
        {
#line 210
        __assert_fail("i < n", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c",
                      210U, "get_tags_from_classification");
        }
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 212
    tmp___1 = i;
#line 212
    i ++;
#line 212
    *(r + tmp___1) = node->tag;
#line 213
    t = node;
#line 214
    node = node->global_next;
    {
#line 215
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 215
      if (t) {
        {
#line 215
        free((void *)t);
        }
      }
#line 215
      goto while_break___1;
    }
    while_break___1: /* CIL Label */ ;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 217
  if (i < n) {
    {
#line 217
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 217
      if (! (i < n)) {
#line 217
        goto while_break___2;
      }
#line 217
      tmp___2 = i;
#line 217
      i ++;
#line 217
      *(r + tmp___2) = 0;
    }
    while_break___2: /* CIL Label */ ;
    }
  }
#line 218
  return (max_tag);
}
}
#line 221 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static void init_classification(Classification *c ) 
{ 
  ClassNode *tmp ;

  {
#line 223
  c->first_class = (Class *)((void *)0);
#line 224
  tmp = (ClassNode *)((void *)0);
#line 224
  c->last_node = tmp;
#line 224
  c->first_node = tmp;
#line 225
  return;
}
}
#line 227 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
int32 mdjvu_classify_patterns(mdjvu_pattern_t *b , int32 *r , int32 n , int32 dpi___0 ,
                              mdjvu_matcher_options_t options ) 
{ 
  int32 i ;
  Classification cl ;
  int32 tmp ;

  {
  {
#line 233
  init_classification(& cl);
#line 235
  i = 0;
  }
  {
#line 235
  while (1) {
    while_continue: /* CIL Label */ ;
#line 235
    if (! (i < n)) {
#line 235
      goto while_break;
    }
#line 235
    if (*(b + i)) {
      {
#line 235
      classify(& cl, *(b + i), dpi___0, options, 1);
      }
    }
#line 235
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 237
  tmp = get_tags_from_classification(b, r, n, & cl);
  }
#line 237
  return (tmp);
}
}
#line 241 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static void get_cheap_center(mdjvu_bitmap_t bitmap , int32 *cx , int32 *cy ) 
{ 
  int32 tmp ;
  int32 tmp___0 ;

  {
  {
#line 243
  tmp = mdjvu_bitmap_get_width(bitmap);
#line 243
  *cx = tmp / 2;
#line 244
  tmp___0 = mdjvu_bitmap_get_height(bitmap);
#line 244
  *cy = tmp___0 / 2;
  }
#line 245
  return;
}
}
#line 250 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
int32 mdjvu_classify_bitmaps(mdjvu_image_t image , int32 *result , mdjvu_matcher_options_t options ,
                             int centers_needed ) 
{ 
  int32 i ;
  int32 n ;
  int32 tmp ;
  int32 dpi___0 ;
  int32 tmp___0 ;
  mdjvu_pattern_t *patterns ;
  void *tmp___1 ;
  int32 max_tag ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___2 ;
  int tmp___3 ;
  int32 cx ;
  int32 cy ;
  mdjvu_bitmap_t bitmap___0 ;
  mdjvu_bitmap_t tmp___4 ;

  {
  {
#line 254
  tmp = mdjvu_image_get_bitmap_count(image);
#line 254
  n = tmp;
#line 255
  tmp___0 = mdjvu_image_get_resolution(image);
#line 255
  dpi___0 = tmp___0;
#line 256
  tmp___1 = malloc(sizeof(mdjvu_pattern_t ) * (unsigned long )n);
#line 256
  patterns = (mdjvu_pattern_t *)tmp___1;
#line 259
  i = 0;
  }
  {
#line 259
  while (1) {
    while_continue: /* CIL Label */ ;
#line 259
    if (! (i < n)) {
#line 259
      goto while_break;
    }
    {
#line 261
    tmp___2 = mdjvu_image_get_bitmap(image, i);
#line 261
    bitmap = tmp___2;
#line 262
    tmp___3 = mdjvu_image_get_not_a_letter_flag(image, bitmap);
    }
#line 262
    if (tmp___3) {
#line 263
      *(patterns + i) = (mdjvu_pattern_t )((void *)0);
    } else {
      {
#line 265
      *(patterns + i) = mdjvu_pattern_create(options, bitmap);
      }
    }
#line 259
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 268
  max_tag = mdjvu_classify_patterns(patterns, result, n, dpi___0, options);
  }
#line 270
  if (centers_needed) {
    {
#line 272
    mdjvu_image_enable_centers(image);
#line 273
    i = 0;
    }
    {
#line 273
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 273
      if (! (i < n)) {
#line 273
        goto while_break___0;
      }
      {
#line 276
      tmp___4 = mdjvu_image_get_bitmap(image, i);
#line 276
      bitmap___0 = tmp___4;
      }
#line 277
      if (*(patterns + i)) {
        {
#line 278
        mdjvu_pattern_get_center(*(patterns + i), & cx, & cy);
        }
      } else {
        {
#line 280
        get_cheap_center(bitmap___0, & cx, & cy);
        }
      }
      {
#line 281
      mdjvu_image_set_center(image, bitmap___0, cx, cy);
#line 273
      i ++;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
  }
#line 285
  i = 0;
  {
#line 285
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 285
    if (! (i < n)) {
#line 285
      goto while_break___1;
    }
#line 286
    if (*(patterns + i)) {
      {
#line 286
      mdjvu_pattern_destroy(*(patterns + i));
      }
    }
#line 285
    i ++;
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 287
  while (1) {
    while_continue___2: /* CIL Label */ ;
#line 287
    if (patterns) {
      {
#line 287
      free((void *)patterns);
      }
    }
#line 287
    goto while_break___2;
  }
  while_break___2: /* CIL Label */ ;
  }
#line 289
  return (max_tag);
}
}
#line 296 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
int32 mdjvu_multipage_classify_patterns(int32 npages , int32 total_patterns_count ,
                                        int32 *npatterns , mdjvu_pattern_t **patterns ,
                                        int32 *result , int32 *dpi___0 , mdjvu_matcher_options_t options ,
                                        void (*report___0)(void * , int  ) , void *param ) 
{ 
  mdjvu_pattern_t *all_patterns ;
  void *tmp ;
  int32 patterns_gathered ;
  int32 page ;
  int32 max_tag ;
  Classification cl ;
  int32 n ;
  int32 d ;
  mdjvu_pattern_t *p ;
  int32 i ;
  int32 tmp___0 ;

  {
  {
#line 304
  tmp = malloc((unsigned long )total_patterns_count * sizeof(mdjvu_pattern_t ));
#line 304
  all_patterns = (mdjvu_pattern_t *)tmp;
#line 310
  init_classification(& cl);
#line 312
  patterns_gathered = 0;
#line 313
  page = 0;
  }
  {
#line 313
  while (1) {
    while_continue: /* CIL Label */ ;
#line 313
    if (! (page < npages)) {
#line 313
      goto while_break;
    }
#line 315
    n = *(npatterns + page);
#line 316
    d = *(dpi___0 + page);
#line 317
    p = *(patterns + page);
#line 320
    i = 0;
    {
#line 320
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 320
      if (! (i < n)) {
#line 320
        goto while_break___0;
      }
#line 322
      tmp___0 = patterns_gathered;
#line 322
      patterns_gathered ++;
#line 322
      *(all_patterns + tmp___0) = *(p + i);
#line 323
      if (*(p + i)) {
        {
#line 323
        classify(& cl, *(p + i), d, options, page);
        }
      }
#line 320
      i ++;
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 325
    (*report___0)(param, page);
#line 313
    page ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 328
  max_tag = get_tags_from_classification(all_patterns, result, total_patterns_count,
                                         & cl);
#line 331
  free((void *)all_patterns);
  }
#line 332
  return (max_tag);
}
}
#line 336 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
int32 mdjvu_multipage_classify_bitmaps(int32 npages , int32 total_patterns_count ,
                                       mdjvu_image_t *pages , int32 *result , mdjvu_matcher_options_t options ,
                                       void (*report___0)(void * , int  ) , void *param ,
                                       int centers_needed ) 
{ 
  int32 max_tag ;
  int32 k ;
  int32 page ;
  int32 *npatterns ;
  void *tmp ;
  int32 *dpi___0 ;
  void *tmp___0 ;
  mdjvu_pattern_t *patterns ;
  void *tmp___1 ;
  mdjvu_pattern_t **pointers ;
  void *tmp___2 ;
  int32 patterns_created ;
  mdjvu_image_t current_image ;
  int32 c ;
  int32 tmp___3 ;
  int32 i ;
  int32 tmp___4 ;
  int32 tmp___5 ;
  mdjvu_bitmap_t tmp___6 ;
  mdjvu_bitmap_t tmp___7 ;
  int tmp___8 ;
  int32 patterns_processed ;
  mdjvu_image_t current_image___0 ;
  int32 n ;
  int32 tmp___9 ;
  int32 i___0 ;
  int32 cx ;
  int32 cy ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___10 ;

  {
  {
#line 342
  tmp = malloc((unsigned long )npages * sizeof(int32 ));
#line 342
  npatterns = (int32 *)tmp;
#line 343
  tmp___0 = malloc((unsigned long )npages * sizeof(int32 ));
#line 343
  dpi___0 = (int32 *)tmp___0;
#line 344
  tmp___1 = malloc((unsigned long )total_patterns_count * sizeof(mdjvu_pattern_t ));
#line 344
  patterns = (mdjvu_pattern_t *)tmp___1;
#line 346
  tmp___2 = malloc((unsigned long )npages * sizeof(mdjvu_pattern_t *));
#line 346
  pointers = (mdjvu_pattern_t **)tmp___2;
#line 349
  patterns_created = 0;
#line 350
  page = 0;
  }
  {
#line 350
  while (1) {
    while_continue: /* CIL Label */ ;
#line 350
    if (! (page < npages)) {
#line 350
      goto while_break;
    }
    {
#line 352
    current_image = *(pages + page);
#line 353
    tmp___3 = mdjvu_image_get_bitmap_count(current_image);
#line 353
    *(npatterns + page) = tmp___3;
#line 353
    c = tmp___3;
#line 355
    *(dpi___0 + page) = mdjvu_image_get_resolution(current_image);
#line 357
    *(pointers + page) = patterns + patterns_created;
#line 358
    i = 0;
    }
    {
#line 358
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 358
      if (! (i < c)) {
#line 358
        goto while_break___0;
      }
      {
#line 360
      tmp___7 = mdjvu_image_get_bitmap(current_image, i);
#line 360
      tmp___8 = mdjvu_image_get_not_a_letter_flag(current_image, tmp___7);
      }
#line 360
      if (tmp___8) {
#line 361
        tmp___4 = patterns_created;
#line 361
        patterns_created ++;
#line 361
        *(patterns + tmp___4) = (mdjvu_pattern_t )((void *)0);
      } else {
        {
#line 364
        tmp___5 = patterns_created;
#line 364
        patterns_created ++;
#line 364
        tmp___6 = mdjvu_image_get_bitmap(current_image, i);
#line 364
        *(patterns + tmp___5) = mdjvu_pattern_create(options, tmp___6);
        }
      }
#line 358
      i ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 350
    page ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 372
  max_tag = mdjvu_multipage_classify_patterns(npages, total_patterns_count, npatterns,
                                              pointers, result, dpi___0, options,
                                              report___0, param);
  }
#line 376
  if (centers_needed) {
#line 378
    patterns_processed = 0;
#line 380
    page = 0;
    {
#line 380
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 380
      if (! (page < npages)) {
#line 380
        goto while_break___1;
      }
      {
#line 382
      current_image___0 = *(pages + page);
#line 383
      tmp___9 = mdjvu_image_get_bitmap_count(current_image___0);
#line 383
      n = tmp___9;
#line 385
      mdjvu_image_enable_centers(current_image___0);
#line 386
      i___0 = 0;
      }
      {
#line 386
      while (1) {
        while_continue___2: /* CIL Label */ ;
#line 386
        if (! (i___0 < n)) {
#line 386
          goto while_break___2;
        }
        {
#line 389
        tmp___10 = mdjvu_image_get_bitmap(current_image___0, i___0);
#line 389
        bitmap = tmp___10;
        }
#line 390
        if (*(patterns + patterns_processed)) {
          {
#line 391
          mdjvu_pattern_get_center(*(patterns + patterns_processed), & cx, & cy);
          }
        } else {
          {
#line 393
          get_cheap_center(bitmap, & cx, & cy);
          }
        }
        {
#line 394
        patterns_processed ++;
#line 395
        mdjvu_image_set_center(current_image___0, bitmap, cx, cy);
#line 386
        i___0 ++;
        }
      }
      while_break___2: /* CIL Label */ ;
      }
#line 380
      page ++;
    }
    while_break___1: /* CIL Label */ ;
    }
  }
#line 400
  k = 0;
  {
#line 400
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 400
    if (! (k < total_patterns_count)) {
#line 400
      goto while_break___3;
    }
#line 402
    if (*(patterns + k)) {
      {
#line 403
      mdjvu_pattern_destroy(*(patterns + k));
      }
    }
#line 400
    k ++;
  }
  while_break___3: /* CIL Label */ ;
  }
  {
#line 405
  free((void *)patterns);
#line 406
  free((void *)pointers);
#line 407
  free((void *)npatterns);
#line 408
  free((void *)dpi___0);
  }
#line 410
  return (max_tag);
}
}
#line 414 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
void mdjvu_multipage_get_dictionary_flags(int32 n , int32 *npatterns , int32 max_tag ,
                                          int32 *tags , unsigned char *dictionary_flags ) 
{ 
  int32 page_number ;
  int32 *first_page_met ;
  void *tmp ;
  int32 i ;
  int32 total_bitmaps_passed ;
  int32 bitmap_count ;
  int32 tag ;
  int32 tmp___0 ;

  {
  {
#line 422
  tmp = malloc((unsigned long )(max_tag + 1) * sizeof(int32 ));
#line 422
  first_page_met = (int32 *)tmp;
#line 423
  total_bitmaps_passed = 0;
#line 424
  memset((void *)dictionary_flags, 0, (size_t )(max_tag + 1));
#line 425
  i = 0;
  }
  {
#line 425
  while (1) {
    while_continue: /* CIL Label */ ;
#line 425
    if (! (i <= max_tag)) {
#line 425
      goto while_break;
    }
#line 425
    *(first_page_met + i) = -1;
#line 425
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 427
  page_number = 0;
  {
#line 427
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 427
    if (! (page_number < n)) {
#line 427
      goto while_break___0;
    }
#line 429
    bitmap_count = *(npatterns + page_number);
#line 431
    i = 0;
    {
#line 431
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 431
      if (! (i < bitmap_count)) {
#line 431
        goto while_break___1;
      }
#line 433
      tmp___0 = total_bitmaps_passed;
#line 433
      total_bitmaps_passed ++;
#line 433
      tag = *(tags + tmp___0);
#line 434
      if (! tag) {
#line 434
        goto __Cont;
      }
#line 436
      if (*(first_page_met + tag) == -1) {
#line 439
        *(first_page_met + tag) = page_number;
      } else
#line 441
      if (*(first_page_met + tag) != page_number) {
#line 444
        *(dictionary_flags + tag) = (unsigned char)1;
      }
      __Cont: /* CIL Label */ 
#line 431
      i ++;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 427
    page_number ++;
  }
  while_break___0: /* CIL Label */ ;
  }
  {
#line 449
  free((void *)first_page_met);
  }
#line 450
  return;
}
}
#line 15 "../include/minidjvu/image-io/tiff.h"
mdjvu_bitmap_t mdjvu_load_tiff(char const   *path , int32 *presolution , mdjvu_error_t *perr ,
                               uint32 idx ) ;
#line 139 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/tiffload.c"
mdjvu_bitmap_t mdjvu_load_tiff(char const   *path , int32 *presolution , mdjvu_error_t *perr ,
                               uint32 idx ) 
{ 


  {
  {
#line 144
  *perr = mdjvu_get_error((MinidjvuErrorType )11);
  }
#line 145
  return ((mdjvu_bitmap_t )((void *)0));
}
}
#line 32 "../include/minidjvu/djvu/iff.h"
int32 mdjvu_iff_get_id(mdjvu_iff_t iff ) ;
#line 37
int32 mdjvu_iff_get_length(mdjvu_iff_t iff ) ;
#line 40
mdjvu_iff_t mdjvu_iff_read_chunk(mdjvu_file_t file ) ;
#line 749 "/usr/include/stdio.h"
extern int fseek(FILE *__stream , long __off , int __whence ) ;
#line 11 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
static void read_align(FILE *f ) 
{ 
  long pos ;
  long tmp ;

  {
  {
#line 13
  tmp = ftell(f);
#line 13
  pos = tmp;
  }
#line 14
  if (pos & 1L) {
    {
#line 14
    fgetc(f);
    }
  }
#line 15
  return;
}
}
#line 17 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
static void write_align(FILE *f ) 
{ 
  long pos ;
  long tmp ;

  {
  {
#line 19
  tmp = ftell(f);
#line 19
  pos = tmp;
  }
#line 20
  if (pos & 1L) {
    {
#line 20
    fputc(0, f);
    }
  }
#line 21
  return;
}
}
#line 32 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
int32 mdjvu_iff_get_id(mdjvu_iff_t iff ) 
{ 


  {
#line 34
  return (((Chunk *)iff)->id);
}
}
#line 37 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
int32 mdjvu_iff_get_length(mdjvu_iff_t iff ) 
{ 


  {
#line 39
  return ((int32 )((Chunk *)iff)->length);
}
}
#line 42 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
mdjvu_iff_t mdjvu_iff_read_chunk(mdjvu_file_t file ) 
{ 
  FILE *f ;
  Chunk *chunk ;
  void *tmp ;
  int32 tmp___0 ;
  long tmp___1 ;

  {
  {
#line 44
  f = (FILE *)file;
#line 45
  tmp = malloc(sizeof(Chunk ));
#line 45
  chunk = (Chunk *)tmp;
#line 46
  read_align(f);
#line 47
  chunk->id = mdjvu_read_big_endian_int32(file);
#line 48
  tmp___0 = mdjvu_read_big_endian_int32(file);
#line 48
  chunk->length = (uint32 )tmp___0;
#line 49
  tmp___1 = ftell(f);
#line 49
  chunk->start = (uint32 )tmp___1;
#line 50
  chunk->write = 0;
  }
#line 52
  return ((mdjvu_iff_t )chunk);
}
}
#line 55 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
mdjvu_iff_t mdjvu_iff_write_chunk(int32 id , mdjvu_file_t file ) 
{ 
  FILE *f ;
  Chunk *chunk ;
  void *tmp ;
  long tmp___0 ;

  {
  {
#line 57
  f = (FILE *)file;
#line 58
  tmp = malloc(sizeof(Chunk ));
#line 58
  chunk = (Chunk *)tmp;
#line 59
  write_align(f);
#line 60
  mdjvu_write_big_endian_int32(id, file);
#line 61
  mdjvu_write_big_endian_int32(0, file);
#line 63
  chunk->id = id;
#line 64
  tmp___0 = ftell(f);
#line 64
  chunk->start = (uint32 )tmp___0;
#line 65
  chunk->length = (uint32 )0;
#line 66
  chunk->write = 1;
  }
#line 68
  return ((mdjvu_iff_t )chunk);
}
}
#line 71 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
void mdjvu_iff_close_chunk(mdjvu_iff_t iff , mdjvu_file_t file ) 
{ 
  FILE *f ;
  Chunk *chunk ;
  long pos ;
  long tmp ;
  uint32 length ;

  {
#line 73
  f = (FILE *)file;
#line 74
  chunk = (Chunk *)iff;
#line 76
  if (chunk->write) {
    {
#line 78
    tmp = ftell(f);
#line 78
    pos = tmp;
#line 79
    length = (uint32 )(pos - (long )chunk->start);
#line 80
    fseek(f, (long )(chunk->start - 4U), 0);
#line 81
    mdjvu_write_big_endian_int32((int32 )length, file);
#line 82
    fseek(f, pos, 0);
    }
  } else {
    {
#line 86
    fseek(f, (long )(chunk->start + chunk->length), 0);
    }
  }
  {
#line 89
  free((void *)chunk);
  }
#line 90
  return;
}
}
#line 13 "../include/minidjvu/alg/smooth.h"
void mdjvu_smooth(mdjvu_bitmap_t b ) ;
#line 12 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/smooth.c"
static void smooth_row(unsigned char *r , unsigned char *u , unsigned char *t , unsigned char *l ,
                       int32 n ) 
{ 
  int32 i ;
  int score ;

  {
#line 19
  i = 0;
  {
#line 19
  while (1) {
    while_continue: /* CIL Label */ ;
#line 19
    if (! (i < n)) {
#line 19
      goto while_break;
    }
#line 21
    score = ((((int )*(u + i) + (int )*(l + i)) + (int )*(t + (i - 1))) + (int )*(t + (i + 1))) - 2;
#line 28
    if (score < 0) {
#line 29
      *(r + i) = (unsigned char)0;
    } else {
#line 31
      *(r + i) = *(t + i);
    }
#line 19
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 33
  return;
}
}
#line 36 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/smooth.c"
void mdjvu_smooth(mdjvu_bitmap_t b ) 
{ 
  int32 w ;
  int32 tmp ;
  int32 h ;
  int32 tmp___0 ;
  int32 i ;
  unsigned char *u ;
  unsigned char *t ;
  unsigned char *l ;
  unsigned char *r ;
  void *tmp___1 ;
  void *tmp___2 ;
  void *tmp___3 ;
  void *tmp___4 ;
  unsigned char *tmp___5 ;

  {
  {
#line 38
  tmp = mdjvu_bitmap_get_width(b);
#line 38
  w = tmp;
#line 39
  tmp___0 = mdjvu_bitmap_get_height(b);
#line 39
  h = tmp___0;
  }
#line 43
  if (h < 3) {
#line 43
    return;
  }
  {
#line 45
  tmp___1 = calloc((size_t )(w + 2), (size_t )1);
#line 45
  u = (unsigned char *)tmp___1 + 1;
#line 46
  tmp___2 = calloc((size_t )(w + 2), (size_t )1);
#line 46
  t = (unsigned char *)tmp___2 + 1;
#line 47
  tmp___3 = calloc((size_t )(w + 2), (size_t )1);
#line 47
  l = (unsigned char *)tmp___3 + 1;
#line 48
  tmp___4 = malloc((size_t )w);
#line 48
  r = (unsigned char *)tmp___4;
#line 50
  mdjvu_bitmap_unpack_row_0_or_1(b, l, 0);
#line 51
  i = 0;
  }
  {
#line 51
  while (1) {
    while_continue: /* CIL Label */ ;
#line 51
    if (! (i < h)) {
#line 51
      goto while_break;
    }
#line 53
    tmp___5 = u;
#line 54
    u = t;
#line 55
    t = l;
#line 56
    l = tmp___5;
#line 58
    if (i + 1 < h) {
      {
#line 59
      mdjvu_bitmap_unpack_row_0_or_1(b, l, i + 1);
      }
    } else {
      {
#line 61
      memset((void *)l, 0, (size_t )w);
      }
    }
    {
#line 63
    smooth_row(r, u, t, l, w);
#line 64
    mdjvu_bitmap_pack_row(b, r, i);
#line 51
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 67
  free((void *)(u - 1));
#line 68
  free((void *)(t - 1));
#line 69
  free((void *)(l - 1));
#line 70
  free((void *)r);
  }
#line 71
  return;
}
}
#line 133 "../include/minidjvu/base/5image.h"
void mdjvu_image_enable_not_a_letter_flags(mdjvu_image_t image ) ;
#line 137
void mdjvu_image_set_not_a_letter_flag(mdjvu_image_t image , mdjvu_bitmap_t b , int v ) ;
#line 141
int mdjvu_image_has_suspiciously_big_flags(mdjvu_image_t image ) ;
#line 144
int mdjvu_image_get_suspiciously_big_flag(mdjvu_image_t image , mdjvu_bitmap_t b ) ;
#line 19 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/nosubst.c"
static int segments_intersect_or_touch(int32 a1 , int32 l1 , int32 a2 , int32 l2 ) 
{ 
  int tmp ;

  {
#line 21
  if (a1 <= a2 + l2) {
#line 21
    if (a2 <= a1 + l1) {
#line 21
      tmp = 1;
    } else {
#line 21
      tmp = 0;
    }
  } else {
#line 21
    tmp = 0;
  }
#line 21
  return (tmp);
}
}
#line 24 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/nosubst.c"
static int blits_intersect_or_touch(mdjvu_image_t image , int32 b1 , int32 b2 ) 
{ 
  int32 x1 ;
  int32 tmp ;
  int32 x2 ;
  int32 tmp___0 ;
  int32 y1 ;
  int32 tmp___1 ;
  int32 y2 ;
  int32 tmp___2 ;
  mdjvu_bitmap_t bitmap1 ;
  mdjvu_bitmap_t tmp___3 ;
  mdjvu_bitmap_t bitmap2 ;
  mdjvu_bitmap_t tmp___4 ;
  int32 w1 ;
  int32 tmp___5 ;
  int32 w2 ;
  int32 tmp___6 ;
  int32 h1 ;
  int32 tmp___7 ;
  int32 h2 ;
  int32 tmp___8 ;
  int tmp___9 ;
  int tmp___10 ;
  int tmp___11 ;

  {
  {
#line 26
  tmp = mdjvu_image_get_blit_x(image, b1);
#line 26
  x1 = tmp;
#line 27
  tmp___0 = mdjvu_image_get_blit_x(image, b2);
#line 27
  x2 = tmp___0;
#line 28
  tmp___1 = mdjvu_image_get_blit_y(image, b1);
#line 28
  y1 = tmp___1;
#line 29
  tmp___2 = mdjvu_image_get_blit_y(image, b2);
#line 29
  y2 = tmp___2;
#line 30
  tmp___3 = mdjvu_image_get_blit_bitmap(image, b1);
#line 30
  bitmap1 = tmp___3;
#line 31
  tmp___4 = mdjvu_image_get_blit_bitmap(image, b2);
#line 31
  bitmap2 = tmp___4;
#line 32
  tmp___5 = mdjvu_bitmap_get_width(bitmap1);
#line 32
  w1 = tmp___5;
#line 33
  tmp___6 = mdjvu_bitmap_get_width(bitmap2);
#line 33
  w2 = tmp___6;
#line 34
  tmp___7 = mdjvu_bitmap_get_height(bitmap1);
#line 34
  h1 = tmp___7;
#line 35
  tmp___8 = mdjvu_bitmap_get_height(bitmap2);
#line 35
  h2 = tmp___8;
#line 36
  tmp___9 = segments_intersect_or_touch(x1, w1, x2, w2);
  }
#line 36
  if (tmp___9) {
    {
#line 36
    tmp___10 = segments_intersect_or_touch(y1, h1, y2, h2);
    }
#line 36
    if (tmp___10) {
#line 36
      tmp___11 = 1;
    } else {
#line 36
      tmp___11 = 0;
    }
  } else {
#line 36
    tmp___11 = 0;
  }
#line 36
  return (tmp___11);
}
}
#line 40 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/nosubst.c"
static void make_no_subst(mdjvu_image_t image , int32 blit ) 
{ 
  int32 i ;
  int32 b ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp ;
  int tmp___0 ;
  int tmp___1 ;

  {
  {
#line 43
  tmp = mdjvu_image_get_blit_bitmap(image, blit);
#line 43
  bitmap = tmp;
#line 44
  tmp___0 = mdjvu_image_get_not_a_letter_flag(image, bitmap);
  }
#line 44
  if (tmp___0) {
#line 44
    return;
  }
  {
#line 45
  mdjvu_image_set_not_a_letter_flag(image, bitmap, 1);
#line 48
  b = mdjvu_image_get_blit_count(image);
#line 49
  i = 0;
  }
  {
#line 49
  while (1) {
    while_continue: /* CIL Label */ ;
#line 49
    if (! (i < b)) {
#line 49
      goto while_break;
    }
    {
#line 51
    tmp___1 = blits_intersect_or_touch(image, blit, i);
    }
#line 51
    if (tmp___1) {
      {
#line 52
      make_no_subst(image, i);
      }
    }
#line 49
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 54
  return;
}
}
#line 56 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/nosubst.c"
void mdjvu_calculate_not_a_letter_flags(mdjvu_image_t image ) 
{ 
  int32 i ;
  int32 b ;
  int tmp ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___0 ;
  int tmp___1 ;

  {
  {
#line 59
  tmp = mdjvu_image_has_suspiciously_big_flags(image);
  }
#line 59
  if (! tmp) {
    {
#line 59
    __assert_fail("mdjvu_image_has_suspiciously_big_flags(image)", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/nosubst.c",
                  59U, "mdjvu_calculate_not_a_letter_flags");
    }
  }
  {
#line 60
  mdjvu_image_enable_not_a_letter_flags(image);
#line 61
  b = mdjvu_image_get_blit_count(image);
#line 62
  i = 0;
  }
  {
#line 62
  while (1) {
    while_continue: /* CIL Label */ ;
#line 62
    if (! (i < b)) {
#line 62
      goto while_break;
    }
    {
#line 64
    tmp___0 = mdjvu_image_get_blit_bitmap(image, i);
#line 64
    bitmap = tmp___0;
#line 65
    tmp___1 = mdjvu_image_get_suspiciously_big_flag(image, bitmap);
    }
#line 65
    if (tmp___1) {
      {
#line 66
      make_no_subst(image, i);
      }
    }
#line 62
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 68
  return;
}
}
#line 37 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static int32 sum_column_gray(byte **pixels , int32 x , int32 y1 , int32 y2 ) 
{ 
  int sum ;
  int y ;

  {
#line 39
  sum = 0;
#line 40
  y = y1;
  {
#line 40
  while (1) {
    while_continue: /* CIL Label */ ;
#line 40
    if (! (y <= y2)) {
#line 40
      goto while_break;
    }
#line 40
    sum += (int )*(*(pixels + y) + x);
#line 40
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 41
  return (sum);
}
}
#line 44 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static int32 sum_row_gray(byte *row , int32 x1 , int32 x2 ) 
{ 
  int sum ;
  int x ;
  int n ;
  byte *p ;

  {
#line 46
  sum = 0;
#line 46
  n = x2 - x1;
#line 47
  p = row + x1;
#line 48
  x = 0;
  {
#line 48
  while (1) {
    while_continue: /* CIL Label */ ;
#line 48
    if (! (x <= n)) {
#line 48
      goto while_break;
    }
#line 48
    sum += (int )*(p + x);
#line 48
    x ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 49
  return (sum);
}
}
#line 52 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static int32 sum_column_black_and_white(byte **pixels , int32 x , int32 y1 , int32 y2 ) 
{ 
  int sum ;
  int y ;

  {
#line 54
  sum = 0;
#line 55
  y = y1;
  {
#line 55
  while (1) {
    while_continue: /* CIL Label */ ;
#line 55
    if (! (y <= y2)) {
#line 55
      goto while_break;
    }
#line 55
    if (*(*(pixels + y) + x)) {
#line 55
      sum ++;
    }
#line 55
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 56
  return (sum);
}
}
#line 59 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static int32 sum_row_black_and_white(byte *row , int32 x1 , int32 x2 ) 
{ 
  int sum ;
  int x ;
  int n ;
  byte *p ;

  {
#line 61
  sum = 0;
#line 61
  n = x2 - x1;
#line 62
  p = row + x1;
#line 63
  x = 0;
  {
#line 63
  while (1) {
    while_continue: /* CIL Label */ ;
#line 63
    if (! (x <= n)) {
#line 63
      goto while_break;
    }
#line 63
    if (*(p + x)) {
#line 63
      sum ++;
    }
#line 63
    x ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 64
  return (sum);
}
}
#line 67
static void make_vcut(int32 a , int32 l , int32 w , int32 h , byte **pixels , byte *sig ,
                      int32 k , int32 (*s_row)(byte * , int32  , int32  ) , int32 (*s_col)(byte ** ,
                                                                                           int32  ,
                                                                                           int32  ,
                                                                                           int32  ) ,
                      int32 size ) ;
#line 73 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static void make_hcut(int32 a , int32 l , int32 w , int32 h , byte **pixels , byte *sig ,
                      int32 k , int32 (*s_row)(byte * , int32  , int32  ) , int32 (*s_col)(byte ** ,
                                                                                           int32  ,
                                                                                           int32  ,
                                                                                           int32  ) ,
                      int32 size ) 
{ 
  int32 cut ;
  int32 up_weight ;
  int32 last_row_weight ;

  {
#line 79
  cut = 0;
#line 80
  up_weight = 0;
#line 82
  if (k >= size) {
#line 82
    return;
  }
#line 84
  if (a) {
#line 86
    last_row_weight = 0;
#line 88
    if (w) {
#line 88
      if (! h) {
        {
#line 88
        __assert_fail("w && h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c",
                      88U, "make_hcut");
        }
      }
    } else {
      {
#line 88
      __assert_fail("w && h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c",
                    88U, "make_hcut");
      }
    }
    {
#line 90
    while (1) {
      while_continue: /* CIL Label */ ;
#line 90
      if (! (up_weight << 1 < a)) {
#line 90
        goto while_break;
      }
      {
#line 92
      last_row_weight = (*s_row)(*(pixels + cut), l, (l + w) - 1);
#line 93
      up_weight += last_row_weight;
#line 94
      cut ++;
      }
    }
    while_break: /* CIL Label */ ;
    }
#line 96
    cut --;
#line 97
    up_weight -= last_row_weight;
#line 98
    *(sig + k) = (byte )((256 * (cut * w + (w * ((a >> 1) - up_weight)) / last_row_weight)) / (w * h));
#line 101
    if (a - (up_weight << 1) > last_row_weight) {
#line 103
      cut ++;
#line 104
      up_weight += last_row_weight;
    }
  } else {
#line 109
    cut = h / 2;
#line 110
    *(sig + k) = (byte )128;
  }
  {
#line 113
  make_vcut(up_weight, l, w, cut, pixels, sig, k << 1, s_row, s_col, size);
#line 114
  make_vcut(a - up_weight, l, w, h - cut, pixels + cut, sig, (k << 1) | 1, s_row,
            s_col, size);
  }
#line 115
  return;
}
}
#line 117 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static void make_vcut(int32 a , int32 l , int32 w , int32 h , byte **pixels , byte *sig ,
                      int32 k , int32 (*s_row)(byte * , int32  , int32  ) , int32 (*s_col)(byte ** ,
                                                                                           int32  ,
                                                                                           int32  ,
                                                                                           int32  ) ,
                      int32 size ) 
{ 
  int32 cut ;
  int32 left_weight ;
  int32 last_col_weight ;

  {
#line 123
  cut = 0;
#line 124
  left_weight = 0;
#line 126
  if (k >= size) {
#line 126
    return;
  }
#line 128
  if (a) {
#line 130
    last_col_weight = 0;
#line 132
    if (w) {
#line 132
      if (! h) {
        {
#line 132
        __assert_fail("w && h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c",
                      132U, "make_vcut");
        }
      }
    } else {
      {
#line 132
      __assert_fail("w && h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c",
                    132U, "make_vcut");
      }
    }
    {
#line 134
    while (1) {
      while_continue: /* CIL Label */ ;
#line 134
      if (! (left_weight << 1 < a)) {
#line 134
        goto while_break;
      }
      {
#line 136
      last_col_weight = (*s_col)(pixels, l + cut, 0, h - 1);
#line 137
      left_weight += last_col_weight;
#line 138
      cut ++;
      }
    }
    while_break: /* CIL Label */ ;
    }
#line 140
    cut --;
#line 141
    left_weight -= last_col_weight;
#line 142
    *(sig + k) = (byte )((256 * (cut * h + (h * ((a >> 1) - left_weight)) / last_col_weight)) / (w * h));
#line 145
    if (a - (left_weight << 1) > last_col_weight) {
#line 147
      cut ++;
#line 147
      left_weight += last_col_weight;
    }
  } else {
#line 152
    cut = w / 2;
#line 153
    *(sig + k) = (byte )128;
  }
  {
#line 156
  make_hcut(left_weight, l, cut, h, pixels, sig, k << 1, s_row, s_col, size);
#line 157
  make_hcut(a - left_weight, l + cut, w - cut, h, pixels, sig, (k << 1) | 1, s_row,
            s_col, size);
  }
#line 158
  return;
}
}
#line 160 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static void get_signature(int32 width , int32 height , byte **pixels , byte *sig ,
                          int32 (*s_row)(byte * , int32  , int32  ) , int32 (*s_col)(byte ** ,
                                                                                     int32  ,
                                                                                     int32  ,
                                                                                     int32  ) ,
                          int32 size ) 
{ 
  int32 area ;
  int32 i ;
  int32 tmp ;

  {
#line 165
  area = 0;
#line 166
  i = 0;
  {
#line 166
  while (1) {
    while_continue: /* CIL Label */ ;
#line 166
    if (! (i < height)) {
#line 166
      goto while_break;
    }
    {
#line 168
    tmp = (*s_row)(*(pixels + i), 0, width - 1);
#line 168
    area += tmp;
#line 166
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 171
  make_hcut(area, 0, width, height, pixels, sig, 1, s_row, s_col, size);
  }
#line 172
  return;
}
}
#line 174 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
void mdjvu_get_gray_signature(unsigned char **data , int32 w , int32 h , unsigned char *result ,
                              int32 size ) 
{ 


  {
  {
#line 177
  get_signature(w, h, data, result, & sum_row_gray, & sum_column_gray, size);
  }
#line 178
  return;
}
}
#line 180 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
void mdjvu_get_black_and_white_signature(unsigned char **data , int32 w , int32 h ,
                                         unsigned char *result , int32 size ) 
{ 


  {
  {
#line 184
  get_signature(w, h, data, result, & sum_row_black_and_white, & sum_column_black_and_white,
                size);
  }
#line 185
  return;
}
}
#line 10 "../include/minidjvu/djvu/djvu.h"
int mdjvu_locate_jb2_chunk(mdjvu_file_t file , int32 *plength , mdjvu_error_t *perr ) ;
#line 16
mdjvu_image_t mdjvu_file_load_djvu_page(mdjvu_file_t file , mdjvu_error_t *perr ) ;
#line 17
mdjvu_image_t mdjvu_load_djvu_page(char const   *path , mdjvu_error_t *perr ) ;
#line 10 "../include/minidjvu/jb2.h"
extern mdjvu_image_t mdjvu_file_load_jb2(mdjvu_file_t  , int32 length , mdjvu_error_t * ) ;
#line 10 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
static uint32 read_uint32_most_significant_byte_first(FILE *f ) 
{ 
  uint32 r ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;

  {
  {
#line 12
  tmp = fgetc(f);
#line 12
  r = (uint32 )(tmp << 24);
#line 13
  tmp___0 = fgetc(f);
#line 13
  r |= (unsigned int )(tmp___0 << 16);
#line 14
  tmp___1 = fgetc(f);
#line 14
  r |= (unsigned int )(tmp___1 << 8);
#line 15
  tmp___2 = fgetc(f);
#line 15
  r |= (unsigned int )tmp___2;
  }
#line 16
  return (r);
}
}
#line 27 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
static void skip_in_chunk(IFFChunk *chunk , unsigned int len ) 
{ 


  {
  {
#line 29
  while (1) {
    while_continue: /* CIL Label */ ;
#line 29
    if (! chunk) {
#line 29
      goto while_break;
    }
#line 31
    chunk->skipped += len;
#line 32
    chunk = chunk->parent;
  }
  while_break: /* CIL Label */ ;
  }
#line 34
  return;
}
}
#line 36 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
static void skip_to_next_sibling_chunk(FILE *file , IFFChunk *chunk ) 
{ 


  {
  {
#line 38
  skip_in_chunk(chunk->parent, chunk->length + 8U);
#line 39
  fseek(file, (long )((chunk->length + 1U) & 4294967294U), 1);
#line 40
  chunk->id = read_uint32_most_significant_byte_first(file);
#line 41
  chunk->length = read_uint32_most_significant_byte_first(file);
#line 42
  chunk->skipped = (uint32 )0;
  }
#line 43
  return;
}
}
#line 45 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
static void get_child_chunk(FILE *file , IFFChunk *chunk , IFFChunk *parent ) 
{ 


  {
  {
#line 47
  chunk->id = read_uint32_most_significant_byte_first(file);
#line 48
  chunk->length = read_uint32_most_significant_byte_first(file);
#line 49
  chunk->skipped = (uint32 )0;
#line 50
  chunk->parent = parent;
#line 51
  skip_in_chunk(parent, 8U);
  }
#line 52
  return;
}
}
#line 54 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
static int find_sibling_chunk(FILE *file , IFFChunk *chunk , uint32 id ) 
{ 


  {
  {
#line 56
  while (1) {
    while_continue: /* CIL Label */ ;
#line 56
    if (! (chunk->id != id)) {
#line 56
      goto while_break;
    }
#line 58
    if (chunk->parent) {
#line 58
      if ((chunk->parent)->skipped >= (chunk->parent)->length) {
#line 59
        return (0);
      }
    }
    {
#line 60
    skip_to_next_sibling_chunk(file, chunk);
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 62
  return (1);
}
}
#line 70 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
int mdjvu_locate_jb2_chunk(mdjvu_file_t file , int32 *plength , mdjvu_error_t *perr ) 
{ 
  IFFChunk FORM ;
  IFFChunk Sjbz ;
  FILE *f ;
  uint32 i ;
  uint32 tmp ;
  int tmp___0 ;
  uint32 tmp___1 ;
  int tmp___2 ;

  {
  {
#line 73
  f = (FILE *)file;
#line 74
  tmp = read_uint32_most_significant_byte_first(f);
#line 74
  i = tmp;
  }
#line 75
  if (perr) {
#line 75
    *perr = (mdjvu_error_t )((void *)0);
  }
#line 76
  if (i != 1096033876U) {
#line 78
    if (perr) {
      {
#line 78
      *perr = mdjvu_get_error((MinidjvuErrorType )5);
      }
    }
#line 79
    return (0);
  }
  {
#line 82
  get_child_chunk(f, & FORM, (IFFChunk *)((void *)0));
#line 83
  tmp___0 = find_sibling_chunk(f, & FORM, (uint32 )1179603533);
  }
#line 83
  if (! tmp___0) {
#line 85
    if (perr) {
      {
#line 85
      *perr = mdjvu_get_error((MinidjvuErrorType )5);
      }
    }
#line 86
    return (0);
  }
  {
#line 89
  tmp___1 = read_uint32_most_significant_byte_first(f);
  }
#line 89
  if (tmp___1 != 1145722453U) {
#line 91
    if (perr) {
      {
#line 91
      *perr = mdjvu_get_error((MinidjvuErrorType )8);
      }
    }
#line 92
    return (0);
  }
  {
#line 95
  skip_in_chunk(& FORM, 4U);
#line 97
  get_child_chunk(f, & Sjbz, & FORM);
#line 98
  tmp___2 = find_sibling_chunk(f, & Sjbz, (uint32 )1399480954);
  }
#line 98
  if (! tmp___2) {
#line 100
    if (perr) {
      {
#line 100
      *perr = mdjvu_get_error((MinidjvuErrorType )9);
      }
    }
#line 101
    return (0);
  }
#line 104
  *plength = (int32 )Sjbz.length;
#line 106
  return (1);
}
}
#line 109 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
mdjvu_image_t mdjvu_file_load_djvu_page(mdjvu_file_t file , mdjvu_error_t *perr ) 
{ 
  int32 length ;
  int tmp ;
  mdjvu_image_t tmp___0 ;

  {
  {
#line 112
  tmp = mdjvu_locate_jb2_chunk(file, & length, perr);
  }
#line 112
  if (! tmp) {
#line 113
    return ((mdjvu_image_t )((void *)0));
  }
  {
#line 114
  tmp___0 = mdjvu_file_load_jb2(file, length, perr);
  }
#line 114
  return (tmp___0);
}
}
#line 117 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
mdjvu_image_t mdjvu_load_djvu_page(char const   *path , mdjvu_error_t *perr ) 
{ 
  mdjvu_image_t result ;
  FILE *f ;
  FILE *tmp ;

  {
  {
#line 120
  tmp = fopen((char const   */* __restrict  */)path, (char const   */* __restrict  */)"rb");
#line 120
  f = tmp;
  }
#line 121
  if (perr) {
#line 121
    *perr = (mdjvu_error_t )((void *)0);
  }
#line 122
  if (! f) {
#line 124
    if (perr) {
      {
#line 124
      *perr = mdjvu_get_error((MinidjvuErrorType )1);
      }
    }
#line 125
    return ((mdjvu_image_t )((void *)0));
  }
  {
#line 127
  result = mdjvu_file_load_djvu_page((mdjvu_file_t )f, perr);
#line 128
  fclose(f);
  }
#line 129
  return (result);
}
}
#line 11 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/average.c"
mdjvu_bitmap_t mdjvu_average(mdjvu_bitmap_t *bitmaps , int32 n , int32 *cx , int32 *cy ) 
{ 
  int32 i ;
  int32 min_x ;
  int32 min_y ;
  int32 max_x_plus_1 ;
  int32 max_y_plus_1 ;
  int32 *buf ;
  int32 buf_w ;
  int32 buf_h ;
  unsigned char *row ;
  int32 tmp_x ;
  int32 tmp_y ;
  int32 threshold ;
  mdjvu_bitmap_t result ;
  mdjvu_bitmap_t tmp ;
  int32 w ;
  int32 tmp___0 ;
  int32 h ;
  int32 tmp___1 ;
  int32 ncx ;
  int32 ncy ;
  void *tmp___2 ;
  void *tmp___3 ;
  int32 w___0 ;
  int32 tmp___4 ;
  int32 h___0 ;
  int32 tmp___5 ;
  int32 sx ;
  int32 sy ;
  int32 x ;
  int32 y ;
  int32 *buf_row ;
  int32 j ;

  {
#line 16
  min_x = 0;
#line 16
  min_y = 0;
#line 16
  max_x_plus_1 = 0;
#line 16
  max_y_plus_1 = 0;
#line 21
  threshold = n / 2;
#line 24
  if (n == 1) {
    {
#line 26
    tmp = mdjvu_bitmap_clone(*(bitmaps + 0));
    }
#line 26
    return (tmp);
  }
#line 29
  i = 0;
  {
#line 29
  while (1) {
    while_continue: /* CIL Label */ ;
#line 29
    if (! (i < n)) {
#line 29
      goto while_break;
    }
    {
#line 31
    tmp___0 = mdjvu_bitmap_get_width(*(bitmaps + i));
#line 31
    w = tmp___0;
#line 32
    tmp___1 = mdjvu_bitmap_get_height(*(bitmaps + i));
#line 32
    h = tmp___1;
#line 33
    ncx = *(cx + i) / 8;
#line 34
    ncy = *(cy + i) / 8;
    }
#line 36
    if (ncx >= 0) {
#line 36
      if (! (ncx < w)) {
        {
#line 36
        __assert_fail("ncx >= 0 && ncx < w", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/average.c",
                      36U, "mdjvu_average");
        }
      }
    } else {
      {
#line 36
      __assert_fail("ncx >= 0 && ncx < w", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/average.c",
                    36U, "mdjvu_average");
      }
    }
#line 37
    if (ncy >= 0) {
#line 37
      if (! (ncy < h)) {
        {
#line 37
        __assert_fail("ncy >= 0 && ncy < h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/average.c",
                      37U, "mdjvu_average");
        }
      }
    } else {
      {
#line 37
      __assert_fail("ncy >= 0 && ncy < h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/average.c",
                    37U, "mdjvu_average");
      }
    }
#line 39
    if (- ncx < min_x) {
#line 39
      min_x = - ncx;
    }
#line 40
    if (- ncy < min_y) {
#line 40
      min_y = - ncy;
    }
#line 41
    if (w - ncx > max_x_plus_1) {
#line 41
      max_x_plus_1 = w - ncx;
    }
#line 42
    if (h - ncy > max_y_plus_1) {
#line 42
      max_y_plus_1 = h - ncy;
    }
#line 29
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 45
  buf_w = max_x_plus_1 - min_x;
#line 46
  buf_h = max_y_plus_1 - min_y;
#line 47
  tmp___2 = calloc((size_t )(buf_w * buf_h), sizeof(int32 ));
#line 47
  buf = (int32 *)tmp___2;
#line 48
  tmp___3 = malloc((size_t )buf_w);
#line 48
  row = (unsigned char *)tmp___3;
#line 51
  i = 0;
  }
  {
#line 51
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 51
    if (! (i < n)) {
#line 51
      goto while_break___0;
    }
    {
#line 53
    tmp___4 = mdjvu_bitmap_get_width(*(bitmaps + i));
#line 53
    w___0 = tmp___4;
#line 54
    tmp___5 = mdjvu_bitmap_get_height(*(bitmaps + i));
#line 54
    h___0 = tmp___5;
#line 55
    sx = min_x + *(cx + i) / 8;
#line 55
    sy = min_y + *(cy + i) / 8;
#line 58
    y = 0;
    }
    {
#line 58
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 58
      if (! (y < h___0)) {
#line 58
        goto while_break___1;
      }
      {
#line 60
      buf_row = buf + buf_w * (y - sy);
#line 61
      mdjvu_bitmap_unpack_row(*(bitmaps + i), row, y);
#line 62
      x = 0;
      }
      {
#line 62
      while (1) {
        while_continue___2: /* CIL Label */ ;
#line 62
        if (! (x < w___0)) {
#line 62
          goto while_break___2;
        }
#line 64
        if (*(row + x)) {
#line 65
          (*(buf_row + (x - sx))) ++;
        }
#line 62
        x ++;
      }
      while_break___2: /* CIL Label */ ;
      }
#line 58
      y ++;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 51
    i ++;
  }
  while_break___0: /* CIL Label */ ;
  }
  {
#line 70
  result = mdjvu_bitmap_create(buf_w, buf_h);
#line 71
  i = 0;
  }
  {
#line 71
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 71
    if (! (i < buf_h)) {
#line 71
      goto while_break___3;
    }
#line 74
    j = 0;
    {
#line 74
    while (1) {
      while_continue___4: /* CIL Label */ ;
#line 74
      if (! (j < buf_w)) {
#line 74
        goto while_break___4;
      }
#line 76
      if (*(buf + (i * buf_w + j)) > threshold) {
#line 76
        *(row + j) = (unsigned char)1;
      } else {
#line 76
        *(row + j) = (unsigned char)0;
      }
#line 74
      j ++;
    }
    while_break___4: /* CIL Label */ ;
    }
    {
#line 78
    mdjvu_bitmap_pack_row(result, row, i);
#line 71
    i ++;
    }
  }
  while_break___3: /* CIL Label */ ;
  }
  {
#line 81
  mdjvu_bitmap_remove_margins(result, & tmp_x, & tmp_y);
#line 83
  free((void *)row);
#line 84
  free((void *)buf);
  }
#line 86
  return (result);
}
}
#line 14 "../include/minidjvu/base/5image.h"
void mdjvu_image_destroy(mdjvu_image_t image ) ;
#line 29
void mdjvu_image_remove_bitmap_margins(mdjvu_image_t image ) ;
#line 55
void mdjvu_image_remove_NULL_blits(mdjvu_image_t image ) ;
#line 74
void mdjvu_image_exchange_bitmaps(mdjvu_image_t image , int32 i1 , int32 i2 ) ;
#line 77
mdjvu_bitmap_t mdjvu_image_new_bitmap(mdjvu_image_t image , int32 w , int32 h ) ;
#line 86
int mdjvu_image_check_indices(mdjvu_image_t image ) ;
#line 93
void mdjvu_image_remove_unused_bitmaps(mdjvu_image_t image ) ;
#line 99
void mdjvu_image_set_dictionary(mdjvu_image_t image , mdjvu_image_t dict ) ;
#line 100
mdjvu_image_t mdjvu_image_get_dictionary(mdjvu_image_t image ) ;
#line 107
int mdjvu_image_has_prototypes(mdjvu_image_t image ) ;
#line 109
void mdjvu_image_enable_prototypes(mdjvu_image_t image ) ;
#line 111
void mdjvu_image_disable_prototypes(mdjvu_image_t image ) ;
#line 113
mdjvu_bitmap_t mdjvu_image_get_prototype(mdjvu_image_t image , mdjvu_bitmap_t b ) ;
#line 115
void mdjvu_image_set_prototype(mdjvu_image_t image , mdjvu_bitmap_t b , mdjvu_bitmap_t prototype ) ;
#line 119
int mdjvu_image_has_substitutions(mdjvu_image_t image ) ;
#line 120
void mdjvu_image_enable_substitutions(mdjvu_image_t image ) ;
#line 121
void mdjvu_image_disable_substitutions(mdjvu_image_t image ) ;
#line 124
void mdjvu_image_set_substitution(mdjvu_image_t image , mdjvu_bitmap_t b , mdjvu_bitmap_t s ) ;
#line 134
void mdjvu_image_disable_not_a_letter_flags(mdjvu_image_t image ) ;
#line 143
void mdjvu_image_disable_suspiciously_big_flags(mdjvu_image_t image ) ;
#line 152
int mdjvu_image_has_masses(mdjvu_image_t image ) ;
#line 153
void mdjvu_image_enable_masses(mdjvu_image_t image ) ;
#line 154
void mdjvu_image_disable_masses(mdjvu_image_t image ) ;
#line 155
int32 mdjvu_image_get_mass(mdjvu_image_t image , mdjvu_bitmap_t b ) ;
#line 162
int mdjvu_image_has_centers(mdjvu_image_t image ) ;
#line 170
int mdjvu_image_has_dictionary_indices(mdjvu_image_t image ) ;
#line 171
void mdjvu_image_enable_dictionary_indices(mdjvu_image_t image ) ;
#line 172
void mdjvu_image_disable_dictionary_indices(mdjvu_image_t image ) ;
#line 173
int32 mdjvu_image_get_dictionary_index(mdjvu_image_t image , mdjvu_bitmap_t b ) ;
#line 174
void mdjvu_image_set_dictionary_index(mdjvu_image_t image , mdjvu_bitmap_t b , int32 v ) ;
#line 177
void mdjvu_image_sort_bitmaps(mdjvu_image_t img ) ;
#line 480 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__warn_unused_result__,
__leaf__)) realloc)(void *__ptr , size_t __size ) ;
#line 53 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 const   artifact_sizes[7]  = {      (int32 const   )sizeof(mdjvu_bitmap_t ),      (int32 const   )sizeof(mdjvu_bitmap_t ),      (int32 const   )sizeof(unsigned char ),      (int32 const   )sizeof(unsigned char ), 
        (int32 const   )sizeof(int32 ),      (int32 const   )sizeof(int32 ),      (int32 const   )sizeof(Point )};
#line 81 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
static void initialize_artifact(void **artifacts , mdjvu_bitmap_t bitmap , mdjvu_artifact_type_enum a ) 
{ 
  int32 i ;
  int32 tmp ;

  {
  {
#line 83
  tmp = mdjvu_bitmap_get_index(bitmap);
#line 83
  i = tmp;
  }
  {
#line 86
  if ((unsigned int )a == 0U) {
#line 86
    goto case_0;
  }
#line 89
  if ((unsigned int )a == 1U) {
#line 89
    goto case_1;
  }
#line 92
  if ((unsigned int )a == 4U) {
#line 92
    goto case_4;
  }
#line 96
  if ((unsigned int )a == 5U) {
#line 96
    goto case_5;
  }
#line 99
  if ((unsigned int )a == 2U) {
#line 99
    goto case_2;
  }
#line 102
  if ((unsigned int )a == 3U) {
#line 102
    goto case_3;
  }
#line 106
  if ((unsigned int )a == 7U) {
#line 106
    goto case_7;
  }
#line 106
  if ((unsigned int )a == 6U) {
#line 106
    goto case_7;
  }
#line 84
  goto switch_break;
  case_0: /* CIL Label */ 
#line 87
  *((mdjvu_bitmap_t *)*(artifacts + 0) + i) = (mdjvu_bitmap_t )((void *)0);
#line 88
  goto switch_break;
  case_1: /* CIL Label */ 
#line 90
  *((mdjvu_bitmap_t *)*(artifacts + 1) + i) = (mdjvu_bitmap_t )((void *)0);
#line 91
  goto switch_break;
  case_4: /* CIL Label */ 
  {
#line 93
  *((int32 *)*(artifacts + 4) + i) = mdjvu_bitmap_get_mass(bitmap);
  }
#line 95
  goto switch_break;
  case_5: /* CIL Label */ 
#line 97
  *((int32 *)*(artifacts + 5) + i) = -1;
#line 98
  goto switch_break;
  case_2: /* CIL Label */ 
#line 100
  *((unsigned char *)*(artifacts + 2) + i) = (unsigned char)0;
#line 101
  goto switch_break;
  case_3: /* CIL Label */ 
#line 103
  *((unsigned char *)*(artifacts + 3) + i) = (unsigned char)0;
#line 104
  goto switch_break;
  case_7: /* CIL Label */ 
  case_6: /* CIL Label */ ;
  switch_break: /* CIL Label */ ;
  }
#line 108
  return;
}
}
#line 110 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
static void initialize_artifacts(void **artifacts , mdjvu_bitmap_t bitmap ) 
{ 
  int a ;

  {
#line 113
  a = 0;
  {
#line 113
  while (1) {
    while_continue: /* CIL Label */ ;
#line 113
    if (! (a < 7)) {
#line 113
      goto while_break;
    }
#line 115
    if (*(artifacts + a)) {
      {
#line 116
      initialize_artifact(artifacts, bitmap, (mdjvu_artifact_type_enum )a);
      }
    }
#line 113
    a ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 119
  return;
}
}
#line 121 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
static void mdjvu_image_enable_artifact(mdjvu_image_t image , mdjvu_artifact_type_enum artifact_index ) 
{ 
  int32 i ;
  int32 n ;

  {
#line 125
  n = ((Image___0 *)image)->bitmaps_count;
#line 126
  if (! ((Image___0 *)image)->artifacts[artifact_index]) {
    {
#line 128
    ((Image___0 *)image)->artifacts[artifact_index] = malloc((size_t )(((Image___0 *)image)->bitmaps_allocated * (int32 )artifact_sizes[artifact_index]));
    }
  }
#line 131
  i = 0;
  {
#line 131
  while (1) {
    while_continue: /* CIL Label */ ;
#line 131
    if (! (i < n)) {
#line 131
      goto while_break;
    }
    {
#line 133
    initialize_artifact(((Image___0 *)image)->artifacts, *(((Image___0 *)image)->bitmaps + i),
                        artifact_index);
#line 131
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 135
  return;
}
}
#line 137 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
static void mdjvu_image_disable_artifact(mdjvu_image_t image , mdjvu_artifact_type_enum artifact_index ) 
{ 


  {
#line 140
  if (((Image___0 *)image)->artifacts[artifact_index]) {
    {
#line 142
    free(((Image___0 *)image)->artifacts[artifact_index]);
#line 143
    ((Image___0 *)image)->artifacts[artifact_index] = (void *)0;
    }
  }
#line 145
  return;
}
}
#line 150 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
mdjvu_image_t mdjvu_image_create(int32 width , int32 height ) 
{ 
  int i ;
  Image___0 *image ;
  void *tmp ;
  void *tmp___0 ;
  void *tmp___1 ;
  void *tmp___2 ;
  void *tmp___3 ;

  {
  {
#line 153
  tmp = malloc(sizeof(Image___0 ));
#line 153
  image = (Image___0 *)tmp;
#line 155
  mdjvu_init();
#line 157
  image->width = width;
#line 158
  image->height = height;
#line 160
  image->bitmaps_allocated = 16;
#line 161
  tmp___0 = malloc((unsigned long )image->bitmaps_allocated * sizeof(mdjvu_bitmap_t ));
#line 161
  image->bitmaps = (mdjvu_bitmap_t *)tmp___0;
#line 163
  image->bitmaps_count = 0;
#line 165
  image->blits_allocated = 32;
#line 166
  tmp___1 = malloc((unsigned long )image->blits_allocated * sizeof(int32 ));
#line 166
  image->x = (int32 *)tmp___1;
#line 167
  tmp___2 = malloc((unsigned long )image->blits_allocated * sizeof(int32 ));
#line 167
  image->y = (int32 *)tmp___2;
#line 168
  tmp___3 = malloc((unsigned long )image->blits_allocated * sizeof(mdjvu_bitmap_t ));
#line 168
  image->blits = (mdjvu_bitmap_t *)tmp___3;
#line 170
  image->blits_count = 0;
#line 172
  image->dictionary = (mdjvu_image_t )((void *)0);
#line 173
  image->resolution = 0;
#line 175
  i = 0;
  }
  {
#line 175
  while (1) {
    while_continue: /* CIL Label */ ;
#line 175
    if (! (i < 7)) {
#line 175
      goto while_break;
    }
#line 176
    image->artifacts[i] = (void *)0;
#line 175
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 178
  return ((mdjvu_image_t )image);
}
}
#line 183 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_destroy(mdjvu_image_t image ) 
{ 
  int32 i ;
  int k ;

  {
  {
#line 187
  free((void *)((Image___0 *)image)->blits);
#line 188
  free((void *)((Image___0 *)image)->x);
#line 189
  free((void *)((Image___0 *)image)->y);
#line 190
  k = 0;
  }
  {
#line 190
  while (1) {
    while_continue: /* CIL Label */ ;
#line 190
    if (! (k < 7)) {
#line 190
      goto while_break;
    }
    {
#line 192
    mdjvu_image_disable_artifact(image, (mdjvu_artifact_type_enum )k);
#line 190
    k ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 194
  i = 0;
  {
#line 194
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 194
    if (! (i < ((Image___0 *)image)->bitmaps_count)) {
#line 194
      goto while_break___0;
    }
    {
#line 195
    mdjvu_bitmap_destroy(*(((Image___0 *)image)->bitmaps + i));
#line 194
    i ++;
    }
  }
  while_break___0: /* CIL Label */ ;
  }
  {
#line 196
  free((void *)((Image___0 *)image)->bitmaps);
#line 197
  free((void *)((Image___0 *)image));
  }
#line 198
  return;
}
}
#line 202 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_get_width(mdjvu_image_t image ) 
{ 


  {
#line 203
  return (((Image___0 *)image)->width);
}
}
#line 205 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_get_height(mdjvu_image_t image ) 
{ 


  {
#line 206
  return (((Image___0 *)image)->height);
}
}
#line 208 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_get_bitmap_count(mdjvu_image_t image ) 
{ 


  {
#line 209
  return (((Image___0 *)image)->bitmaps_count);
}
}
#line 211 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_get_blit_count(mdjvu_image_t image ) 
{ 


  {
#line 212
  return (((Image___0 *)image)->blits_count);
}
}
#line 214 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_dictionary(mdjvu_image_t image , mdjvu_image_t dict ) 
{ 


  {
#line 216
  ((Image___0 *)image)->dictionary = dict;
#line 217
  return;
}
}
#line 219 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
mdjvu_image_t mdjvu_image_get_dictionary(mdjvu_image_t image ) 
{ 


  {
#line 221
  return (((Image___0 *)image)->dictionary);
}
}
#line 227 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_add_bitmap(mdjvu_image_t image , mdjvu_bitmap_t bmp ) 
{ 
  int i ;
  void *tmp ;
  int32 tmp___0 ;

  {
#line 229
  if (((Image___0 *)image)->bitmaps_count == ((Image___0 *)image)->bitmaps_allocated) {
    {
#line 232
    ((Image___0 *)image)->bitmaps_allocated <<= 1;
#line 233
    tmp = realloc((void *)((Image___0 *)image)->bitmaps, (unsigned long )((Image___0 *)image)->bitmaps_allocated * sizeof(mdjvu_bitmap_t ));
#line 233
    ((Image___0 *)image)->bitmaps = (mdjvu_bitmap_t *)tmp;
#line 235
    i = 0;
    }
    {
#line 235
    while (1) {
      while_continue: /* CIL Label */ ;
#line 235
      if (! (i < 7)) {
#line 235
        goto while_break;
      }
#line 237
      if (((Image___0 *)image)->artifacts[i]) {
        {
#line 239
        ((Image___0 *)image)->artifacts[i] = realloc(((Image___0 *)image)->artifacts[i],
                                                     (size_t )(((Image___0 *)image)->bitmaps_allocated * (int32 )artifact_sizes[i]));
        }
      }
#line 235
      i ++;
    }
    while_break: /* CIL Label */ ;
    }
  }
  {
#line 244
  *(((Image___0 *)image)->bitmaps + ((Image___0 *)image)->bitmaps_count) = bmp;
#line 245
  mdjvu_bitmap_set_index(bmp, ((Image___0 *)image)->bitmaps_count);
#line 246
  initialize_artifacts(((Image___0 *)image)->artifacts, bmp);
#line 247
  tmp___0 = ((Image___0 *)image)->bitmaps_count;
#line 247
  (((Image___0 *)image)->bitmaps_count) ++;
  }
#line 247
  return (tmp___0);
}
}
#line 250 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_has_bitmap(mdjvu_image_t image , mdjvu_bitmap_t bitmap ) 
{ 
  int32 i ;
  int32 tmp ;

  {
  {
#line 252
  tmp = mdjvu_bitmap_get_index(bitmap);
#line 252
  i = tmp;
  }
#line 253
  if (i >= ((Image___0 *)image)->bitmaps_count) {
#line 253
    return (0);
  }
#line 254
  return ((unsigned long )bitmap == (unsigned long )*(((Image___0 *)image)->bitmaps + i));
}
}
#line 257 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
mdjvu_bitmap_t mdjvu_image_get_bitmap(mdjvu_image_t image , int32 i ) 
{ 


  {
#line 259
  return (*(((Image___0 *)image)->bitmaps + i));
}
}
#line 262 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
mdjvu_bitmap_t mdjvu_image_new_bitmap(mdjvu_image_t image , int32 w , int32 h ) 
{ 
  mdjvu_bitmap_t bmp ;
  mdjvu_bitmap_t tmp ;

  {
  {
#line 264
  tmp = mdjvu_bitmap_create(w, h);
#line 264
  bmp = tmp;
#line 265
  mdjvu_image_add_bitmap(image, bmp);
  }
#line 266
  return (bmp);
}
}
#line 269 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_exchange_bitmaps(mdjvu_image_t image , int32 i1 , int32 i2 ) 
{ 
  int a ;
  mdjvu_bitmap_t b1 ;
  mdjvu_bitmap_t b2 ;
  char buf[16] ;

  {
#line 273
  b1 = *(((Image___0 *)image)->bitmaps + i1);
#line 273
  b2 = *(((Image___0 *)image)->bitmaps + i2);
#line 274
  if (i1 == i2) {
#line 274
    return;
  }
  {
#line 276
  *(((Image___0 *)image)->bitmaps + i1) = b2;
#line 277
  *(((Image___0 *)image)->bitmaps + i2) = b1;
#line 278
  mdjvu_bitmap_set_index(b1, i2);
#line 279
  mdjvu_bitmap_set_index(b2, i1);
#line 281
  a = 0;
  }
  {
#line 281
  while (1) {
    while_continue: /* CIL Label */ ;
#line 281
    if (! (a < 7)) {
#line 281
      goto while_break;
    }
#line 283
    if (((Image___0 *)image)->artifacts[a]) {
      {
#line 286
      memcpy((void */* __restrict  */)(buf), (void const   */* __restrict  */)((char *)((Image___0 *)image)->artifacts[a] + i1 * (int32 )artifact_sizes[a]),
             (size_t )artifact_sizes[a]);
#line 289
      memcpy((void */* __restrict  */)((char *)((Image___0 *)image)->artifacts[a] + i1 * (int32 )artifact_sizes[a]),
             (void const   */* __restrict  */)((char *)((Image___0 *)image)->artifacts[a] + i2 * (int32 )artifact_sizes[a]),
             (size_t )artifact_sizes[a]);
#line 292
      memcpy((void */* __restrict  */)((char *)((Image___0 *)image)->artifacts[a] + i2 * (int32 )artifact_sizes[a]),
             (void const   */* __restrict  */)(buf), (size_t )artifact_sizes[a]);
      }
    }
#line 281
    a ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 297
  return;
}
}
#line 299 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_check_indices(mdjvu_image_t image ) 
{ 
  int32 n ;
  int32 i ;
  int32 tmp ;

  {
#line 301
  n = ((Image___0 *)image)->bitmaps_count;
#line 303
  i = 0;
  {
#line 303
  while (1) {
    while_continue: /* CIL Label */ ;
#line 303
    if (! (i < n)) {
#line 303
      goto while_break;
    }
    {
#line 305
    tmp = mdjvu_bitmap_get_index(*(((Image___0 *)image)->bitmaps + i));
    }
#line 305
    if (tmp != i) {
#line 306
      return (0);
    }
#line 303
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 308
  return (1);
}
}
#line 311 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_remove_unused_bitmaps(mdjvu_image_t image ) 
{ 
  int32 b ;
  int32 n ;
  int32 i ;
  int32 filled ;
  int32 *use_count ;
  void *tmp ;
  mdjvu_bitmap_t *new_bitmaps ;
  int32 new_bitmaps_count ;
  int32 a ;
  void *new_artifacts[7] ;
  mdjvu_bitmap_t bmp ;
  int32 tmp___0 ;
  int tmp___1 ;
  void *tmp___2 ;
  int32 tmp___3 ;

  {
  {
#line 313
  b = ((Image___0 *)image)->blits_count;
#line 314
  n = ((Image___0 *)image)->bitmaps_count;
#line 316
  tmp = calloc((size_t )n, sizeof(int32 ));
#line 316
  use_count = (int32 *)tmp;
#line 321
  i = 0;
  }
  {
#line 321
  while (1) {
    while_continue: /* CIL Label */ ;
#line 321
    if (! (i < b)) {
#line 321
      goto while_break;
    }
    {
#line 323
    bmp = *(((Image___0 *)image)->blits + i);
#line 324
    tmp___1 = mdjvu_image_has_bitmap(image, bmp);
    }
#line 324
    if (tmp___1) {
      {
#line 325
      tmp___0 = mdjvu_bitmap_get_index(bmp);
#line 325
      (*(use_count + tmp___0)) ++;
      }
    }
#line 321
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 328
  new_bitmaps_count = 0;
#line 329
  i = 0;
  {
#line 329
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 329
    if (! (i < n)) {
#line 329
      goto while_break___0;
    }
#line 331
    if (*(use_count + i)) {
#line 332
      new_bitmaps_count ++;
    }
#line 329
    i ++;
  }
  while_break___0: /* CIL Label */ ;
  }
  {
#line 336
  tmp___2 = malloc((unsigned long )new_bitmaps_count * sizeof(mdjvu_bitmap_t ));
#line 336
  new_bitmaps = (mdjvu_bitmap_t *)tmp___2;
#line 338
  a = 0;
  }
  {
#line 338
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 338
    if (! (a < 7)) {
#line 338
      goto while_break___1;
    }
#line 340
    if (((Image___0 *)image)->artifacts[a]) {
      {
#line 341
      new_artifacts[a] = malloc((size_t )(new_bitmaps_count * (int32 )artifact_sizes[a]));
      }
    } else {
#line 343
      new_artifacts[a] = (void *)0;
    }
#line 338
    a ++;
  }
  while_break___1: /* CIL Label */ ;
  }
#line 346
  filled = 0;
#line 347
  i = 0;
  {
#line 347
  while (1) {
    while_continue___2: /* CIL Label */ ;
#line 347
    if (! (i < n)) {
#line 347
      goto while_break___2;
    }
#line 349
    if (*(use_count + i)) {
      {
#line 351
      mdjvu_bitmap_set_index(*(((Image___0 *)image)->bitmaps + i), filled);
#line 352
      *(new_bitmaps + filled) = *(((Image___0 *)image)->bitmaps + i);
#line 353
      a = 0;
      }
      {
#line 353
      while (1) {
        while_continue___3: /* CIL Label */ ;
#line 353
        if (! (a < 7)) {
#line 353
          goto while_break___3;
        }
#line 355
        if (((Image___0 *)image)->artifacts[a]) {
          {
#line 357
          memcpy((void */* __restrict  */)((char *)new_artifacts[a] + filled * (int32 )artifact_sizes[a]),
                 (void const   */* __restrict  */)((char *)((Image___0 *)image)->artifacts[a] + i * (int32 )artifact_sizes[a]),
                 (size_t )artifact_sizes[a]);
          }
        }
#line 353
        a ++;
      }
      while_break___3: /* CIL Label */ ;
      }
#line 362
      filled ++;
    } else {
      {
#line 365
      mdjvu_bitmap_destroy(*(((Image___0 *)image)->bitmaps + i));
      }
    }
#line 347
    i ++;
  }
  while_break___2: /* CIL Label */ ;
  }
  {
#line 368
  free((void *)use_count);
#line 369
  free((void *)((Image___0 *)image)->bitmaps);
#line 370
  ((Image___0 *)image)->bitmaps = new_bitmaps;
#line 371
  tmp___3 = new_bitmaps_count;
#line 371
  ((Image___0 *)image)->bitmaps_allocated = tmp___3;
#line 371
  ((Image___0 *)image)->bitmaps_count = tmp___3;
#line 373
  a = 0;
  }
  {
#line 373
  while (1) {
    while_continue___4: /* CIL Label */ ;
#line 373
    if (! (a < 7)) {
#line 373
      goto while_break___4;
    }
#line 375
    if (((Image___0 *)image)->artifacts[a]) {
      {
#line 377
      free(((Image___0 *)image)->artifacts[a]);
#line 378
      ((Image___0 *)image)->artifacts[a] = new_artifacts[a];
      }
    }
#line 373
    a ++;
  }
  while_break___4: /* CIL Label */ ;
  }
#line 382
  return;
}
}
#line 387 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_add_blit(mdjvu_image_t image , int32 x , int32 y , mdjvu_bitmap_t bitmap ) 
{ 
  void *tmp ;
  void *tmp___0 ;
  void *tmp___1 ;
  int32 tmp___2 ;

  {
#line 391
  if (((Image___0 *)image)->blits_count == ((Image___0 *)image)->blits_allocated) {
    {
#line 393
    ((Image___0 *)image)->blits_allocated <<= 1;
#line 394
    tmp = realloc((void *)((Image___0 *)image)->x, (unsigned long )((Image___0 *)image)->blits_allocated * sizeof(int32 ));
#line 394
    ((Image___0 *)image)->x = (int32 *)tmp;
#line 396
    tmp___0 = realloc((void *)((Image___0 *)image)->y, (unsigned long )((Image___0 *)image)->blits_allocated * sizeof(int32 ));
#line 396
    ((Image___0 *)image)->y = (int32 *)tmp___0;
#line 398
    tmp___1 = realloc((void *)((Image___0 *)image)->blits, (unsigned long )((Image___0 *)image)->blits_allocated * sizeof(mdjvu_bitmap_t ));
#line 398
    ((Image___0 *)image)->blits = (mdjvu_bitmap_t *)tmp___1;
    }
  }
#line 401
  *(((Image___0 *)image)->x + ((Image___0 *)image)->blits_count) = x;
#line 402
  *(((Image___0 *)image)->y + ((Image___0 *)image)->blits_count) = y;
#line 403
  *(((Image___0 *)image)->blits + ((Image___0 *)image)->blits_count) = bitmap;
#line 404
  tmp___2 = ((Image___0 *)image)->blits_count;
#line 404
  (((Image___0 *)image)->blits_count) ++;
#line 404
  return (tmp___2);
}
}
#line 407 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_remove_NULL_blits(mdjvu_image_t image ) 
{ 
  int32 *new_x ;
  void *tmp ;
  int32 *new_y ;
  void *tmp___0 ;
  mdjvu_bitmap_t *new_blits ;
  void *tmp___1 ;
  int32 filled ;
  int32 i ;

  {
  {
#line 409
  tmp = malloc((unsigned long )((Image___0 *)image)->blits_count * sizeof(int32 ));
#line 409
  new_x = (int32 *)tmp;
#line 410
  tmp___0 = malloc((unsigned long )((Image___0 *)image)->blits_count * sizeof(int32 ));
#line 410
  new_y = (int32 *)tmp___0;
#line 411
  tmp___1 = malloc((unsigned long )((Image___0 *)image)->blits_count * sizeof(mdjvu_bitmap_t ));
#line 411
  new_blits = (mdjvu_bitmap_t *)tmp___1;
#line 413
  filled = 0;
#line 415
  i = 0;
  }
  {
#line 415
  while (1) {
    while_continue: /* CIL Label */ ;
#line 415
    if (! (i < ((Image___0 *)image)->blits_count)) {
#line 415
      goto while_break;
    }
#line 417
    if (*(((Image___0 *)image)->blits + i)) {
#line 419
      *(new_x + filled) = *(((Image___0 *)image)->x + i);
#line 420
      *(new_y + filled) = *(((Image___0 *)image)->y + i);
#line 421
      *(new_blits + filled) = *(((Image___0 *)image)->blits + i);
#line 422
      filled ++;
    }
#line 415
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 426
  free((void *)((Image___0 *)image)->x);
#line 427
  free((void *)((Image___0 *)image)->y);
#line 428
  free((void *)((Image___0 *)image)->blits);
#line 429
  ((Image___0 *)image)->x = new_x;
#line 430
  ((Image___0 *)image)->y = new_y;
#line 431
  ((Image___0 *)image)->blits = new_blits;
#line 432
  ((Image___0 *)image)->blits_allocated = ((Image___0 *)image)->blits_count;
#line 433
  ((Image___0 *)image)->blits_count = filled;
  }
#line 434
  return;
}
}
#line 437 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_get_blit_x(mdjvu_image_t image , int32 i ) 
{ 


  {
#line 439
  if (i >= 0) {
#line 439
    if (! (i < ((Image___0 *)image)->blits_count)) {
      {
#line 439
      __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                    439U, "mdjvu_image_get_blit_x");
      }
    }
  } else {
    {
#line 439
    __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                  439U, "mdjvu_image_get_blit_x");
    }
  }
#line 440
  return (*(((Image___0 *)image)->x + i));
}
}
#line 443 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_get_blit_y(mdjvu_image_t image , int32 i ) 
{ 


  {
#line 445
  if (i >= 0) {
#line 445
    if (! (i < ((Image___0 *)image)->blits_count)) {
      {
#line 445
      __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                    445U, "mdjvu_image_get_blit_y");
      }
    }
  } else {
    {
#line 445
    __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                  445U, "mdjvu_image_get_blit_y");
    }
  }
#line 446
  return (*(((Image___0 *)image)->y + i));
}
}
#line 449 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_blit_x(mdjvu_image_t image , int32 i , int32 x ) 
{ 


  {
#line 451
  if (i >= 0) {
#line 451
    if (! (i < ((Image___0 *)image)->blits_count)) {
      {
#line 451
      __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                    451U, "mdjvu_image_set_blit_x");
      }
    }
  } else {
    {
#line 451
    __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                  451U, "mdjvu_image_set_blit_x");
    }
  }
#line 452
  *(((Image___0 *)image)->x + i) = x;
#line 453
  return;
}
}
#line 455 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_blit_y(mdjvu_image_t image , int32 i , int32 y ) 
{ 


  {
#line 457
  if (i >= 0) {
#line 457
    if (! (i < ((Image___0 *)image)->blits_count)) {
      {
#line 457
      __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                    457U, "mdjvu_image_set_blit_y");
      }
    }
  } else {
    {
#line 457
    __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                  457U, "mdjvu_image_set_blit_y");
    }
  }
#line 458
  *(((Image___0 *)image)->y + i) = y;
#line 459
  return;
}
}
#line 461 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
mdjvu_bitmap_t mdjvu_image_get_blit_bitmap(mdjvu_image_t image , int32 i ) 
{ 


  {
#line 464
  if (i >= 0) {
#line 464
    if (! (i < ((Image___0 *)image)->blits_count)) {
      {
#line 464
      __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                    464U, "mdjvu_image_get_blit_bitmap");
      }
    }
  } else {
    {
#line 464
    __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                  464U, "mdjvu_image_get_blit_bitmap");
    }
  }
#line 465
  return (*(((Image___0 *)image)->blits + i));
}
}
#line 468 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_blit_bitmap(mdjvu_image_t image , int32 i , mdjvu_bitmap_t b ) 
{ 


  {
#line 470
  if (i >= 0) {
#line 470
    if (! (i < ((Image___0 *)image)->blits_count)) {
      {
#line 470
      __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                    470U, "mdjvu_image_set_blit_bitmap");
      }
    }
  } else {
    {
#line 470
    __assert_fail("i >= 0 && i < ((Image *) image)->blits_count", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c",
                  470U, "mdjvu_image_set_blit_bitmap");
    }
  }
#line 471
  *(((Image___0 *)image)->blits + i) = b;
#line 472
  return;
}
}
#line 475 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_exchange_blits(mdjvu_image_t image , int32 i , int32 j ) 
{ 
  int32 t ;
  mdjvu_bitmap_t b ;

  {
#line 478
  if (i == j) {
#line 478
    return;
  }
#line 479
  t = *(((Image___0 *)image)->x + i);
#line 479
  *(((Image___0 *)image)->x + i) = *(((Image___0 *)image)->x + j);
#line 479
  *(((Image___0 *)image)->x + j) = t;
#line 480
  t = *(((Image___0 *)image)->y + i);
#line 480
  *(((Image___0 *)image)->y + i) = *(((Image___0 *)image)->y + j);
#line 480
  *(((Image___0 *)image)->y + j) = t;
#line 481
  b = *(((Image___0 *)image)->blits + i);
#line 481
  *(((Image___0 *)image)->blits + i) = *(((Image___0 *)image)->blits + j);
#line 481
  *(((Image___0 *)image)->blits + j) = b;
#line 482
  return;
}
}
#line 487 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_get_resolution(mdjvu_image_t image ) 
{ 


  {
#line 489
  return (((Image___0 *)image)->resolution);
}
}
#line 492 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_resolution(mdjvu_image_t image , int32 dpi___0 ) 
{ 


  {
#line 494
  ((Image___0 *)image)->resolution = dpi___0;
#line 495
  return;
}
}
#line 500 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_enable_prototypes(mdjvu_image_t image ) 
{ 


  {
  {
#line 501
  mdjvu_image_enable_artifact(image, (mdjvu_artifact_type_enum )0);
  }
#line 501
  return;
}
}
#line 503 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_enable_substitutions(mdjvu_image_t image ) 
{ 


  {
  {
#line 504
  mdjvu_image_enable_artifact(image, (mdjvu_artifact_type_enum )1);
  }
#line 504
  return;
}
}
#line 506 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_enable_masses(mdjvu_image_t image ) 
{ 


  {
  {
#line 507
  mdjvu_image_enable_artifact(image, (mdjvu_artifact_type_enum )4);
  }
#line 507
  return;
}
}
#line 509 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_enable_dictionary_indices(mdjvu_image_t image ) 
{ 


  {
  {
#line 510
  mdjvu_image_enable_artifact(image, (mdjvu_artifact_type_enum )5);
  }
#line 510
  return;
}
}
#line 512 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_enable_suspiciously_big_flags(mdjvu_image_t image ) 
{ 


  {
  {
#line 513
  mdjvu_image_enable_artifact(image, (mdjvu_artifact_type_enum )3);
  }
#line 513
  return;
}
}
#line 515 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_enable_not_a_letter_flags(mdjvu_image_t image ) 
{ 


  {
  {
#line 516
  mdjvu_image_enable_artifact(image, (mdjvu_artifact_type_enum )2);
  }
#line 516
  return;
}
}
#line 518 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_enable_centers(mdjvu_image_t image ) 
{ 


  {
  {
#line 519
  mdjvu_image_enable_artifact(image, (mdjvu_artifact_type_enum )6);
  }
#line 519
  return;
}
}
#line 522 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_disable_prototypes(mdjvu_image_t image ) 
{ 


  {
  {
#line 523
  mdjvu_image_disable_artifact(image, (mdjvu_artifact_type_enum )0);
  }
#line 523
  return;
}
}
#line 525 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_disable_substitutions(mdjvu_image_t image ) 
{ 


  {
  {
#line 526
  mdjvu_image_disable_artifact(image, (mdjvu_artifact_type_enum )1);
  }
#line 526
  return;
}
}
#line 528 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_disable_masses(mdjvu_image_t image ) 
{ 


  {
  {
#line 529
  mdjvu_image_disable_artifact(image, (mdjvu_artifact_type_enum )4);
  }
#line 529
  return;
}
}
#line 531 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_disable_dictionary_indices(mdjvu_image_t image ) 
{ 


  {
  {
#line 532
  mdjvu_image_disable_artifact(image, (mdjvu_artifact_type_enum )5);
  }
#line 532
  return;
}
}
#line 534 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_disable_suspiciously_big_flags(mdjvu_image_t image ) 
{ 


  {
  {
#line 535
  mdjvu_image_disable_artifact(image, (mdjvu_artifact_type_enum )3);
  }
#line 535
  return;
}
}
#line 537 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_disable_not_a_letter_flags(mdjvu_image_t image ) 
{ 


  {
  {
#line 538
  mdjvu_image_disable_artifact(image, (mdjvu_artifact_type_enum )2);
  }
#line 538
  return;
}
}
#line 540 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_disable_centers(mdjvu_image_t image ) 
{ 


  {
  {
#line 541
  mdjvu_image_disable_artifact(image, (mdjvu_artifact_type_enum )6);
  }
#line 541
  return;
}
}
#line 544 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_has_prototypes(mdjvu_image_t image ) 
{ 


  {
#line 545
  return ((unsigned long )((Image___0 *)image)->artifacts[0] != (unsigned long )((void *)0));
}
}
#line 547 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_has_substitutions(mdjvu_image_t image ) 
{ 


  {
#line 548
  return ((unsigned long )((Image___0 *)image)->artifacts[1] != (unsigned long )((void *)0));
}
}
#line 550 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_has_masses(mdjvu_image_t image ) 
{ 


  {
#line 551
  return ((unsigned long )((Image___0 *)image)->artifacts[4] != (unsigned long )((void *)0));
}
}
#line 553 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_has_dictionary_indices(mdjvu_image_t image ) 
{ 


  {
#line 554
  return ((unsigned long )((Image___0 *)image)->artifacts[5] != (unsigned long )((void *)0));
}
}
#line 556 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_has_suspiciously_big_flags(mdjvu_image_t image ) 
{ 


  {
#line 557
  return ((unsigned long )((Image___0 *)image)->artifacts[3] != (unsigned long )((void *)0));
}
}
#line 559 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_has_not_a_letter_flags(mdjvu_image_t image ) 
{ 


  {
#line 560
  return ((unsigned long )((Image___0 *)image)->artifacts[2] != (unsigned long )((void *)0));
}
}
#line 562 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_has_centers(mdjvu_image_t image ) 
{ 


  {
#line 563
  return ((unsigned long )((Image___0 *)image)->artifacts[6] != (unsigned long )((void *)0));
}
}
#line 566 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_get_not_a_letter_flag(mdjvu_image_t image , mdjvu_bitmap_t b ) 
{ 
  int32 tmp ;

  {
  {
#line 568
  tmp = mdjvu_bitmap_get_index(b);
  }
#line 568
  return ((int )*((unsigned char *)((Image___0 *)image)->artifacts[2] + tmp));
}
}
#line 572 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_not_a_letter_flag(mdjvu_image_t image , mdjvu_bitmap_t b , int v ) 
{ 
  int32 tmp ;

  {
  {
#line 574
  tmp = mdjvu_bitmap_get_index(b);
  }
#line 574
  if (v) {
#line 574
    *((unsigned char *)((Image___0 *)image)->artifacts[2] + tmp) = (unsigned char)1;
  } else {
#line 574
    *((unsigned char *)((Image___0 *)image)->artifacts[2] + tmp) = (unsigned char)0;
  }
#line 576
  return;
}
}
#line 578 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int mdjvu_image_get_suspiciously_big_flag(mdjvu_image_t image , mdjvu_bitmap_t b ) 
{ 
  int32 tmp ;

  {
  {
#line 580
  tmp = mdjvu_bitmap_get_index(b);
  }
#line 580
  return ((int )*((unsigned char *)((Image___0 *)image)->artifacts[3] + tmp));
}
}
#line 584 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_suspiciously_big_flag(mdjvu_image_t image , mdjvu_bitmap_t b ,
                                           int v ) 
{ 
  int32 tmp ;

  {
  {
#line 586
  tmp = mdjvu_bitmap_get_index(b);
  }
#line 586
  if (v) {
#line 586
    *((unsigned char *)((Image___0 *)image)->artifacts[3] + tmp) = (unsigned char)1;
  } else {
#line 586
    *((unsigned char *)((Image___0 *)image)->artifacts[3] + tmp) = (unsigned char)0;
  }
#line 588
  return;
}
}
#line 590 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
mdjvu_bitmap_t mdjvu_image_get_prototype(mdjvu_image_t image , mdjvu_bitmap_t b ) 
{ 
  int32 tmp ;

  {
  {
#line 592
  tmp = mdjvu_bitmap_get_index(b);
  }
#line 592
  return (*((mdjvu_bitmap_t *)((Image___0 *)image)->artifacts[0] + tmp));
}
}
#line 596 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_prototype(mdjvu_image_t image , mdjvu_bitmap_t b , mdjvu_bitmap_t prototype ) 
{ 
  int32 tmp ;

  {
  {
#line 598
  tmp = mdjvu_bitmap_get_index(b);
#line 598
  *((mdjvu_bitmap_t *)((Image___0 *)image)->artifacts[0] + tmp) = prototype;
  }
#line 600
  return;
}
}
#line 602 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
mdjvu_bitmap_t mdjvu_image_get_substitution(mdjvu_image_t image , mdjvu_bitmap_t b ) 
{ 
  mdjvu_bitmap_t subst ;
  int32 tmp ;
  mdjvu_bitmap_t tmp___0 ;

  {
#line 605
  if (! ((Image___0 *)image)->artifacts[1]) {
#line 605
    return (b);
  }
#line 606
  if (! b) {
#line 606
    return (b);
  }
  {
#line 607
  tmp = mdjvu_bitmap_get_index(b);
#line 607
  subst = *((mdjvu_bitmap_t *)((Image___0 *)image)->artifacts[1] + tmp);
  }
#line 610
  if (subst) {
#line 610
    tmp___0 = subst;
  } else {
#line 610
    tmp___0 = b;
  }
#line 610
  return (tmp___0);
}
}
#line 613 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_get_mass(mdjvu_image_t image , mdjvu_bitmap_t b ) 
{ 
  int32 tmp ;

  {
  {
#line 615
  tmp = mdjvu_bitmap_get_index(b);
  }
#line 615
  return (*((int32 *)((Image___0 *)image)->artifacts[4] + tmp));
}
}
#line 618 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
int32 mdjvu_image_get_dictionary_index(mdjvu_image_t image , mdjvu_bitmap_t b ) 
{ 
  int32 tmp ;

  {
  {
#line 620
  tmp = mdjvu_bitmap_get_index(b);
  }
#line 620
  return (*((int32 *)((Image___0 *)image)->artifacts[5] + tmp));
}
}
#line 622 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_dictionary_index(mdjvu_image_t image , mdjvu_bitmap_t b , int32 v ) 
{ 
  int32 tmp ;

  {
  {
#line 624
  tmp = mdjvu_bitmap_get_index(b);
#line 624
  *((int32 *)((Image___0 *)image)->artifacts[5] + tmp) = v;
  }
#line 625
  return;
}
}
#line 627 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_substitution(mdjvu_image_t image , mdjvu_bitmap_t b , mdjvu_bitmap_t s ) 
{ 
  int tmp ;
  int32 tmp___0 ;

  {
#line 629
  if (s) {
#line 629
    if ((unsigned long )b != (unsigned long )s) {
      {
#line 629
      tmp = mdjvu_image_has_bitmap(image, s);
      }
#line 629
      if (tmp) {
        {
#line 630
        s = mdjvu_image_get_substitution(image, s);
        }
      }
    }
  }
  {
#line 632
  tmp___0 = mdjvu_bitmap_get_index(b);
#line 632
  *((mdjvu_bitmap_t *)((Image___0 *)image)->artifacts[1] + tmp___0) = s;
  }
#line 634
  return;
}
}
#line 636 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_get_center(mdjvu_image_t image , mdjvu_bitmap_t b , int32 *px , int32 *py ) 
{ 
  Point *p ;
  int32 i ;
  int32 tmp ;

  {
  {
#line 638
  p = (Point *)((Image___0 *)image)->artifacts[6];
#line 639
  tmp = mdjvu_bitmap_get_index(b);
#line 639
  i = tmp;
#line 640
  *px = (p + i)->x;
#line 641
  *py = (p + i)->y;
  }
#line 642
  return;
}
}
#line 644 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_set_center(mdjvu_image_t image , mdjvu_bitmap_t b , int32 x , int32 y ) 
{ 
  Point *p ;
  int32 i ;
  int32 tmp ;

  {
  {
#line 646
  p = (Point *)((Image___0 *)image)->artifacts[6];
#line 647
  tmp = mdjvu_bitmap_get_index(b);
#line 647
  i = tmp;
#line 648
  (p + i)->x = x;
#line 649
  (p + i)->y = y;
  }
#line 650
  return;
}
}
#line 656 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_sort_bitmaps(mdjvu_image_t img ) 
{ 
  int32 blit_count ;
  int32 tmp ;
  int32 blits_passed ;
  int32 shapes_passed ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___0 ;
  int32 i ;
  int32 tmp___1 ;

  {
  {
#line 658
  tmp = mdjvu_image_get_blit_count(img);
#line 658
  blit_count = tmp;
#line 659
  shapes_passed = 0;
#line 660
  blits_passed = 0;
  }
  {
#line 660
  while (1) {
    while_continue: /* CIL Label */ ;
#line 660
    if (! (blits_passed < blit_count)) {
#line 660
      goto while_break;
    }
    {
#line 662
    tmp___0 = mdjvu_image_get_blit_bitmap(img, blits_passed);
#line 662
    bitmap = tmp___0;
#line 663
    tmp___1 = mdjvu_bitmap_get_index(bitmap);
#line 663
    i = tmp___1;
    }
#line 664
    if (i < shapes_passed) {
#line 664
      goto __Cont;
    }
    {
#line 665
    mdjvu_image_exchange_bitmaps(img, shapes_passed, i);
#line 666
    shapes_passed ++;
    }
    __Cont: /* CIL Label */ 
#line 660
    blits_passed ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 668
  return;
}
}
#line 673 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
void mdjvu_image_remove_bitmap_margins(mdjvu_image_t image ) 
{ 
  int32 *delta_x ;
  int32 *delta_y ;
  int32 n ;
  int32 b ;
  int32 i ;
  void *tmp ;
  void *tmp___0 ;
  int32 blit_index ;
  int32 tmp___1 ;

  {
  {
#line 676
  n = ((Image___0 *)image)->bitmaps_count;
#line 677
  b = ((Image___0 *)image)->blits_count;
#line 680
  tmp = malloc((unsigned long )n * sizeof(int32 ));
#line 680
  delta_x = (int32 *)tmp;
#line 681
  tmp___0 = malloc((unsigned long )n * sizeof(int32 ));
#line 681
  delta_y = (int32 *)tmp___0;
#line 683
  i = 0;
  }
  {
#line 683
  while (1) {
    while_continue: /* CIL Label */ ;
#line 683
    if (! (i < n)) {
#line 683
      goto while_break;
    }
    {
#line 684
    mdjvu_bitmap_remove_margins(*(((Image___0 *)image)->bitmaps + i), delta_x + i,
                                delta_y + i);
#line 683
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 686
  i = 0;
  {
#line 686
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 686
    if (! (i < b)) {
#line 686
      goto while_break___0;
    }
    {
#line 688
    tmp___1 = mdjvu_bitmap_get_index(*(((Image___0 *)image)->blits + i));
#line 688
    blit_index = tmp___1;
#line 689
    *(((Image___0 *)image)->x + i) += *(delta_x + blit_index);
#line 690
    *(((Image___0 *)image)->y + i) += *(delta_y + blit_index);
#line 686
    i ++;
    }
  }
  while_break___0: /* CIL Label */ ;
  }
  {
#line 693
  free((void *)delta_x);
#line 694
  free((void *)delta_y);
  }
#line 695
  return;
}
}
#line 17 "../include/minidjvu/image-io/tiff.h"
int mdjvu_have_tiff_support(void) ;
#line 19
void mdjvu_disable_tiff_warnings(void) ;
#line 15 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/tiff.c"
int mdjvu_have_tiff_support(void) 
{ 


  {
#line 20
  return (0);
}
}
#line 24 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/tiff.c"
void mdjvu_disable_tiff_warnings(void) 
{ 


  {
#line 29
  return;
}
}
#line 44 "/usr/include/libintl.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__leaf__)) dgettext)(char const   *__domainname ,
                                                                                 char const   *__msgid )  __attribute__((__format_arg__(2))) ;
#line 11 "../include/minidjvu/alg/compress.h"
mdjvu_compression_options_t mdjvu_compression_options_create(void) ;
#line 12
void mdjvu_compression_options_destroy(mdjvu_compression_options_t opt ) ;
#line 20
void mdjvu_set_matcher_options(mdjvu_compression_options_t opt , mdjvu_matcher_options_t v ) ;
#line 22
void mdjvu_set_clean(mdjvu_compression_options_t opt , int v ) ;
#line 23
void mdjvu_set_verbose(mdjvu_compression_options_t opt , int v ) ;
#line 24
void mdjvu_set_no_prototypes(mdjvu_compression_options_t opt , int v ) ;
#line 25
void mdjvu_set_averaging(mdjvu_compression_options_t opt , int v ) ;
#line 26
void mdjvu_set_report(mdjvu_compression_options_t opt , int v ) ;
#line 27
void mdjvu_set_report_start_page(mdjvu_compression_options_t opt , int v ) ;
#line 28
void mdjvu_set_report_total_pages(mdjvu_compression_options_t opt , int v ) ;
#line 30
void mdjvu_compress_image(mdjvu_image_t image , mdjvu_compression_options_t opt ) ;
#line 31
mdjvu_image_t mdjvu_compress_multipage(int n , mdjvu_image_t *pages , mdjvu_compression_options_t options ) ;
#line 30 "../include/minidjvu/jb2.h"
void mdjvu_find_prototypes(mdjvu_image_t img ) ;
#line 36
void mdjvu_multipage_find_prototypes(mdjvu_image_t dict , int32 npages , mdjvu_image_t *pages ,
                                     void (*report___0)(void *param , int page ) ,
                                     void *param ) ;
#line 362 "/usr/include/stdio.h"
extern int printf(char const   * __restrict  __format  , ...) ;
#line 695
extern int puts(char const   *__s ) ;
#line 24 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
mdjvu_compression_options_t mdjvu_compression_options_create(void) 
{ 
  mdjvu_compression_options_t opt ;
  void *tmp ;

  {
  {
#line 26
  tmp = malloc(sizeof(struct MinidjvuCompressionOptions ));
#line 26
  opt = (mdjvu_compression_options_t )tmp;
#line 28
  mdjvu_init();
#line 29
  opt->clean = 0;
#line 30
  opt->verbose = 0;
#line 31
  opt->report = 0;
#line 32
  opt->averaging = 0;
#line 33
  opt->no_prototypes = 0;
#line 34
  opt->matcher_options = (mdjvu_matcher_options_t )((void *)0);
  }
#line 35
  return (opt);
}
}
#line 38 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
void mdjvu_compression_options_destroy(mdjvu_compression_options_t opt ) 
{ 


  {
#line 40
  if (opt->matcher_options) {
    {
#line 41
    mdjvu_matcher_options_destroy(opt->matcher_options);
    }
  }
  {
#line 42
  free((void *)opt);
  }
#line 43
  return;
}
}
#line 45 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
void mdjvu_set_matcher_options(mdjvu_compression_options_t opt , mdjvu_matcher_options_t v ) 
{ 


  {
#line 47
  if (opt->matcher_options) {
    {
#line 48
    mdjvu_matcher_options_destroy(opt->matcher_options);
    }
  }
#line 49
  opt->matcher_options = v;
#line 50
  return;
}
}
#line 51 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
void mdjvu_set_clean(mdjvu_compression_options_t opt , int v ) 
{ 


  {
#line 52
  opt->clean = v;
#line 52
  return;
}
}
#line 53 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
void mdjvu_set_verbose(mdjvu_compression_options_t opt , int v ) 
{ 


  {
#line 54
  opt->verbose = v;
#line 54
  return;
}
}
#line 55 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
void mdjvu_set_averaging(mdjvu_compression_options_t opt , int v ) 
{ 


  {
#line 56
  opt->averaging = v;
#line 56
  return;
}
}
#line 57 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
void mdjvu_set_no_prototypes(mdjvu_compression_options_t opt , int v ) 
{ 


  {
#line 58
  opt->no_prototypes = v;
#line 58
  return;
}
}
#line 59 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
void mdjvu_set_report(mdjvu_compression_options_t opt , int v ) 
{ 


  {
#line 60
  opt->report = v;
#line 60
  return;
}
}
#line 61 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
void mdjvu_set_report_start_page(mdjvu_compression_options_t opt , int v ) 
{ 


  {
#line 62
  opt->report_start_page = v;
#line 62
  return;
}
}
#line 63 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
void mdjvu_set_report_total_pages(mdjvu_compression_options_t opt , int v ) 
{ 


  {
#line 64
  opt->report_total_pages = v;
#line 64
  return;
}
}
#line 66 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static void find_substitutions(mdjvu_image_t image , struct MinidjvuCompressionOptions *opt ) 
{ 
  mdjvu_matcher_options_t m_opt ;
  int32 i ;
  int32 n ;
  int32 tmp ;
  int32 *tags ;
  void *tmp___0 ;
  int32 max_tag ;
  int32 tmp___1 ;
  mdjvu_bitmap_t *representatives ;
  void *tmp___2 ;
  int32 *cx ;
  void *tmp___3 ;
  int32 *cy ;
  void *tmp___4 ;
  int tmp___5 ;
  mdjvu_bitmap_t *sources ;
  void *tmp___6 ;
  int j ;
  int sources_found ;
  mdjvu_bitmap_t rep ;
  int tmp___7 ;
  int tmp___8 ;
  mdjvu_bitmap_t tmp___9 ;

  {
  {
#line 69
  m_opt = opt->matcher_options;
#line 70
  tmp = mdjvu_image_get_bitmap_count(image);
#line 70
  n = tmp;
#line 71
  tmp___0 = malloc((unsigned long )n * sizeof(int32 ));
#line 71
  tags = (int32 *)tmp___0;
#line 72
  tmp___1 = mdjvu_classify_bitmaps(image, tags, m_opt, opt->averaging);
#line 72
  max_tag = tmp___1;
#line 73
  tmp___2 = calloc((size_t )(max_tag + 1), sizeof(mdjvu_bitmap_t ));
#line 73
  representatives = (mdjvu_bitmap_t *)tmp___2;
#line 75
  tmp___3 = malloc((unsigned long )n * sizeof(int32 ));
#line 75
  cx = (int32 *)tmp___3;
#line 76
  tmp___4 = malloc((unsigned long )n * sizeof(int32 ));
#line 76
  cy = (int32 *)tmp___4;
#line 78
  tmp___5 = mdjvu_image_has_substitutions(image);
  }
#line 78
  if (! tmp___5) {
    {
#line 79
    mdjvu_image_enable_substitutions(image);
    }
  }
#line 80
  if (! opt->averaging) {
#line 82
    i = 0;
    {
#line 82
    while (1) {
      while_continue: /* CIL Label */ ;
#line 82
      if (! (i < n)) {
#line 82
        goto while_break;
      }
#line 84
      if (! *(representatives + *(tags + i))) {
        {
#line 85
        *(representatives + *(tags + i)) = mdjvu_image_get_bitmap(image, i);
        }
      }
#line 82
      i ++;
    }
    while_break: /* CIL Label */ ;
    }
  } else {
    {
#line 91
    tmp___6 = calloc((size_t )n, sizeof(mdjvu_bitmap_t ));
#line 91
    sources = (mdjvu_bitmap_t *)tmp___6;
#line 92
    i = 1;
    }
    {
#line 92
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 92
      if (! (i < max_tag)) {
#line 92
        goto while_break___0;
      }
#line 94
      sources_found = 0;
#line 97
      j = 0;
      {
#line 97
      while (1) {
        while_continue___1: /* CIL Label */ ;
#line 97
        if (! (j < n)) {
#line 97
          goto while_break___1;
        }
#line 99
        if (*(tags + j) == i) {
          {
#line 100
          tmp___7 = sources_found;
#line 100
          sources_found ++;
#line 100
          *(sources + tmp___7) = mdjvu_image_get_bitmap(image, j);
          }
        }
#line 97
        j ++;
      }
      while_break___1: /* CIL Label */ ;
      }
#line 103
      j = 0;
      {
#line 103
      while (1) {
        while_continue___2: /* CIL Label */ ;
#line 103
        if (! (j < sources_found)) {
#line 103
          goto while_break___2;
        }
        {
#line 104
        mdjvu_image_get_center(image, *(sources + j), cx + j, cy + j);
#line 103
        j ++;
        }
      }
      while_break___2: /* CIL Label */ ;
      }
      {
#line 106
      rep = mdjvu_average(sources, sources_found, cx, cy);
#line 107
      mdjvu_image_add_bitmap(image, rep);
#line 108
      mdjvu_image_set_substitution(image, rep, rep);
#line 109
      *(representatives + i) = rep;
#line 92
      i ++;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 112
    mdjvu_image_disable_centers(image);
#line 113
    free((void *)sources);
    }
  }
  {
#line 115
  tmp___8 = mdjvu_image_check_indices(image);
  }
#line 115
  if (! tmp___8) {
    {
#line 115
    __assert_fail("mdjvu_image_check_indices(image)", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c",
                  115U, "find_substitutions");
    }
  }
  {
#line 116
  free((void *)cx);
#line 117
  free((void *)cy);
#line 120
  i = 0;
  }
  {
#line 120
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 120
    if (! (i < n)) {
#line 120
      goto while_break___3;
    }
#line 122
    if (! *(tags + i)) {
#line 122
      goto __Cont;
    }
    {
#line 123
    tmp___9 = mdjvu_image_get_bitmap(image, i);
#line 123
    mdjvu_image_set_substitution(image, tmp___9, *(representatives + *(tags + i)));
    }
    __Cont: /* CIL Label */ 
#line 120
    i ++;
  }
  while_break___3: /* CIL Label */ ;
  }
  {
#line 128
  free((void *)representatives);
#line 129
  free((void *)tags);
  }
#line 130
  return;
}
}
#line 133 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static int32 count_prototypes(mdjvu_image_t image ) 
{ 
  int32 i ;
  int32 s ;
  int32 n ;
  int32 tmp ;
  mdjvu_bitmap_t bmp ;
  mdjvu_bitmap_t tmp___0 ;
  mdjvu_bitmap_t tmp___1 ;

  {
  {
#line 135
  s = 0;
#line 135
  tmp = mdjvu_image_get_bitmap_count(image);
#line 135
  n = tmp;
#line 136
  i = 0;
  }
  {
#line 136
  while (1) {
    while_continue: /* CIL Label */ ;
#line 136
    if (! (i < n)) {
#line 136
      goto while_break;
    }
    {
#line 138
    tmp___0 = mdjvu_image_get_bitmap(image, i);
#line 138
    bmp = tmp___0;
#line 139
    tmp___1 = mdjvu_image_get_prototype(image, bmp);
    }
#line 139
    if (tmp___1) {
#line 140
      s ++;
    }
#line 136
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 142
  return (s);
}
}
#line 146 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
void mdjvu_compress_image(mdjvu_image_t image , mdjvu_compression_options_t opt ) 
{ 
  mdjvu_compression_options_t options ;
  char *tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  char *tmp___2 ;
  char *tmp___3 ;
  char *tmp___4 ;
  int32 tmp___5 ;
  char *tmp___6 ;
  char *tmp___7 ;
  char *tmp___8 ;
  int32 tmp___9 ;
  char *tmp___10 ;

  {
#line 149
  if (opt) {
#line 150
    options = opt;
  } else {
    {
#line 152
    options = mdjvu_compression_options_create();
    }
  }
#line 154
  if (options->verbose) {
    {
#line 154
    tmp = dgettext("minidjvu", "deciding what pieces are letters");
#line 154
    puts((char const   *)tmp);
    }
  }
  {
#line 155
  mdjvu_calculate_not_a_letter_flags(image);
  }
#line 157
  if (options->verbose) {
    {
#line 157
    tmp___0 = dgettext("minidjvu", "sorting blits");
#line 157
    puts((char const   *)tmp___0);
    }
  }
  {
#line 158
  mdjvu_sort_blits(image);
  }
#line 159
  if (options->verbose) {
    {
#line 159
    tmp___1 = dgettext("minidjvu", "sorting bitmaps");
#line 159
    puts((char const   *)tmp___1);
    }
  }
  {
#line 160
  mdjvu_image_sort_bitmaps(image);
  }
#line 162
  if (options->matcher_options) {
#line 164
    if (options->verbose) {
      {
#line 164
      tmp___2 = dgettext("minidjvu", "matching patterns");
#line 164
      puts((char const   *)tmp___2);
      }
    }
    {
#line 165
    find_substitutions(image, options);
    }
#line 167
    if (options->verbose) {
      {
#line 167
      tmp___3 = dgettext("minidjvu", "adjusting substitution coordinates");
#line 167
      puts((char const   *)tmp___3);
      }
    }
    {
#line 168
    mdjvu_adjust(image);
    }
#line 170
    if (options->verbose) {
      {
#line 170
      tmp___4 = dgettext("minidjvu", "removing unused bitmaps");
#line 170
      puts((char const   *)tmp___4);
      }
    }
    {
#line 171
    mdjvu_image_remove_unused_bitmaps(image);
    }
#line 173
    if (options->verbose) {
      {
#line 175
      tmp___5 = mdjvu_image_get_bitmap_count(image);
#line 175
      tmp___6 = dgettext("minidjvu", "the image now has %d bitmaps\n");
#line 175
      printf((char const   */* __restrict  */)tmp___6, tmp___5);
      }
    }
#line 179
    if (options->averaging) {
#line 181
      if (options->verbose) {
        {
#line 181
        tmp___7 = dgettext("minidjvu", "sorting bitmaps (again)");
#line 181
        puts((char const   *)tmp___7);
        }
      }
      {
#line 182
      mdjvu_image_sort_bitmaps(image);
      }
    }
  }
#line 186
  if (options->no_prototypes) {
    {
#line 188
    mdjvu_image_enable_prototypes(image);
    }
  } else {
#line 192
    if (options->verbose) {
      {
#line 192
      tmp___8 = dgettext("minidjvu", "finding prototypes");
#line 192
      puts((char const   *)tmp___8);
      }
    }
    {
#line 193
    mdjvu_find_prototypes(image);
    }
#line 194
    if (options->verbose) {
      {
#line 196
      tmp___9 = count_prototypes(image);
#line 196
      tmp___10 = dgettext("minidjvu", "%d bitmaps have prototypes\n");
#line 196
      printf((char const   */* __restrict  */)tmp___10, tmp___9);
      }
    }
  }
#line 201
  if (! opt) {
    {
#line 202
    mdjvu_compression_options_destroy(options);
    }
  }
#line 203
  return;
}
}
#line 223 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static mdjvu_image_t get_dictionary(int32 max_tag , mdjvu_bitmap_t *representatives ,
                                    unsigned char *dictionary_flags ) 
{ 
  mdjvu_image_t dictionary ;
  mdjvu_image_t tmp ;
  int32 tag ;
  mdjvu_bitmap_t clone ;

  {
  {
#line 227
  tmp = mdjvu_image_create(0, 0);
#line 227
  dictionary = tmp;
#line 229
  tag = 1;
  }
  {
#line 229
  while (1) {
    while_continue: /* CIL Label */ ;
#line 229
    if (! (tag <= max_tag)) {
#line 229
      goto while_break;
    }
#line 232
    if (! *(dictionary_flags + tag)) {
#line 232
      goto __Cont;
    }
    {
#line 233
    clone = mdjvu_bitmap_clone(*(representatives + tag));
#line 234
    *(representatives + tag) = clone;
#line 235
    mdjvu_image_add_bitmap(dictionary, clone);
    }
    __Cont: /* CIL Label */ 
#line 229
    tag ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 237
  return (dictionary);
}
}
#line 253 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static void set_substitutions(int n , mdjvu_image_t *pages , int32 total_bitmaps_count ,
                              int32 *tags , mdjvu_bitmap_t *representatives ) 
{ 
  int page_number ;
  int32 total_bitmaps_passed ;
  mdjvu_image_t page ;
  int32 bitmap_count ;
  int32 tmp ;
  int32 i ;
  int tmp___0 ;
  int32 tag ;
  int32 tmp___1 ;
  mdjvu_bitmap_t tmp___2 ;

  {
#line 260
  total_bitmaps_passed = 0;
#line 261
  page_number = 0;
  {
#line 261
  while (1) {
    while_continue: /* CIL Label */ ;
#line 261
    if (! (page_number < n)) {
#line 261
      goto while_break;
    }
    {
#line 263
    page = *(pages + page_number);
#line 264
    tmp = mdjvu_image_get_bitmap_count(page);
#line 264
    bitmap_count = tmp;
#line 267
    tmp___0 = mdjvu_image_has_substitutions(page);
    }
#line 267
    if (! tmp___0) {
      {
#line 268
      mdjvu_image_enable_substitutions(page);
      }
    }
#line 270
    i = 0;
    {
#line 270
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 270
      if (! (i < bitmap_count)) {
#line 270
        goto while_break___0;
      }
#line 272
      tmp___1 = total_bitmaps_passed;
#line 272
      total_bitmaps_passed ++;
#line 272
      tag = *(tags + tmp___1);
#line 273
      if (! tag) {
#line 273
        goto __Cont;
      }
      {
#line 274
      tmp___2 = mdjvu_image_get_bitmap(page, i);
#line 274
      mdjvu_image_set_substitution(page, tmp___2, *(representatives + tag));
      }
      __Cont: /* CIL Label */ 
#line 270
      i ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 261
    page_number ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 279
  return;
}
}
#line 283 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static void report_classify(void *param , int page_completed ) 
{ 
  mdjvu_compression_options_t r ;
  char *tmp ;

  {
#line 285
  r = (mdjvu_compression_options_t )param;
#line 286
  if (r->report) {
    {
#line 288
    tmp = dgettext("minidjvu", "Classification: %d of %d completed\n");
#line 288
    printf((char const   */* __restrict  */)tmp, r->report_start_page + page_completed,
           r->report_total_pages);
    }
  }
#line 291
  return;
}
}
#line 293 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static void report_prototypes(void *param , int page_completed ) 
{ 
  mdjvu_compression_options_t r ;
  char *tmp ;

  {
#line 295
  r = (mdjvu_compression_options_t )param;
#line 296
  if (r->report) {
    {
#line 298
    tmp = dgettext("minidjvu", "Prototype search: %d of %d completed\n");
#line 298
    printf((char const   */* __restrict  */)tmp, r->report_start_page + page_completed,
           r->report_total_pages);
    }
  }
#line 301
  return;
}
}
#line 304 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
mdjvu_image_t mdjvu_compress_multipage(int n , mdjvu_image_t *pages , mdjvu_compression_options_t options ) 
{ 
  mdjvu_image_t dictionary ;
  int i ;
  int32 total_bitmaps_count ;
  int32 max_tag ;
  mdjvu_bitmap_t *representatives ;
  int32 *tags ;
  int32 *npatterns ;
  unsigned char *dictionary_flags ;
  int32 tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  int tmp___2 ;
  void *tmp___3 ;
  char *tmp___4 ;
  char *tmp___5 ;
  void *tmp___6 ;
  void *tmp___7 ;
  void *tmp___8 ;
  char *tmp___9 ;
  char *tmp___10 ;

  {
#line 306
  dictionary = (mdjvu_image_t )((void *)0);
#line 314
  total_bitmaps_count = 0;
#line 315
  i = 0;
  {
#line 315
  while (1) {
    while_continue: /* CIL Label */ ;
#line 315
    if (! (i < n)) {
#line 315
      goto while_break;
    }
    {
#line 317
    tmp = mdjvu_image_get_bitmap_count(*(pages + i));
#line 317
    total_bitmaps_count += tmp;
    }
#line 319
    if (options->verbose) {
      {
#line 319
      tmp___0 = dgettext("minidjvu", "deciding what pieces are letters in page #%d\n");
#line 319
      printf((char const   */* __restrict  */)tmp___0, i);
      }
    }
    {
#line 320
    mdjvu_calculate_not_a_letter_flags(*(pages + i));
    }
#line 322
    if (options->verbose) {
      {
#line 322
      tmp___1 = dgettext("minidjvu", "sorting letters in page #%d\n");
#line 322
      printf((char const   */* __restrict  */)tmp___1, i);
      }
    }
    {
#line 323
    mdjvu_sort_blits(*(pages + i));
#line 324
    mdjvu_image_sort_bitmaps(*(pages + i));
#line 326
    tmp___2 = mdjvu_image_has_substitutions(*(pages + i));
    }
#line 326
    if (! tmp___2) {
      {
#line 327
      mdjvu_image_enable_substitutions(*(pages + i));
      }
    }
#line 315
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 330
  tmp___3 = malloc((unsigned long )total_bitmaps_count * sizeof(int32 ));
#line 330
  tags = (int32 *)tmp___3;
  }
#line 331
  if (options->report) {
    {
#line 331
    tmp___4 = dgettext("minidjvu", "started classification\n");
#line 331
    printf((char const   */* __restrict  */)tmp___4);
    }
  }
  {
#line 332
  max_tag = mdjvu_multipage_classify_bitmaps(n, total_bitmaps_count, pages, tags,
                                             options->matcher_options, & report_classify,
                                             (void *)options, options->averaging);
  }
#line 336
  if (options->report) {
    {
#line 336
    tmp___5 = dgettext("minidjvu", "finished classification\n");
#line 336
    printf((char const   */* __restrict  */)tmp___5);
    }
  }
  {
#line 338
  tmp___6 = malloc((size_t )(max_tag + 1));
#line 338
  dictionary_flags = (unsigned char *)tmp___6;
#line 339
  tmp___7 = malloc((unsigned long )(max_tag + 1) * sizeof(mdjvu_bitmap_t ));
#line 339
  representatives = (mdjvu_bitmap_t *)tmp___7;
#line 342
  tmp___8 = malloc((unsigned long )n * sizeof(int32 ));
#line 342
  npatterns = (int32 *)tmp___8;
#line 343
  i = 0;
  }
  {
#line 343
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 343
    if (! (i < n)) {
#line 343
      goto while_break___0;
    }
    {
#line 345
    *(npatterns + i) = mdjvu_image_get_bitmap_count(*(pages + i));
#line 343
    i ++;
    }
  }
  while_break___0: /* CIL Label */ ;
  }
  {
#line 347
  mdjvu_multipage_get_dictionary_flags(n, npatterns, max_tag, tags, dictionary_flags);
#line 349
  free((void *)npatterns);
  }
#line 351
  if (! options->averaging) {
    {
#line 353
    mdjvu_multipage_choose_representatives(n, pages, max_tag, tags, representatives);
#line 354
    dictionary = get_dictionary(max_tag, representatives, dictionary_flags);
    }
  } else {
    {
#line 358
    dictionary = mdjvu_multipage_choose_average_representatives(n, pages, total_bitmaps_count,
                                                                max_tag, tags, representatives,
                                                                dictionary_flags);
    }
  }
#line 361
  i = 0;
  {
#line 361
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 361
    if (! (i < n)) {
#line 361
      goto while_break___1;
    }
    {
#line 362
    mdjvu_image_set_dictionary(*(pages + i), dictionary);
#line 361
    i ++;
    }
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 364
  set_substitutions(n, pages, total_bitmaps_count, tags, representatives);
#line 366
  mdjvu_multipage_adjust(dictionary, n, pages);
#line 367
  i = 0;
  }
  {
#line 367
  while (1) {
    while_continue___2: /* CIL Label */ ;
#line 367
    if (! (i < n)) {
#line 367
      goto while_break___2;
    }
    {
#line 368
    mdjvu_image_remove_unused_bitmaps(*(pages + i));
#line 367
    i ++;
    }
  }
  while_break___2: /* CIL Label */ ;
  }
#line 369
  if (options->report) {
    {
#line 369
    tmp___9 = dgettext("minidjvu", "started prototype search\n");
#line 369
    printf((char const   */* __restrict  */)tmp___9);
    }
  }
  {
#line 370
  mdjvu_multipage_find_prototypes(dictionary, n, pages, & report_prototypes, (void *)options);
  }
#line 372
  if (options->report) {
    {
#line 372
    tmp___10 = dgettext("minidjvu", "finished prototype search\n");
#line 372
    printf((char const   */* __restrict  */)tmp___10);
    }
  }
  {
#line 373
  free((void *)dictionary_flags);
#line 374
  free((void *)representatives);
#line 375
  free((void *)tags);
  }
#line 377
  return (dictionary);
}
}
#line 49 "../include/minidjvu/djvu/djvu.h"
void mdjvu_read_info_chunk(mdjvu_file_t f , int32 *pw , int32 *ph , int32 *pdpi ) ;
#line 12 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuinfo.c"
void mdjvu_write_info_chunk(mdjvu_file_t f , mdjvu_image_t image ) 
{ 
  int32 w ;
  int32 tmp ;
  int32 h ;
  int32 tmp___0 ;
  int32 dpi___0 ;
  int32 tmp___1 ;

  {
  {
#line 14
  tmp = mdjvu_image_get_width(image);
#line 14
  w = tmp;
#line 15
  tmp___0 = mdjvu_image_get_height(image);
#line 15
  h = tmp___0;
#line 16
  tmp___1 = mdjvu_image_get_resolution(image);
#line 16
  dpi___0 = tmp___1;
  }
#line 18
  if (! dpi___0) {
#line 18
    dpi___0 = 300;
  }
  {
#line 20
  mdjvu_write_big_endian_int16((int16 )((uint16 )w), f);
#line 21
  mdjvu_write_big_endian_int16((int16 )((uint16 )h), f);
#line 22
  mdjvu_write_little_endian_int16((int16 )24, f);
#line 23
  mdjvu_write_little_endian_int16((int16 )((uint16 )dpi___0), f);
#line 24
  mdjvu_write_little_endian_int16((int16 )278, f);
  }
#line 25
  return;
}
}
#line 27 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuinfo.c"
void mdjvu_read_info_chunk(mdjvu_file_t f , int32 *pw , int32 *ph , int32 *pdpi ) 
{ 
  int16 w ;
  int16 tmp ;
  int16 h ;
  int16 tmp___0 ;
  int16 dpi___0 ;

  {
  {
#line 29
  tmp = mdjvu_read_big_endian_int16(f);
#line 29
  w = tmp;
#line 30
  tmp___0 = mdjvu_read_big_endian_int16(f);
#line 30
  h = tmp___0;
#line 32
  mdjvu_read_little_endian_int16(f);
#line 33
  dpi___0 = mdjvu_read_little_endian_int16(f);
#line 34
  mdjvu_read_little_endian_int16(f);
  }
#line 36
  if (pw) {
#line 36
    *pw = (int32 )w;
  }
#line 37
  if (ph) {
#line 37
    *ph = (int32 )h;
  }
#line 38
  if (pdpi) {
#line 38
    *pdpi = (int32 )dpi___0;
  }
#line 39
  return;
}
}
#line 18 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/jb2/proto.c"
static int diff(mdjvu_bitmap_t image , mdjvu_bitmap_t prototype , unsigned char **image_uncompressed ,
                unsigned char **proto_uncompressed , int32 ceiling ) 
{ 
  int32 pw ;
  int32 tmp ;
  int32 ph ;
  int32 tmp___0 ;
  int32 iw ;
  int32 tmp___1 ;
  int32 ih ;
  int32 tmp___2 ;
  int32 shift_x ;
  int32 shift_y ;
  int32 s ;
  int32 i ;
  int32 n ;
  unsigned char *ir ;
  unsigned char *pr ;
  int tmp___3 ;
  int tmp___4 ;
  void *tmp___5 ;
  void *tmp___6 ;
  int32 y ;

  {
  {
#line 24
  tmp = mdjvu_bitmap_get_width(prototype);
#line 24
  pw = tmp;
#line 25
  tmp___0 = mdjvu_bitmap_get_height(prototype);
#line 25
  ph = tmp___0;
#line 26
  tmp___1 = mdjvu_bitmap_get_width(image);
#line 26
  iw = tmp___1;
#line 27
  tmp___2 = mdjvu_bitmap_get_height(image);
#line 27
  ih = tmp___2;
#line 29
  s = 0;
#line 29
  n = pw + 2;
#line 33
  tmp___3 = abs(iw - pw);
  }
#line 33
  if (tmp___3 > 2) {
#line 33
    return (2147483647);
  }
  {
#line 34
  tmp___4 = abs(ih - ph);
  }
#line 34
  if (tmp___4 > 2) {
#line 34
    return (2147483647);
  }
  {
#line 36
  tmp___5 = malloc((size_t )n);
#line 36
  ir = (unsigned char *)tmp___5;
#line 37
  tmp___6 = malloc((size_t )n);
#line 37
  pr = (unsigned char *)tmp___6;
#line 40
  shift_x = (pw - pw / 2) - (iw - iw / 2);
#line 41
  shift_y = ph / 2 - ih / 2;
#line 43
  memset((void *)pr, 0, (size_t )n);
#line 44
  memset((void *)ir, 0, (size_t )n);
#line 46
  i = -1;
  }
  {
#line 46
  while (1) {
    while_continue: /* CIL Label */ ;
#line 46
    if (! (i <= ph)) {
#line 46
      goto while_break;
    }
#line 48
    y = i - shift_y;
#line 50
    if (y >= 0) {
#line 50
      if (y < ih) {
        {
#line 51
        memcpy((void */* __restrict  */)((ir + shift_x) + 1), (void const   */* __restrict  */)*(image_uncompressed + y),
               (size_t )iw);
        }
      } else {
        {
#line 53
        memset((void *)ir, 0, (size_t )n);
        }
      }
    } else {
      {
#line 53
      memset((void *)ir, 0, (size_t )n);
      }
    }
#line 55
    if (i >= 0) {
#line 55
      if (i < ph) {
        {
#line 56
        memcpy((void */* __restrict  */)(pr + 1), (void const   */* __restrict  */)*(proto_uncompressed + i),
               (size_t )pw);
        }
      } else {
        {
#line 58
        memset((void *)pr, 0, (size_t )n);
        }
      }
    } else {
      {
#line 58
      memset((void *)pr, 0, (size_t )n);
      }
    }
#line 61
    y = 0;
    {
#line 61
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 61
      if (! (y < n)) {
#line 61
        goto while_break___0;
      }
#line 61
      if ((int )*(ir + y) != (int )*(pr + y)) {
#line 61
        s ++;
      }
#line 61
      y ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 62
    if (s > ceiling) {
      {
#line 64
      free((void *)ir);
#line 65
      free((void *)pr);
      }
#line 66
      return (s);
    }
#line 46
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 70
  free((void *)ir);
#line 71
  free((void *)pr);
  }
#line 73
  return (s);
}
}
#line 76 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/jb2/proto.c"
static void find_prototypes(mdjvu_image_t dict , unsigned char ***uncompressed_dict ,
                            mdjvu_image_t img ) 
{ 
  int32 d ;
  int32 tmp ;
  int32 tmp___0 ;
  int32 i ;
  int32 n ;
  int32 tmp___1 ;
  unsigned char ***uncompressed_bitmaps ;
  void *tmp___2 ;
  mdjvu_bitmap_t current ;
  mdjvu_bitmap_t tmp___3 ;
  int32 w ;
  int32 tmp___4 ;
  int32 h ;
  int32 tmp___5 ;
  int tmp___6 ;
  int tmp___7 ;
  int tmp___8 ;
  mdjvu_bitmap_t current___0 ;
  mdjvu_bitmap_t tmp___9 ;
  int32 mass ;
  int32 tmp___10 ;
  int32 w___0 ;
  int32 tmp___11 ;
  int32 h___0 ;
  int32 tmp___12 ;
  int32 max_score ;
  int32 j ;
  mdjvu_bitmap_t best_match ;
  int32 best_score ;
  int32 score ;
  mdjvu_bitmap_t candidate ;
  mdjvu_bitmap_t tmp___13 ;
  int32 c_mass ;
  int32 tmp___14 ;
  int tmp___15 ;
  int32 score___0 ;
  mdjvu_bitmap_t candidate___0 ;
  mdjvu_bitmap_t tmp___16 ;
  int32 c_mass___0 ;
  int32 tmp___17 ;
  int tmp___18 ;

  {
#line 79
  if (dict) {
    {
#line 79
    tmp = mdjvu_image_get_bitmap_count(dict);
#line 79
    tmp___0 = tmp;
    }
  } else {
#line 79
    tmp___0 = 0;
  }
  {
#line 79
  d = tmp___0;
#line 80
  tmp___1 = mdjvu_image_get_bitmap_count(img);
#line 80
  n = tmp___1;
#line 81
  tmp___2 = malloc((unsigned long )n * sizeof(unsigned char **));
#line 81
  uncompressed_bitmaps = (unsigned char ***)tmp___2;
#line 84
  i = 0;
  }
  {
#line 84
  while (1) {
    while_continue: /* CIL Label */ ;
#line 84
    if (! (i < n)) {
#line 84
      goto while_break;
    }
    {
#line 86
    tmp___3 = mdjvu_image_get_bitmap(img, i);
#line 86
    current = tmp___3;
#line 87
    tmp___4 = mdjvu_bitmap_get_width(current);
#line 87
    w = tmp___4;
#line 88
    tmp___5 = mdjvu_bitmap_get_height(current);
#line 88
    h = tmp___5;
#line 89
    *(uncompressed_bitmaps + i) = mdjvu_create_2d_array(w, h);
#line 90
    mdjvu_bitmap_unpack_all_0_or_1(current, *(uncompressed_bitmaps + i));
#line 84
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 93
  tmp___6 = mdjvu_image_has_prototypes(img);
  }
#line 93
  if (! tmp___6) {
    {
#line 94
    mdjvu_image_enable_prototypes(img);
    }
  }
  {
#line 95
  tmp___7 = mdjvu_image_has_substitutions(img);
  }
#line 95
  if (! tmp___7) {
    {
#line 96
    mdjvu_image_enable_substitutions(img);
    }
  }
  {
#line 97
  tmp___8 = mdjvu_image_has_masses(img);
  }
#line 97
  if (! tmp___8) {
    {
#line 98
    mdjvu_image_enable_masses(img);
    }
  }
#line 99
  i = 0;
  {
#line 99
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 99
    if (! (i < n)) {
#line 99
      goto while_break___0;
    }
    {
#line 101
    tmp___9 = mdjvu_image_get_bitmap(img, i);
#line 101
    current___0 = tmp___9;
#line 102
    tmp___10 = mdjvu_image_get_mass(img, current___0);
#line 102
    mass = tmp___10;
#line 103
    tmp___11 = mdjvu_bitmap_get_width(current___0);
#line 103
    w___0 = tmp___11;
#line 104
    tmp___12 = mdjvu_bitmap_get_height(current___0);
#line 104
    h___0 = tmp___12;
#line 105
    max_score = ((w___0 * h___0) * 21) / 100;
#line 107
    best_match = (mdjvu_bitmap_t )((void *)0);
#line 108
    best_score = max_score;
#line 110
    j = 0;
    }
    {
#line 110
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 110
      if (! (j < d)) {
#line 110
        goto while_break___1;
      }
      {
#line 113
      tmp___13 = mdjvu_image_get_bitmap(dict, j);
#line 113
      candidate = tmp___13;
#line 114
      tmp___14 = mdjvu_image_get_mass(dict, candidate);
#line 114
      c_mass = tmp___14;
#line 115
      tmp___15 = abs(mass - c_mass);
      }
#line 115
      if (tmp___15 > best_score) {
#line 115
        goto __Cont;
      }
      {
#line 116
      score = diff(current___0, candidate, *(uncompressed_bitmaps + i), *(uncompressed_dict + j),
                   best_score);
      }
#line 121
      if (score < best_score) {
#line 123
        best_score = score;
#line 124
        best_match = candidate;
#line 125
        if (! score) {
#line 126
          goto while_break___1;
        }
      }
      __Cont: /* CIL Label */ 
#line 110
      j ++;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 130
    if (best_score) {
#line 130
      j = 0;
      {
#line 130
      while (1) {
        while_continue___2: /* CIL Label */ ;
#line 130
        if (! (j < i)) {
#line 130
          goto while_break___2;
        }
        {
#line 133
        tmp___16 = mdjvu_image_get_bitmap(img, j);
#line 133
        candidate___0 = tmp___16;
#line 134
        tmp___17 = mdjvu_image_get_mass(img, candidate___0);
#line 134
        c_mass___0 = tmp___17;
#line 135
        tmp___18 = abs(mass - c_mass___0);
        }
#line 135
        if (tmp___18 > best_score) {
#line 135
          goto __Cont___0;
        }
        {
#line 136
        score___0 = diff(current___0, candidate___0, *(uncompressed_bitmaps + i),
                         *(uncompressed_bitmaps + j), best_score);
        }
#line 141
        if (score___0 < best_score) {
#line 143
          best_score = score___0;
#line 144
          best_match = candidate___0;
#line 145
          if (! score___0) {
#line 146
            goto while_break___2;
          }
        }
        __Cont___0: /* CIL Label */ 
#line 130
        j ++;
      }
      while_break___2: /* CIL Label */ ;
      }
    }
#line 150
    if (best_score) {
      {
#line 151
      mdjvu_image_set_prototype(img, current___0, best_match);
      }
    } else {
      {
#line 153
      mdjvu_image_set_substitution(img, current___0, best_match);
      }
    }
#line 99
    i ++;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 157
  i = 0;
  {
#line 157
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 157
    if (! (i < n)) {
#line 157
      goto while_break___3;
    }
    {
#line 159
    mdjvu_destroy_2d_array(*(uncompressed_bitmaps + i));
#line 157
    i ++;
    }
  }
  while_break___3: /* CIL Label */ ;
  }
  {
#line 161
  free((void *)uncompressed_bitmaps);
  }
#line 162
  return;
}
}
#line 164 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/jb2/proto.c"
void mdjvu_find_prototypes(mdjvu_image_t img ) 
{ 


  {
  {
#line 166
  find_prototypes((mdjvu_image_t )((void *)0), (unsigned char ***)((void *)0), img);
  }
#line 167
  return;
}
}
#line 169 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/jb2/proto.c"
void mdjvu_multipage_find_prototypes(mdjvu_image_t dict , int32 npages , mdjvu_image_t *pages ,
                                     void (*report___0)(void *param , int page ) ,
                                     void *param ) 
{ 
  int i ;
  int32 n ;
  int32 tmp ;
  unsigned char ***uncompressed_dict_bitmaps ;
  void *tmp___0 ;
  mdjvu_bitmap_t current ;
  mdjvu_bitmap_t tmp___1 ;
  int32 w ;
  int32 tmp___2 ;
  int32 h ;
  int32 tmp___3 ;
  int tmp___4 ;

  {
  {
#line 176
  tmp = mdjvu_image_get_bitmap_count(dict);
#line 176
  n = tmp;
#line 177
  tmp___0 = malloc((unsigned long )n * sizeof(unsigned char **));
#line 177
  uncompressed_dict_bitmaps = (unsigned char ***)tmp___0;
#line 180
  i = 0;
  }
  {
#line 180
  while (1) {
    while_continue: /* CIL Label */ ;
#line 180
    if (! (i < n)) {
#line 180
      goto while_break;
    }
    {
#line 182
    tmp___1 = mdjvu_image_get_bitmap(dict, i);
#line 182
    current = tmp___1;
#line 183
    tmp___2 = mdjvu_bitmap_get_width(current);
#line 183
    w = tmp___2;
#line 184
    tmp___3 = mdjvu_bitmap_get_height(current);
#line 184
    h = tmp___3;
#line 185
    *(uncompressed_dict_bitmaps + i) = mdjvu_create_2d_array(w, h);
#line 186
    mdjvu_bitmap_unpack_all_0_or_1(current, *(uncompressed_dict_bitmaps + i));
#line 180
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 189
  tmp___4 = mdjvu_image_has_masses(dict);
  }
#line 189
  if (! tmp___4) {
    {
#line 190
    mdjvu_image_enable_masses(dict);
    }
  }
#line 192
  i = 0;
  {
#line 192
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 192
    if (! (i < npages)) {
#line 192
      goto while_break___0;
    }
    {
#line 194
    find_prototypes(dict, uncompressed_dict_bitmaps, *(pages + i));
#line 195
    (*report___0)(param, i);
#line 192
    i ++;
    }
  }
  while_break___0: /* CIL Label */ ;
  }
#line 199
  i = 0;
  {
#line 199
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 199
    if (! (i < n)) {
#line 199
      goto while_break___1;
    }
    {
#line 201
    mdjvu_destroy_2d_array(*(uncompressed_dict_bitmaps + i));
#line 199
    i ++;
    }
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 203
  free((void *)uncompressed_dict_bitmaps);
  }
#line 204
  return;
}
}
#line 26 "../include/minidjvu/base/1error.h"
char const   *mdjvu_get_error_message(mdjvu_error_t error ) ;
#line 8 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/1error.c"
char const   *mdjvu_get_error_message(mdjvu_error_t error ) 
{ 


  {
#line 10
  return ((char const   *)error);
}
}
#line 13 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/1error.c"
mdjvu_error_t mdjvu_get_error(MinidjvuErrorType e ) 
{ 
  char *tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  char *tmp___2 ;
  char *tmp___3 ;
  char *tmp___4 ;
  char *tmp___5 ;
  char *tmp___6 ;
  char *tmp___7 ;
  char *tmp___8 ;
  char *tmp___9 ;
  char *tmp___10 ;
  char *tmp___11 ;
  char *tmp___12 ;

  {
  {
#line 17
  if ((unsigned int )e == 0U) {
#line 17
    goto case_0;
  }
#line 19
  if ((unsigned int )e == 1U) {
#line 19
    goto case_1;
  }
#line 21
  if ((unsigned int )e == 2U) {
#line 21
    goto case_2;
  }
#line 23
  if ((unsigned int )e == 3U) {
#line 23
    goto case_3;
  }
#line 25
  if ((unsigned int )e == 4U) {
#line 25
    goto case_4;
  }
#line 27
  if ((unsigned int )e == 5U) {
#line 27
    goto case_5;
  }
#line 29
  if ((unsigned int )e == 6U) {
#line 29
    goto case_6;
  }
#line 31
  if ((unsigned int )e == 7U) {
#line 31
    goto case_7;
  }
#line 33
  if ((unsigned int )e == 8U) {
#line 33
    goto case_8;
  }
#line 35
  if ((unsigned int )e == 9U) {
#line 35
    goto case_9;
  }
#line 37
  if ((unsigned int )e == 10U) {
#line 37
    goto case_10;
  }
#line 39
  if ((unsigned int )e == 11U) {
#line 39
    goto case_11;
  }
#line 41
  if ((unsigned int )e == 12U) {
#line 41
    goto case_12;
  }
#line 15
  goto switch_break;
  case_0: /* CIL Label */ 
  {
#line 18
  tmp = dgettext("minidjvu", "unable to write to file");
  }
#line 18
  return ((mdjvu_error_t )tmp);
  case_1: /* CIL Label */ 
  {
#line 20
  tmp___0 = dgettext("minidjvu", "unable to read from file");
  }
#line 20
  return ((mdjvu_error_t )tmp___0);
  case_2: /* CIL Label */ 
  {
#line 22
  tmp___1 = dgettext("minidjvu", "I/O error");
  }
#line 22
  return ((mdjvu_error_t )tmp___1);
  case_3: /* CIL Label */ 
  {
#line 24
  tmp___2 = dgettext("minidjvu", "bad PBM file");
  }
#line 24
  return ((mdjvu_error_t )tmp___2);
  case_4: /* CIL Label */ 
  {
#line 26
  tmp___3 = dgettext("minidjvu", "bad Windows BMP file (perhaps it has non-bitonal data)");
  }
#line 26
  return ((mdjvu_error_t )tmp___3);
  case_5: /* CIL Label */ 
  {
#line 28
  tmp___4 = dgettext("minidjvu", "bad DjVu file");
  }
#line 28
  return ((mdjvu_error_t )tmp___4);
  case_6: /* CIL Label */ 
  {
#line 30
  tmp___5 = dgettext("minidjvu", "bad bilevel data in DjVu file");
  }
#line 30
  return ((mdjvu_error_t )tmp___5);
  case_7: /* CIL Label */ 
  {
#line 32
  tmp___6 = dgettext("minidjvu", "bad TIFF file (perhaps it has non-bitonal data)");
  }
#line 32
  return ((mdjvu_error_t )tmp___6);
  case_8: /* CIL Label */ 
  {
#line 34
  tmp___7 = dgettext("minidjvu", "unsupported type of DjVu file");
  }
#line 34
  return ((mdjvu_error_t )tmp___7);
  case_9: /* CIL Label */ 
  {
#line 36
  tmp___8 = dgettext("minidjvu", "bilevel data not found in DjVu file");
  }
#line 36
  return ((mdjvu_error_t )tmp___8);
  case_10: /* CIL Label */ 
  {
#line 38
  tmp___9 = dgettext("minidjvu", "somehow prototype references recursed");
  }
#line 38
  return ((mdjvu_error_t )tmp___9);
  case_11: /* CIL Label */ 
  {
#line 40
  tmp___10 = dgettext("minidjvu", "minidjvu was compiled without TIFF support");
  }
#line 40
  return ((mdjvu_error_t )tmp___10);
  case_12: /* CIL Label */ 
  {
#line 42
  tmp___11 = dgettext("minidjvu", "minidjvu was compiled without PNG support");
  }
#line 42
  return ((mdjvu_error_t )tmp___11);
  switch_break: /* CIL Label */ ;
  }
  {
#line 44
  tmp___12 = dgettext("minidjvu", "some weird error happened, probably caused by a bug in minidjvu");
  }
#line 44
  return ((mdjvu_error_t )tmp___12);
}
}
#line 8 "../include/minidjvu/image-io/bmp.h"
int mdjvu_save_bmp(mdjvu_bitmap_t bmp , char const   *path , int32 resolution , mdjvu_error_t *perr ) ;
#line 9
int mdjvu_file_save_bmp(mdjvu_bitmap_t bmp , mdjvu_file_t file , int32 resolution ,
                        mdjvu_error_t *perr ) ;
#line 14
mdjvu_bitmap_t mdjvu_load_bmp(char const   *path , mdjvu_error_t *perr ) ;
#line 15
mdjvu_bitmap_t mdjvu_file_load_bmp(mdjvu_file_t file , mdjvu_error_t *perr ) ;
#line 30 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static uint32 read_uint32(FILE *f ) 
{ 
  uint32 r ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;

  {
  {
#line 32
  tmp = fgetc(f);
#line 32
  r = (uint32 )tmp;
#line 33
  tmp___0 = fgetc(f);
#line 33
  r |= (unsigned int )(tmp___0 << 8);
#line 34
  tmp___1 = fgetc(f);
#line 34
  r |= (unsigned int )(tmp___1 << 16);
#line 35
  tmp___2 = fgetc(f);
  }
#line 35
  return (r | (unsigned int )(tmp___2 << 24));
}
}
#line 38 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static uint16 read_uint16(FILE *f ) 
{ 
  uint32 r ;
  int tmp ;
  int tmp___0 ;

  {
  {
#line 40
  tmp = fgetc(f);
#line 40
  r = (uint32 )tmp;
#line 41
  tmp___0 = fgetc(f);
  }
#line 41
  return ((uint16 )(r | (unsigned int )(tmp___0 << 8)));
}
}
#line 44 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void write_uint16(FILE *f , uint16 i ) 
{ 


  {
  {
#line 46
  fputc((int )i, f);
#line 47
  fputc((int )i >> 8, f);
  }
#line 48
  return;
}
}
#line 50 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void write_uint32(FILE *f , uint32 i ) 
{ 


  {
  {
#line 52
  fputc((int )i, f);
#line 53
  fputc((int )(i >> 8), f);
#line 54
  fputc((int )(i >> 16), f);
#line 55
  fputc((int )(i >> 24), f);
  }
#line 56
  return;
}
}
#line 58 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void write_bmp_header(FILE *f , uint32 w , uint32 h , int resolution ) 
{ 
  uint32 row_size ;
  uint32 data_size ;
  uint32 data_offset ;
  uint32 dpm ;

  {
  {
#line 61
  row_size = ((w + 31U) & 4294967264U) >> 3;
#line 62
  data_size = row_size * h;
#line 63
  data_offset = (uint32 )62;
#line 64
  dpm = (uint32 )((resolution * 5000) / 127);
#line 65
  fputc('B', f);
#line 66
  fputc('M', f);
#line 67
  write_uint32(f, data_size + data_offset);
#line 68
  write_uint32(f, (uint32 )0);
#line 69
  write_uint32(f, data_offset);
#line 70
  write_uint32(f, (uint32 )40);
#line 71
  write_uint32(f, w);
#line 72
  write_uint32(f, h);
#line 73
  write_uint16(f, (uint16 )1);
#line 74
  write_uint16(f, (uint16 )1);
#line 75
  write_uint32(f, (uint32 )0);
#line 76
  write_uint32(f, data_size);
#line 77
  write_uint32(f, dpm);
#line 78
  write_uint32(f, dpm);
#line 79
  write_uint32(f, (uint32 )2);
#line 80
  write_uint32(f, (uint32 )0);
#line 81
  write_uint32(f, (uint32 )0);
#line 82
  write_uint32(f, (uint32 )16777215);
  }
#line 83
  return;
}
}
#line 85 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void read_bmp_header(FILE *f , Header *h ) 
{ 


  {
  {
#line 87
  h->file_size = read_uint32(f);
#line 88
  h->reserved = read_uint32(f);
#line 89
  h->offset = read_uint32(f);
#line 90
  h->size = read_uint32(f);
#line 91
  h->width = read_uint32(f);
#line 92
  h->height = read_uint32(f);
#line 93
  h->planes = read_uint16(f);
#line 94
  h->bits = read_uint16(f);
#line 95
  h->compression = read_uint32(f);
#line 96
  h->imagesize = read_uint32(f);
#line 97
  h->xresolution = read_uint32(f);
#line 98
  h->yresolution = read_uint32(f);
#line 99
  h->ncolors = read_uint32(f);
#line 100
  h->importantcolors = read_uint32(f);
#line 101
  h->color_0 = read_uint32(f);
#line 102
  h->color_1 = read_uint32(f);
  }
#line 103
  return;
}
}
#line 105 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void save_DIB_bytes(mdjvu_bitmap_t bmp , FILE *f ) 
{ 
  int32 w ;
  int32 tmp ;
  int32 h ;
  int32 tmp___0 ;
  int32 bytes_per_row ;
  int32 tmp___1 ;
  int32 DIB_row_size ;
  unsigned char *buf ;
  void *tmp___2 ;
  uint32 *p ;
  uint32 i ;
  int mask ;
  uint32 j ;
  unsigned char *row ;
  unsigned char *tmp___3 ;

  {
  {
#line 107
  tmp = mdjvu_bitmap_get_width(bmp);
#line 107
  w = tmp;
#line 108
  tmp___0 = mdjvu_bitmap_get_height(bmp);
#line 108
  h = tmp___0;
#line 109
  tmp___1 = mdjvu_bitmap_get_packed_row_size(bmp);
#line 109
  bytes_per_row = tmp___1;
#line 110
  DIB_row_size = ((w + 31) & -32) >> 3;
#line 111
  tmp___2 = malloc((size_t )DIB_row_size);
#line 111
  buf = (unsigned char *)tmp___2;
  }
#line 115
  if (w & 7) {
#line 116
    mask = ~ (255 >> (w & 7));
  } else {
#line 118
    mask = ~ 0;
  }
#line 120
  i = (uint32 )h;
  {
#line 120
  while (1) {
    while_continue: /* CIL Label */ ;
#line 120
    if (! i) {
#line 120
      goto while_break;
    }
    {
#line 123
    tmp___3 = mdjvu_bitmap_access_packed_row(bmp, (int32 )(i - 1U));
#line 123
    row = tmp___3;
#line 124
    memcpy((void */* __restrict  */)buf, (void const   */* __restrict  */)row, (size_t )bytes_per_row);
#line 125
    j = (uint32 )(DIB_row_size >> 2);
#line 125
    p = (uint32 *)buf;
    }
    {
#line 125
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 125
      if (! j) {
#line 125
        goto while_break___0;
      }
#line 127
      *p = ~ *p;
#line 125
      j --;
#line 125
      p ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 130
    if (bytes_per_row > 1) {
      {
#line 132
      fwrite((void const   */* __restrict  */)buf, (size_t )1, (size_t )(bytes_per_row - 1),
             (FILE */* __restrict  */)f);
      }
    }
    {
#line 134
    fputc((int )*(buf + (bytes_per_row - 1)) & mask, f);
#line 135
    j = (uint32 )(DIB_row_size - bytes_per_row);
    }
    {
#line 135
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 135
      if (! j) {
#line 135
        goto while_break___1;
      }
      {
#line 135
      fputc(0, f);
#line 135
      j --;
      }
    }
    while_break___1: /* CIL Label */ ;
    }
#line 120
    i --;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 137
  free((void *)buf);
  }
#line 138
  return;
}
}
#line 140 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
int mdjvu_file_save_bmp(mdjvu_bitmap_t bmp , mdjvu_file_t file , int32 resolution ,
                        mdjvu_error_t *perr ) 
{ 
  FILE *f ;
  int32 tmp ;
  int32 tmp___0 ;

  {
  {
#line 145
  f = (FILE *)file;
#line 146
  tmp = mdjvu_bitmap_get_height(bmp);
#line 146
  tmp___0 = mdjvu_bitmap_get_width(bmp);
#line 146
  write_bmp_header(f, (uint32 )tmp___0, (uint32 )tmp, resolution);
#line 148
  save_DIB_bytes(bmp, f);
  }
#line 149
  return (1);
}
}
#line 152 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
int mdjvu_save_bmp(mdjvu_bitmap_t bmp , char const   *path , int32 resolution , mdjvu_error_t *perr ) 
{ 
  FILE *f ;
  FILE *tmp ;
  int result ;

  {
  {
#line 157
  tmp = fopen((char const   */* __restrict  */)path, (char const   */* __restrict  */)"wb");
#line 157
  f = tmp;
  }
#line 159
  if (perr) {
#line 159
    *perr = (mdjvu_error_t )((void *)0);
  }
#line 160
  if (! f) {
    {
#line 162
    *perr = mdjvu_get_error((MinidjvuErrorType )0);
    }
#line 163
    return (0);
  }
  {
#line 165
  result = mdjvu_file_save_bmp(bmp, (mdjvu_file_t )f, resolution, perr);
#line 166
  fclose(f);
  }
#line 167
  return (result);
}
}
#line 170 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void invert_row(unsigned char *row , int32 bytes_per_row , int32 w ) 
{ 
  int32 i ;

  {
#line 173
  i = 0;
  {
#line 173
  while (1) {
    while_continue: /* CIL Label */ ;
#line 173
    if (! (i < bytes_per_row)) {
#line 173
      goto while_break;
    }
#line 174
    *(row + i) = (unsigned char )(~ ((int )*(row + i)));
#line 173
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 177
  if (w & 7) {
#line 178
    *(row + (bytes_per_row - 1)) = (unsigned char )((int )*(row + (bytes_per_row - 1)) & ~ (255 >> (w & 7)));
  }
#line 179
  return;
}
}
#line 190 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
mdjvu_bitmap_t mdjvu_file_load_bmp(mdjvu_file_t file , mdjvu_error_t *perr ) 
{ 
  FILE *f ;
  mdjvu_bitmap_t result ;
  int32 w ;
  int32 h ;
  int32 y ;
  int32 DIB_row_size ;
  int32 bytes_per_row ;
  int invert ;
  Header header ;
  int tmp ;
  int tmp___0 ;
  unsigned char *row ;
  unsigned char *tmp___1 ;
  int k ;
  size_t tmp___2 ;

  {
#line 192
  f = (FILE *)file;
#line 199
  if (perr) {
#line 199
    *perr = (mdjvu_error_t )((void *)0);
  }
  {
#line 201
  tmp = fgetc(f);
  }
#line 201
  if (! (tmp == 66)) {
#line 201
    if (perr) {
      {
#line 201
      *perr = mdjvu_get_error((MinidjvuErrorType )4);
      }
    }
#line 201
    return ((mdjvu_bitmap_t )((void *)0));
  }
  {
#line 202
  tmp___0 = fgetc(f);
  }
#line 202
  if (! (tmp___0 == 77)) {
#line 202
    if (perr) {
      {
#line 202
      *perr = mdjvu_get_error((MinidjvuErrorType )4);
      }
    }
#line 202
    return ((mdjvu_bitmap_t )((void *)0));
  }
  {
#line 203
  read_bmp_header(f, & header);
  }
#line 204
  if (! (header.compression == 0U)) {
#line 204
    if (perr) {
      {
#line 204
      *perr = mdjvu_get_error((MinidjvuErrorType )4);
      }
    }
#line 204
    return ((mdjvu_bitmap_t )((void *)0));
  }
#line 205
  if (! ((int )header.planes == 1)) {
#line 205
    if (perr) {
      {
#line 205
      *perr = mdjvu_get_error((MinidjvuErrorType )4);
      }
    }
#line 205
    return ((mdjvu_bitmap_t )((void *)0));
  }
#line 206
  if (! ((int )header.bits == 1)) {
#line 206
    if (perr) {
      {
#line 206
      *perr = mdjvu_get_error((MinidjvuErrorType )4);
      }
    }
#line 206
    return ((mdjvu_bitmap_t )((void *)0));
  }
#line 207
  if ((header.color_0 & 16777215U) == 0U) {
#line 207
    if (! ((header.color_1 & 16777215U) == 16777215U)) {
#line 207
      goto _L___0;
    }
  } else
  _L___0: /* CIL Label */ 
#line 207
  if ((header.color_1 & 16777215U) == 0U) {
#line 207
    if (! ((header.color_0 & 16777215U) == 16777215U)) {
#line 207
      goto _L;
    }
  } else {
    _L: /* CIL Label */ 
#line 207
    if (perr) {
      {
#line 207
      *perr = mdjvu_get_error((MinidjvuErrorType )4);
      }
    }
#line 207
    return ((mdjvu_bitmap_t )((void *)0));
  }
  {
#line 210
  invert = (header.color_0 & 16777215U) == 0U;
#line 211
  w = (int32 )header.width;
#line 212
  h = (int32 )header.height;
#line 213
  result = mdjvu_bitmap_create(w, h);
#line 214
  DIB_row_size = ((w + 31) & -32) >> 3;
#line 215
  bytes_per_row = mdjvu_bitmap_get_packed_row_size(result);
#line 217
  y = h;
  }
  {
#line 217
  while (1) {
    while_continue: /* CIL Label */ ;
#line 217
    if (! y) {
#line 217
      goto while_break;
    }
    {
#line 219
    tmp___1 = mdjvu_bitmap_access_packed_row(result, y - 1);
#line 219
    row = tmp___1;
#line 221
    tmp___2 = fread((void */* __restrict  */)row, (size_t )bytes_per_row, (size_t )1,
                    (FILE */* __restrict  */)f);
    }
#line 221
    if (tmp___2 != 1UL) {
#line 223
      if (perr) {
        {
#line 223
        *perr = mdjvu_get_error((MinidjvuErrorType )2);
        }
      }
#line 224
      return ((mdjvu_bitmap_t )((void *)0));
    }
#line 227
    k = 0;
    {
#line 227
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 227
      if (! (k < DIB_row_size - bytes_per_row)) {
#line 227
        goto while_break___0;
      }
      {
#line 228
      fgetc(f);
#line 227
      k ++;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 230
    if (invert) {
      {
#line 231
      invert_row(row, bytes_per_row, w);
      }
    }
#line 217
    y --;
  }
  while_break: /* CIL Label */ ;
  }
#line 234
  return (result);
}
}
#line 237 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
mdjvu_bitmap_t mdjvu_load_bmp(char const   *path , mdjvu_error_t *perr ) 
{ 
  FILE *f ;
  FILE *tmp ;
  mdjvu_bitmap_t result ;

  {
  {
#line 239
  tmp = fopen((char const   */* __restrict  */)path, (char const   */* __restrict  */)"rb");
#line 239
  f = tmp;
  }
#line 241
  if (! f) {
#line 243
    if (perr) {
      {
#line 243
      *perr = mdjvu_get_error((MinidjvuErrorType )1);
      }
    }
#line 244
    return ((mdjvu_bitmap_t )((void *)0));
  }
#line 246
  if (perr) {
#line 246
    *perr = (mdjvu_error_t )((void *)0);
  }
  {
#line 247
  result = mdjvu_file_load_bmp((mdjvu_file_t )f, perr);
#line 248
  fclose(f);
  }
#line 249
  return (result);
}
}
#line 5 "../include/minidjvu/alg/clean.h"
void mdjvu_clean(mdjvu_image_t image ) ;
#line 14 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/clean.c"
void mdjvu_clean(mdjvu_image_t image ) 
{ 
  int32 b ;
  int32 tmp ;
  int32 i ;
  int32 dpi___0 ;
  int32 tmp___0 ;
  int32 tinysize ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___1 ;
  int32 mass ;
  int32 tmp___2 ;
  int32 big ;
  int tmp___3 ;

  {
  {
#line 16
  tmp = mdjvu_image_get_blit_count(image);
#line 16
  b = tmp;
#line 17
  tmp___0 = mdjvu_image_get_resolution(image);
#line 17
  dpi___0 = tmp___0;
#line 18
  tinysize = (dpi___0 * dpi___0) / 20000 - 1;
#line 19
  mdjvu_image_enable_masses(image);
  }
#line 20
  if (tinysize <= 0) {
#line 20
    return;
  }
#line 22
  i = 0;
  {
#line 22
  while (1) {
    while_continue: /* CIL Label */ ;
#line 22
    if (! (i < b)) {
#line 22
      goto while_break;
    }
    {
#line 24
    tmp___1 = mdjvu_image_get_blit_bitmap(image, i);
#line 24
    bitmap = tmp___1;
#line 25
    tmp___2 = mdjvu_image_get_mass(image, bitmap);
#line 25
    mass = tmp___2;
#line 28
    tmp___3 = mdjvu_image_get_suspiciously_big_flag(image, bitmap);
#line 28
    big = tmp___3;
    }
#line 29
    if (mass <= tinysize) {
#line 29
      if (! big) {
        {
#line 30
        mdjvu_image_set_blit_bitmap(image, i, (mdjvu_bitmap_t )((void *)0));
        }
      }
    }
#line 22
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 33
  mdjvu_image_remove_NULL_blits(image);
#line 34
  mdjvu_image_remove_unused_bitmaps(image);
  }
#line 35
  return;
}
}
#line 12 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/smooth.c"
static void smooth_row___0(unsigned char *r , unsigned char *u , unsigned char *t ,
                           unsigned char *l , int32 n ) 
{ 
  int32 i ;
  int score ;

  {
#line 19
  i = 0;
  {
#line 19
  while (1) {
    while_continue: /* CIL Label */ ;
#line 19
    if (! (i < n)) {
#line 19
      goto while_break;
    }
#line 21
    score = ((((int )*(u + i) + (int )*(l + i)) + (int )*(t + (i - 1))) + (int )*(t + (i + 1))) - 2;
#line 28
    if (score < 0) {
#line 29
      *(r + i) = (unsigned char)0;
    } else {
#line 31
      *(r + i) = *(t + i);
    }
#line 19
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 33
  return;
}
}
#line 32 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/0porting.c"
static int initialized___1  =    0;
#line 57 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
static void interpret_runs_in_a_line___0(int32 min_x , int32 max_x , unsigned char *map ,
                                         unsigned char *result_line , unsigned char *line ) 
{ 
  int32 i ;

  {
  {
#line 62
  i = min_x;
#line 63
  memset((void *)result_line, 0, (size_t )((max_x - min_x) + 1));
#line 64
  *(map + (max_x + 1)) = (unsigned char)0;
  }
  {
#line 65
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 68
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 68
      if (! ((int )*(map + i) != 1)) {
#line 68
        goto while_break___0;
      }
#line 70
      i ++;
#line 70
      if (i > max_x) {
#line 70
        return;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 73
    *(map + i) = (unsigned char)0;
    {
#line 76
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 76
      if (! ((int )*(map + i) != 2)) {
#line 76
        goto while_break___1;
      }
#line 78
      *(result_line + (i - min_x)) = *(line + i);
#line 79
      *(line + i) = (unsigned char)0;
#line 80
      i ++;
#line 80
      if (i > max_x) {
#line 80
        return;
      }
    }
    while_break___1: /* CIL Label */ ;
    }
#line 83
    *(map + i) = (unsigned char)0;
  }
  while_break: /* CIL Label */ ;
  }
}
}
#line 93 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
static mdjvu_bitmap_t interpret_runs___0(int32 min_x , int32 max_x , int32 min_y ,
                                         int32 max_y , unsigned char **map , unsigned char **pixels ) 
{ 
  int32 w ;
  int32 h ;
  unsigned char *line_buf ;
  void *tmp ;
  mdjvu_bitmap_t bmp ;
  mdjvu_bitmap_t tmp___0 ;
  int32 y ;

  {
  {
#line 98
  w = (max_x - min_x) + 1;
#line 99
  h = (max_y - min_y) + 1;
#line 100
  tmp = malloc((size_t )w);
#line 100
  line_buf = (unsigned char *)tmp;
#line 101
  tmp___0 = mdjvu_bitmap_create(w, h);
#line 101
  bmp = tmp___0;
#line 103
  y = min_y;
  }
  {
#line 103
  while (1) {
    while_continue: /* CIL Label */ ;
#line 103
    if (! (y <= max_y)) {
#line 103
      goto while_break;
    }
    {
#line 105
    interpret_runs_in_a_line___0(min_x, max_x, *(map + y), line_buf, *(pixels + y));
#line 106
    mdjvu_bitmap_pack_row(bmp, line_buf, y - min_y);
#line 103
    y ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 108
  free((void *)line_buf);
  }
#line 109
  return (bmp);
}
}
#line 119 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
static void walk_around_a_black_contour___0(unsigned char **pixels , unsigned char **map ,
                                            int32 start_x , int32 start_y , int32 *pmin_x ,
                                            int32 *pmax_x , int32 *pmin_y , int32 *pmax_y ) 
{ 
  int32 x ;
  int32 y ;
  int32 dx ;
  int32 dy ;
  int32 min_x ;
  int32 max_x ;
  int32 max_y ;
  int32 x4 ;
  int32 y4 ;
  int32 old_dx ;
  int32 old_dx___0 ;

  {
#line 125
  x = start_x;
#line 125
  y = start_y;
#line 126
  dx = 0;
#line 126
  dy = 1;
#line 133
  min_x = start_x;
#line 134
  max_x = start_x;
#line 135
  max_y = start_y;
  {
#line 161
  while (1) {
    while_continue: /* CIL Label */ ;
#line 161
    if (! (x != start_x)) {
#line 161
      if (! (y != start_y)) {
#line 161
        if (! (dx != -1)) {
#line 161
          goto while_break;
        }
      }
    }
#line 163
    if (! *(*(pixels + y) + x)) {
      {
#line 163
      __assert_fail("pixels[y][x]", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c",
                    163U, "walk_around_a_black_contour");
      }
    }
#line 166
    if (x < min_x) {
#line 166
      min_x = x;
    } else
#line 166
    if (x > max_x) {
#line 166
      max_x = x;
    }
#line 167
    if (y > max_y) {
#line 167
      max_y = y;
    }
#line 170
    if (dx == 0) {
#line 172
      if (dy > 0) {
#line 173
        *(*(map + y) + x) = (unsigned char)1;
      } else {
#line 175
        *(*(map + y) + (x + 1)) = (unsigned char)2;
      }
    }
#line 179
    if (*(*(pixels + (y + dy)) + (x + dx))) {
#line 181
      x4 = (x + dx) - dy;
#line 181
      y4 = (y + dy) + dx;
#line 183
      if (*(*(pixels + y4) + x4)) {
#line 188
        old_dx = dx;
#line 189
        dx = - dy;
#line 190
        dy = old_dx;
#line 191
        x = x4;
#line 191
        y = y4;
      } else {
#line 196
        x += dx;
#line 196
        y += dy;
      }
    } else {
#line 203
      old_dx___0 = dx;
#line 204
      dx = dy;
#line 205
      dy = - old_dx___0;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 208
  *pmin_x = min_x;
#line 209
  *pmax_x = max_x;
#line 210
  *pmin_y = start_y;
#line 211
  *pmax_y = max_y;
#line 212
  return;
}
}
#line 216
static void add_to_image___0(mdjvu_image_t image , mdjvu_bitmap_t bitmap , int32 dpi___0 ,
                             mdjvu_split_options_t opt , int32 blit_shift_x , int32 blit_shift_y ,
                             int big ) ;
#line 227 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
static void process_row___0(unsigned char **pixels , unsigned char **map , int32 y ,
                            int32 w , int32 h , mdjvu_image_t image , int32 shift_x ,
                            int32 shift_y , int32 max_shape_width , int32 blit_shift_x ,
                            int32 blit_shift_y , int32 dpi___0 , mdjvu_split_options_t opt ,
                            int big ) 
{ 
  unsigned char *row ;
  int32 i ;
  int32 min_x ;
  int32 max_x ;
  int32 min_y ;
  int32 max_y ;
  int32 shape_width ;
  mdjvu_bitmap_t bitmap ;
  int32 tmp ;
  int32 number_of_chunks ;
  int32 j ;
  int32 shape_height ;
  int32 tmp___0 ;
  int32 chunk_x ;
  mdjvu_bitmap_t chunk ;
  mdjvu_bitmap_t tmp___1 ;

  {
#line 235
  row = *(pixels + y);
#line 237
  i = 0;
  {
#line 237
  while (1) {
    while_continue: /* CIL Label */ ;
#line 237
    if (! (i < w)) {
#line 237
      goto while_break;
    }
#line 239
    if (*(row + i)) {
      {
#line 245
      walk_around_a_black_contour___0(pixels, map, i, y, & min_x, & max_x, & min_y,
                                      & max_y);
#line 247
      bitmap = interpret_runs___0(min_x, max_x, min_y, max_y, map, pixels);
#line 250
      shape_width = mdjvu_bitmap_get_width(bitmap);
      }
#line 251
      if (! (shape_width == (max_x - min_x) + 1)) {
        {
#line 251
        __assert_fail("shape_width == max_x - min_x + 1", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c",
                      251U, "process_row");
        }
      }
      {
#line 252
      tmp = mdjvu_bitmap_get_height(bitmap);
      }
#line 252
      if (! (tmp == (max_y - min_y) + 1)) {
        {
#line 252
        __assert_fail("mdjvu_bitmap_get_height(bitmap) == max_y - min_y + 1", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c",
                      252U, "process_row");
        }
      }
#line 253
      if (shape_width <= max_shape_width) {
        {
#line 255
        mdjvu_image_add_bitmap(image, bitmap);
#line 256
        mdjvu_image_add_blit(image, (shift_x + min_x) + blit_shift_x, (y + shift_y) + blit_shift_y,
                             bitmap);
#line 258
        mdjvu_image_set_suspiciously_big_flag(image, bitmap, big);
        }
      } else {
        {
#line 263
        number_of_chunks = ((shape_width + max_shape_width) - 1) / max_shape_width;
#line 267
        tmp___0 = mdjvu_bitmap_get_height(bitmap);
#line 267
        shape_height = tmp___0;
#line 268
        j = 0;
        }
        {
#line 268
        while (1) {
          while_continue___0: /* CIL Label */ ;
#line 268
          if (! (j < number_of_chunks)) {
#line 268
            goto while_break___0;
          }
          {
#line 270
          chunk_x = (shape_width * j) / number_of_chunks;
#line 271
          tmp___1 = mdjvu_bitmap_crop(bitmap, chunk_x, 0, (shape_width * (j + 1)) / number_of_chunks - chunk_x,
                                      shape_height);
#line 271
          chunk = tmp___1;
#line 280
          add_to_image___0(image, chunk, dpi___0, opt, ((shift_x + chunk_x) + min_x) + blit_shift_x,
                           (y + shift_y) + blit_shift_y, 1);
#line 283
          mdjvu_bitmap_destroy(chunk);
#line 268
          j ++;
          }
        }
        while_break___0: /* CIL Label */ ;
        }
        {
#line 285
        mdjvu_bitmap_destroy(bitmap);
        }
      }
    }
#line 237
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 289
  return;
}
}
#line 295 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/split.c"
static void add_to_image___0(mdjvu_image_t image , mdjvu_bitmap_t bitmap , int32 dpi___0 ,
                             mdjvu_split_options_t opt , int32 blit_shift_x , int32 blit_shift_y ,
                             int big ) 
{ 
  int32 max_shape_size ;
  int32 tmp ;
  int32 width ;
  int32 tmp___0 ;
  int32 height ;
  int32 tmp___1 ;
  unsigned char **buf ;
  unsigned char **window_base ;
  unsigned char **window_buf ;
  unsigned char **map ;
  int32 window_shift ;
  int32 y ;
  int32 i ;
  void *tmp___2 ;
  unsigned char *tmp___3 ;
  unsigned char *tmp___4 ;
  unsigned char *top_margin_save ;
  unsigned char *bot_margin_save ;
  int32 old_window_shift ;

  {
#line 303
  if (opt) {
#line 303
    tmp = *((int32 *)opt);
  } else {
#line 303
    tmp = 0;
  }
  {
#line 303
  max_shape_size = tmp;
#line 304
  tmp___0 = mdjvu_bitmap_get_width(bitmap);
#line 304
  width = tmp___0;
#line 305
  tmp___1 = mdjvu_bitmap_get_height(bitmap);
#line 305
  height = tmp___1;
#line 307
  window_shift = 0;
#line 307
  y = 0;
  }
#line 309
  if (! max_shape_size) {
#line 310
    max_shape_size = dpi___0;
  }
#line 311
  if (max_shape_size > height) {
#line 312
    max_shape_size = height;
  }
  {
#line 327
  map = mdjvu_create_2d_array(width + 1, max_shape_size);
#line 330
  buf = mdjvu_create_2d_array(width + 2, max_shape_size + 1);
#line 331
  tmp___2 = malloc((unsigned long )(2 * (max_shape_size + 2)) * sizeof(unsigned char *));
#line 331
  window_buf = (unsigned char **)tmp___2;
#line 333
  window_base = window_buf + 1;
#line 336
  i = 0;
  }
  {
#line 336
  while (1) {
    while_continue: /* CIL Label */ ;
#line 336
    if (! (i < max_shape_size)) {
#line 336
      goto while_break;
    }
    {
#line 338
    tmp___3 = *(buf + i) + 1;
#line 338
    *(window_base + (max_shape_size + i)) = tmp___3;
#line 338
    *(window_base + i) = tmp___3;
#line 339
    mdjvu_bitmap_unpack_row(bitmap, *(buf + i) + 1, i);
#line 336
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 343
  tmp___4 = *(buf + max_shape_size) + 1;
#line 343
  *(window_base + (2 * max_shape_size - 1)) = tmp___4;
#line 343
  *(window_base + -1) = tmp___4;
  {
#line 350
  while (1) {
    while_continue___0: /* CIL Label */ ;
    {
#line 356
    top_margin_save = *(window_base + (window_shift - 1));
#line 358
    bot_margin_save = *(window_base + (window_shift + max_shape_size));
#line 361
    *(window_base + (window_shift - 1)) = *(buf + max_shape_size) + 1;
#line 362
    *(window_base + (window_shift + max_shape_size)) = *(buf + max_shape_size) + 1;
#line 364
    process_row___0(window_base + window_shift, map, 0, width, max_shape_size, image,
                    0, y, max_shape_size, blit_shift_x, blit_shift_y, dpi___0, opt,
                    big);
#line 369
    *(window_base + (window_shift - 1)) = top_margin_save;
#line 370
    *(window_base + (window_shift + max_shape_size)) = bot_margin_save;
#line 373
    y ++;
#line 374
    old_window_shift = window_shift;
#line 375
    window_shift = y % max_shape_size;
    }
#line 376
    if (y + max_shape_size > height) {
#line 377
      goto while_break___0;
    }
    {
#line 380
    mdjvu_bitmap_unpack_row(bitmap, *(buf + old_window_shift) + 1, (y + max_shape_size) - 1);
    }
  }
  while_break___0: /* CIL Label */ ;
  }
#line 385
  i = 0;
  {
#line 385
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 385
    if (! (y + i < height)) {
#line 385
      goto while_break___1;
    }
    {
#line 387
    process_row___0(window_base + window_shift, map, i, width, max_shape_size, image,
                    0, y, max_shape_size, blit_shift_x, blit_shift_y, dpi___0, opt,
                    big);
#line 385
    i ++;
    }
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 394
  free((void *)window_buf);
#line 395
  mdjvu_destroy_2d_array(map);
#line 396
  mdjvu_destroy_2d_array(buf);
  }
#line 397
  return;
}
}
#line 58 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static Class *new_class___0(Classification *cl ) 
{ 
  Class *c ;
  void *tmp ;
  ClassNode *tmp___0 ;

  {
  {
#line 60
  tmp = malloc(sizeof(Class ));
#line 60
  c = (Class *)tmp;
#line 61
  tmp___0 = (ClassNode *)((void *)0);
#line 61
  c->last = tmp___0;
#line 61
  c->first = tmp___0;
#line 62
  c->prev_class = (struct Class *)((void *)0);
#line 63
  c->next_class = cl->first_class;
#line 64
  c->last_page = 0;
  }
#line 65
  if (cl->first_class) {
#line 65
    (cl->first_class)->prev_class = c;
  }
#line 66
  cl->first_class = c;
#line 67
  return (c);
}
}
#line 71 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static void delete_class___0(Classification *cl , Class *c ) 
{ 
  Class *prev ;
  Class *next ;

  {
#line 73
  prev = c->prev_class;
#line 73
  next = c->next_class;
#line 75
  if (prev) {
#line 76
    prev->next_class = next;
  } else {
#line 78
    cl->first_class = next;
  }
#line 80
  if (next) {
#line 81
    next->prev_class = prev;
  }
  {
#line 83
  while (1) {
    while_continue: /* CIL Label */ ;
#line 83
    if (c) {
      {
#line 83
      free((void *)c);
      }
    }
#line 83
    goto while_break;
  }
  while_break: /* CIL Label */ ;
  }
#line 84
  return;
}
}
#line 87 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static ClassNode *new_node___0(Classification *cl , Class *c , mdjvu_pattern_t ptr ) 
{ 
  ClassNode *n ;
  void *tmp ;

  {
  {
#line 89
  tmp = malloc(sizeof(ClassNode ));
#line 89
  n = (ClassNode *)tmp;
#line 90
  n->ptr = ptr;
#line 91
  n->next = c->first;
#line 92
  c->first = n;
  }
#line 93
  if (! c->last) {
#line 93
    c->last = n;
  }
#line 94
  n->global_next = (struct ClassNode *)((void *)0);
#line 96
  if (cl->last_node) {
#line 97
    (cl->last_node)->global_next = n;
  } else {
#line 99
    cl->first_node = n;
  }
#line 101
  cl->last_node = n;
#line 102
  return (n);
}
}
#line 106 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static Class *merge___0(Classification *cl , Class *c1 , Class *c2 ) 
{ 


  {
#line 108
  if (! c1->first) {
    {
#line 110
    delete_class___0(cl, c1);
    }
#line 111
    return (c2);
  }
#line 113
  if (c2->first) {
#line 115
    (c1->last)->next = c2->first;
#line 116
    c1->last = c2->last;
  }
  {
#line 118
  delete_class___0(cl, c2);
  }
#line 119
  return (c1);
}
}
#line 123 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static unsigned int put_tags___0(Classification *cl ) 
{ 
  int32 tag ;
  Class *c ;
  ClassNode *n ;

  {
#line 125
  tag = 1;
#line 126
  c = cl->first_class;
  {
#line 127
  while (1) {
    while_continue: /* CIL Label */ ;
#line 127
    if (! c) {
#line 127
      goto while_break;
    }
#line 129
    n = c->first;
    {
#line 130
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 130
      if (! n) {
#line 130
        goto while_break___0;
      }
#line 132
      n->tag = tag;
#line 133
      n = n->next;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 135
    c = c->next_class;
#line 136
    tag ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 138
  return ((unsigned int )(tag - 1));
}
}
#line 142 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static void delete_all_classes___0(Classification *cl ) 
{ 
  Class *c ;
  Class *t ;

  {
#line 144
  c = cl->first_class;
  {
#line 145
  while (1) {
    while_continue: /* CIL Label */ ;
#line 145
    if (! c) {
#line 145
      goto while_break;
    }
#line 147
    t = c;
#line 148
    c = c->next_class;
    {
#line 149
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 149
      if (t) {
        {
#line 149
        free((void *)t);
        }
      }
#line 149
      goto while_break___0;
    }
    while_break___0: /* CIL Label */ ;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 151
  return;
}
}
#line 154 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static int compare_to_class___0(mdjvu_pattern_t p , Class *c , int32 dpi___0 , mdjvu_matcher_options_t options ,
                                int flag ) 
{ 
  int r ;
  ClassNode *n ;

  {
#line 157
  r = 0;
#line 158
  n = c->first;
  {
#line 159
  while (1) {
    while_continue: /* CIL Label */ ;
#line 159
    if (! n) {
#line 159
      goto while_break;
    }
    {
#line 161
    r = mdjvu_match_patterns(p, n->ptr, dpi___0, options);
    }
#line 162
    if (r == flag) {
#line 162
      return (1);
    }
#line 163
    n = n->next;
  }
  while_break: /* CIL Label */ ;
  }
#line 165
  return (0);
}
}
#line 168 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static void classify___0(Classification *cl , mdjvu_pattern_t p , int32 dpi___0 ,
                         mdjvu_matcher_options_t options , int32 page ) 
{ 
  Class *class_of_this ;
  Class *c ;
  Class *next_c ;
  int tmp ;
  int tmp___0 ;

  {
#line 172
  class_of_this = (Class *)((void *)0);
#line 173
  next_c = (Class *)((void *)0);
#line 174
  c = cl->first_class;
  {
#line 174
  while (1) {
    while_continue: /* CIL Label */ ;
#line 174
    if (! c) {
#line 174
      goto while_break;
    }
#line 176
    next_c = c->next_class;
#line 178
    if ((unsigned long )class_of_this == (unsigned long )c) {
#line 178
      goto __Cont;
    }
#line 179
    if (c->last_page < page - 1) {
#line 179
      goto __Cont;
    }
    {
#line 180
    tmp = compare_to_class___0(p, c, dpi___0, options, -1);
    }
#line 180
    if (tmp) {
#line 181
      goto __Cont;
    } else {
      {
#line 180
      tmp___0 = compare_to_class___0(p, c, dpi___0, options, 1);
      }
#line 180
      if (! tmp___0) {
#line 181
        goto __Cont;
      }
    }
#line 183
    if (class_of_this) {
      {
#line 184
      class_of_this = merge___0(cl, class_of_this, c);
      }
    } else {
#line 186
      class_of_this = c;
    }
    __Cont: /* CIL Label */ 
#line 174
    c = next_c;
  }
  while_break: /* CIL Label */ ;
  }
#line 188
  if (! class_of_this) {
    {
#line 188
    class_of_this = new_class___0(cl);
    }
  }
#line 189
  if (page > class_of_this->last_page) {
#line 190
    class_of_this->last_page = page;
  }
  {
#line 191
  new_node___0(cl, class_of_this, p);
  }
#line 192
  return;
}
}
#line 194 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static int32 get_tags_from_classification___0(mdjvu_pattern_t *b , int32 *r , int32 n ,
                                              Classification *cl ) 
{ 
  int32 i ;
  int32 max_tag ;
  unsigned int tmp ;
  ClassNode *node ;
  ClassNode *t ;
  int32 tmp___0 ;
  int32 tmp___1 ;
  int32 tmp___2 ;

  {
  {
#line 197
  tmp = put_tags___0(cl);
#line 197
  max_tag = (int32 )tmp;
#line 200
  delete_all_classes___0(cl);
#line 202
  i = 0;
#line 203
  node = cl->first_node;
  }
  {
#line 204
  while (1) {
    while_continue: /* CIL Label */ ;
#line 204
    if (! node) {
#line 204
      goto while_break;
    }
    {
#line 207
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 207
      if (! (! *(b + i))) {
#line 207
        goto while_break___0;
      }
#line 209
      tmp___0 = i;
#line 209
      i ++;
#line 209
      *(r + tmp___0) = 0;
#line 210
      if (! (i < n)) {
        {
#line 210
        __assert_fail("i < n", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c",
                      210U, "get_tags_from_classification");
        }
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 212
    tmp___1 = i;
#line 212
    i ++;
#line 212
    *(r + tmp___1) = node->tag;
#line 213
    t = node;
#line 214
    node = node->global_next;
    {
#line 215
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 215
      if (t) {
        {
#line 215
        free((void *)t);
        }
      }
#line 215
      goto while_break___1;
    }
    while_break___1: /* CIL Label */ ;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 217
  if (i < n) {
    {
#line 217
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 217
      if (! (i < n)) {
#line 217
        goto while_break___2;
      }
#line 217
      tmp___2 = i;
#line 217
      i ++;
#line 217
      *(r + tmp___2) = 0;
    }
    while_break___2: /* CIL Label */ ;
    }
  }
#line 218
  return (max_tag);
}
}
#line 221 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static void init_classification___0(Classification *c ) 
{ 
  ClassNode *tmp ;

  {
#line 223
  c->first_class = (Class *)((void *)0);
#line 224
  tmp = (ClassNode *)((void *)0);
#line 224
  c->last_node = tmp;
#line 224
  c->first_node = tmp;
#line 225
  return;
}
}
#line 241 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/classify.c"
static void get_cheap_center___0(mdjvu_bitmap_t bitmap , int32 *cx , int32 *cy ) 
{ 
  int32 tmp ;
  int32 tmp___0 ;

  {
  {
#line 243
  tmp = mdjvu_bitmap_get_width(bitmap);
#line 243
  *cx = tmp / 2;
#line 244
  tmp___0 = mdjvu_bitmap_get_height(bitmap);
#line 244
  *cy = tmp___0 / 2;
  }
#line 245
  return;
}
}
#line 78 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c"
static int donut_connectivity_test___0(byte *upper , byte *row , byte *lower ) 
{ 
  int sum ;
  int l ;
  int u ;
  int d ;
  int r ;
  int x ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  int s ;
  int tmp___3 ;
  int tmp___4 ;
  int tmp___5 ;
  int tmp___6 ;

  {
#line 95
  if (*upper) {
#line 95
    u = 1;
  } else {
#line 95
    u = 0;
  }
#line 95
  if (*lower) {
#line 95
    d = 1;
  } else {
#line 95
    d = 0;
  }
#line 95
  if (*(row + -1)) {
#line 95
    l = 1;
  } else {
#line 95
    l = 0;
  }
#line 95
  if (*(row + 1)) {
#line 95
    r = 1;
  } else {
#line 95
    r = 0;
  }
#line 95
  sum = ((u + d) + l) + r;
  {
#line 100
  if (sum == 3) {
#line 100
    goto case_3;
  }
#line 117
  if (sum == 2) {
#line 117
    goto case_2___0;
  }
#line 151
  if (sum == 4) {
#line 151
    goto case_4;
  }
#line 151
  if (sum == 0) {
#line 151
    goto case_4;
  }
#line 153
  if (sum == 1) {
#line 153
    goto case_1___0;
  }
#line 155
  goto switch_default___0;
  case_3: /* CIL Label */ 
#line 102
  x = 6 - (((u + (l << 1)) + d) + (d << 1));
  {
#line 105
  if (x == 0) {
#line 105
    goto case_0;
  }
#line 107
  if (x == 1) {
#line 107
    goto case_1;
  }
#line 109
  if (x == 2) {
#line 109
    goto case_2;
  }
#line 111
  if (x == 3) {
#line 111
    goto case_3___0;
  }
#line 113
  goto switch_default;
  case_0: /* CIL Label */ 
#line 106
  if (*(upper + -1)) {
#line 106
    if (*(lower + -1)) {
#line 106
      tmp = 0;
    } else {
#line 106
      tmp = 1;
    }
  } else {
#line 106
    tmp = 1;
  }
#line 106
  return (tmp);
  case_1: /* CIL Label */ 
#line 108
  if (*(lower + -1)) {
#line 108
    if (*(lower + 1)) {
#line 108
      tmp___0 = 0;
    } else {
#line 108
      tmp___0 = 1;
    }
  } else {
#line 108
    tmp___0 = 1;
  }
#line 108
  return (tmp___0);
  case_2: /* CIL Label */ 
#line 110
  if (*(upper + 1)) {
#line 110
    if (*(lower + 1)) {
#line 110
      tmp___1 = 0;
    } else {
#line 110
      tmp___1 = 1;
    }
  } else {
#line 110
    tmp___1 = 1;
  }
#line 110
  return (tmp___1);
  case_3___0: /* CIL Label */ 
#line 112
  if (*(upper + -1)) {
#line 112
    if (*(upper + 1)) {
#line 112
      tmp___2 = 0;
    } else {
#line 112
      tmp___2 = 1;
    }
  } else {
#line 112
    tmp___2 = 1;
  }
#line 112
  return (tmp___2);
  switch_default: /* CIL Label */ 
  {
#line 113
  __assert_fail("0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                113U, "donut_connectivity_test");
  }
#line 113
  return (0);
  switch_break___0: /* CIL Label */ ;
  }
#line 116
  goto switch_break;
  case_2___0: /* CIL Label */ 
#line 119
  s = l + r;
#line 120
  if (s & 1) {
#line 126
    if (l) {
#line 128
      if (u) {
#line 129
        if (*(upper + -1)) {
#line 129
          tmp___3 = 0;
        } else {
#line 129
          tmp___3 = 1;
        }
#line 129
        return (tmp___3);
      } else {
#line 131
        if (*(lower + -1)) {
#line 131
          tmp___4 = 0;
        } else {
#line 131
          tmp___4 = 1;
        }
#line 131
        return (tmp___4);
      }
    } else
#line 135
    if (u) {
#line 136
      if (*(upper + 1)) {
#line 136
        tmp___5 = 0;
      } else {
#line 136
        tmp___5 = 1;
      }
#line 136
      return (tmp___5);
    } else {
#line 138
      if (*(lower + 1)) {
#line 138
        tmp___6 = 0;
      } else {
#line 138
        tmp___6 = 1;
      }
#line 138
      return (tmp___6);
    }
  } else {
#line 147
    return (1);
  }
#line 150
  goto switch_break;
  case_4: /* CIL Label */ 
  case_0___0: /* CIL Label */ 
#line 152
  return (1);
  case_1___0: /* CIL Label */ 
#line 154
  return (0);
  switch_default___0: /* CIL Label */ 
  {
#line 155
  __assert_fail("0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                155U, "donut_connectivity_test");
  }
#line 155
  return (0);
  switch_break: /* CIL Label */ ;
  }
#line 157
  return (0);
}
}
#line 158 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c"
static byte donut_transform_pixel___0(byte *upper , byte *row , byte *lower ) 
{ 
  int sum ;
  int l ;
  int u ;
  int d ;
  int r ;
  int x ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  int s ;
  int tmp___3 ;
  int tmp___4 ;
  int tmp___5 ;
  int tmp___6 ;

  {
#line 189
  if (! *row) {
#line 189
    return ((byte )0);
  }
#line 191
  if (*upper) {
#line 191
    u = 1;
  } else {
#line 191
    u = 0;
  }
#line 191
  if (*lower) {
#line 191
    d = 1;
  } else {
#line 191
    d = 0;
  }
#line 191
  if (*(row + -1)) {
#line 191
    l = 1;
  } else {
#line 191
    l = 0;
  }
#line 191
  if (*(row + 1)) {
#line 191
    r = 1;
  } else {
#line 191
    r = 0;
  }
#line 191
  sum = ((u + d) + l) + r;
  {
#line 196
  if (sum == 3) {
#line 196
    goto case_3;
  }
#line 196
  if (sum == 1) {
#line 196
    goto case_3;
  }
#line 214
  if (sum == 2) {
#line 214
    goto case_2___0;
  }
#line 248
  if (sum == 4) {
#line 248
    goto case_4;
  }
#line 248
  if (sum == 0) {
#line 248
    goto case_4;
  }
#line 250
  goto switch_default___0;
  case_3: /* CIL Label */ 
  case_1: /* CIL Label */ 
#line 198
  x = ((u + (l << 1)) + d) + (d << 1);
#line 199
  if (sum == 3) {
#line 199
    x = (6 - x) ^ 2;
  }
  {
#line 202
  if (x == 0) {
#line 202
    goto case_0;
  }
#line 204
  if (x == 1) {
#line 204
    goto case_1___0;
  }
#line 206
  if (x == 2) {
#line 206
    goto case_2;
  }
#line 208
  if (x == 3) {
#line 208
    goto case_3___0;
  }
#line 210
  goto switch_default;
  case_0: /* CIL Label */ 
#line 203
  if (*(upper + 1)) {
#line 203
    if (*(lower + 1)) {
#line 203
      tmp = 0;
    } else {
#line 203
      tmp = 1;
    }
  } else {
#line 203
    tmp = 1;
  }
#line 203
  return ((byte )tmp);
  case_1___0: /* CIL Label */ 
#line 205
  if (*(upper + -1)) {
#line 205
    if (*(upper + 1)) {
#line 205
      tmp___0 = 0;
    } else {
#line 205
      tmp___0 = 1;
    }
  } else {
#line 205
    tmp___0 = 1;
  }
#line 205
  return ((byte )tmp___0);
  case_2: /* CIL Label */ 
#line 207
  if (*(upper + -1)) {
#line 207
    if (*(lower + -1)) {
#line 207
      tmp___1 = 0;
    } else {
#line 207
      tmp___1 = 1;
    }
  } else {
#line 207
    tmp___1 = 1;
  }
#line 207
  return ((byte )tmp___1);
  case_3___0: /* CIL Label */ 
#line 209
  if (*(lower + -1)) {
#line 209
    if (*(lower + 1)) {
#line 209
      tmp___2 = 0;
    } else {
#line 209
      tmp___2 = 1;
    }
  } else {
#line 209
    tmp___2 = 1;
  }
#line 209
  return ((byte )tmp___2);
  switch_default: /* CIL Label */ 
  {
#line 210
  __assert_fail("0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                210U, "donut_transform_pixel");
  }
#line 210
  return ((byte )0);
  switch_break___0: /* CIL Label */ ;
  }
#line 213
  goto switch_break;
  case_2___0: /* CIL Label */ 
#line 216
  s = l + r;
#line 217
  if (s & 1) {
#line 223
    if (l) {
#line 225
      if (u) {
#line 226
        if (*(upper + -1)) {
#line 226
          tmp___3 = 0;
        } else {
#line 226
          tmp___3 = 1;
        }
#line 226
        return ((byte )tmp___3);
      } else {
#line 228
        if (*(lower + -1)) {
#line 228
          tmp___4 = 0;
        } else {
#line 228
          tmp___4 = 1;
        }
#line 228
        return ((byte )tmp___4);
      }
    } else
#line 232
    if (u) {
#line 233
      if (*(upper + 1)) {
#line 233
        tmp___5 = 0;
      } else {
#line 233
        tmp___5 = 1;
      }
#line 233
      return ((byte )tmp___5);
    } else {
#line 235
      if (*(lower + 1)) {
#line 235
        tmp___6 = 0;
      } else {
#line 235
        tmp___6 = 1;
      }
#line 235
      return ((byte )tmp___6);
    }
  } else {
#line 244
    return ((byte )1);
  }
#line 247
  goto switch_break;
  case_4: /* CIL Label */ 
  case_0___0: /* CIL Label */ 
#line 249
  return ((byte )1);
  switch_default___0: /* CIL Label */ 
  {
#line 250
  __assert_fail("0", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                250U, "donut_transform_pixel");
  }
#line 250
  return ((byte )0);
  switch_break: /* CIL Label */ ;
  }
#line 252
  return ((unsigned char)0);
}
}
#line 257 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c"
static int flay___0(byte **pixels , int w , int h , int rank , int **ranks ) 
{ 
  int i ;
  int j ;
  int result ;
  byte *buf ;
  void *tmp ;
  byte *up ;
  byte *row ;
  byte *dn ;
  byte *buf_row ;
  int *rank_row ;
  int tmp___0 ;

  {
  {
#line 259
  result = 0;
#line 261
  tmp = malloc(sizeof(byte ) * (unsigned long )(w * h));
#line 261
  buf = (byte *)tmp;
  }
#line 263
  if (! pixels) {
    {
#line 263
    __assert_fail("pixels", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                  263U, "flay");
    }
  }
#line 264
  if (! w) {
    {
#line 264
    __assert_fail("w", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                  264U, "flay");
    }
  }
#line 265
  if (! h) {
    {
#line 265
    __assert_fail("h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/frames.c",
                  265U, "flay");
    }
  }
#line 267
  i = 0;
  {
#line 267
  while (1) {
    while_continue: /* CIL Label */ ;
#line 267
    if (! (i < h)) {
#line 267
      goto while_break;
    }
#line 267
    j = 0;
    {
#line 267
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 267
      if (! (j < w)) {
#line 267
        goto while_break___0;
      }
      {
#line 269
      *(buf + (w * i + j)) = donut_transform_pixel___0(*(pixels + (i - 1)) + j, *(pixels + i) + j,
                                                       *(pixels + (i + 1)) + j);
#line 267
      j ++;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 267
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 273
  i = 0;
  {
#line 273
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 273
    if (! (i < h)) {
#line 273
      goto while_break___1;
    }
#line 275
    up = *(pixels + (i - 1));
#line 275
    row = *(pixels + i);
#line 275
    dn = *(pixels + (i + 1));
#line 276
    buf_row = buf + w * i;
#line 277
    rank_row = (int *)((void *)0);
#line 278
    if (ranks) {
#line 278
      rank_row = *(ranks + i);
    }
#line 279
    j = 0;
    {
#line 279
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 279
      if (! (j < w)) {
#line 279
        goto while_break___2;
      }
#line 281
      if (*(row + j)) {
#line 281
        if (! *(buf_row + j)) {
          {
#line 283
          tmp___0 = donut_connectivity_test___0(up + j, row + j, dn + j);
          }
#line 283
          if (! tmp___0) {
#line 285
            *(row + j) = *(buf_row + j);
#line 286
            if (rank) {
#line 286
              *(rank_row + j) = rank;
            }
#line 287
            result = 1;
          }
        } else {
#line 291
          *(row + j) = *(buf_row + j);
        }
      } else {
#line 291
        *(row + j) = *(buf_row + j);
      }
#line 279
      j ++;
    }
    while_break___2: /* CIL Label */ ;
    }
#line 273
    i ++;
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 295
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 295
    if (buf) {
      {
#line 295
      free((void *)buf);
      }
    }
#line 295
    goto while_break___3;
  }
  while_break___3: /* CIL Label */ ;
  }
#line 296
  return (result);
}
}
#line 10 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
static uint32 read_uint32_most_significant_byte_first___0(FILE *f ) 
{ 
  uint32 r ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;

  {
  {
#line 12
  tmp = fgetc(f);
#line 12
  r = (uint32 )(tmp << 24);
#line 13
  tmp___0 = fgetc(f);
#line 13
  r |= (unsigned int )(tmp___0 << 16);
#line 14
  tmp___1 = fgetc(f);
#line 14
  r |= (unsigned int )(tmp___1 << 8);
#line 15
  tmp___2 = fgetc(f);
#line 15
  r |= (unsigned int )tmp___2;
  }
#line 16
  return (r);
}
}
#line 27 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
static void skip_in_chunk___0(IFFChunk *chunk , unsigned int len ) 
{ 


  {
  {
#line 29
  while (1) {
    while_continue: /* CIL Label */ ;
#line 29
    if (! chunk) {
#line 29
      goto while_break;
    }
#line 31
    chunk->skipped += len;
#line 32
    chunk = chunk->parent;
  }
  while_break: /* CIL Label */ ;
  }
#line 34
  return;
}
}
#line 36 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
static void skip_to_next_sibling_chunk___0(FILE *file , IFFChunk *chunk ) 
{ 


  {
  {
#line 38
  skip_in_chunk___0(chunk->parent, chunk->length + 8U);
#line 39
  fseek(file, (long )((chunk->length + 1U) & 4294967294U), 1);
#line 40
  chunk->id = read_uint32_most_significant_byte_first___0(file);
#line 41
  chunk->length = read_uint32_most_significant_byte_first___0(file);
#line 42
  chunk->skipped = (uint32 )0;
  }
#line 43
  return;
}
}
#line 45 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
static void get_child_chunk___0(FILE *file , IFFChunk *chunk , IFFChunk *parent ) 
{ 


  {
  {
#line 47
  chunk->id = read_uint32_most_significant_byte_first___0(file);
#line 48
  chunk->length = read_uint32_most_significant_byte_first___0(file);
#line 49
  chunk->skipped = (uint32 )0;
#line 50
  chunk->parent = parent;
#line 51
  skip_in_chunk___0(parent, 8U);
  }
#line 52
  return;
}
}
#line 54 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/djvuload.c"
static int find_sibling_chunk___0(FILE *file , IFFChunk *chunk , uint32 id ) 
{ 


  {
  {
#line 56
  while (1) {
    while_continue: /* CIL Label */ ;
#line 56
    if (! (chunk->id != id)) {
#line 56
      goto while_break;
    }
#line 58
    if (chunk->parent) {
#line 58
      if ((chunk->parent)->skipped >= (chunk->parent)->length) {
#line 59
        return (0);
      }
    }
    {
#line 60
    skip_to_next_sibling_chunk___0(file, chunk);
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 62
  return (1);
}
}
#line 82 "/usr/include/libintl.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__leaf__)) textdomain)(char const   *__domainname ) ;
#line 147 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1), __leaf__)) atoi)(char const   *__nptr )  __attribute__((__pure__)) ;
#line 195 "/usr/include/stdio.h"
extern FILE *tmpfile(void) ;
#line 364
extern  __attribute__((__nothrow__)) int sprintf(char * __restrict  __s , char const   * __restrict  __format 
                                                 , ...) ;
#line 433
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) sscanf)(char const   * __restrict  __s ,
                                                                             char const   * __restrict  __format 
                                                                             , ...)  __asm__("__isoc99_sscanf")  ;
#line 129 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strcpy)(char * __restrict  __dest ,
                                                                                                 char const   * __restrict  __src ) ;
#line 132
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strncpy)(char * __restrict  __dest ,
                                                                                                  char const   * __restrict  __src ,
                                                                                                  size_t __n ) ;
#line 137
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strcat)(char * __restrict  __dest ,
                                                                                                 char const   * __restrict  __src ) ;
#line 144
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,2), __leaf__)) strcmp)(char const   *__s1 ,
                                                                                               char const   *__s2 )  __attribute__((__pure__)) ;
#line 263
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1), __leaf__)) strrchr)(char const   *__s ,
                                                                                                int __c )  __attribute__((__pure__)) ;
#line 285
extern  __attribute__((__nothrow__)) size_t ( __attribute__((__nonnull__(1,2), __leaf__)) strcspn)(char const   *__s ,
                                                                                                   char const   *__reject )  __attribute__((__pure__)) ;
#line 181 "/usr/include/x86_64-linux-gnu/bits/mathcalls.h"
extern  __attribute__((__nothrow__)) double ( __attribute__((__leaf__)) fabs)(double __x )  __attribute__((__const__)) ;
#line 124 "/usr/include/locale.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__leaf__)) setlocale)(int __category ,
                                                                                  char const   *__locale ) ;
#line 18 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int32 dpi  =    300;
#line 19 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int32 pages_per_dict  =    10;
#line 20 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int dpi_specified  =    0;
#line 21 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int verbose  =    0;
#line 22 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int smooth  =    0;
#line 23 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int averaging  =    0;
#line 24 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int match  =    0;
#line 25 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int Match  =    0;
#line 26 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int aggression  =    100;
#line 27 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int erosion  =    0;
#line 28 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int clean  =    0;
#line 29 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int report  =    0;
#line 30 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int no_prototypes  =    0;
#line 31 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int warnings  =    0;
#line 32 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int indirect  =    0;
#line 33 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
char const   *dict_suffix  =    (char const   *)((void *)0);
#line 39 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static int get_ext_delim_pos(char const   *fname ) 
{ 
  size_t pos ;
  size_t tmp ;
  size_t last ;
  size_t tmp___0 ;

  {
  {
#line 41
  tmp = strcspn(fname, ".");
#line 41
  pos = tmp;
#line 42
  last = (size_t )0;
  }
  {
#line 44
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 44
    tmp___0 = strlen(fname);
    }
#line 44
    if (! (last + pos != tmp___0)) {
#line 44
      goto while_break;
    }
    {
#line 46
    last += pos + 1UL;
#line 47
    pos = strcspn(fname + last, ".");
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 49
  return ((int )last);
}
}
#line 52 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static char *get_page_or_dict_name(char **elements , int cnt , char const   *fname ) 
{ 
  int i ;
  int extpos ;
  int same ;
  char *page_name ;
  char *pattern ;
  void *tmp ;
  int tmp___0 ;
  int previdx ;
  int idx ;
  int res ;
  void *tmp___1 ;
  int tmp___2 ;
  char *tmp___3 ;

  {
  {
#line 54
  same = -1;
#line 57
  extpos = get_ext_delim_pos(fname);
#line 58
  tmp = malloc((unsigned long )(extpos + 10) * sizeof(char ));
#line 58
  page_name = (char *)tmp;
#line 59
  memset((void *)page_name, '\000', (size_t )(extpos + 6));
  }
#line 60
  if (extpos > 0) {
    {
#line 61
    strncpy((char */* __restrict  */)page_name, (char const   */* __restrict  */)fname,
            (size_t )(extpos - 1));
    }
  }
  {
#line 62
  strcat((char */* __restrict  */)page_name, (char const   */* __restrict  */)".djvu");
#line 64
  i = 0;
  }
  {
#line 64
  while (1) {
    while_continue: /* CIL Label */ ;
#line 64
    if (! (i < cnt)) {
#line 64
      goto while_break;
    }
    {
#line 66
    tmp___0 = strcmp((char const   *)page_name, (char const   *)*(elements + i));
    }
#line 66
    if (tmp___0 == 0) {
#line 68
      same = i;
#line 69
      goto while_break;
    }
#line 64
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 73
  if (same != -1) {
    {
#line 75
    previdx = 0;
#line 75
    idx = 0;
#line 77
    *(page_name + (extpos - 1)) = (char )'\000';
#line 79
    tmp___1 = malloc((unsigned long )(extpos + 10) * sizeof(char ));
#line 79
    pattern = (char *)tmp___1;
#line 80
    strcpy((char */* __restrict  */)pattern, (char const   */* __restrict  */)page_name);
#line 81
    strcat((char */* __restrict  */)pattern, (char const   */* __restrict  */)"#%d.");
#line 83
    i = same;
    }
    {
#line 83
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 83
      if (! (i < cnt)) {
#line 83
        goto while_break___0;
      }
      {
#line 85
      tmp___2 = mdjvu_ends_with_ignore_case((char const   *)*(elements + i), ".djvu");
      }
#line 85
      if (tmp___2) {
        {
#line 87
        res = sscanf((char const   */* __restrict  */)*(elements + i), (char const   */* __restrict  */)pattern,
                     & idx);
        }
#line 88
        if (res) {
#line 88
          if (idx > previdx) {
#line 88
            previdx = idx;
          }
        }
      }
#line 83
      i ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 91
    if (idx == 999) {
      {
#line 93
      tmp___3 = dgettext("minidjvu", "Cannot generate a unique name for %s\n");
#line 93
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)tmp___3,
              fname);
#line 94
      exit(1);
      }
    }
    {
#line 96
    sprintf((char */* __restrict  */)(page_name + (extpos - 1)), (char const   */* __restrict  */)"#%03d.djvu",
            idx + 1);
#line 97
    free((void *)pattern);
    }
  }
#line 99
  return (page_name);
}
}
#line 102 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static void replace_suffix(char *name , char const   *suffix ) 
{ 
  int len ;
  size_t tmp ;

  {
  {
#line 104
  tmp = strlen((char const   *)name);
#line 104
  len = (int )tmp;
#line 106
  *(name + (len - 4)) = (char )'\000';
#line 107
  strcat((char */* __restrict  */)name, (char const   */* __restrict  */)suffix);
  }
#line 108
  return;
}
}
#line 114 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static void show_usage_and_exit(void) 
{ 
  char const   *what_it_does ;
  char *tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  char const   *tmp___2 ;
  char *tmp___3 ;
  char const   *tmp___4 ;
  int tmp___5 ;
  char *tmp___6 ;
  char *tmp___7 ;
  char *tmp___8 ;
  char *tmp___9 ;
  char *tmp___10 ;
  char *tmp___11 ;
  char *tmp___12 ;
  char *tmp___13 ;
  char *tmp___14 ;
  int tmp___15 ;
  char *tmp___16 ;
  char *tmp___17 ;
  char *tmp___18 ;
  char *tmp___19 ;
  char *tmp___20 ;
  char *tmp___21 ;
  char *tmp___22 ;
  char *tmp___23 ;
  char *tmp___24 ;
  char *tmp___25 ;
  char *tmp___26 ;
  char *tmp___27 ;
  char *tmp___28 ;
  char *tmp___29 ;
  char *tmp___30 ;
  char *tmp___31 ;
  char *tmp___32 ;

  {
  {
#line 116
  tmp = dgettext("minidjvu", "encode/decode bitonal DjVu files");
#line 116
  what_it_does = (char const   *)tmp;
#line 117
  tmp___4 = mdjvu_get_version();
#line 117
  tmp___5 = strcmp("0.9", tmp___4);
  }
#line 117
  if (tmp___5) {
    {
#line 119
    tmp___0 = dgettext("minidjvu", "minidjvu - %s\n");
#line 119
    printf((char const   */* __restrict  */)tmp___0, what_it_does);
#line 120
    tmp___1 = dgettext("minidjvu", "Warning: program and library version mismatch:\n");
#line 120
    printf((char const   */* __restrict  */)tmp___1);
#line 121
    tmp___2 = mdjvu_get_version();
#line 121
    tmp___3 = dgettext("minidjvu", "    program version %s, library version %s.\n\n");
#line 121
    printf((char const   */* __restrict  */)tmp___3, "0.9", tmp___2);
    }
  } else {
    {
#line 126
    printf((char const   */* __restrict  */)"minidjvu %s - %s\n", "0.9", what_it_does);
    }
  }
  {
#line 129
  tmp___6 = dgettext("minidjvu", "Usage:\n");
#line 129
  printf((char const   */* __restrict  */)tmp___6);
#line 130
  tmp___7 = dgettext("minidjvu", "single page encoding/decoding:\n");
#line 130
  printf((char const   */* __restrict  */)tmp___7);
#line 131
  tmp___8 = dgettext("minidjvu", "    minidjvu [options] <input file> <output file>\n");
#line 131
  printf((char const   */* __restrict  */)tmp___8);
#line 132
  tmp___9 = dgettext("minidjvu", "multiple pages encoding:\n");
#line 132
  printf((char const   */* __restrict  */)tmp___9);
#line 133
  tmp___10 = dgettext("minidjvu", "    minidjvu [options] <input file> ... <output file>\n");
#line 133
  printf((char const   */* __restrict  */)tmp___10);
#line 134
  tmp___11 = dgettext("minidjvu", "Formats supported:\n");
#line 134
  printf((char const   */* __restrict  */)tmp___11);
#line 136
  tmp___12 = dgettext("minidjvu", "    DjVu (single-page bitonal), PBM, Windows BMP");
#line 136
  printf((char const   */* __restrict  */)tmp___12);
#line 137
  tmp___15 = mdjvu_have_tiff_support();
  }
#line 137
  if (tmp___15) {
    {
#line 138
    tmp___13 = dgettext("minidjvu", ", TIFF.\n");
#line 138
    printf((char const   */* __restrict  */)tmp___13);
    }
  } else {
    {
#line 140
    tmp___14 = dgettext("minidjvu", "; TIFF support is OFF.\n");
#line 140
    printf((char const   */* __restrict  */)tmp___14);
    }
  }
  {
#line 142
  tmp___16 = dgettext("minidjvu", "Options:\n");
#line 142
  printf((char const   */* __restrict  */)tmp___16);
#line 143
  tmp___17 = dgettext("minidjvu", "    -A, --Averaging:               compute \"average\" representatives\n");
#line 143
  printf((char const   */* __restrict  */)tmp___17);
#line 144
  tmp___18 = dgettext("minidjvu", "    -a <n>, --aggression <n>:      set aggression level (default 100)\n");
#line 144
  printf((char const   */* __restrict  */)tmp___18);
#line 145
  tmp___19 = dgettext("minidjvu", "    -c, --clean                    remove small black pieces\n");
#line 145
  printf((char const   */* __restrict  */)tmp___19);
#line 146
  tmp___20 = dgettext("minidjvu", "    -d <n> --dpi <n>:              set resolution in dots per inch\n");
#line 146
  printf((char const   */* __restrict  */)tmp___20);
#line 147
  tmp___21 = dgettext("minidjvu", "    -e, --erosion                  sacrifice quality to gain in size\n");
#line 147
  printf((char const   */* __restrict  */)tmp___21);
#line 148
  tmp___22 = dgettext("minidjvu", "    -i, --indirect:                generate an indirect multipage document\n");
#line 148
  printf((char const   */* __restrict  */)tmp___22);
#line 149
  tmp___23 = dgettext("minidjvu", "    -l, --lossy:                   use all lossy options (-s -c -m -e -A)\n");
#line 149
  printf((char const   */* __restrict  */)tmp___23);
#line 150
  tmp___24 = dgettext("minidjvu", "    -m, --match:                   match and substitute patterns\n");
#line 150
  printf((char const   */* __restrict  */)tmp___24);
#line 151
  tmp___25 = dgettext("minidjvu", "    -n, --no-prototypes:           do not search for prototypes\n");
#line 151
  printf((char const   */* __restrict  */)tmp___25);
#line 152
  tmp___26 = dgettext("minidjvu", "    -p <n>, --pages-per-dict <n>:  pages per dictionary (default 10)\n");
#line 152
  printf((char const   */* __restrict  */)tmp___26);
#line 153
  tmp___27 = dgettext("minidjvu", "    -r, --report:                  report multipage coding progress\n");
#line 153
  printf((char const   */* __restrict  */)tmp___27);
#line 154
  tmp___28 = dgettext("minidjvu", "    -s, --smooth:                  remove some badly looking pixels\n");
#line 154
  printf((char const   */* __restrict  */)tmp___28);
#line 155
  tmp___29 = dgettext("minidjvu", "    -v, --verbose:                 print messages about everything\n");
#line 155
  printf((char const   */* __restrict  */)tmp___29);
#line 156
  tmp___30 = dgettext("minidjvu", "    -X, --Xtension:                file extension for shared dictionary files\n");
#line 156
  printf((char const   */* __restrict  */)tmp___30);
#line 157
  tmp___31 = dgettext("minidjvu", "    -w, --warnings:                do not suppress TIFF warnings\n");
#line 157
  printf((char const   */* __restrict  */)tmp___31);
#line 158
  tmp___32 = dgettext("minidjvu", "See the man page for detailed description of each option.\n");
#line 158
  printf((char const   */* __restrict  */)tmp___32);
#line 159
  exit(2);
  }
}
}
#line 162 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static int decide_if_bmp(char const   *path ) 
{ 
  int tmp ;

  {
  {
#line 164
  tmp = mdjvu_ends_with_ignore_case(path, ".bmp");
  }
#line 164
  return (tmp);
}
}
#line 167 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static int decide_if_djvu(char const   *path ) 
{ 
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;

  {
  {
#line 169
  tmp = mdjvu_ends_with_ignore_case(path, ".djvu");
  }
#line 169
  if (tmp) {
#line 169
    tmp___1 = 1;
  } else {
    {
#line 169
    tmp___0 = mdjvu_ends_with_ignore_case(path, ".djv");
    }
#line 169
    if (tmp___0) {
#line 169
      tmp___1 = 1;
    } else {
#line 169
      tmp___1 = 0;
    }
  }
#line 169
  return (tmp___1);
}
}
#line 173 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static int decide_if_tiff(char const   *path ) 
{ 
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;

  {
  {
#line 175
  tmp = mdjvu_ends_with_ignore_case(path, ".tiff");
  }
#line 175
  if (tmp) {
#line 175
    tmp___1 = 1;
  } else {
    {
#line 175
    tmp___0 = mdjvu_ends_with_ignore_case(path, ".tif");
    }
#line 175
    if (tmp___0) {
#line 175
      tmp___1 = 1;
    } else {
#line 175
      tmp___1 = 0;
    }
  }
#line 175
  return (tmp___1);
}
}
#line 181 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static mdjvu_image_t load_image(char const   *path ) 
{ 
  mdjvu_error_t error ;
  mdjvu_image_t image ;
  char *tmp ;
  char const   *tmp___0 ;
  int32 tmp___1 ;
  int32 tmp___2 ;
  char *tmp___3 ;

  {
#line 186
  if (verbose) {
    {
#line 186
    tmp = dgettext("minidjvu", "loading a DjVu page from `%s\'\n");
#line 186
    printf((char const   */* __restrict  */)tmp, path);
    }
  }
  {
#line 187
  image = mdjvu_load_djvu_page(path, & error);
  }
#line 188
  if (! image) {
    {
#line 190
    tmp___0 = mdjvu_get_error_message(error);
#line 190
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s: %s\n",
            path, tmp___0);
#line 191
    exit(1);
    }
  }
#line 193
  if (verbose) {
    {
#line 195
    tmp___1 = mdjvu_image_get_blit_count(image);
#line 195
    tmp___2 = mdjvu_image_get_bitmap_count(image);
#line 195
    tmp___3 = dgettext("minidjvu", "loaded; the page has %d bitmaps and %d blits\n");
#line 195
    printf((char const   */* __restrict  */)tmp___3, tmp___2, tmp___1);
    }
  }
#line 199
  return (image);
}
}
#line 202 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static mdjvu_matcher_options_t get_matcher_options(void) 
{ 
  mdjvu_matcher_options_t m_options ;

  {
#line 204
  m_options = (mdjvu_matcher_options_t )((void *)0);
#line 205
  if (match) {
#line 205
    goto _L;
  } else
#line 205
  if (Match) {
    _L: /* CIL Label */ 
    {
#line 207
    m_options = mdjvu_matcher_options_create();
#line 208
    mdjvu_use_matcher_method(m_options, 1);
    }
#line 209
    if (Match) {
      {
#line 210
      mdjvu_use_matcher_method(m_options, 2);
      }
    }
    {
#line 211
    mdjvu_set_aggression(m_options, aggression);
    }
  }
#line 213
  return (m_options);
}
}
#line 216 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static void sort_and_save_image(mdjvu_image_t image , char const   *path ) 
{ 
  mdjvu_error_t error ;
  mdjvu_compression_options_t options ;
  mdjvu_compression_options_t tmp ;
  mdjvu_matcher_options_t tmp___0 ;
  char *tmp___1 ;
  char const   *tmp___2 ;
  int tmp___3 ;

  {
  {
#line 220
  tmp = mdjvu_compression_options_create();
#line 220
  options = tmp;
#line 221
  tmp___0 = get_matcher_options();
#line 221
  mdjvu_set_matcher_options(options, tmp___0);
#line 223
  mdjvu_set_clean(options, clean);
#line 224
  mdjvu_set_verbose(options, verbose);
#line 225
  mdjvu_set_no_prototypes(options, no_prototypes);
#line 226
  mdjvu_set_averaging(options, averaging);
#line 227
  mdjvu_compress_image(image, options);
#line 228
  mdjvu_compression_options_destroy(options);
  }
#line 230
  if (verbose) {
    {
#line 230
    tmp___1 = dgettext("minidjvu", "encoding to `%s\'\n");
#line 230
    printf((char const   */* __restrict  */)tmp___1, path);
    }
  }
  {
#line 232
  tmp___3 = mdjvu_save_djvu_page(image, path, (char const   *)((void *)0), & error,
                                 erosion);
  }
#line 232
  if (! tmp___3) {
    {
#line 234
    tmp___2 = mdjvu_get_error_message(error);
#line 234
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s: %s\n",
            path, tmp___2);
#line 235
    exit(1);
    }
  }
#line 237
  return;
}
}
#line 239 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static mdjvu_bitmap_t load_bitmap(char const   *path , int tiff_idx ) 
{ 
  mdjvu_error_t error ;
  mdjvu_bitmap_t bitmap ;
  char *tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  mdjvu_image_t image ;
  mdjvu_image_t tmp___2 ;
  int32 tmp___3 ;
  int32 tmp___4 ;
  char *tmp___5 ;
  char *tmp___6 ;
  int tmp___7 ;
  int tmp___8 ;
  int tmp___9 ;
  char const   *tmp___10 ;
  char *tmp___11 ;

  {
  {
#line 244
  tmp___9 = decide_if_bmp(path);
  }
#line 244
  if (tmp___9) {
#line 246
    if (verbose) {
      {
#line 246
      tmp = dgettext("minidjvu", "loading from Windows BMP file `%s\'\n");
#line 246
      printf((char const   */* __restrict  */)tmp, path);
      }
    }
    {
#line 247
    bitmap = mdjvu_load_bmp(path, & error);
    }
  } else {
    {
#line 249
    tmp___8 = decide_if_tiff(path);
    }
#line 249
    if (tmp___8) {
#line 251
      if (verbose) {
        {
#line 251
        tmp___0 = dgettext("minidjvu", "loading from TIFF file `%s\'\n");
#line 251
        printf((char const   */* __restrict  */)tmp___0, path);
        }
      }
#line 252
      if (! warnings) {
        {
#line 253
        mdjvu_disable_tiff_warnings();
        }
      }
#line 254
      if (dpi_specified) {
        {
#line 255
        bitmap = mdjvu_load_tiff(path, (int32 *)((void *)0), & error, (uint32 )tiff_idx);
        }
      } else {
        {
#line 257
        bitmap = mdjvu_load_tiff(path, & dpi, & error, (uint32 )tiff_idx);
        }
      }
#line 258
      if (verbose) {
        {
#line 258
        tmp___1 = dgettext("minidjvu", "resolution is %d dpi\n");
#line 258
        printf((char const   */* __restrict  */)tmp___1, dpi);
        }
      }
    } else {
      {
#line 260
      tmp___7 = decide_if_djvu(path);
      }
#line 260
      if (tmp___7) {
        {
#line 262
        tmp___2 = load_image(path);
#line 262
        image = tmp___2;
#line 263
        bitmap = mdjvu_render(image);
#line 264
        mdjvu_image_destroy(image);
        }
#line 265
        if (verbose) {
          {
#line 267
          tmp___3 = mdjvu_bitmap_get_height(bitmap);
#line 267
          tmp___4 = mdjvu_bitmap_get_width(bitmap);
#line 267
          tmp___5 = dgettext("minidjvu", "bitmap %d x %d rendered\n");
#line 267
          printf((char const   */* __restrict  */)tmp___5, tmp___4, tmp___3);
          }
        }
      } else {
#line 274
        if (verbose) {
          {
#line 274
          tmp___6 = dgettext("minidjvu", "loading from PBM file `%s\'\n");
#line 274
          printf((char const   */* __restrict  */)tmp___6, path);
          }
        }
        {
#line 275
        bitmap = mdjvu_load_pbm(path, & error);
        }
      }
    }
  }
#line 278
  if (! bitmap) {
    {
#line 280
    tmp___10 = mdjvu_get_error_message(error);
#line 280
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s: %s\n",
            path, tmp___10);
#line 281
    exit(1);
    }
  }
#line 284
  if (smooth) {
#line 286
    if (verbose) {
      {
#line 286
      tmp___11 = dgettext("minidjvu", "smoothing the bitmap\n");
#line 286
      printf((char const   */* __restrict  */)tmp___11);
      }
    }
    {
#line 287
    mdjvu_smooth(bitmap);
    }
  }
#line 290
  return (bitmap);
}
}
#line 293 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static void save_bitmap(mdjvu_bitmap_t bitmap , char const   *path ) 
{ 
  mdjvu_error_t error ;
  int result ;
  char *tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  int tmp___2 ;
  int tmp___3 ;
  char const   *tmp___4 ;

  {
  {
#line 298
  tmp___3 = decide_if_bmp(path);
  }
#line 298
  if (tmp___3) {
#line 300
    if (verbose) {
      {
#line 300
      tmp = dgettext("minidjvu", "saving to Windows BMP file `%s\'\n");
#line 300
      printf((char const   */* __restrict  */)tmp, path);
      }
    }
    {
#line 301
    result = mdjvu_save_bmp(bitmap, path, dpi, & error);
    }
  } else {
    {
#line 303
    tmp___2 = decide_if_tiff(path);
    }
#line 303
    if (tmp___2) {
#line 305
      if (verbose) {
        {
#line 305
        tmp___0 = dgettext("minidjvu", "saving to TIFF file `%s\'\n");
#line 305
        printf((char const   */* __restrict  */)tmp___0, path);
        }
      }
#line 306
      if (! warnings) {
        {
#line 307
        mdjvu_disable_tiff_warnings();
        }
      }
      {
#line 308
      result = mdjvu_save_tiff(bitmap, path, & error);
      }
    } else {
#line 312
      if (verbose) {
        {
#line 312
        tmp___1 = dgettext("minidjvu", "saving to PBM file `%s\'\n");
#line 312
        printf((char const   */* __restrict  */)tmp___1, path);
        }
      }
      {
#line 313
      result = mdjvu_save_pbm(bitmap, path, & error);
      }
    }
  }
#line 316
  if (! result) {
    {
#line 318
    tmp___4 = mdjvu_get_error_message(error);
#line 318
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s: %s\n",
            path, tmp___4);
#line 319
    exit(1);
    }
  }
#line 321
  return;
}
}
#line 325 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static void decode(int argc , char **argv ) 
{ 
  mdjvu_image_t image ;
  mdjvu_bitmap_t bitmap ;
  char *tmp ;
  char *tmp___0 ;
  int32 tmp___1 ;
  int32 tmp___2 ;
  char *tmp___3 ;
  char *tmp___4 ;

  {
#line 330
  if (verbose) {
    {
#line 330
    tmp = dgettext("minidjvu", "\nDECODING\n");
#line 330
    printf((char const   */* __restrict  */)tmp);
    }
  }
#line 331
  if (verbose) {
    {
#line 331
    tmp___0 = dgettext("minidjvu", "________\n\n");
#line 331
    printf((char const   */* __restrict  */)tmp___0);
    }
  }
  {
#line 333
  image = load_image((char const   *)*(argv + 1));
#line 334
  bitmap = mdjvu_render(image);
#line 335
  mdjvu_image_destroy(image);
  }
#line 337
  if (verbose) {
    {
#line 339
    tmp___1 = mdjvu_bitmap_get_height(bitmap);
#line 339
    tmp___2 = mdjvu_bitmap_get_width(bitmap);
#line 339
    tmp___3 = dgettext("minidjvu", "bitmap %d x %d rendered\n");
#line 339
    printf((char const   */* __restrict  */)tmp___3, tmp___2, tmp___1);
    }
  }
#line 344
  if (smooth) {
#line 346
    if (verbose) {
      {
#line 346
      tmp___4 = dgettext("minidjvu", "smoothing the bitmap\n");
#line 346
      printf((char const   */* __restrict  */)tmp___4);
      }
    }
    {
#line 347
    mdjvu_smooth(bitmap);
    }
  }
  {
#line 350
  save_bitmap(bitmap, (char const   *)*(argv + 2));
#line 351
  mdjvu_bitmap_destroy(bitmap);
  }
#line 352
  return;
}
}
#line 355 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static mdjvu_image_t split_and_destroy(mdjvu_bitmap_t bitmap ) 
{ 
  mdjvu_image_t image ;
  char *tmp ;
  int32 tmp___0 ;
  char *tmp___1 ;
  char *tmp___2 ;
  int32 tmp___3 ;
  char *tmp___4 ;

  {
#line 358
  if (verbose) {
    {
#line 358
    tmp = dgettext("minidjvu", "splitting the bitmap into pieces\n");
#line 358
    printf((char const   */* __restrict  */)tmp);
    }
  }
  {
#line 359
  image = mdjvu_split(bitmap, dpi, (mdjvu_split_options_t )((void *)0));
#line 360
  mdjvu_bitmap_destroy(bitmap);
  }
#line 361
  if (verbose) {
    {
#line 363
    tmp___0 = mdjvu_image_get_blit_count(image);
#line 363
    tmp___1 = dgettext("minidjvu", "the split image has %d pieces\n");
#line 363
    printf((char const   */* __restrict  */)tmp___1, tmp___0);
    }
  }
#line 366
  if (clean) {
#line 368
    if (verbose) {
      {
#line 368
      tmp___2 = dgettext("minidjvu", "cleaning\n");
#line 368
      printf((char const   */* __restrict  */)tmp___2);
      }
    }
    {
#line 369
    mdjvu_clean(image);
    }
#line 370
    if (verbose) {
      {
#line 372
      tmp___3 = mdjvu_image_get_blit_count(image);
#line 372
      tmp___4 = dgettext("minidjvu", "the cleaned image has %d pieces\n");
#line 372
      printf((char const   */* __restrict  */)tmp___4, tmp___3);
      }
    }
  }
#line 376
  return (image);
}
}
#line 380 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static void encode(int argc , char **argv ) 
{ 
  mdjvu_bitmap_t bitmap ;
  mdjvu_image_t image ;
  char *tmp ;
  char *tmp___0 ;

  {
#line 385
  if (verbose) {
    {
#line 385
    tmp = dgettext("minidjvu", "\nENCODING\n");
#line 385
    printf((char const   */* __restrict  */)tmp);
    }
  }
#line 386
  if (verbose) {
    {
#line 386
    tmp___0 = dgettext("minidjvu", "________\n\n");
#line 386
    printf((char const   */* __restrict  */)tmp___0);
    }
  }
  {
#line 388
  bitmap = load_bitmap((char const   *)*(argv + 1), 0);
#line 390
  image = split_and_destroy(bitmap);
#line 391
  sort_and_save_image(image, (char const   *)*(argv + 2));
#line 392
  mdjvu_image_destroy(image);
  }
#line 393
  return;
}
}
#line 397 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static void filter(int argc , char **argv ) 
{ 
  mdjvu_bitmap_t bitmap ;
  char *tmp ;
  char *tmp___0 ;

  {
#line 401
  if (verbose) {
    {
#line 401
    tmp = dgettext("minidjvu", "\nFILTERING\n");
#line 401
    printf((char const   */* __restrict  */)tmp);
    }
  }
#line 402
  if (verbose) {
    {
#line 402
    tmp___0 = dgettext("minidjvu", "_________\n\n");
#line 402
    printf((char const   */* __restrict  */)tmp___0);
    }
  }
  {
#line 404
  bitmap = load_bitmap((char const   *)*(argv + 1), 0);
#line 405
  save_bitmap(bitmap, (char const   *)*(argv + 2));
#line 406
  mdjvu_bitmap_destroy(bitmap);
  }
#line 407
  return;
}
}
#line 410 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static char const   *strip(char const   *str , char sep ) 
{ 
  char const   *t ;
  char *tmp ;

  {
  {
#line 412
  tmp = strrchr(str, (int )sep);
#line 412
  t = (char const   *)tmp;
  }
#line 413
  if (t) {
#line 414
    return (t + 1);
  } else {
#line 416
    return (str);
  }
}
}
#line 420 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static char const   *strip_dir(char const   *path ) 
{ 
  char const   *tmp ;
  char const   *tmp___0 ;

  {
  {
#line 422
  tmp = strip(path, (char )'\\');
#line 422
  tmp___0 = strip(tmp, (char )'/');
  }
#line 422
  return (tmp___0);
}
}
#line 426 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static void multipage_encode(int n , char **pages , char *outname , uint32 multipage_tiff ) 
{ 
  mdjvu_image_t *images ;
  mdjvu_image_t dict ;
  int i ;
  int el ;
  int ndicts ;
  double tmp ;
  double tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  char *dict_name ;
  char *path ;
  char **elements ;
  void *tmp___3 ;
  int *sizes ;
  void *tmp___4 ;
  mdjvu_compression_options_t options ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_error_t error ;
  int32 pages_compressed ;
  FILE *f ;
  FILE *tf ;
  char *tmp___5 ;
  int tmp___6 ;
  char *tmp___7 ;
  char *tmp___8 ;
  char *tmp___9 ;
  char *tmp___10 ;
  mdjvu_matcher_options_t tmp___11 ;
  void *tmp___12 ;
  int32 pages_to_compress ;
  char *tmp___13 ;
  int tmp___14 ;
  char const   *tmp___15 ;
  size_t tmp___16 ;
  size_t tmp___17 ;
  void *tmp___18 ;
  char const   *tmp___19 ;
  int tmp___20 ;
  int tmp___21 ;
  char const   *tmp___22 ;
  char *tmp___23 ;
  char const   *tmp___24 ;
  char const   *tmp___25 ;
  char const   *tmp___26 ;
  int tmp___27 ;
  char *tmp___28 ;
  mdjvu_error_t tmp___29 ;

  {
#line 430
  el = 0;
#line 431
  if (pages_per_dict <= 0) {
#line 431
    tmp___2 = 1;
  } else {
#line 431
    if (n % pages_per_dict > 0) {
      {
#line 431
      tmp = fabs((double )(n / pages_per_dict));
#line 431
      tmp___1 = (int )tmp + 1;
      }
    } else {
      {
#line 431
      tmp___0 = fabs((double )(n / pages_per_dict));
#line 431
      tmp___1 = (int )tmp___0;
      }
    }
#line 431
    tmp___2 = tmp___1;
  }
  {
#line 431
  ndicts = tmp___2;
#line 435
  tmp___3 = malloc((unsigned long )(n + ndicts) * sizeof(char *));
#line 435
  elements = (char **)tmp___3;
#line 436
  tmp___4 = malloc((unsigned long )(n + ndicts) * sizeof(int ));
#line 436
  sizes = (int *)tmp___4;
#line 441
  tf = (FILE *)((void *)0);
#line 443
  match = 1;
#line 445
  tmp___6 = decide_if_djvu((char const   *)outname);
  }
#line 445
  if (! tmp___6) {
    {
#line 447
    tmp___5 = dgettext("minidjvu", "when encoding many pages, output file must be DjVu\n");
#line 447
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)tmp___5);
#line 448
    exit(1);
    }
  }
#line 450
  if (! indirect) {
    {
#line 452
    tf = tmpfile();
    }
#line 453
    if (! tf) {
      {
#line 455
      tmp___7 = dgettext("minidjvu", "Could not create a temporary file\n");
#line 455
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)tmp___7);
#line 456
      exit(1);
      }
    }
  }
#line 460
  if (verbose) {
    {
#line 460
    tmp___8 = dgettext("minidjvu", "\nMULTIPAGE ENCODING\n");
#line 460
    printf((char const   */* __restrict  */)tmp___8);
    }
  }
#line 461
  if (verbose) {
    {
#line 461
    tmp___9 = dgettext("minidjvu", "__________________\n\n");
#line 461
    printf((char const   */* __restrict  */)tmp___9);
    }
  }
#line 462
  if (verbose) {
    {
#line 462
    tmp___10 = dgettext("minidjvu", "%d pages total\n");
#line 462
    printf((char const   */* __restrict  */)tmp___10, n);
    }
  }
  {
#line 464
  options = mdjvu_compression_options_create();
#line 465
  tmp___11 = get_matcher_options();
#line 465
  mdjvu_set_matcher_options(options, tmp___11);
#line 467
  mdjvu_set_clean(options, clean);
#line 468
  mdjvu_set_verbose(options, verbose);
#line 469
  mdjvu_set_no_prototypes(options, no_prototypes);
#line 470
  mdjvu_set_report(options, report);
#line 471
  mdjvu_set_averaging(options, averaging);
#line 472
  mdjvu_set_report_total_pages(options, n);
  }
#line 475
  if (pages_per_dict <= 0) {
#line 475
    pages_per_dict = n;
  }
#line 476
  if (pages_per_dict > n) {
#line 476
    pages_per_dict = n;
  }
  {
#line 477
  tmp___12 = malloc((unsigned long )pages_per_dict * sizeof(mdjvu_image_t ));
#line 477
  images = (mdjvu_image_t *)tmp___12;
#line 478
  pages_compressed = 0;
  }
  {
#line 480
  while (1) {
    while_continue: /* CIL Label */ ;
#line 480
    if (! (n - pages_compressed)) {
#line 480
      goto while_break;
    }
#line 482
    pages_to_compress = n - pages_compressed;
#line 483
    if (pages_to_compress > pages_per_dict) {
#line 484
      pages_to_compress = pages_per_dict;
    }
    {
#line 486
    mdjvu_set_report_start_page(options, pages_compressed + 1);
#line 488
    i = 0;
    }
    {
#line 488
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 488
      if (! (i < pages_to_compress)) {
#line 488
        goto while_break___0;
      }
#line 490
      if (multipage_tiff) {
        {
#line 491
        bitmap = load_bitmap((char const   *)*(pages + 0), pages_compressed + i);
        }
      } else {
        {
#line 493
        bitmap = load_bitmap((char const   *)*(pages + (pages_compressed + i)), 0);
        }
      }
      {
#line 494
      *(images + i) = split_and_destroy(bitmap);
      }
#line 495
      if (report) {
        {
#line 496
        tmp___13 = dgettext("minidjvu", "Loading: %d of %d completed\n");
#line 496
        printf((char const   */* __restrict  */)tmp___13, (pages_compressed + i) + 1,
               n);
        }
      }
#line 488
      i ++;
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 499
    dict = mdjvu_compress_multipage(pages_to_compress, images, options);
    }
#line 501
    if (multipage_tiff) {
#line 501
      tmp___14 = 0;
    } else {
#line 501
      tmp___14 = pages_compressed;
    }
    {
#line 501
    tmp___15 = strip_dir((char const   *)*(pages + tmp___14));
#line 501
    path = get_page_or_dict_name(elements, el, tmp___15);
#line 502
    tmp___16 = strlen((char const   *)path);
#line 502
    tmp___17 = strlen(dict_suffix);
#line 502
    tmp___18 = malloc(((tmp___16 + tmp___17) - 2UL) * sizeof(char ));
#line 502
    dict_name = (char *)tmp___18;
#line 503
    strcpy((char */* __restrict  */)dict_name, (char const   */* __restrict  */)path);
#line 504
    replace_suffix(dict_name, dict_suffix);
    }
#line 506
    if (! indirect) {
      {
#line 507
      *(sizes + el) = mdjvu_file_save_djvu_dictionary(dict, (mdjvu_file_t )tf, 0,
                                                      & error, erosion);
      }
    } else {
      {
#line 509
      *(sizes + el) = mdjvu_save_djvu_dictionary(dict, (char const   *)dict_name,
                                                 & error, erosion);
      }
    }
#line 511
    if (! *(sizes + el)) {
      {
#line 513
      tmp___19 = mdjvu_get_error_message(error);
#line 513
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s: %s\n",
              dict_name, tmp___19);
#line 514
      exit(1);
      }
    }
#line 516
    tmp___20 = el;
#line 516
    el ++;
#line 516
    *(elements + tmp___20) = dict_name;
#line 518
    i = 0;
    {
#line 518
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 518
      if (! (i < pages_to_compress)) {
#line 518
        goto while_break___1;
      }
#line 520
      if (i > 0) {
#line 521
        if (multipage_tiff) {
#line 521
          tmp___21 = 0;
        } else {
#line 521
          tmp___21 = pages_compressed + i;
        }
        {
#line 521
        tmp___22 = strip_dir((char const   *)*(pages + tmp___21));
#line 521
        path = get_page_or_dict_name(elements, el, tmp___22);
        }
      }
#line 523
      if (verbose) {
        {
#line 524
        tmp___23 = dgettext("minidjvu", "saving page #%d into %s using dictionary %s\n");
#line 524
        printf((char const   */* __restrict  */)tmp___23, (pages_compressed + i) + 1,
               path, dict_name);
        }
      }
#line 526
      if (! indirect) {
        {
#line 527
        tmp___24 = strip_dir((char const   *)dict_name);
#line 527
        *(sizes + el) = mdjvu_file_save_djvu_page(*(images + i), (mdjvu_file_t )tf,
                                                  tmp___24, 0, & error, erosion);
        }
      } else {
        {
#line 529
        tmp___25 = strip_dir((char const   *)dict_name);
#line 529
        *(sizes + el) = mdjvu_save_djvu_page(*(images + i), (char const   *)path,
                                             tmp___25, & error, erosion);
        }
      }
#line 530
      if (! *(sizes + el)) {
        {
#line 532
        tmp___26 = mdjvu_get_error_message(error);
#line 532
        fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s: %s\n",
                path, tmp___26);
#line 533
        exit(1);
        }
      }
      {
#line 535
      tmp___27 = el;
#line 535
      el ++;
#line 535
      *(elements + tmp___27) = path;
#line 536
      mdjvu_image_destroy(*(images + i));
      }
#line 537
      if (report) {
        {
#line 538
        tmp___28 = dgettext("minidjvu", "Saving: %d of %d completed\n");
#line 538
        printf((char const   */* __restrict  */)tmp___28, (pages_compressed + i) + 1,
               n);
        }
      }
#line 518
      i ++;
    }
    while_break___1: /* CIL Label */ ;
    }
    {
#line 540
    mdjvu_image_destroy(dict);
#line 541
    pages_compressed += pages_to_compress;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 543
  if (! indirect) {
    {
#line 545
    f = fopen((char const   */* __restrict  */)outname, (char const   */* __restrict  */)"wb");
    }
#line 546
    if (! f) {
      {
#line 548
      tmp___29 = mdjvu_get_error((MinidjvuErrorType )0);
#line 548
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"%s: %s\n",
              outname, (char const   *)tmp___29);
#line 549
      exit(1);
      }
    }
    {
#line 551
    mdjvu_file_save_djvu_dir(elements, sizes, el, (mdjvu_file_t )f, (mdjvu_file_t )tf,
                             & error);
#line 552
    fclose(tf);
#line 553
    fclose(f);
    }
  } else {
    {
#line 556
    mdjvu_save_djvu_dir(elements, sizes, el, (char const   *)outname, & error);
    }
  }
#line 558
  i = 0;
  {
#line 558
  while (1) {
    while_continue___2: /* CIL Label */ ;
#line 558
    if (! (i < el)) {
#line 558
      goto while_break___2;
    }
    {
#line 558
    free((void *)*(elements + i));
#line 558
    i ++;
    }
  }
  while_break___2: /* CIL Label */ ;
  }
  {
#line 559
  free((void *)elements);
#line 560
  free((void *)sizes);
#line 563
  mdjvu_compression_options_destroy(options);
#line 565
  free((void *)images);
  }
#line 566
  return;
}
}
#line 574 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static int same_option(char const   *option , char const   *s ) 
{ 
  int tmp ;
  int tmp___0 ;

  {
#line 576
  if ((int const   )*(option + 0) == (int const   )*(s + 0)) {
#line 576
    if (! *(option + 1)) {
#line 576
      return (1);
    }
  }
  {
#line 577
  tmp = strcmp(option, s);
  }
#line 577
  if (! tmp) {
#line 577
    return (1);
  }
#line 578
  if ((int const   )*(option + 0) == 45) {
    {
#line 578
    tmp___0 = strcmp(option + 1, s);
    }
#line 578
    if (! tmp___0) {
#line 578
      return (1);
    }
  }
#line 579
  return (0);
}
}
#line 582 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
static int process_options(int argc , char **argv ) 
{ 
  int i ;
  char *option ;
  char *tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  int tmp___2 ;
  int tmp___3 ;
  int tmp___4 ;
  int tmp___5 ;
  int tmp___6 ;
  int tmp___7 ;
  int tmp___8 ;
  int tmp___9 ;
  int tmp___10 ;
  int tmp___11 ;
  int tmp___12 ;
  int tmp___13 ;
  int tmp___14 ;
  int tmp___15 ;
  int tmp___16 ;
  int tmp___17 ;
  int tmp___18 ;

  {
#line 585
  i = 1;
  {
#line 585
  while (1) {
    while_continue: /* CIL Label */ ;
#line 585
    if (i < argc) {
#line 585
      if (! ((int )*(*(argv + i) + 0) == 45)) {
#line 585
        goto while_break;
      }
    } else {
#line 585
      goto while_break;
    }
    {
#line 587
    option = *(argv + i) + 1;
#line 588
    tmp___18 = same_option((char const   *)option, "verbose");
    }
#line 588
    if (tmp___18) {
#line 589
      verbose = 1;
    } else {
      {
#line 590
      tmp___17 = same_option((char const   *)option, "smooth");
      }
#line 590
      if (tmp___17) {
#line 591
        smooth = 1;
      } else {
        {
#line 592
        tmp___16 = same_option((char const   *)option, "match");
        }
#line 592
        if (tmp___16) {
#line 593
          match = 1;
        } else {
          {
#line 594
          tmp___15 = same_option((char const   *)option, "Match");
          }
#line 594
          if (tmp___15) {
#line 595
            Match = 1;
          } else {
            {
#line 596
            tmp___14 = same_option((char const   *)option, "no-prototypes");
            }
#line 596
            if (tmp___14) {
#line 597
              no_prototypes = 1;
            } else {
              {
#line 598
              tmp___13 = same_option((char const   *)option, "erosion");
              }
#line 598
              if (tmp___13) {
#line 599
                erosion = 1;
              } else {
                {
#line 600
                tmp___12 = same_option((char const   *)option, "clean");
                }
#line 600
                if (tmp___12) {
#line 601
                  clean = 1;
                } else {
                  {
#line 602
                  tmp___11 = same_option((char const   *)option, "warnings");
                  }
#line 602
                  if (tmp___11) {
#line 603
                    warnings = 1;
                  } else {
                    {
#line 604
                    tmp___10 = same_option((char const   *)option, "report");
                    }
#line 604
                    if (tmp___10) {
#line 605
                      report = 1;
                    } else {
                      {
#line 606
                      tmp___9 = same_option((char const   *)option, "Averaging");
                      }
#line 606
                      if (tmp___9) {
#line 607
                        averaging = 1;
                      } else {
                        {
#line 608
                        tmp___8 = same_option((char const   *)option, "lossy");
                        }
#line 608
                        if (tmp___8) {
#line 610
                          smooth = 1;
#line 611
                          match = 1;
#line 612
                          erosion = 1;
#line 613
                          clean = 1;
#line 614
                          averaging = 1;
                        } else {
                          {
#line 616
                          tmp___7 = same_option((char const   *)option, "Lossy");
                          }
#line 616
                          if (tmp___7) {
#line 618
                            smooth = 1;
#line 619
                            match = 1;
#line 619
                            Match = match;
#line 620
                            erosion = 1;
#line 621
                            clean = 1;
#line 622
                            averaging = 1;
                          } else {
                            {
#line 624
                            tmp___6 = same_option((char const   *)option, "pages-per-dict");
                            }
#line 624
                            if (tmp___6) {
#line 626
                              i ++;
#line 627
                              if (i == argc) {
                                {
#line 627
                                show_usage_and_exit();
                                }
                              }
                              {
#line 628
                              pages_per_dict = atoi((char const   *)*(argv + i));
                              }
#line 629
                              if (pages_per_dict < 0) {
                                {
#line 631
                                tmp = dgettext("minidjvu", "bad --pages-per-dict value\n");
#line 631
                                fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)tmp);
#line 632
                                exit(2);
                                }
                              }
                            } else {
                              {
#line 635
                              tmp___5 = same_option((char const   *)option, "dpi");
                              }
#line 635
                              if (tmp___5) {
#line 637
                                i ++;
#line 638
                                if (i == argc) {
                                  {
#line 638
                                  show_usage_and_exit();
                                  }
                                }
                                {
#line 639
                                dpi = atoi((char const   *)*(argv + i));
#line 640
                                dpi_specified = 1;
                                }
#line 641
                                if (dpi < 20) {
                                  {
#line 643
                                  tmp___0 = dgettext("minidjvu", "bad resolution\n");
#line 643
                                  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)tmp___0);
#line 644
                                  exit(2);
                                  }
                                } else
#line 641
                                if (dpi > 2000) {
                                  {
#line 643
                                  tmp___0 = dgettext("minidjvu", "bad resolution\n");
#line 643
                                  fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)tmp___0);
#line 644
                                  exit(2);
                                  }
                                }
                              } else {
                                {
#line 647
                                tmp___4 = same_option((char const   *)option, "aggression");
                                }
#line 647
                                if (tmp___4) {
#line 649
                                  i ++;
#line 650
                                  if (i == argc) {
                                    {
#line 650
                                    show_usage_and_exit();
                                    }
                                  }
                                  {
#line 651
                                  aggression = atoi((char const   *)*(argv + i));
#line 652
                                  match = 1;
                                  }
                                } else {
                                  {
#line 654
                                  tmp___3 = same_option((char const   *)option, "Xtension");
                                  }
#line 654
                                  if (tmp___3) {
#line 656
                                    i ++;
#line 657
                                    if (i == argc) {
                                      {
#line 657
                                      show_usage_and_exit();
                                      }
                                    }
#line 658
                                    dict_suffix = (char const   *)*(argv + i);
                                  } else {
                                    {
#line 660
                                    tmp___2 = same_option((char const   *)option,
                                                          "indirect");
                                    }
#line 660
                                    if (tmp___2) {
#line 661
                                      indirect = 1;
                                    } else {
                                      {
#line 664
                                      tmp___1 = dgettext("minidjvu", "unknown option: %s\n");
#line 664
                                      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)tmp___1,
                                              *(argv + i));
#line 665
                                      exit(2);
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
#line 585
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 668
  return (i);
}
}
#line 671 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/tools/minidjvu.c"
int main(int argc , char **argv ) 
{ 
  int arg_start ;
  int tmp ;
  int tmp___0 ;
  char *tmp___1 ;

  {
  {
#line 678
  setlocale(6, "");
#line 680
  bindtextdomain("minidjvu", "/usr/local/share/locale");
#line 681
  textdomain("minidjvu");
#line 685
  arg_start = process_options(argc, argv);
  }
#line 686
  if ((unsigned long )dict_suffix == (unsigned long )((void *)0)) {
#line 686
    dict_suffix = "iff";
  }
#line 688
  argc -= arg_start - 1;
#line 689
  argv += arg_start - 1;
#line 691
  if (argc < 3) {
    {
#line 692
    show_usage_and_exit();
    }
  }
#line 694
  if (argc > 3) {
    {
#line 696
    multipage_encode(argc - 2, argv + 1, *(argv + (argc - 1)), (uint32 )0);
    }
  } else {
    {
#line 704
    tmp___0 = decide_if_djvu((char const   *)*(argv + 2));
    }
#line 704
    if (tmp___0) {
      {
#line 706
      encode(argc, argv);
      }
    } else {
      {
#line 710
      tmp = decide_if_djvu((char const   *)*(argv + 1));
      }
#line 710
      if (tmp) {
        {
#line 711
        decode(argc, argv);
        }
      } else {
        {
#line 713
        filter(argc, argv);
        }
      }
    }
  }
#line 716
  if (verbose) {
    {
#line 716
    printf((char const   */* __restrict  */)"\n");
    }
  }
#line 718
  if (alive_bitmap_counter) {
    {
#line 719
    tmp___1 = dgettext("minidjvu", "alive_bitmap_counter = %d\n");
#line 719
    printf((char const   */* __restrict  */)tmp___1, alive_bitmap_counter);
    }
  }
#line 721
  return (0);
}
}
#line 30 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/erosion.c"
static void get_erosion_candidates_in_a_row___0(unsigned char *r , unsigned char *u ,
                                                unsigned char *t , unsigned char *l ,
                                                int32 n ) 
{ 
  int32 i ;
  int score_4 ;
  int score_d ;

  {
#line 38
  n --;
#line 39
  *(r + 0) = (unsigned char)0;
#line 40
  *(r + n) = (unsigned char)0;
#line 41
  i = 1;
  {
#line 41
  while (1) {
    while_continue: /* CIL Label */ ;
#line 41
    if (! (i < n)) {
#line 41
      goto while_break;
    }
#line 43
    score_4 = ((((int )*(u + i) + (int )*(l + i)) + (int )*(t + (i - 1))) + (int )*(t + (i + 1))) - 2;
#line 44
    score_d = ((((int )*(u + (i - 1)) + (int )*(l + (i - 1))) + (int )*(u + (i + 1))) + (int )*(l + (i + 1))) - 2;
#line 46
    if (! score_4) {
#line 46
      if (! score_d) {
#line 46
        *(r + i) = (unsigned char)1;
      } else {
#line 46
        *(r + i) = (unsigned char)0;
      }
    } else {
#line 46
      *(r + i) = (unsigned char)0;
    }
#line 41
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 48
  return;
}
}
#line 11 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
static void read_align___0(FILE *f ) 
{ 
  long pos ;
  long tmp ;

  {
  {
#line 13
  tmp = ftell(f);
#line 13
  pos = tmp;
  }
#line 14
  if (pos & 1L) {
    {
#line 14
    fgetc(f);
    }
  }
#line 15
  return;
}
}
#line 17 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/djvu/iff.c"
static void write_align___0(FILE *f ) 
{ 
  long pos ;
  long tmp ;

  {
  {
#line 19
  tmp = ftell(f);
#line 19
  pos = tmp;
  }
#line 20
  if (pos & 1L) {
    {
#line 20
    fputc(0, f);
    }
  }
#line 21
  return;
}
}
#line 9 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/pbm.c"
static void skip_to_the_end_of_line___0(FILE *file ) 
{ 
  int tmp ;

  {
  {
#line 11
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 13
    tmp = fgetc(file);
    }
    {
#line 15
    if (tmp == 10) {
#line 15
      goto case_10;
    }
#line 15
    if (tmp == 13) {
#line 15
      goto case_10;
    }
#line 15
    if (tmp == -1) {
#line 15
      goto case_10;
    }
#line 13
    goto switch_break;
    case_10: /* CIL Label */ 
    case_13: /* CIL Label */ 
    case_neg_1: /* CIL Label */ 
#line 16
    return;
    switch_break: /* CIL Label */ ;
    }
  }
  while_break: /* CIL Label */ ;
  }
}
}
#line 21 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/pbm.c"
static void mdjvu_skip_pbm_whitespace_and_comments___0(mdjvu_file_t f ) 
{ 
  FILE *file ;
  int c ;
  int tmp ;

  {
  {
#line 23
  file = (FILE *)f;
#line 24
  tmp = fgetc(file);
#line 24
  c = tmp;
  }
  {
#line 25
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 29
    if (c == 10) {
#line 29
      goto case_10;
    }
#line 29
    if (c == 13) {
#line 29
      goto case_10;
    }
#line 29
    if (c == 9) {
#line 29
      goto case_10;
    }
#line 29
    if (c == 32) {
#line 29
      goto case_10;
    }
#line 32
    if (c == 35) {
#line 32
      goto case_35;
    }
#line 36
    goto switch_default;
    case_10: /* CIL Label */ 
    case_13: /* CIL Label */ 
    case_9: /* CIL Label */ 
    case_32: /* CIL Label */ 
    {
#line 30
    c = fgetc(file);
    }
#line 31
    goto switch_break;
    case_35: /* CIL Label */ 
    {
#line 33
    skip_to_the_end_of_line___0(file);
#line 34
    c = fgetc(file);
    }
#line 35
    goto switch_break;
    switch_default: /* CIL Label */ 
    {
#line 37
    ungetc(c, file);
    }
#line 38
    return;
    switch_break: /* CIL Label */ ;
    }
  }
  while_break: /* CIL Label */ ;
  }
}
}
#line 16 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/6string.c"
static int my_strcasecmp___0(char const   *s1 , char const   *s2 ) 
{ 
  int c1 ;
  int c2 ;
  int d ;
  char const   *tmp ;
  char const   *tmp___0 ;

  {
  {
#line 19
  while (1) {
    while_continue: /* CIL Label */ ;
#line 19
    if (! *s1) {
#line 19
      goto while_break;
    }
    {
#line 22
    tmp = s1;
#line 22
    s1 ++;
#line 22
    c1 = tolower((int )*tmp);
#line 22
    tmp___0 = s2;
#line 22
    s2 ++;
#line 22
    c2 = tolower((int )*tmp___0);
#line 23
    d = c1 - c2;
    }
#line 24
    if (d) {
#line 24
      return (d);
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 26
  return ((int )*s2);
}
}
#line 81 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
static void initialize_artifact___0(void **artifacts , mdjvu_bitmap_t bitmap , mdjvu_artifact_type_enum a ) 
{ 
  int32 i ;
  int32 tmp ;

  {
  {
#line 83
  tmp = mdjvu_bitmap_get_index(bitmap);
#line 83
  i = tmp;
  }
  {
#line 86
  if ((unsigned int )a == 0U) {
#line 86
    goto case_0;
  }
#line 89
  if ((unsigned int )a == 1U) {
#line 89
    goto case_1;
  }
#line 92
  if ((unsigned int )a == 4U) {
#line 92
    goto case_4;
  }
#line 96
  if ((unsigned int )a == 5U) {
#line 96
    goto case_5;
  }
#line 99
  if ((unsigned int )a == 2U) {
#line 99
    goto case_2;
  }
#line 102
  if ((unsigned int )a == 3U) {
#line 102
    goto case_3;
  }
#line 106
  if ((unsigned int )a == 7U) {
#line 106
    goto case_7;
  }
#line 106
  if ((unsigned int )a == 6U) {
#line 106
    goto case_7;
  }
#line 84
  goto switch_break;
  case_0: /* CIL Label */ 
#line 87
  *((mdjvu_bitmap_t *)*(artifacts + 0) + i) = (mdjvu_bitmap_t )((void *)0);
#line 88
  goto switch_break;
  case_1: /* CIL Label */ 
#line 90
  *((mdjvu_bitmap_t *)*(artifacts + 1) + i) = (mdjvu_bitmap_t )((void *)0);
#line 91
  goto switch_break;
  case_4: /* CIL Label */ 
  {
#line 93
  *((int32 *)*(artifacts + 4) + i) = mdjvu_bitmap_get_mass(bitmap);
  }
#line 95
  goto switch_break;
  case_5: /* CIL Label */ 
#line 97
  *((int32 *)*(artifacts + 5) + i) = -1;
#line 98
  goto switch_break;
  case_2: /* CIL Label */ 
#line 100
  *((unsigned char *)*(artifacts + 2) + i) = (unsigned char)0;
#line 101
  goto switch_break;
  case_3: /* CIL Label */ 
#line 103
  *((unsigned char *)*(artifacts + 3) + i) = (unsigned char)0;
#line 104
  goto switch_break;
  case_7: /* CIL Label */ 
  case_6: /* CIL Label */ ;
  switch_break: /* CIL Label */ ;
  }
#line 108
  return;
}
}
#line 110 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
static void initialize_artifacts___0(void **artifacts , mdjvu_bitmap_t bitmap ) 
{ 
  int a ;

  {
#line 113
  a = 0;
  {
#line 113
  while (1) {
    while_continue: /* CIL Label */ ;
#line 113
    if (! (a < 7)) {
#line 113
      goto while_break;
    }
#line 115
    if (*(artifacts + a)) {
      {
#line 116
      initialize_artifact___0(artifacts, bitmap, (mdjvu_artifact_type_enum )a);
      }
    }
#line 113
    a ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 119
  return;
}
}
#line 121 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
static void mdjvu_image_enable_artifact___0(mdjvu_image_t image , mdjvu_artifact_type_enum artifact_index ) 
{ 
  int32 i ;
  int32 n ;

  {
#line 125
  n = ((Image___0 *)image)->bitmaps_count;
#line 126
  if (! ((Image___0 *)image)->artifacts[artifact_index]) {
    {
#line 128
    ((Image___0 *)image)->artifacts[artifact_index] = malloc((size_t )(((Image___0 *)image)->bitmaps_allocated * (int32 )artifact_sizes[artifact_index]));
    }
  }
#line 131
  i = 0;
  {
#line 131
  while (1) {
    while_continue: /* CIL Label */ ;
#line 131
    if (! (i < n)) {
#line 131
      goto while_break;
    }
    {
#line 133
    initialize_artifact___0(((Image___0 *)image)->artifacts, *(((Image___0 *)image)->bitmaps + i),
                            artifact_index);
#line 131
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 135
  return;
}
}
#line 137 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/5image.c"
static void mdjvu_image_disable_artifact___0(mdjvu_image_t image , mdjvu_artifact_type_enum artifact_index ) 
{ 


  {
#line 140
  if (((Image___0 *)image)->artifacts[artifact_index]) {
    {
#line 142
    free(((Image___0 *)image)->artifacts[artifact_index]);
#line 143
    ((Image___0 *)image)->artifacts[artifact_index] = (void *)0;
    }
  }
#line 145
  return;
}
}
#line 18 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/jb2/proto.c"
static int diff___0(mdjvu_bitmap_t image , mdjvu_bitmap_t prototype , unsigned char **image_uncompressed ,
                    unsigned char **proto_uncompressed , int32 ceiling ) 
{ 
  int32 pw ;
  int32 tmp ;
  int32 ph ;
  int32 tmp___0 ;
  int32 iw ;
  int32 tmp___1 ;
  int32 ih ;
  int32 tmp___2 ;
  int32 shift_x ;
  int32 shift_y ;
  int32 s ;
  int32 i ;
  int32 n ;
  unsigned char *ir ;
  unsigned char *pr ;
  int tmp___3 ;
  int tmp___4 ;
  void *tmp___5 ;
  void *tmp___6 ;
  int32 y ;

  {
  {
#line 24
  tmp = mdjvu_bitmap_get_width(prototype);
#line 24
  pw = tmp;
#line 25
  tmp___0 = mdjvu_bitmap_get_height(prototype);
#line 25
  ph = tmp___0;
#line 26
  tmp___1 = mdjvu_bitmap_get_width(image);
#line 26
  iw = tmp___1;
#line 27
  tmp___2 = mdjvu_bitmap_get_height(image);
#line 27
  ih = tmp___2;
#line 29
  s = 0;
#line 29
  n = pw + 2;
#line 33
  tmp___3 = abs(iw - pw);
  }
#line 33
  if (tmp___3 > 2) {
#line 33
    return (2147483647);
  }
  {
#line 34
  tmp___4 = abs(ih - ph);
  }
#line 34
  if (tmp___4 > 2) {
#line 34
    return (2147483647);
  }
  {
#line 36
  tmp___5 = malloc((size_t )n);
#line 36
  ir = (unsigned char *)tmp___5;
#line 37
  tmp___6 = malloc((size_t )n);
#line 37
  pr = (unsigned char *)tmp___6;
#line 40
  shift_x = (pw - pw / 2) - (iw - iw / 2);
#line 41
  shift_y = ph / 2 - ih / 2;
#line 43
  memset((void *)pr, 0, (size_t )n);
#line 44
  memset((void *)ir, 0, (size_t )n);
#line 46
  i = -1;
  }
  {
#line 46
  while (1) {
    while_continue: /* CIL Label */ ;
#line 46
    if (! (i <= ph)) {
#line 46
      goto while_break;
    }
#line 48
    y = i - shift_y;
#line 50
    if (y >= 0) {
#line 50
      if (y < ih) {
        {
#line 51
        memcpy((void */* __restrict  */)((ir + shift_x) + 1), (void const   */* __restrict  */)*(image_uncompressed + y),
               (size_t )iw);
        }
      } else {
        {
#line 53
        memset((void *)ir, 0, (size_t )n);
        }
      }
    } else {
      {
#line 53
      memset((void *)ir, 0, (size_t )n);
      }
    }
#line 55
    if (i >= 0) {
#line 55
      if (i < ph) {
        {
#line 56
        memcpy((void */* __restrict  */)(pr + 1), (void const   */* __restrict  */)*(proto_uncompressed + i),
               (size_t )pw);
        }
      } else {
        {
#line 58
        memset((void *)pr, 0, (size_t )n);
        }
      }
    } else {
      {
#line 58
      memset((void *)pr, 0, (size_t )n);
      }
    }
#line 61
    y = 0;
    {
#line 61
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 61
      if (! (y < n)) {
#line 61
        goto while_break___0;
      }
#line 61
      if ((int )*(ir + y) != (int )*(pr + y)) {
#line 61
        s ++;
      }
#line 61
      y ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 62
    if (s > ceiling) {
      {
#line 64
      free((void *)ir);
#line 65
      free((void *)pr);
      }
#line 66
      return (s);
    }
#line 46
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 70
  free((void *)ir);
#line 71
  free((void *)pr);
  }
#line 73
  return (s);
}
}
#line 76 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/jb2/proto.c"
static void find_prototypes___0(mdjvu_image_t dict , unsigned char ***uncompressed_dict ,
                                mdjvu_image_t img ) 
{ 
  int32 d ;
  int32 tmp ;
  int32 tmp___0 ;
  int32 i ;
  int32 n ;
  int32 tmp___1 ;
  unsigned char ***uncompressed_bitmaps ;
  void *tmp___2 ;
  mdjvu_bitmap_t current ;
  mdjvu_bitmap_t tmp___3 ;
  int32 w ;
  int32 tmp___4 ;
  int32 h ;
  int32 tmp___5 ;
  int tmp___6 ;
  int tmp___7 ;
  int tmp___8 ;
  mdjvu_bitmap_t current___0 ;
  mdjvu_bitmap_t tmp___9 ;
  int32 mass ;
  int32 tmp___10 ;
  int32 w___0 ;
  int32 tmp___11 ;
  int32 h___0 ;
  int32 tmp___12 ;
  int32 max_score ;
  int32 j ;
  mdjvu_bitmap_t best_match ;
  int32 best_score ;
  int32 score ;
  mdjvu_bitmap_t candidate ;
  mdjvu_bitmap_t tmp___13 ;
  int32 c_mass ;
  int32 tmp___14 ;
  int tmp___15 ;
  int32 score___0 ;
  mdjvu_bitmap_t candidate___0 ;
  mdjvu_bitmap_t tmp___16 ;
  int32 c_mass___0 ;
  int32 tmp___17 ;
  int tmp___18 ;

  {
#line 79
  if (dict) {
    {
#line 79
    tmp = mdjvu_image_get_bitmap_count(dict);
#line 79
    tmp___0 = tmp;
    }
  } else {
#line 79
    tmp___0 = 0;
  }
  {
#line 79
  d = tmp___0;
#line 80
  tmp___1 = mdjvu_image_get_bitmap_count(img);
#line 80
  n = tmp___1;
#line 81
  tmp___2 = malloc((unsigned long )n * sizeof(unsigned char **));
#line 81
  uncompressed_bitmaps = (unsigned char ***)tmp___2;
#line 84
  i = 0;
  }
  {
#line 84
  while (1) {
    while_continue: /* CIL Label */ ;
#line 84
    if (! (i < n)) {
#line 84
      goto while_break;
    }
    {
#line 86
    tmp___3 = mdjvu_image_get_bitmap(img, i);
#line 86
    current = tmp___3;
#line 87
    tmp___4 = mdjvu_bitmap_get_width(current);
#line 87
    w = tmp___4;
#line 88
    tmp___5 = mdjvu_bitmap_get_height(current);
#line 88
    h = tmp___5;
#line 89
    *(uncompressed_bitmaps + i) = mdjvu_create_2d_array(w, h);
#line 90
    mdjvu_bitmap_unpack_all_0_or_1(current, *(uncompressed_bitmaps + i));
#line 84
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 93
  tmp___6 = mdjvu_image_has_prototypes(img);
  }
#line 93
  if (! tmp___6) {
    {
#line 94
    mdjvu_image_enable_prototypes(img);
    }
  }
  {
#line 95
  tmp___7 = mdjvu_image_has_substitutions(img);
  }
#line 95
  if (! tmp___7) {
    {
#line 96
    mdjvu_image_enable_substitutions(img);
    }
  }
  {
#line 97
  tmp___8 = mdjvu_image_has_masses(img);
  }
#line 97
  if (! tmp___8) {
    {
#line 98
    mdjvu_image_enable_masses(img);
    }
  }
#line 99
  i = 0;
  {
#line 99
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 99
    if (! (i < n)) {
#line 99
      goto while_break___0;
    }
    {
#line 101
    tmp___9 = mdjvu_image_get_bitmap(img, i);
#line 101
    current___0 = tmp___9;
#line 102
    tmp___10 = mdjvu_image_get_mass(img, current___0);
#line 102
    mass = tmp___10;
#line 103
    tmp___11 = mdjvu_bitmap_get_width(current___0);
#line 103
    w___0 = tmp___11;
#line 104
    tmp___12 = mdjvu_bitmap_get_height(current___0);
#line 104
    h___0 = tmp___12;
#line 105
    max_score = ((w___0 * h___0) * 21) / 100;
#line 107
    best_match = (mdjvu_bitmap_t )((void *)0);
#line 108
    best_score = max_score;
#line 110
    j = 0;
    }
    {
#line 110
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 110
      if (! (j < d)) {
#line 110
        goto while_break___1;
      }
      {
#line 113
      tmp___13 = mdjvu_image_get_bitmap(dict, j);
#line 113
      candidate = tmp___13;
#line 114
      tmp___14 = mdjvu_image_get_mass(dict, candidate);
#line 114
      c_mass = tmp___14;
#line 115
      tmp___15 = abs(mass - c_mass);
      }
#line 115
      if (tmp___15 > best_score) {
#line 115
        goto __Cont;
      }
      {
#line 116
      score = diff___0(current___0, candidate, *(uncompressed_bitmaps + i), *(uncompressed_dict + j),
                       best_score);
      }
#line 121
      if (score < best_score) {
#line 123
        best_score = score;
#line 124
        best_match = candidate;
#line 125
        if (! score) {
#line 126
          goto while_break___1;
        }
      }
      __Cont: /* CIL Label */ 
#line 110
      j ++;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 130
    if (best_score) {
#line 130
      j = 0;
      {
#line 130
      while (1) {
        while_continue___2: /* CIL Label */ ;
#line 130
        if (! (j < i)) {
#line 130
          goto while_break___2;
        }
        {
#line 133
        tmp___16 = mdjvu_image_get_bitmap(img, j);
#line 133
        candidate___0 = tmp___16;
#line 134
        tmp___17 = mdjvu_image_get_mass(img, candidate___0);
#line 134
        c_mass___0 = tmp___17;
#line 135
        tmp___18 = abs(mass - c_mass___0);
        }
#line 135
        if (tmp___18 > best_score) {
#line 135
          goto __Cont___0;
        }
        {
#line 136
        score___0 = diff___0(current___0, candidate___0, *(uncompressed_bitmaps + i),
                             *(uncompressed_bitmaps + j), best_score);
        }
#line 141
        if (score___0 < best_score) {
#line 143
          best_score = score___0;
#line 144
          best_match = candidate___0;
#line 145
          if (! score___0) {
#line 146
            goto while_break___2;
          }
        }
        __Cont___0: /* CIL Label */ 
#line 130
        j ++;
      }
      while_break___2: /* CIL Label */ ;
      }
    }
#line 150
    if (best_score) {
      {
#line 151
      mdjvu_image_set_prototype(img, current___0, best_match);
      }
    } else {
      {
#line 153
      mdjvu_image_set_substitution(img, current___0, best_match);
      }
    }
#line 99
    i ++;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 157
  i = 0;
  {
#line 157
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 157
    if (! (i < n)) {
#line 157
      goto while_break___3;
    }
    {
#line 159
    mdjvu_destroy_2d_array(*(uncompressed_bitmaps + i));
#line 157
    i ++;
    }
  }
  while_break___3: /* CIL Label */ ;
  }
  {
#line 161
  free((void *)uncompressed_bitmaps);
  }
#line 162
  return;
}
}
#line 21 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/blitsort.c"
static int compare_top_edges_downward___0(void const   *p1 , void const   *p2 ) 
{ 
  BlitPassport const   *bp1 ;
  BlitPassport const   *bp2 ;
  int32 d ;

  {
#line 23
  bp1 = (BlitPassport const   *)p1;
#line 24
  bp2 = (BlitPassport const   *)p2;
#line 26
  d = (int32 )(bp1->top - bp2->top);
#line 27
  if (d) {
#line 27
    return (d);
  }
#line 28
  d = (int32 )(bp1->left - bp2->left);
#line 29
  if (d) {
#line 29
    return (d);
  }
#line 30
  return (0);
}
}
#line 33 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/blitsort.c"
static int compare_left_edges_rightward___0(void const   *p1 , void const   *p2 ) 
{ 
  BlitPassport const   *bp1 ;
  BlitPassport const   *bp2 ;
  int32 d ;

  {
#line 35
  bp1 = (BlitPassport const   *)p1;
#line 36
  bp2 = (BlitPassport const   *)p2;
#line 38
  d = (int32 )(bp1->left - bp2->left);
#line 39
  if (d) {
#line 39
    return (d);
  }
#line 40
  d = (int32 )(bp1->top - bp2->top);
#line 41
  if (d) {
#line 41
    return (d);
  }
#line 42
  return (0);
}
}
#line 45 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/blitsort.c"
static int compare_integers_reversed___0(void const   *p1 , void const   *p2 ) 
{ 
  int32 d ;
  int tmp ;
  int tmp___0 ;

  {
#line 47
  if (sizeof(int ) == sizeof(int32 )) {
#line 49
    return ((int )(*((int const   *)p2) - *((int const   *)p1)));
  } else {
#line 53
    d = (int32 )(*((int32 const   *)p2) - *((int32 const   *)p1));
#line 54
    if (d > 0) {
#line 54
      tmp___0 = 1;
    } else {
#line 54
      if (d < 0) {
#line 54
        tmp = -1;
      } else {
#line 54
        tmp = 0;
      }
#line 54
      tmp___0 = tmp;
    }
#line 54
    return (tmp___0);
  }
}
}
#line 19 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/nosubst.c"
static int segments_intersect_or_touch___0(int32 a1 , int32 l1 , int32 a2 , int32 l2 ) 
{ 
  int tmp ;

  {
#line 21
  if (a1 <= a2 + l2) {
#line 21
    if (a2 <= a1 + l1) {
#line 21
      tmp = 1;
    } else {
#line 21
      tmp = 0;
    }
  } else {
#line 21
    tmp = 0;
  }
#line 21
  return (tmp);
}
}
#line 24 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/nosubst.c"
static int blits_intersect_or_touch___0(mdjvu_image_t image , int32 b1 , int32 b2 ) 
{ 
  int32 x1 ;
  int32 tmp ;
  int32 x2 ;
  int32 tmp___0 ;
  int32 y1 ;
  int32 tmp___1 ;
  int32 y2 ;
  int32 tmp___2 ;
  mdjvu_bitmap_t bitmap1 ;
  mdjvu_bitmap_t tmp___3 ;
  mdjvu_bitmap_t bitmap2 ;
  mdjvu_bitmap_t tmp___4 ;
  int32 w1 ;
  int32 tmp___5 ;
  int32 w2 ;
  int32 tmp___6 ;
  int32 h1 ;
  int32 tmp___7 ;
  int32 h2 ;
  int32 tmp___8 ;
  int tmp___9 ;
  int tmp___10 ;
  int tmp___11 ;

  {
  {
#line 26
  tmp = mdjvu_image_get_blit_x(image, b1);
#line 26
  x1 = tmp;
#line 27
  tmp___0 = mdjvu_image_get_blit_x(image, b2);
#line 27
  x2 = tmp___0;
#line 28
  tmp___1 = mdjvu_image_get_blit_y(image, b1);
#line 28
  y1 = tmp___1;
#line 29
  tmp___2 = mdjvu_image_get_blit_y(image, b2);
#line 29
  y2 = tmp___2;
#line 30
  tmp___3 = mdjvu_image_get_blit_bitmap(image, b1);
#line 30
  bitmap1 = tmp___3;
#line 31
  tmp___4 = mdjvu_image_get_blit_bitmap(image, b2);
#line 31
  bitmap2 = tmp___4;
#line 32
  tmp___5 = mdjvu_bitmap_get_width(bitmap1);
#line 32
  w1 = tmp___5;
#line 33
  tmp___6 = mdjvu_bitmap_get_width(bitmap2);
#line 33
  w2 = tmp___6;
#line 34
  tmp___7 = mdjvu_bitmap_get_height(bitmap1);
#line 34
  h1 = tmp___7;
#line 35
  tmp___8 = mdjvu_bitmap_get_height(bitmap2);
#line 35
  h2 = tmp___8;
#line 36
  tmp___9 = segments_intersect_or_touch___0(x1, w1, x2, w2);
  }
#line 36
  if (tmp___9) {
    {
#line 36
    tmp___10 = segments_intersect_or_touch___0(y1, h1, y2, h2);
    }
#line 36
    if (tmp___10) {
#line 36
      tmp___11 = 1;
    } else {
#line 36
      tmp___11 = 0;
    }
  } else {
#line 36
    tmp___11 = 0;
  }
#line 36
  return (tmp___11);
}
}
#line 40 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/nosubst.c"
static void make_no_subst___0(mdjvu_image_t image , int32 blit ) 
{ 
  int32 i ;
  int32 b ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp ;
  int tmp___0 ;
  int tmp___1 ;

  {
  {
#line 43
  tmp = mdjvu_image_get_blit_bitmap(image, blit);
#line 43
  bitmap = tmp;
#line 44
  tmp___0 = mdjvu_image_get_not_a_letter_flag(image, bitmap);
  }
#line 44
  if (tmp___0) {
#line 44
    return;
  }
  {
#line 45
  mdjvu_image_set_not_a_letter_flag(image, bitmap, 1);
#line 48
  b = mdjvu_image_get_blit_count(image);
#line 49
  i = 0;
  }
  {
#line 49
  while (1) {
    while_continue: /* CIL Label */ ;
#line 49
    if (! (i < b)) {
#line 49
      goto while_break;
    }
    {
#line 51
    tmp___1 = blits_intersect_or_touch___0(image, blit, i);
    }
#line 51
    if (tmp___1) {
      {
#line 52
      make_no_subst___0(image, i);
      }
    }
#line 49
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 54
  return;
}
}
#line 40 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   pithdiff1_veto_threshold___0  =    (double const   )23;
#line 41 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   pithdiff2_veto_threshold___0  =    (double const   )4;
#line 42 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff1_veto_threshold___0  =    (double const   )1000;
#line 43 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff2_veto_threshold___0  =    (double const   )1500;
#line 44 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff3_veto_threshold___0  =    (double const   )2000;
#line 46 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   size_difference_threshold___0  =    (double const   )10;
#line 47 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   mass_difference_threshold___0  =    (double const   )15;
#line 49 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff1_falloff___0  =    (double const   ).9;
#line 50 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff2_falloff___0  =    (double const   )1;
#line 51 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static double const   shiftdiff3_falloff___0  =    (double const   )1.15;
#line 53 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static void interpolate___0(Options *opt , double const   *v1 , double const   *v2 ,
                            int l , int r , int x ) 
{ 
  double w1 ;
  double w2 ;

  {
#line 56
  w1 = (double )(r - x) / (double )(r - l);
#line 57
  w2 = (double )1 - w1;
#line 58
  opt->pithdiff1_threshold = (double )(*(v1 + 0) * (double const   )w1 + *(v2 + 0) * (double const   )w2);
#line 59
  opt->pithdiff2_threshold = (double )(*(v1 + 1) * (double const   )w1 + *(v2 + 1) * (double const   )w2);
#line 60
  opt->shiftdiff1_threshold = (double )(*(v1 + 2) * (double const   )w1 + *(v2 + 2) * (double const   )w2);
#line 61
  opt->shiftdiff2_threshold = (double )(*(v1 + 3) * (double const   )w1 + *(v2 + 3) * (double const   )w2);
#line 62
  opt->shiftdiff3_threshold = (double )(*(v1 + 4) * (double const   )w1 + *(v2 + 4) * (double const   )w2);
#line 63
  return;
}
}
#line 139 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int simple_tests___0(Image *i1 , Image *i2 ) 
{ 
  int32 w1 ;
  int32 h1 ;
  int32 m1 ;
  int32 w2 ;
  int32 h2 ;
  int32 m2 ;

  {
#line 141
  w1 = i1->width;
#line 141
  h1 = i1->height;
#line 141
  m1 = i1->mass;
#line 142
  w2 = i2->width;
#line 142
  h2 = i2->height;
#line 142
  m2 = i2->mass;
#line 144
  if (100. * (double )w1 > (100. + (double )size_difference_threshold___0) * (double )w2) {
#line 144
    return (-1);
  }
#line 145
  if (100. * (double )w2 > (100. + (double )size_difference_threshold___0) * (double )w1) {
#line 145
    return (-1);
  }
#line 146
  if (100. * (double )h1 > (100. + (double )size_difference_threshold___0) * (double )h2) {
#line 146
    return (-1);
  }
#line 147
  if (100. * (double )h2 > (100. + (double )size_difference_threshold___0) * (double )h1) {
#line 147
    return (-1);
  }
#line 148
  if (100. * (double )m1 > (100. + (double )mass_difference_threshold___0) * (double )m2) {
#line 148
    return (-1);
  }
#line 149
  if (100. * (double )m2 > (100. + (double )mass_difference_threshold___0) * (double )m1) {
#line 149
    return (-1);
  }
#line 151
  return (0);
}
}
#line 171 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 distance_by_pixeldiff_functions_by_shift___0(Image *i1 , Image *i2 ,
                                                          int32 (*compare_row)(byte * ,
                                                                               byte * ,
                                                                               int32  ) ,
                                                          int32 (*compare_1_with_white)(byte * ,
                                                                                        int32  ) ,
                                                          int32 (*compare_2_with_white)(byte * ,
                                                                                        int32  ) ,
                                                          int32 ceiling , int32 shift_x ,
                                                          int32 shift_y ) 
{ 
  int32 w1 ;
  int32 w2 ;
  int32 h1 ;
  int32 h2 ;
  int32 min_y ;
  int32 tmp ;
  int32 right1 ;
  int32 max_y_plus_1 ;
  int32 tmp___0 ;
  int32 i ;
  int32 min_overlap_x ;
  int32 tmp___1 ;
  int32 max_overlap_x_plus_1 ;
  int32 tmp___2 ;
  int32 min_overlap_x_for_i1 ;
  int32 max_overlap_x_plus_1_for_i1 ;
  int32 overlap_length ;
  int32 score ;
  int32 y1___0 ;
  int32 tmp___3 ;
  int32 tmp___4 ;
  int32 tmp___5 ;
  int32 tmp___6 ;
  int32 tmp___7 ;
  int32 tmp___8 ;
  int32 tmp___9 ;

  {
#line 178
  w1 = i1->width;
#line 178
  w2 = i2->width;
#line 178
  h1 = i1->height;
#line 178
  h2 = i2->height;
#line 179
  if (shift_y < 0) {
#line 179
    tmp = shift_y;
  } else {
#line 179
    tmp = 0;
  }
#line 179
  min_y = tmp;
#line 180
  right1 = shift_x + w1;
#line 181
  if (h2 > shift_y + h1) {
#line 181
    tmp___0 = h2;
  } else {
#line 181
    tmp___0 = shift_y + h1;
  }
#line 181
  max_y_plus_1 = tmp___0;
#line 183
  if (shift_x > 0) {
#line 183
    tmp___1 = shift_x;
  } else {
#line 183
    tmp___1 = 0;
  }
#line 183
  min_overlap_x = tmp___1;
#line 184
  if (w2 < right1) {
#line 184
    tmp___2 = w2;
  } else {
#line 184
    tmp___2 = right1;
  }
#line 184
  max_overlap_x_plus_1 = tmp___2;
#line 185
  min_overlap_x_for_i1 = min_overlap_x - shift_x;
#line 186
  max_overlap_x_plus_1_for_i1 = max_overlap_x_plus_1 - shift_x;
#line 187
  overlap_length = max_overlap_x_plus_1 - min_overlap_x;
#line 188
  score = 0;
#line 190
  if (overlap_length <= 0) {
#line 190
    return (2147483647);
  }
#line 192
  i = min_y;
  {
#line 192
  while (1) {
    while_continue: /* CIL Label */ ;
#line 192
    if (! (i < max_y_plus_1)) {
#line 192
      goto while_break;
    }
#line 194
    y1___0 = i - shift_y;
#line 198
    if (i < 0) {
      {
#line 201
      tmp___3 = (*compare_1_with_white)(*(i1->pixels + y1___0), w1);
#line 201
      score += tmp___3;
      }
    } else
#line 198
    if (i >= h2) {
      {
#line 201
      tmp___3 = (*compare_1_with_white)(*(i1->pixels + y1___0), w1);
#line 201
      score += tmp___3;
      }
    } else
#line 203
    if (i < shift_y) {
      {
#line 206
      tmp___4 = (*compare_2_with_white)(*(i2->pixels + i), w2);
#line 206
      score += tmp___4;
      }
    } else
#line 203
    if (i >= shift_y + h1) {
      {
#line 206
      tmp___4 = (*compare_2_with_white)(*(i2->pixels + i), w2);
#line 206
      score += tmp___4;
      }
    } else {
      {
#line 211
      tmp___5 = (*compare_row)(*(i1->pixels + y1___0) + min_overlap_x_for_i1, *(i2->pixels + i) + min_overlap_x,
                               overlap_length);
#line 211
      score += tmp___5;
      }
#line 217
      if (min_overlap_x > 0) {
        {
#line 218
        tmp___6 = (*compare_2_with_white)(*(i2->pixels + i), min_overlap_x);
#line 218
        score += tmp___6;
        }
      } else {
        {
#line 220
        tmp___7 = (*compare_1_with_white)(*(i1->pixels + y1___0), min_overlap_x_for_i1);
#line 220
        score += tmp___7;
        }
      }
#line 223
      if (max_overlap_x_plus_1 < w2) {
        {
#line 225
        tmp___8 = (*compare_2_with_white)(*(i2->pixels + i) + max_overlap_x_plus_1,
                                          w2 - max_overlap_x_plus_1);
#line 225
        score += tmp___8;
        }
      } else {
        {
#line 231
        tmp___9 = (*compare_1_with_white)(*(i1->pixels + y1___0) + max_overlap_x_plus_1_for_i1,
                                          w1 - max_overlap_x_plus_1_for_i1);
#line 231
        score += tmp___9;
        }
      }
    }
#line 238
    if (score >= ceiling) {
#line 238
      return (2147483647);
    }
#line 192
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 240
  return (score);
}
}
#line 243 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 distance_by_pixeldiff_functions___0(Image *i1 , Image *i2 , int32 (*compare_row)(byte * ,
                                                                                              byte * ,
                                                                                              int32  ) ,
                                                 int32 (*compare_1_with_white)(byte * ,
                                                                               int32  ) ,
                                                 int32 (*compare_2_with_white)(byte * ,
                                                                               int32  ) ,
                                                 int32 ceiling ) 
{ 
  byte **p1 ;
  byte **p2 ;
  int32 w1 ;
  int32 w2 ;
  int32 h1 ;
  int32 h2 ;
  int32 shift_x ;
  int32 shift_y ;
  Image *img ;
  int32 tmp ;

  {
#line 256
  if (i1->width > i2->width) {
#line 258
    img = i1;
#line 259
    i1 = i2;
#line 260
    i2 = img;
  }
#line 263
  w1 = i1->width;
#line 263
  h1 = i1->height;
#line 263
  p1 = i1->pixels;
#line 264
  w2 = i2->width;
#line 264
  h2 = i2->height;
#line 264
  p2 = i2->pixels;
#line 268
  shift_x = (w2 - w2 / 2) - (w1 - w1 / 2);
#line 269
  shift_y = h2 / 2 - h1 / 2;
#line 271
  shift_x = i2->mass_center_x - i1->mass_center_x;
#line 272
  if (shift_x < 0) {
#line 273
    shift_x = (shift_x - 4) / 8;
  } else {
#line 275
    shift_x = (shift_x + 4) / 8;
  }
#line 277
  shift_y = i2->mass_center_y - i1->mass_center_y;
#line 278
  if (shift_y < 0) {
#line 279
    shift_y = (shift_y - 4) / 8;
  } else {
#line 281
    shift_y = (shift_y + 4) / 8;
  }
  {
#line 283
  tmp = distance_by_pixeldiff_functions_by_shift___0(i1, i2, compare_row, compare_1_with_white,
                                                     compare_2_with_white, ceiling,
                                                     shift_x, shift_y);
  }
#line 283
  return (tmp);
}
}
#line 302 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pithdiff_compare_row___0(byte *row1 , byte *row2 , int32 n ) 
{ 
  int32 i ;
  int32 s ;
  int32 k ;
  int32 l ;

  {
#line 304
  s = 0;
#line 305
  i = 0;
  {
#line 305
  while (1) {
    while_continue: /* CIL Label */ ;
#line 305
    if (! (i < n)) {
#line 305
      goto while_break;
    }
#line 307
    k = (int32 )*(row1 + i);
#line 307
    l = (int32 )*(row2 + i);
#line 308
    if (k == 255) {
#line 309
      s += 255 - l;
    } else
#line 310
    if (l == 255) {
#line 311
      s += 255 - k;
    }
#line 305
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 313
  return (s);
}
}
#line 316 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pithdiff_compare_with_white___0(byte *row , int32 n ) 
{ 
  int32 i ;
  int32 s ;

  {
#line 318
  s = 0;
#line 319
  i = 0;
  {
#line 319
  while (1) {
    while_continue: /* CIL Label */ ;
#line 319
    if (! (i < n)) {
#line 319
      goto while_break;
    }
#line 319
    if ((int )*(row + i) == 255) {
#line 319
      s += 255;
    }
#line 319
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 320
  return (s);
}
}
#line 323 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pithdiff_distance___0(Image *i1 , Image *i2 , int32 ceiling ) 
{ 
  int32 tmp ;

  {
  {
#line 325
  tmp = distance_by_pixeldiff_functions___0(i1, i2, & pithdiff_compare_row___0, & pithdiff_compare_with_white___0,
                                            & pithdiff_compare_with_white___0, ceiling);
  }
#line 325
  return (tmp);
}
}
#line 332 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int pithdiff_equivalence___0(Image *i1 , Image *i2 , double threshold , int32 dpi___0 ) 
{ 
  int32 perimeter ;
  int32 ceiling ;
  int32 d ;
  int32 tmp ;

  {
  {
#line 334
  perimeter = ((i1->width + i1->height) + i2->width) + i2->height;
#line 335
  ceiling = (int32 )(((pithdiff1_veto_threshold___0 * (double const   )dpi___0) * (double const   )perimeter) / (double const   )100);
#line 336
  tmp = pithdiff_distance___0(i1, i2, ceiling);
#line 336
  d = tmp;
  }
#line 337
  if (d == 2147483647) {
#line 337
    return (-1);
  }
#line 338
  if ((double )d < ((threshold * (double )dpi___0) * (double )perimeter) / (double )100) {
#line 338
    return (1);
  }
#line 339
  return (0);
}
}
#line 353 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int shiftdiff_equivalence___0(byte *s1 , byte *s2 , double falloff , double veto ,
                                     double threshold ) 
{ 
  int i ;
  int delay_before_falloff ;
  int delay_counter ;
  double penalty ;
  double weight ;
  int difference ;

  {
#line 355
  delay_before_falloff = 1;
#line 355
  delay_counter = 1;
#line 356
  penalty = (double )0;
#line 357
  weight = (double )1;
#line 359
  i = 1;
  {
#line 359
  while (1) {
    while_continue: /* CIL Label */ ;
#line 359
    if (! (i < 32)) {
#line 359
      goto while_break;
    }
#line 361
    difference = (int )*(s1 + i) - (int )*(s2 + i);
#line 362
    penalty += (double )(difference * difference) * weight;
#line 363
    delay_counter --;
#line 363
    if (! delay_counter) {
#line 365
      weight *= falloff;
#line 366
      delay_before_falloff <<= 1;
#line 366
      delay_counter = delay_before_falloff;
    }
#line 359
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 370
  if (penalty >= veto * (double )32) {
#line 370
    return (-1);
  }
#line 371
  if (penalty <= threshold * (double )32) {
#line 371
    return (1);
  }
#line 372
  return (0);
}
}
#line 394 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static void get_mass_center___0(unsigned char **pixels , int32 w , int32 h , int32 *pmass_center_x ,
                                int32 *pmass_center_y ) 
{ 
  double x_sum ;
  double y_sum ;
  double mass ;
  int32 i ;
  int32 j ;
  unsigned char *row ;
  unsigned char pixel ;

  {
#line 397
  x_sum = (double )0;
#line 397
  y_sum = (double )0;
#line 397
  mass = (double )0;
#line 400
  i = 0;
  {
#line 400
  while (1) {
    while_continue: /* CIL Label */ ;
#line 400
    if (! (i < h)) {
#line 400
      goto while_break;
    }
#line 402
    row = *(pixels + i);
#line 403
    j = 0;
    {
#line 403
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 403
      if (! (j < w)) {
#line 403
        goto while_break___0;
      }
#line 405
      pixel = *(row + j);
#line 406
      x_sum += (double )((int )pixel * j);
#line 407
      y_sum += (double )((int )pixel * i);
#line 408
      mass += (double )pixel;
#line 403
      j ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 400
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 412
  *pmass_center_x = (int32 )((x_sum * (double )8) / mass);
#line 413
  *pmass_center_y = (int32 )((y_sum * (double )8) / mass);
#line 414
  return;
}
}
#line 426 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static void sweep___0(unsigned char **pixels , unsigned char **source , int w , int h ) 
{ 
  int x ;
  int y ;
  unsigned char *row ;
  unsigned char *srow ;
  unsigned char *supper ;
  unsigned char *slower ;

  {
#line 430
  y = 0;
  {
#line 430
  while (1) {
    while_continue: /* CIL Label */ ;
#line 430
    if (! (y < h)) {
#line 430
      goto while_break;
    }
#line 432
    row = *(pixels + y);
#line 433
    srow = *(source + y);
#line 434
    supper = *(source + (y - 1));
#line 435
    slower = *(source + (y + 1));
#line 437
    x = 0;
    {
#line 437
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 437
      if (! (x < w)) {
#line 437
        goto while_break___0;
      }
#line 439
      *(row + x) = (unsigned char )(((((int )*(supper + x) | (int )*(srow + (x - 1))) | (int )*(srow + x)) | (int )*(srow + (x + 1))) | (int )*(slower + x));
#line 437
      x ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 430
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 444
  return;
}
}
#line 446 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static unsigned char **quick_thin___0(unsigned char **pixels , int w , int h , int N ) 
{ 
  unsigned char **aux ;
  unsigned char **tmp ;
  unsigned char **buf ;
  unsigned char **tmp___0 ;
  int tmp___1 ;

  {
  {
#line 448
  tmp = provide_margins(pixels, w, h, 1);
#line 448
  aux = tmp;
#line 449
  tmp___0 = allocate_bitmap_with_white_margins(w, h);
#line 449
  buf = tmp___0;
#line 451
  clear_bitmap(buf, w, h);
#line 452
  invert_bitmap(aux, w, h, 0);
  }
  {
#line 454
  while (1) {
    while_continue: /* CIL Label */ ;
#line 454
    tmp___1 = N;
#line 454
    N --;
#line 454
    if (! tmp___1) {
#line 454
      goto while_break;
    }
    {
#line 456
    sweep___0(buf, aux, w, h);
#line 457
    assign_bitmap(aux, buf, w, h);
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 460
  invert_bitmap(buf, w, h, 0);
#line 462
  free_bitmap_with_margins(aux);
  }
#line 463
  return (buf);
}
}
#line 466 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static unsigned char **quick_thicken___0(unsigned char **pixels , int w , int h ,
                                         int N ) 
{ 
  int r_w ;
  int r_h ;
  int y ;
  int x ;
  unsigned char **aux ;
  unsigned char **tmp ;
  unsigned char **buf ;
  unsigned char **tmp___0 ;
  int tmp___1 ;

  {
  {
#line 468
  r_w = w + N * 2;
#line 469
  r_h = h + N * 2;
#line 471
  tmp = allocate_bitmap_with_white_margins(r_w, r_h);
#line 471
  aux = tmp;
#line 472
  tmp___0 = allocate_bitmap_with_white_margins(r_w, r_h);
#line 472
  buf = tmp___0;
#line 474
  clear_bitmap(buf, r_w, r_h);
#line 475
  clear_bitmap(aux, r_w, r_h);
#line 476
  y = 0;
  }
  {
#line 476
  while (1) {
    while_continue: /* CIL Label */ ;
#line 476
    if (! (y < h)) {
#line 476
      goto while_break;
    }
#line 476
    x = 0;
    {
#line 476
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 476
      if (! (x < w)) {
#line 476
        goto while_break___0;
      }
#line 478
      *(*(aux + (y + N)) + (x + N)) = *(*(pixels + y) + x);
#line 476
      x ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 476
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 481
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 481
    tmp___1 = N;
#line 481
    N --;
#line 481
    if (! tmp___1) {
#line 481
      goto while_break___1;
    }
    {
#line 483
    sweep___0(buf, aux, r_w, r_h);
#line 484
    assign_bitmap(aux, buf, r_w, r_h);
    }
  }
  while_break___1: /* CIL Label */ ;
  }
  {
#line 487
  free_bitmap_with_margins(aux);
  }
#line 488
  return (buf);
}
}
#line 552 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pith2_row_subset___0(byte *A , byte *B , int32 length ) 
{ 
  int32 i ;
  int32 s ;

  {
#line 554
  s = 0;
#line 555
  i = 0;
  {
#line 555
  while (1) {
    while_continue: /* CIL Label */ ;
#line 555
    if (! (i < length)) {
#line 555
      goto while_break;
    }
#line 557
    if ((int )*(A + i) & ! *(B + i)) {
#line 558
      s += 255;
    }
#line 555
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 560
  return (s);
}
}
#line 563 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pith2_row_has_black___0(byte *row , int32 length ) 
{ 
  int32 i ;
  int32 s ;

  {
#line 565
  s = 0;
#line 566
  i = 0;
  {
#line 566
  while (1) {
    while_continue: /* CIL Label */ ;
#line 566
    if (! (i < length)) {
#line 566
      goto while_break;
    }
#line 568
    if (*(row + i)) {
#line 569
      s += 255;
    }
#line 566
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 571
  return (s);
}
}
#line 574 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int32 pith2_return_0___0(byte *A , int32 length ) 
{ 


  {
#line 576
  return (0);
}
}
#line 579 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int pith2_is_subset___0(mdjvu_pattern_t ptr1 , mdjvu_pattern_t ptr2 , double threshold ,
                               int32 dpi___0 ) 
{ 
  Image *i1 ;
  Image *i2 ;
  Image ptr1_inner ;
  Image ptr2_outer ;
  int32 perimeter ;
  int32 ceiling ;
  int32 d ;

  {
#line 581
  i1 = (Image *)ptr1;
#line 582
  i2 = (Image *)ptr2;
#line 585
  perimeter = ((i1->width + i1->height) + i2->width) + i2->height;
#line 586
  ceiling = (int32 )(((pithdiff2_veto_threshold___0 * (double const   )dpi___0) * (double const   )perimeter) / (double const   )100);
#line 587
  d = 0;
#line 589
  ptr1_inner.pixels = i1->pith2_inner;
#line 590
  if (! i1->pith2_inner) {
    {
#line 590
    __assert_fail("i1->pith2_inner", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c",
                  590U, "pith2_is_subset");
    }
  }
#line 591
  ptr1_inner.width = i1->width;
#line 592
  ptr1_inner.height = i1->height;
#line 593
  ptr1_inner.mass_center_x = i1->mass_center_x;
#line 594
  ptr1_inner.mass_center_y = i1->mass_center_y;
#line 596
  ptr2_outer.pixels = i2->pith2_outer;
#line 597
  if (! i2->pith2_outer) {
    {
#line 597
    __assert_fail("i2->pith2_outer", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c",
                  597U, "pith2_is_subset");
    }
  }
  {
#line 598
  ptr2_outer.width = i2->width + 2;
#line 599
  ptr2_outer.height = i2->height + 2;
#line 600
  ptr2_outer.mass_center_x = i2->mass_center_x + 8;
#line 601
  ptr2_outer.mass_center_y = i2->mass_center_y + 8;
#line 603
  d = distance_by_pixeldiff_functions___0(& ptr1_inner, & ptr2_outer, & pith2_row_subset___0,
                                          & pith2_row_has_black___0, & pith2_return_0___0,
                                          ceiling);
  }
#line 609
  if (d == 2147483647) {
#line 609
    return (-1);
  } else
#line 610
  if ((double )d < ((threshold * (double )dpi___0) * (double )perimeter) / (double )100) {
#line 610
    return (1);
  }
#line 611
  return (0);
}
}
#line 615 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/patterns.c"
static int compare_patterns___0(mdjvu_pattern_t ptr1 , mdjvu_pattern_t ptr2 , int32 dpi___0 ,
                                Options *opt ) 
{ 
  Image *i1 ;
  Image *i2 ;
  int i ;
  int state ;
  int tmp ;

  {
  {
#line 619
  i1 = (Image *)ptr1;
#line 619
  i2 = (Image *)ptr2;
#line 620
  state = 0;
#line 622
  tmp = simple_tests___0(i1, i2);
  }
#line 622
  if (tmp) {
#line 622
    return (-1);
  }
  {
#line 625
  i = shiftdiff_equivalence___0(i1->signature, i2->signature, (double )shiftdiff1_falloff___0,
                                (double )shiftdiff1_veto_threshold___0, opt->shiftdiff1_threshold);
  }
#line 627
  if (i == -1) {
#line 627
    return (-1);
  }
  {
#line 628
  state |= i;
#line 632
  i = shiftdiff_equivalence___0(i1->signature2, i2->signature2, (double )shiftdiff2_falloff___0,
                                (double )shiftdiff2_veto_threshold___0, opt->shiftdiff2_threshold);
  }
#line 634
  if (i == -1) {
#line 634
    return (-1);
  }
  {
#line 635
  state |= i;
#line 639
  i = shiftdiff_equivalence___0(i1->signature, i2->signature, (double )shiftdiff3_falloff___0,
                                (double )shiftdiff3_veto_threshold___0, opt->shiftdiff3_threshold);
  }
#line 641
  if (i == -1) {
#line 641
    return (-1);
  }
  {
#line 642
  state |= i;
#line 645
  i = pith2_is_subset___0(ptr1, ptr2, opt->pithdiff2_threshold, dpi___0);
  }
#line 646
  if (i < 1) {
#line 646
    return (i);
  }
  {
#line 647
  i = pith2_is_subset___0(ptr2, ptr1, opt->pithdiff2_threshold, dpi___0);
  }
#line 648
  if (i < 1) {
#line 648
    return (i);
  }
#line 650
  if (opt->method & 2) {
#line 651
    return (1);
  }
#line 654
  if (opt->aggression > 0) {
    {
#line 656
    i = pithdiff_equivalence___0(i1, i2, opt->pithdiff1_threshold, dpi___0);
    }
#line 657
    if (i == -1) {
#line 657
      return (0);
    }
#line 658
    state |= i;
  }
#line 671
  return (state);
}
}
#line 30 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static uint32 read_uint32___0(FILE *f ) 
{ 
  uint32 r ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;

  {
  {
#line 32
  tmp = fgetc(f);
#line 32
  r = (uint32 )tmp;
#line 33
  tmp___0 = fgetc(f);
#line 33
  r |= (unsigned int )(tmp___0 << 8);
#line 34
  tmp___1 = fgetc(f);
#line 34
  r |= (unsigned int )(tmp___1 << 16);
#line 35
  tmp___2 = fgetc(f);
  }
#line 35
  return (r | (unsigned int )(tmp___2 << 24));
}
}
#line 38 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static uint16 read_uint16___0(FILE *f ) 
{ 
  uint32 r ;
  int tmp ;
  int tmp___0 ;

  {
  {
#line 40
  tmp = fgetc(f);
#line 40
  r = (uint32 )tmp;
#line 41
  tmp___0 = fgetc(f);
  }
#line 41
  return ((uint16 )(r | (unsigned int )(tmp___0 << 8)));
}
}
#line 44 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void write_uint16___0(FILE *f , uint16 i ) 
{ 


  {
  {
#line 46
  fputc((int )i, f);
#line 47
  fputc((int )i >> 8, f);
  }
#line 48
  return;
}
}
#line 50 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void write_uint32___0(FILE *f , uint32 i ) 
{ 


  {
  {
#line 52
  fputc((int )i, f);
#line 53
  fputc((int )(i >> 8), f);
#line 54
  fputc((int )(i >> 16), f);
#line 55
  fputc((int )(i >> 24), f);
  }
#line 56
  return;
}
}
#line 58 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void write_bmp_header___0(FILE *f , uint32 w , uint32 h , int resolution ) 
{ 
  uint32 row_size ;
  uint32 data_size ;
  uint32 data_offset ;
  uint32 dpm ;

  {
  {
#line 61
  row_size = ((w + 31U) & 4294967264U) >> 3;
#line 62
  data_size = row_size * h;
#line 63
  data_offset = (uint32 )62;
#line 64
  dpm = (uint32 )((resolution * 5000) / 127);
#line 65
  fputc('B', f);
#line 66
  fputc('M', f);
#line 67
  write_uint32___0(f, data_size + data_offset);
#line 68
  write_uint32___0(f, (uint32 )0);
#line 69
  write_uint32___0(f, data_offset);
#line 70
  write_uint32___0(f, (uint32 )40);
#line 71
  write_uint32___0(f, w);
#line 72
  write_uint32___0(f, h);
#line 73
  write_uint16___0(f, (uint16 )1);
#line 74
  write_uint16___0(f, (uint16 )1);
#line 75
  write_uint32___0(f, (uint32 )0);
#line 76
  write_uint32___0(f, data_size);
#line 77
  write_uint32___0(f, dpm);
#line 78
  write_uint32___0(f, dpm);
#line 79
  write_uint32___0(f, (uint32 )2);
#line 80
  write_uint32___0(f, (uint32 )0);
#line 81
  write_uint32___0(f, (uint32 )0);
#line 82
  write_uint32___0(f, (uint32 )16777215);
  }
#line 83
  return;
}
}
#line 85 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void read_bmp_header___0(FILE *f , Header *h ) 
{ 


  {
  {
#line 87
  h->file_size = read_uint32___0(f);
#line 88
  h->reserved = read_uint32___0(f);
#line 89
  h->offset = read_uint32___0(f);
#line 90
  h->size = read_uint32___0(f);
#line 91
  h->width = read_uint32___0(f);
#line 92
  h->height = read_uint32___0(f);
#line 93
  h->planes = read_uint16___0(f);
#line 94
  h->bits = read_uint16___0(f);
#line 95
  h->compression = read_uint32___0(f);
#line 96
  h->imagesize = read_uint32___0(f);
#line 97
  h->xresolution = read_uint32___0(f);
#line 98
  h->yresolution = read_uint32___0(f);
#line 99
  h->ncolors = read_uint32___0(f);
#line 100
  h->importantcolors = read_uint32___0(f);
#line 101
  h->color_0 = read_uint32___0(f);
#line 102
  h->color_1 = read_uint32___0(f);
  }
#line 103
  return;
}
}
#line 105 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void save_DIB_bytes___0(mdjvu_bitmap_t bmp , FILE *f ) 
{ 
  int32 w ;
  int32 tmp ;
  int32 h ;
  int32 tmp___0 ;
  int32 bytes_per_row ;
  int32 tmp___1 ;
  int32 DIB_row_size ;
  unsigned char *buf ;
  void *tmp___2 ;
  uint32 *p ;
  uint32 i ;
  int mask ;
  uint32 j ;
  unsigned char *row ;
  unsigned char *tmp___3 ;

  {
  {
#line 107
  tmp = mdjvu_bitmap_get_width(bmp);
#line 107
  w = tmp;
#line 108
  tmp___0 = mdjvu_bitmap_get_height(bmp);
#line 108
  h = tmp___0;
#line 109
  tmp___1 = mdjvu_bitmap_get_packed_row_size(bmp);
#line 109
  bytes_per_row = tmp___1;
#line 110
  DIB_row_size = ((w + 31) & -32) >> 3;
#line 111
  tmp___2 = malloc((size_t )DIB_row_size);
#line 111
  buf = (unsigned char *)tmp___2;
  }
#line 115
  if (w & 7) {
#line 116
    mask = ~ (255 >> (w & 7));
  } else {
#line 118
    mask = ~ 0;
  }
#line 120
  i = (uint32 )h;
  {
#line 120
  while (1) {
    while_continue: /* CIL Label */ ;
#line 120
    if (! i) {
#line 120
      goto while_break;
    }
    {
#line 123
    tmp___3 = mdjvu_bitmap_access_packed_row(bmp, (int32 )(i - 1U));
#line 123
    row = tmp___3;
#line 124
    memcpy((void */* __restrict  */)buf, (void const   */* __restrict  */)row, (size_t )bytes_per_row);
#line 125
    j = (uint32 )(DIB_row_size >> 2);
#line 125
    p = (uint32 *)buf;
    }
    {
#line 125
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 125
      if (! j) {
#line 125
        goto while_break___0;
      }
#line 127
      *p = ~ *p;
#line 125
      j --;
#line 125
      p ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 130
    if (bytes_per_row > 1) {
      {
#line 132
      fwrite((void const   */* __restrict  */)buf, (size_t )1, (size_t )(bytes_per_row - 1),
             (FILE */* __restrict  */)f);
      }
    }
    {
#line 134
    fputc((int )*(buf + (bytes_per_row - 1)) & mask, f);
#line 135
    j = (uint32 )(DIB_row_size - bytes_per_row);
    }
    {
#line 135
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 135
      if (! j) {
#line 135
        goto while_break___1;
      }
      {
#line 135
      fputc(0, f);
#line 135
      j --;
      }
    }
    while_break___1: /* CIL Label */ ;
    }
#line 120
    i --;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 137
  free((void *)buf);
  }
#line 138
  return;
}
}
#line 170 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/image-io/bmp.c"
static void invert_row___0(unsigned char *row , int32 bytes_per_row , int32 w ) 
{ 
  int32 i ;

  {
#line 173
  i = 0;
  {
#line 173
  while (1) {
    while_continue: /* CIL Label */ ;
#line 173
    if (! (i < bytes_per_row)) {
#line 173
      goto while_break;
    }
#line 174
    *(row + i) = (unsigned char )(~ ((int )*(row + i)));
#line 173
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 177
  if (w & 7) {
#line 178
    *(row + (bytes_per_row - 1)) = (unsigned char )((int )*(row + (bytes_per_row - 1)) & ~ (255 >> (w & 7)));
  }
#line 179
  return;
}
}
#line 264 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
static int row_is_empty___0(Bitmap *bmp , int32 y ) 
{ 
  unsigned char *row ;
  int32 bytes_to_check ;
  int32 bits_to_check ;
  int32 mask ;
  int32 i ;

  {
#line 266
  row = *(bmp->data + y);
#line 267
  bytes_to_check = ((bmp->width + 7) >> 3) - 1;
#line 268
  bits_to_check = bmp->width - (bytes_to_check << 3);
#line 269
  mask = 255 << (8 - bits_to_check);
#line 272
  i = 0;
  {
#line 272
  while (1) {
    while_continue: /* CIL Label */ ;
#line 272
    if (! (i < bytes_to_check)) {
#line 272
      goto while_break;
    }
#line 273
    if (*(row + i)) {
#line 273
      return (0);
    }
#line 272
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 275
  if ((int )*(row + bytes_to_check) & mask) {
#line 275
    return (0);
  }
#line 276
  return (1);
}
}
#line 279 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/4bitmap.c"
static int column_is_empty___0(Bitmap *bmp , int32 x ) 
{ 
  int32 byte_offset ;
  int mask ;
  int32 bytes_per_row ;
  unsigned char *p ;
  int32 i ;
  int32 tmp ;

  {
#line 281
  byte_offset = x >> 3;
#line 282
  mask = 1 << (7 - (x & 7));
#line 283
  bytes_per_row = (bmp->width + 7) >> 3;
#line 284
  p = *(bmp->data + 0) + byte_offset;
#line 285
  i = bmp->height;
  {
#line 287
  while (1) {
    while_continue: /* CIL Label */ ;
#line 287
    tmp = i;
#line 287
    i --;
#line 287
    if (! tmp) {
#line 287
      goto while_break;
    }
#line 289
    if ((int )*p & mask) {
#line 289
      return (0);
    }
#line 290
    p += bytes_per_row;
  }
  while_break: /* CIL Label */ ;
  }
#line 293
  return (1);
}
}
#line 66 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static void find_substitutions___0(mdjvu_image_t image , struct MinidjvuCompressionOptions *opt ) 
{ 
  mdjvu_matcher_options_t m_opt ;
  int32 i ;
  int32 n ;
  int32 tmp ;
  int32 *tags ;
  void *tmp___0 ;
  int32 max_tag ;
  int32 tmp___1 ;
  mdjvu_bitmap_t *representatives ;
  void *tmp___2 ;
  int32 *cx ;
  void *tmp___3 ;
  int32 *cy ;
  void *tmp___4 ;
  int tmp___5 ;
  mdjvu_bitmap_t *sources ;
  void *tmp___6 ;
  int j ;
  int sources_found ;
  mdjvu_bitmap_t rep ;
  int tmp___7 ;
  int tmp___8 ;
  mdjvu_bitmap_t tmp___9 ;

  {
  {
#line 69
  m_opt = opt->matcher_options;
#line 70
  tmp = mdjvu_image_get_bitmap_count(image);
#line 70
  n = tmp;
#line 71
  tmp___0 = malloc((unsigned long )n * sizeof(int32 ));
#line 71
  tags = (int32 *)tmp___0;
#line 72
  tmp___1 = mdjvu_classify_bitmaps(image, tags, m_opt, opt->averaging);
#line 72
  max_tag = tmp___1;
#line 73
  tmp___2 = calloc((size_t )(max_tag + 1), sizeof(mdjvu_bitmap_t ));
#line 73
  representatives = (mdjvu_bitmap_t *)tmp___2;
#line 75
  tmp___3 = malloc((unsigned long )n * sizeof(int32 ));
#line 75
  cx = (int32 *)tmp___3;
#line 76
  tmp___4 = malloc((unsigned long )n * sizeof(int32 ));
#line 76
  cy = (int32 *)tmp___4;
#line 78
  tmp___5 = mdjvu_image_has_substitutions(image);
  }
#line 78
  if (! tmp___5) {
    {
#line 79
    mdjvu_image_enable_substitutions(image);
    }
  }
#line 80
  if (! opt->averaging) {
#line 82
    i = 0;
    {
#line 82
    while (1) {
      while_continue: /* CIL Label */ ;
#line 82
      if (! (i < n)) {
#line 82
        goto while_break;
      }
#line 84
      if (! *(representatives + *(tags + i))) {
        {
#line 85
        *(representatives + *(tags + i)) = mdjvu_image_get_bitmap(image, i);
        }
      }
#line 82
      i ++;
    }
    while_break: /* CIL Label */ ;
    }
  } else {
    {
#line 91
    tmp___6 = calloc((size_t )n, sizeof(mdjvu_bitmap_t ));
#line 91
    sources = (mdjvu_bitmap_t *)tmp___6;
#line 92
    i = 1;
    }
    {
#line 92
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 92
      if (! (i < max_tag)) {
#line 92
        goto while_break___0;
      }
#line 94
      sources_found = 0;
#line 97
      j = 0;
      {
#line 97
      while (1) {
        while_continue___1: /* CIL Label */ ;
#line 97
        if (! (j < n)) {
#line 97
          goto while_break___1;
        }
#line 99
        if (*(tags + j) == i) {
          {
#line 100
          tmp___7 = sources_found;
#line 100
          sources_found ++;
#line 100
          *(sources + tmp___7) = mdjvu_image_get_bitmap(image, j);
          }
        }
#line 97
        j ++;
      }
      while_break___1: /* CIL Label */ ;
      }
#line 103
      j = 0;
      {
#line 103
      while (1) {
        while_continue___2: /* CIL Label */ ;
#line 103
        if (! (j < sources_found)) {
#line 103
          goto while_break___2;
        }
        {
#line 104
        mdjvu_image_get_center(image, *(sources + j), cx + j, cy + j);
#line 103
        j ++;
        }
      }
      while_break___2: /* CIL Label */ ;
      }
      {
#line 106
      rep = mdjvu_average(sources, sources_found, cx, cy);
#line 107
      mdjvu_image_add_bitmap(image, rep);
#line 108
      mdjvu_image_set_substitution(image, rep, rep);
#line 109
      *(representatives + i) = rep;
#line 92
      i ++;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 112
    mdjvu_image_disable_centers(image);
#line 113
    free((void *)sources);
    }
  }
  {
#line 115
  tmp___8 = mdjvu_image_check_indices(image);
  }
#line 115
  if (! tmp___8) {
    {
#line 115
    __assert_fail("mdjvu_image_check_indices(image)", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c",
                  115U, "find_substitutions");
    }
  }
  {
#line 116
  free((void *)cx);
#line 117
  free((void *)cy);
#line 120
  i = 0;
  }
  {
#line 120
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 120
    if (! (i < n)) {
#line 120
      goto while_break___3;
    }
#line 122
    if (! *(tags + i)) {
#line 122
      goto __Cont;
    }
    {
#line 123
    tmp___9 = mdjvu_image_get_bitmap(image, i);
#line 123
    mdjvu_image_set_substitution(image, tmp___9, *(representatives + *(tags + i)));
    }
    __Cont: /* CIL Label */ 
#line 120
    i ++;
  }
  while_break___3: /* CIL Label */ ;
  }
  {
#line 128
  free((void *)representatives);
#line 129
  free((void *)tags);
  }
#line 130
  return;
}
}
#line 133 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static int32 count_prototypes___0(mdjvu_image_t image ) 
{ 
  int32 i ;
  int32 s ;
  int32 n ;
  int32 tmp ;
  mdjvu_bitmap_t bmp ;
  mdjvu_bitmap_t tmp___0 ;
  mdjvu_bitmap_t tmp___1 ;

  {
  {
#line 135
  s = 0;
#line 135
  tmp = mdjvu_image_get_bitmap_count(image);
#line 135
  n = tmp;
#line 136
  i = 0;
  }
  {
#line 136
  while (1) {
    while_continue: /* CIL Label */ ;
#line 136
    if (! (i < n)) {
#line 136
      goto while_break;
    }
    {
#line 138
    tmp___0 = mdjvu_image_get_bitmap(image, i);
#line 138
    bmp = tmp___0;
#line 139
    tmp___1 = mdjvu_image_get_prototype(image, bmp);
    }
#line 139
    if (tmp___1) {
#line 140
      s ++;
    }
#line 136
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 142
  return (s);
}
}
#line 223 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static mdjvu_image_t get_dictionary___0(int32 max_tag , mdjvu_bitmap_t *representatives ,
                                        unsigned char *dictionary_flags ) 
{ 
  mdjvu_image_t dictionary ;
  mdjvu_image_t tmp ;
  int32 tag ;
  mdjvu_bitmap_t clone ;

  {
  {
#line 227
  tmp = mdjvu_image_create(0, 0);
#line 227
  dictionary = tmp;
#line 229
  tag = 1;
  }
  {
#line 229
  while (1) {
    while_continue: /* CIL Label */ ;
#line 229
    if (! (tag <= max_tag)) {
#line 229
      goto while_break;
    }
#line 232
    if (! *(dictionary_flags + tag)) {
#line 232
      goto __Cont;
    }
    {
#line 233
    clone = mdjvu_bitmap_clone(*(representatives + tag));
#line 234
    *(representatives + tag) = clone;
#line 235
    mdjvu_image_add_bitmap(dictionary, clone);
    }
    __Cont: /* CIL Label */ 
#line 229
    tag ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 237
  return (dictionary);
}
}
#line 253 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static void set_substitutions___0(int n , mdjvu_image_t *pages , int32 total_bitmaps_count ,
                                  int32 *tags , mdjvu_bitmap_t *representatives ) 
{ 
  int page_number ;
  int32 total_bitmaps_passed ;
  mdjvu_image_t page ;
  int32 bitmap_count ;
  int32 tmp ;
  int32 i ;
  int tmp___0 ;
  int32 tag ;
  int32 tmp___1 ;
  mdjvu_bitmap_t tmp___2 ;

  {
#line 260
  total_bitmaps_passed = 0;
#line 261
  page_number = 0;
  {
#line 261
  while (1) {
    while_continue: /* CIL Label */ ;
#line 261
    if (! (page_number < n)) {
#line 261
      goto while_break;
    }
    {
#line 263
    page = *(pages + page_number);
#line 264
    tmp = mdjvu_image_get_bitmap_count(page);
#line 264
    bitmap_count = tmp;
#line 267
    tmp___0 = mdjvu_image_has_substitutions(page);
    }
#line 267
    if (! tmp___0) {
      {
#line 268
      mdjvu_image_enable_substitutions(page);
      }
    }
#line 270
    i = 0;
    {
#line 270
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 270
      if (! (i < bitmap_count)) {
#line 270
        goto while_break___0;
      }
#line 272
      tmp___1 = total_bitmaps_passed;
#line 272
      total_bitmaps_passed ++;
#line 272
      tag = *(tags + tmp___1);
#line 273
      if (! tag) {
#line 273
        goto __Cont;
      }
      {
#line 274
      tmp___2 = mdjvu_image_get_bitmap(page, i);
#line 274
      mdjvu_image_set_substitution(page, tmp___2, *(representatives + tag));
      }
      __Cont: /* CIL Label */ 
#line 270
      i ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 261
    page_number ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 279
  return;
}
}
#line 283 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static void report_classify___0(void *param , int page_completed ) 
{ 
  mdjvu_compression_options_t r ;
  char *tmp ;

  {
#line 285
  r = (mdjvu_compression_options_t )param;
#line 286
  if (r->report) {
    {
#line 288
    tmp = dgettext("minidjvu", "Classification: %d of %d completed\n");
#line 288
    printf((char const   */* __restrict  */)tmp, r->report_start_page + page_completed,
           r->report_total_pages);
    }
  }
#line 291
  return;
}
}
#line 293 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/compress.c"
static void report_prototypes___0(void *param , int page_completed ) 
{ 
  mdjvu_compression_options_t r ;
  char *tmp ;

  {
#line 295
  r = (mdjvu_compression_options_t )param;
#line 296
  if (r->report) {
    {
#line 298
    tmp = dgettext("minidjvu", "Prototype search: %d of %d completed\n");
#line 298
    printf((char const   */* __restrict  */)tmp, r->report_start_page + page_completed,
           r->report_total_pages);
    }
  }
#line 301
  return;
}
}
#line 26 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
static int32 compute_baseline___0(mdjvu_bitmap_t bitmap ) 
{ 
  int32 w ;
  int32 tmp ;
  int32 h ;
  int32 tmp___0 ;
  int32 *mass ;
  void *tmp___1 ;
  unsigned char *row ;
  void *tmp___2 ;
  int32 i ;
  int32 j ;
  int32 m ;
  int32 tm ;

  {
  {
#line 28
  tmp = mdjvu_bitmap_get_width(bitmap);
#line 28
  w = tmp;
#line 29
  tmp___0 = mdjvu_bitmap_get_height(bitmap);
#line 29
  h = tmp___0;
#line 30
  tmp___1 = malloc((unsigned long )h * sizeof(int32 ));
#line 30
  mass = (int32 *)tmp___1;
#line 31
  tmp___2 = malloc((size_t )w);
#line 31
  row = (unsigned char *)tmp___2;
#line 33
  tm = 0;
#line 34
  i = 0;
  }
  {
#line 34
  while (1) {
    while_continue: /* CIL Label */ ;
#line 34
    if (! (i < h)) {
#line 34
      goto while_break;
    }
    {
#line 36
    mdjvu_bitmap_unpack_row(bitmap, row, i);
#line 37
    j = 0;
    }
    {
#line 37
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 37
      if (! (j < w)) {
#line 37
        goto while_break___0;
      }
#line 39
      if (*(row + j)) {
#line 40
        goto while_break___0;
      }
#line 37
      j ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 42
    m = w - j;
    {
#line 42
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 42
      if (! (m > 0)) {
#line 42
        goto while_break___1;
      }
#line 44
      if (*(row + ((j + m) - 1))) {
#line 45
        goto while_break___1;
      }
#line 42
      m --;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 47
    *(mass + ((h - i) - 1)) = m;
#line 48
    tm += m;
#line 34
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 51
  m = 0;
#line 52
  i = 0;
  {
#line 54
  while (1) {
    while_continue___2: /* CIL Label */ ;
#line 54
    if (! (m * 6 < tm * 4)) {
#line 54
      goto while_break___2;
    }
#line 56
    m += *(mass + i / 4);
#line 57
    i ++;
  }
  while_break___2: /* CIL Label */ ;
  }
  {
#line 60
  free((void *)row);
#line 61
  free((void *)mass);
  }
#line 63
  return (4 * (h - 1) - i);
}
}
#line 70 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
static void update_blits___0(mdjvu_image_t image , int32 *x_adjust , int32 *y_adjust ) 
{ 
  int32 b ;
  int32 tmp ;
  int32 i ;
  int32 x ;
  int32 tmp___0 ;
  int32 y ;
  int32 tmp___1 ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___2 ;
  mdjvu_bitmap_t subst ;
  mdjvu_bitmap_t tmp___3 ;
  int32 k ;
  int32 tmp___4 ;

  {
  {
#line 72
  tmp = mdjvu_image_get_blit_count(image);
#line 72
  b = tmp;
#line 74
  i = 0;
  }
  {
#line 74
  while (1) {
    while_continue: /* CIL Label */ ;
#line 74
    if (! (i < b)) {
#line 74
      goto while_break;
    }
    {
#line 76
    tmp___0 = mdjvu_image_get_blit_x(image, i);
#line 76
    x = tmp___0;
#line 77
    tmp___1 = mdjvu_image_get_blit_y(image, i);
#line 77
    y = tmp___1;
#line 78
    tmp___2 = mdjvu_image_get_blit_bitmap(image, i);
#line 78
    bitmap = tmp___2;
#line 79
    tmp___3 = mdjvu_image_get_substitution(image, bitmap);
#line 79
    subst = tmp___3;
#line 80
    tmp___4 = mdjvu_bitmap_get_index(bitmap);
#line 80
    k = tmp___4;
#line 82
    mdjvu_image_set_blit_x(image, i, x + *(x_adjust + k));
#line 83
    mdjvu_image_set_blit_y(image, i, y + *(y_adjust + k));
#line 84
    mdjvu_image_set_blit_bitmap(image, i, subst);
#line 74
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 86
  return;
}
}
#line 91 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
static int32 *get_baselines___0(mdjvu_image_t image ) 
{ 
  int32 i ;
  int32 n ;
  int32 tmp ;
  int32 *baseline ;
  void *tmp___0 ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___1 ;
  int tmp___2 ;
  int tmp___3 ;

  {
  {
#line 94
  tmp = mdjvu_image_get_bitmap_count(image);
#line 94
  n = tmp;
#line 95
  tmp___0 = malloc((unsigned long )n * sizeof(int32 ));
#line 95
  baseline = (int32 *)tmp___0;
#line 96
  i = 0;
  }
  {
#line 96
  while (1) {
    while_continue: /* CIL Label */ ;
#line 96
    if (! (i < n)) {
#line 96
      goto while_break;
    }
    {
#line 98
    tmp___1 = mdjvu_image_get_bitmap(image, i);
#line 98
    bitmap = tmp___1;
#line 99
    tmp___2 = mdjvu_image_has_not_a_letter_flags(image);
    }
#line 99
    if (tmp___2) {
      {
#line 99
      tmp___3 = mdjvu_image_get_not_a_letter_flag(image, bitmap);
      }
#line 99
      if (tmp___3) {
#line 102
        *(baseline + i) = -10000;
      } else {
        {
#line 100
        *(baseline + i) = compute_baseline___0(bitmap);
        }
      }
    } else {
#line 102
      *(baseline + i) = -10000;
    }
#line 96
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 104
  return (baseline);
}
}
#line 112 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
static void compute_adjustments___0(mdjvu_bitmap_t bitmap , mdjvu_bitmap_t subst ,
                                    int32 b_base , int32 s_base , int32 *dx , int32 *dy ) 
{ 
  int32 w ;
  int32 h ;
  int32 subst_w ;
  int32 subst_h ;
  int32 adjust ;
  int tmp ;

  {
  {
#line 119
  w = mdjvu_bitmap_get_width(bitmap);
#line 120
  h = mdjvu_bitmap_get_height(bitmap);
#line 121
  subst_w = mdjvu_bitmap_get_width(subst);
#line 122
  subst_h = mdjvu_bitmap_get_height(subst);
#line 123
  *dx = (w - subst_w) / 2;
#line 124
  *dy = (h - subst_h) / 2;
#line 127
  adjust = b_base - s_base;
  }
#line 129
  if (adjust < 0) {
#line 130
    adjust = - (2 - adjust) / 4;
  } else {
#line 132
    adjust = (2 + adjust) / 4;
  }
  {
#line 134
  tmp = abs(adjust - *dy);
  }
#line 134
  if (tmp <= 1 + w / 16) {
#line 135
    *dy = adjust;
  }
#line 136
  return;
}
}
#line 170 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c"
static void adjust_page___0(mdjvu_image_t dict , int32 *dict_baselines , mdjvu_image_t image ) 
{ 
  int32 b ;
  int32 tmp ;
  int32 n ;
  int32 tmp___0 ;
  int32 *baseline ;
  int32 *tmp___1 ;
  int32 i ;
  int32 *x_adjust ;
  void *tmp___2 ;
  int32 *y_adjust ;
  void *tmp___3 ;
  mdjvu_bitmap_t bitmap ;
  mdjvu_bitmap_t tmp___4 ;
  mdjvu_bitmap_t subst ;
  mdjvu_bitmap_t tmp___5 ;
  int32 subst_baseline ;
  int32 tmp___6 ;
  int tmp___7 ;
  int32 tmp___8 ;
  int tmp___9 ;

  {
  {
#line 174
  tmp = mdjvu_image_get_blit_count(image);
#line 174
  b = tmp;
#line 175
  tmp___0 = mdjvu_image_get_bitmap_count(image);
#line 175
  n = tmp___0;
#line 176
  tmp___1 = get_baselines___0(image);
#line 176
  baseline = tmp___1;
#line 179
  tmp___2 = calloc((size_t )n, sizeof(int32 ));
#line 179
  x_adjust = (int32 *)tmp___2;
#line 180
  tmp___3 = calloc((size_t )n, sizeof(int32 ));
#line 180
  y_adjust = (int32 *)tmp___3;
#line 182
  i = 0;
  }
  {
#line 182
  while (1) {
    while_continue: /* CIL Label */ ;
#line 182
    if (! (i < b)) {
#line 182
      goto while_break;
    }
    {
#line 184
    tmp___4 = mdjvu_image_get_blit_bitmap(image, i);
#line 184
    bitmap = tmp___4;
#line 185
    tmp___5 = mdjvu_image_get_substitution(image, bitmap);
#line 185
    subst = tmp___5;
    }
#line 188
    if ((unsigned long )subst == (unsigned long )bitmap) {
#line 188
      goto __Cont;
    } else
#line 188
    if (*(baseline + i) == -10000) {
#line 188
      goto __Cont;
    }
    {
#line 190
    tmp___9 = mdjvu_image_has_bitmap(dict, subst);
    }
#line 190
    if (tmp___9) {
      {
#line 191
      tmp___6 = mdjvu_bitmap_get_index(subst);
#line 191
      subst_baseline = *(dict_baselines + tmp___6);
      }
    } else {
      {
#line 194
      tmp___7 = mdjvu_image_has_bitmap(image, subst);
      }
#line 194
      if (! tmp___7) {
        {
#line 194
        __assert_fail("mdjvu_image_has_bitmap(image, subst)", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/alg/adjust_y.c",
                      194U, "adjust_page");
        }
      }
      {
#line 195
      tmp___8 = mdjvu_bitmap_get_index(subst);
#line 195
      subst_baseline = *(baseline + tmp___8);
      }
    }
    {
#line 198
    compute_adjustments___0(bitmap, subst, *(baseline + i), subst_baseline, x_adjust + i,
                            y_adjust + i);
    }
    __Cont: /* CIL Label */ 
#line 182
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 204
  free((void *)baseline);
#line 206
  update_blits___0(image, x_adjust, y_adjust);
#line 208
  free((void *)x_adjust);
#line 209
  free((void *)y_adjust);
  }
#line 210
  return;
}
}
#line 37 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static int32 sum_column_gray___0(byte **pixels , int32 x , int32 y1 , int32 y2 ) 
{ 
  int sum ;
  int y ;

  {
#line 39
  sum = 0;
#line 40
  y = y1;
  {
#line 40
  while (1) {
    while_continue: /* CIL Label */ ;
#line 40
    if (! (y <= y2)) {
#line 40
      goto while_break;
    }
#line 40
    sum += (int )*(*(pixels + y) + x);
#line 40
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 41
  return (sum);
}
}
#line 44 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static int32 sum_row_gray___0(byte *row , int32 x1 , int32 x2 ) 
{ 
  int sum ;
  int x ;
  int n ;
  byte *p ;

  {
#line 46
  sum = 0;
#line 46
  n = x2 - x1;
#line 47
  p = row + x1;
#line 48
  x = 0;
  {
#line 48
  while (1) {
    while_continue: /* CIL Label */ ;
#line 48
    if (! (x <= n)) {
#line 48
      goto while_break;
    }
#line 48
    sum += (int )*(p + x);
#line 48
    x ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 49
  return (sum);
}
}
#line 52 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static int32 sum_column_black_and_white___0(byte **pixels , int32 x , int32 y1 , int32 y2 ) 
{ 
  int sum ;
  int y ;

  {
#line 54
  sum = 0;
#line 55
  y = y1;
  {
#line 55
  while (1) {
    while_continue: /* CIL Label */ ;
#line 55
    if (! (y <= y2)) {
#line 55
      goto while_break;
    }
#line 55
    if (*(*(pixels + y) + x)) {
#line 55
      sum ++;
    }
#line 55
    y ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 56
  return (sum);
}
}
#line 59 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static int32 sum_row_black_and_white___0(byte *row , int32 x1 , int32 x2 ) 
{ 
  int sum ;
  int x ;
  int n ;
  byte *p ;

  {
#line 61
  sum = 0;
#line 61
  n = x2 - x1;
#line 62
  p = row + x1;
#line 63
  x = 0;
  {
#line 63
  while (1) {
    while_continue: /* CIL Label */ ;
#line 63
    if (! (x <= n)) {
#line 63
      goto while_break;
    }
#line 63
    if (*(p + x)) {
#line 63
      sum ++;
    }
#line 63
    x ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 64
  return (sum);
}
}
#line 67
static void make_vcut___0(int32 a , int32 l , int32 w , int32 h , byte **pixels ,
                          byte *sig , int32 k , int32 (*s_row)(byte * , int32  , int32  ) ,
                          int32 (*s_col)(byte ** , int32  , int32  , int32  ) , int32 size ) ;
#line 73 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static void make_hcut___0(int32 a , int32 l , int32 w , int32 h , byte **pixels ,
                          byte *sig , int32 k , int32 (*s_row)(byte * , int32  , int32  ) ,
                          int32 (*s_col)(byte ** , int32  , int32  , int32  ) , int32 size ) 
{ 
  int32 cut ;
  int32 up_weight ;
  int32 last_row_weight ;

  {
#line 79
  cut = 0;
#line 80
  up_weight = 0;
#line 82
  if (k >= size) {
#line 82
    return;
  }
#line 84
  if (a) {
#line 86
    last_row_weight = 0;
#line 88
    if (w) {
#line 88
      if (! h) {
        {
#line 88
        __assert_fail("w && h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c",
                      88U, "make_hcut");
        }
      }
    } else {
      {
#line 88
      __assert_fail("w && h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c",
                    88U, "make_hcut");
      }
    }
    {
#line 90
    while (1) {
      while_continue: /* CIL Label */ ;
#line 90
      if (! (up_weight << 1 < a)) {
#line 90
        goto while_break;
      }
      {
#line 92
      last_row_weight = (*s_row)(*(pixels + cut), l, (l + w) - 1);
#line 93
      up_weight += last_row_weight;
#line 94
      cut ++;
      }
    }
    while_break: /* CIL Label */ ;
    }
#line 96
    cut --;
#line 97
    up_weight -= last_row_weight;
#line 98
    *(sig + k) = (byte )((256 * (cut * w + (w * ((a >> 1) - up_weight)) / last_row_weight)) / (w * h));
#line 101
    if (a - (up_weight << 1) > last_row_weight) {
#line 103
      cut ++;
#line 104
      up_weight += last_row_weight;
    }
  } else {
#line 109
    cut = h / 2;
#line 110
    *(sig + k) = (byte )128;
  }
  {
#line 113
  make_vcut___0(up_weight, l, w, cut, pixels, sig, k << 1, s_row, s_col, size);
#line 114
  make_vcut___0(a - up_weight, l, w, h - cut, pixels + cut, sig, (k << 1) | 1, s_row,
                s_col, size);
  }
#line 115
  return;
}
}
#line 117 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static void make_vcut___0(int32 a , int32 l , int32 w , int32 h , byte **pixels ,
                          byte *sig , int32 k , int32 (*s_row)(byte * , int32  , int32  ) ,
                          int32 (*s_col)(byte ** , int32  , int32  , int32  ) , int32 size ) 
{ 
  int32 cut ;
  int32 left_weight ;
  int32 last_col_weight ;

  {
#line 123
  cut = 0;
#line 124
  left_weight = 0;
#line 126
  if (k >= size) {
#line 126
    return;
  }
#line 128
  if (a) {
#line 130
    last_col_weight = 0;
#line 132
    if (w) {
#line 132
      if (! h) {
        {
#line 132
        __assert_fail("w && h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c",
                      132U, "make_vcut");
        }
      }
    } else {
      {
#line 132
      __assert_fail("w && h", "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c",
                    132U, "make_vcut");
      }
    }
    {
#line 134
    while (1) {
      while_continue: /* CIL Label */ ;
#line 134
      if (! (left_weight << 1 < a)) {
#line 134
        goto while_break;
      }
      {
#line 136
      last_col_weight = (*s_col)(pixels, l + cut, 0, h - 1);
#line 137
      left_weight += last_col_weight;
#line 138
      cut ++;
      }
    }
    while_break: /* CIL Label */ ;
    }
#line 140
    cut --;
#line 141
    left_weight -= last_col_weight;
#line 142
    *(sig + k) = (byte )((256 * (cut * h + (h * ((a >> 1) - left_weight)) / last_col_weight)) / (w * h));
#line 145
    if (a - (left_weight << 1) > last_col_weight) {
#line 147
      cut ++;
#line 147
      left_weight += last_col_weight;
    }
  } else {
#line 152
    cut = w / 2;
#line 153
    *(sig + k) = (byte )128;
  }
  {
#line 156
  make_hcut___0(left_weight, l, cut, h, pixels, sig, k << 1, s_row, s_col, size);
#line 157
  make_hcut___0(a - left_weight, l + cut, w - cut, h, pixels, sig, (k << 1) | 1, s_row,
                s_col, size);
  }
#line 158
  return;
}
}
#line 160 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/matcher/cuts.c"
static void get_signature___0(int32 width , int32 height , byte **pixels , byte *sig ,
                              int32 (*s_row)(byte * , int32  , int32  ) , int32 (*s_col)(byte ** ,
                                                                                         int32  ,
                                                                                         int32  ,
                                                                                         int32  ) ,
                              int32 size ) 
{ 
  int32 area ;
  int32 i ;
  int32 tmp ;

  {
#line 165
  area = 0;
#line 166
  i = 0;
  {
#line 166
  while (1) {
    while_continue: /* CIL Label */ ;
#line 166
    if (! (i < height)) {
#line 166
      goto while_break;
    }
    {
#line 168
    tmp = (*s_row)(*(pixels + i), 0, width - 1);
#line 168
    area += tmp;
#line 166
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 171
  make_hcut___0(area, 0, width, height, pixels, sig, 1, s_row, s_col, size);
  }
#line 172
  return;
}
}
#line 32 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/0porting.c"
static int initialized___2  =    0;
#line 32 "/home/wheatley/newnew/temp/minidjvu-0.8.svn.2010.05.06+dfsg/src/base/0porting.c"
static int initialized___3  =    0;
