/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is false */

#line 172 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __ssize_t;
#line 220 "/usr/include/unistd.h"
typedef __ssize_t ssize_t;
#line 212 "/usr/lib/gcc/x86_64-linux-gnu/4.8/include/stddef.h"
typedef unsigned long size_t;
#line 28 "/usr/include/x86_64-linux-gnu/bits/sockaddr.h"
typedef unsigned short sa_family_t;
#line 149 "/usr/include/x86_64-linux-gnu/bits/socket.h"
struct sockaddr {
   sa_family_t sa_family ;
   char sa_data[14] ;
};
#line 39 "/usr/include/linux/hdlc/ioctl.h"
struct __anonstruct_sync_serial_settings_36 {
   unsigned int clock_rate ;
   unsigned int clock_type ;
   unsigned short loopback ;
};
#line 39 "/usr/include/linux/hdlc/ioctl.h"
typedef struct __anonstruct_sync_serial_settings_36 sync_serial_settings;
#line 45 "/usr/include/linux/hdlc/ioctl.h"
struct __anonstruct_te1_settings_37 {
   unsigned int clock_rate ;
   unsigned int clock_type ;
   unsigned short loopback ;
   unsigned int slot_map ;
};
#line 45 "/usr/include/linux/hdlc/ioctl.h"
typedef struct __anonstruct_te1_settings_37 te1_settings;
#line 52 "/usr/include/linux/hdlc/ioctl.h"
struct __anonstruct_raw_hdlc_proto_38 {
   unsigned short encoding ;
   unsigned short parity ;
};
#line 52 "/usr/include/linux/hdlc/ioctl.h"
typedef struct __anonstruct_raw_hdlc_proto_38 raw_hdlc_proto;
#line 57 "/usr/include/linux/hdlc/ioctl.h"
struct __anonstruct_fr_proto_39 {
   unsigned int t391 ;
   unsigned int t392 ;
   unsigned int n391 ;
   unsigned int n392 ;
   unsigned int n393 ;
   unsigned short lmi ;
   unsigned short dce ;
};
#line 57 "/usr/include/linux/hdlc/ioctl.h"
typedef struct __anonstruct_fr_proto_39 fr_proto;
#line 67 "/usr/include/linux/hdlc/ioctl.h"
struct __anonstruct_fr_proto_pvc_40 {
   unsigned int dlci ;
};
#line 67 "/usr/include/linux/hdlc/ioctl.h"
typedef struct __anonstruct_fr_proto_pvc_40 fr_proto_pvc;
#line 71 "/usr/include/linux/hdlc/ioctl.h"
struct __anonstruct_fr_proto_pvc_info_41 {
   unsigned int dlci ;
   char master[16] ;
};
#line 71 "/usr/include/linux/hdlc/ioctl.h"
typedef struct __anonstruct_fr_proto_pvc_info_41 fr_proto_pvc_info;
#line 76 "/usr/include/linux/hdlc/ioctl.h"
struct __anonstruct_cisco_proto_42 {
   unsigned int interval ;
   unsigned int timeout ;
};
#line 76 "/usr/include/linux/hdlc/ioctl.h"
typedef struct __anonstruct_cisco_proto_42 cisco_proto;
#line 143 "/usr/include/linux/if.h"
struct ifmap {
   unsigned long mem_start ;
   unsigned long mem_end ;
   unsigned short base_addr ;
   unsigned char irq ;
   unsigned char dma ;
   unsigned char port ;
};
#line 153 "/usr/include/linux/if.h"
union __anonunion_ifs_ifsu_45 {
   raw_hdlc_proto *raw_hdlc ;
   cisco_proto *cisco ;
   fr_proto *fr ;
   fr_proto_pvc *fr_pvc ;
   fr_proto_pvc_info *fr_pvc_info ;
   sync_serial_settings *sync ;
   te1_settings *te1 ;
};
#line 153 "/usr/include/linux/if.h"
struct if_settings {
   unsigned int type ;
   unsigned int size ;
   union __anonunion_ifs_ifsu_45 ifs_ifsu ;
};
#line 177 "/usr/include/linux/if.h"
union __anonunion_ifr_ifrn_46 {
   char ifrn_name[16] ;
};
#line 177 "/usr/include/linux/if.h"
union __anonunion_ifr_ifru_47 {
   struct sockaddr ifru_addr ;
   struct sockaddr ifru_dstaddr ;
   struct sockaddr ifru_broadaddr ;
   struct sockaddr ifru_netmask ;
   struct sockaddr ifru_hwaddr ;
   short ifru_flags ;
   int ifru_ivalue ;
   int ifru_mtu ;
   struct ifmap ifru_map ;
   char ifru_slave[16] ;
   char ifru_newname[16] ;
   void *ifru_data ;
   struct if_settings ifru_settings ;
};
#line 177 "/usr/include/linux/if.h"
struct ifreq {
   union __anonunion_ifr_ifrn_46 ifr_ifrn ;
   union __anonunion_ifr_ifru_47 ifr_ifru ;
};
#line 131 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off_t;
#line 132 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off64_t;
#line 139 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __time_t;
#line 141 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __suseconds_t;
#line 189 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned int __socklen_t;
#line 44 "/usr/include/stdio.h"
struct _IO_FILE;
#line 48 "/usr/include/stdio.h"
typedef struct _IO_FILE FILE;
#line 154 "/usr/include/libio.h"
typedef void _IO_lock_t;
#line 160 "/usr/include/libio.h"
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
#line 245 "/usr/include/libio.h"
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15UL * sizeof(int ) - 4UL * sizeof(void *)) - sizeof(size_t )] ;
};
#line 274 "/usr/include/unistd.h"
typedef __socklen_t socklen_t;
#line 200 "/usr/include/x86_64-linux-gnu/sys/types.h"
typedef unsigned char u_int8_t;
#line 201 "/usr/include/x86_64-linux-gnu/sys/types.h"
typedef unsigned short u_int16_t;
#line 30 "/usr/include/x86_64-linux-gnu/bits/time.h"
struct timeval {
   __time_t tv_sec ;
   __suseconds_t tv_usec ;
};
#line 54 "/usr/include/x86_64-linux-gnu/sys/select.h"
typedef long __fd_mask;
#line 64 "/usr/include/x86_64-linux-gnu/sys/select.h"
struct __anonstruct_fd_set_18 {
   __fd_mask fds_bits[1024 / (8 * (int )sizeof(__fd_mask ))] ;
};
#line 64 "/usr/include/x86_64-linux-gnu/sys/select.h"
typedef struct __anonstruct_fd_set_18 fd_set;
#line 90 "/usr/include/x86_64-linux-gnu/sys/socket.h"
struct sockaddr_in;
#line 49 "/usr/include/stdint.h"
typedef unsigned short uint16_t;
#line 51 "/usr/include/stdint.h"
typedef unsigned int uint32_t;
#line 30 "/usr/include/netinet/in.h"
typedef uint32_t in_addr_t;
#line 31 "/usr/include/netinet/in.h"
struct in_addr {
   in_addr_t s_addr ;
};
#line 117 "/usr/include/netinet/in.h"
typedef uint16_t in_port_t;
#line 237 "/usr/include/netinet/in.h"
struct sockaddr_in {
   sa_family_t sin_family ;
   in_port_t sin_port ;
   struct in_addr sin_addr ;
   unsigned char sin_zero[((sizeof(struct sockaddr ) - sizeof(unsigned short )) - sizeof(in_port_t )) - sizeof(struct in_addr )] ;
};
#line 100 "/usr/include/netdb.h"
struct hostent {
   char *h_name ;
   char **h_aliases ;
   int h_addrtype ;
   int h_length ;
   char **h_addr_list ;
};
#line 40 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/it.c"
struct icmp {
   u_int8_t type ;
   u_int8_t code ;
   u_int16_t cksum ;
   u_int16_t id ;
   u_int16_t seq ;
};
#line 51 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/it.c"
struct ip {
   unsigned int ip_hl : 4 ;
   unsigned int ip_v : 4 ;
   unsigned char ip_tos ;
   unsigned short ip_len ;
   unsigned short ip_id ;
   unsigned short ip_off ;
   unsigned char ip_ttl ;
   unsigned char ip_p ;
   unsigned short ip_sum ;
   struct in_addr ip_src ;
   struct in_addr ip_dst ;
};
#line 353 "/usr/include/unistd.h"
extern int close(int __fd ) ;
#line 360
extern ssize_t read(int __fd , void *__buf , size_t __nbytes ) ;
#line 366
extern ssize_t write(int __fd , void const   *__buf , size_t __n ) ;
#line 146 "/usr/include/fcntl.h"
extern int ( __attribute__((__nonnull__(1))) open)(char const   *__file , int __oflag 
                                                   , ...) ;
#line 364 "/usr/include/stdio.h"
extern  __attribute__((__nothrow__)) int sprintf(char * __restrict  __s , char const   * __restrict  __format 
                                                 , ...) ;
#line 66 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__nonnull__(1), __leaf__)) memset)(void *__s ,
                                                                                               int __c ,
                                                                                               size_t __n ) ;
#line 50 "/usr/include/x86_64-linux-gnu/bits/errno.h"
extern  __attribute__((__nothrow__)) int *( __attribute__((__leaf__)) __errno_location)(void)  __attribute__((__const__)) ;
#line 41 "/usr/include/x86_64-linux-gnu/sys/ioctl.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) ioctl)(int __fd ,
                                                                            unsigned long __request 
                                                                            , ...) ;
#line 46 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/tun_dev.c"
int tun_open_old(void) 
{ 
  char tunname[14] ;
  int i ;
  int fd ;

  {
#line 50
  i = 0;
  {
#line 50
  while (1) {
    while_continue: /* CIL Label */ ;
#line 50
    if (! (i < 255)) {
#line 50
      goto while_break;
    }
    {
#line 51
    sprintf((char */* __restrict  */)(tunname), (char const   */* __restrict  */)"/dev/tun%d",
            i);
#line 53
    fd = open((char const   *)(tunname), 2);
    }
#line 53
    if (fd > 0) {
#line 54
      return (fd);
    }
#line 50
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 57
  return (-1);
}
}
#line 68 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/tun_dev.c"
int tun_open(void) 
{ 
  struct ifreq ifr ;
  int fd ;
  int tmp ;
  int tmp___0 ;
  int *tmp___1 ;
  int tmp___2 ;

  {
  {
#line 72
  fd = open("/dev/net/tun", 2);
  }
#line 72
  if (fd < 0) {
    {
#line 73
    tmp = tun_open_old();
    }
#line 73
    return (tmp);
  }
  {
#line 76
  memset((void *)(& ifr), 0, sizeof(ifr));
#line 78
  ifr.ifr_ifru.ifru_flags = (short)4097;
#line 80
  tmp___2 = ioctl(fd, (unsigned long )(((1U << 30) | (unsigned int )(84 << 8)) | 202U) | (sizeof(int ) << 16),
                  (void *)(& ifr));
  }
#line 80
  if (tmp___2 < 0) {
    {
#line 81
    tmp___1 = __errno_location();
    }
#line 81
    if (*tmp___1 == 77) {
      {
#line 83
      tmp___0 = ioctl(fd, (unsigned long )((84 << 8) | 202), (void *)(& ifr));
      }
#line 83
      if (tmp___0 < 0) {
#line 84
        goto failed;
      }
    } else {
#line 86
      goto failed;
    }
  }
#line 89
  return (fd);
  failed: 
  {
#line 92
  close(fd);
  }
#line 93
  return (-1);
}
}
#line 96 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/tun_dev.c"
int tun_close(int fd ) 
{ 
  int tmp ;

  {
  {
#line 97
  tmp = close(fd);
  }
#line 97
  return (tmp);
}
}
#line 100 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/tun_dev.c"
int tun_write(int fd , char *buf , int len ) 
{ 
  ssize_t tmp ;

  {
  {
#line 101
  tmp = write(fd, (void const   *)buf, (size_t )len);
  }
#line 101
  return ((int )tmp);
}
}
#line 104 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/tun_dev.c"
int tun_read(int fd , char *buf , int len ) 
{ 
  ssize_t tmp ;

  {
  {
#line 105
  tmp = read(fd, (void *)buf, (size_t )len);
  }
#line 105
  return ((int )tmp);
}
}
#line 170 "/usr/include/stdio.h"
extern struct _IO_FILE *stderr ;
#line 356
extern int fprintf(FILE * __restrict  __stream , char const   * __restrict  __format 
                   , ...) ;
#line 846
extern void perror(char const   *__s ) ;
#line 106 "/usr/include/x86_64-linux-gnu/sys/select.h"
extern int select(int __nfds , fd_set * __restrict  __readfds , fd_set * __restrict  __writefds ,
                  fd_set * __restrict  __exceptfds , struct timeval * __restrict  __timeout ) ;
#line 466 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) malloc)(size_t __size )  __attribute__((__malloc__)) ;
#line 543
extern  __attribute__((__nothrow__, __noreturn__)) void ( __attribute__((__leaf__)) exit)(int __status ) ;
#line 46 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__nonnull__(1,2), __leaf__)) memcpy)(void * __restrict  __dest ,
                                                                                                 void const   * __restrict  __src ,
                                                                                                 size_t __n ) ;
#line 113 "/usr/include/x86_64-linux-gnu/sys/socket.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) socket)(int __domain ,
                                                                             int __type ,
                                                                             int __protocol ) ;
#line 163
extern ssize_t sendto(int __fd , void const   *__buf , size_t __n , int __flags ,
                      struct sockaddr  const  * __restrict  __addr , socklen_t __addr_len ) ;
#line 174
extern ssize_t recvfrom(int __fd , void * __restrict  __buf , size_t __n , int __flags ,
                        struct sockaddr * __restrict  __addr , socklen_t * __restrict  __addr_len ) ;
#line 73 "/usr/include/arpa/inet.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) inet_aton)(char const   *__cp ,
                                                                                struct in_addr *__inp ) ;
#line 92 "/usr/include/netdb.h"
extern  __attribute__((__nothrow__)) void ( __attribute__((__leaf__)) herror)(char const   *__str ) ;
#line 144
extern struct hostent *gethostbyname(char const   *__name ) ;
#line 64 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/it.c"
unsigned short in_cksum(unsigned short *addr , int len ) ;
#line 73 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/it.c"
int icmp_tunnel(int sock , int proxy , struct sockaddr_in *target , int tun_fd , int packetsize ,
                u_int16_t id ) 
{ 
  int len ;
  int result ;
  int fromlen ;
  int num ;
  char *packet ;
  fd_set fs ;
  unsigned char didSend ;
  unsigned char didReceive ;
  struct icmp *icmp ;
  struct icmp *icmpr ;
  struct timeval tv ;
  struct sockaddr_in from ;
  void *tmp ;
  int __d0 ;
  int __d1 ;
  int tmp___0 ;
  ssize_t tmp___1 ;
  ssize_t tmp___2 ;
  ssize_t tmp___3 ;
  ssize_t tmp___4 ;

  {
  {
#line 82
  len = (int )sizeof(struct icmp );
#line 84
  tmp = malloc((size_t )(len + packetsize));
#line 84
  packet = (char *)tmp;
  }
#line 84
  if ((unsigned long )packet == (unsigned long )((void *)0)) {
    {
#line 85
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Error allocating packet buffer");
#line 86
    exit(1);
    }
  }
  {
#line 88
  memset((void *)packet, 0, (size_t )(len + packetsize));
#line 90
  icmp = (struct icmp *)packet;
#line 91
  icmpr = (struct icmp *)(packet + sizeof(struct ip ));
  }
  {
#line 94
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 95
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 95
      __asm__  volatile   ("cld; rep; "
                           "stosq": "=c" (__d0), "=D" (__d1): "a" (0), "0" (sizeof(fd_set ) / sizeof(__fd_mask )),
                           "1" (& fs.fds_bits[0]): "memory");
#line 95
      goto while_break___0;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 96
    fs.fds_bits[tun_fd / (8 * (int )sizeof(__fd_mask ))] |= 1L << tun_fd % (8 * (int )sizeof(__fd_mask ));
#line 97
    fs.fds_bits[sock / (8 * (int )sizeof(__fd_mask ))] |= 1L << sock % (8 * (int )sizeof(__fd_mask ));
#line 99
    didReceive = (unsigned char)0;
#line 99
    didSend = didReceive;
#line 101
    tv.tv_sec = (__time_t )1;
#line 102
    tv.tv_usec = (__suseconds_t )0;
#line 104
    if (tun_fd > sock) {
#line 104
      tmp___0 = tun_fd + 1;
    } else {
#line 104
      tmp___0 = sock + 1;
    }
    {
#line 104
    select(tmp___0, (fd_set */* __restrict  */)(& fs), (fd_set */* __restrict  */)((void *)0),
           (fd_set */* __restrict  */)((void *)0), (struct timeval */* __restrict  */)(& tv));
    }
#line 107
    if ((fs.fds_bits[tun_fd / (8 * (int )sizeof(__fd_mask ))] & (1L << tun_fd % (8 * (int )sizeof(__fd_mask )))) != 0L) {
      {
#line 108
      result = tun_read(tun_fd, packet + len, packetsize);
      }
#line 109
      if (! result) {
#line 110
        return (0);
      } else
#line 111
      if (result == -1) {
        {
#line 112
        perror("read");
        }
#line 113
        return (-1);
      }
#line 115
      if (proxy) {
#line 115
        icmp->type = (u_int8_t )0;
      } else {
#line 115
        icmp->type = (u_int8_t )8;
      }
      {
#line 116
      icmp->code = (u_int8_t )0;
#line 117
      icmp->id = id;
#line 118
      icmp->seq = (u_int16_t )0;
#line 119
      icmp->cksum = (u_int16_t )0;
#line 120
      icmp->cksum = in_cksum((unsigned short *)packet, len + result);
#line 121
      tmp___1 = sendto(sock, (void const   *)packet, (size_t )(len + result), 0, (struct sockaddr  const  */* __restrict  */)((struct sockaddr *)target),
                       (socklen_t )sizeof(struct sockaddr_in ));
#line 121
      result = (int )tmp___1;
      }
#line 122
      if (result == -1) {
        {
#line 123
        perror("sendto");
        }
#line 124
        return (-1);
      }
#line 126
      didSend = (unsigned char)1;
    }
#line 130
    if ((fs.fds_bits[sock / (8 * (int )sizeof(__fd_mask ))] & (1L << sock % (8 * (int )sizeof(__fd_mask )))) != 0L) {
      {
#line 131
      fromlen = (int )sizeof(struct sockaddr_in );
#line 132
      tmp___2 = recvfrom(sock, (void */* __restrict  */)packet, (size_t )(len + packetsize),
                         0, (struct sockaddr */* __restrict  */)((struct sockaddr *)(& from)),
                         (socklen_t */* __restrict  */)((socklen_t *)(& fromlen)));
#line 132
      num = (int )tmp___2;
#line 135
      memcpy((void */* __restrict  */)(& target->sin_addr.s_addr), (void const   */* __restrict  */)(& from.sin_addr.s_addr),
             4UL * sizeof(char ));
      }
#line 136
      if ((int )icmpr->id == (int )id) {
        {
#line 137
        tun_write(tun_fd, (packet + sizeof(struct ip )) + sizeof(struct icmp ), (int )(((unsigned long )num - sizeof(struct ip )) - sizeof(struct icmp )));
#line 138
        didReceive = (unsigned char)1;
        }
      } else
#line 139
      if ((int )icmpr->type == 8) {
        {
#line 140
        icmpr->type = (u_int8_t )0;
#line 141
        icmpr->code = (u_int8_t )0;
#line 142
        icmpr->id = icmpr->id;
#line 143
        icmpr->seq = icmpr->seq;
#line 144
        icmpr->cksum = (u_int16_t )0;
#line 145
        icmpr->cksum = in_cksum((unsigned short *)packet, num);
#line 146
        tmp___3 = sendto(sock, (void const   *)(packet + sizeof(struct ip )), ((unsigned long )(len + num) - sizeof(struct ip )) - sizeof(struct icmp ),
                         0, (struct sockaddr  const  */* __restrict  */)((struct sockaddr *)target),
                         (socklen_t )sizeof(struct sockaddr_in ));
#line 146
        result = (int )tmp___3;
        }
      }
    }
#line 155
    if (! proxy) {
#line 155
      if (! didSend) {
#line 155
        if (! didReceive) {
          {
#line 156
          icmp->type = (u_int8_t )8;
#line 157
          icmp->code = (u_int8_t )0;
#line 158
          icmp->id = id;
#line 159
          icmp->seq = (u_int16_t )0;
#line 160
          icmp->cksum = (u_int16_t )0;
#line 161
          icmp->cksum = in_cksum((unsigned short *)packet, len);
#line 162
          tmp___4 = sendto(sock, (void const   *)packet, (size_t )len, 0, (struct sockaddr  const  */* __restrict  */)((struct sockaddr *)target),
                           (socklen_t )sizeof(struct sockaddr_in ));
#line 162
          result = (int )tmp___4;
          }
#line 163
          if (result == -1) {
            {
#line 164
            perror("sendto");
            }
#line 165
            return (-1);
          }
        }
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 170
  return (0);
}
}
#line 181 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/it.c"
int run_icmp_tunnel(int id , int packetsize , int isServer , char *serverNameOrIP ,
                    int tun_fd ) 
{ 
  struct sockaddr_in target ;
  struct in_addr inp ;
  int s ;
  struct hostent *he ;
  int tmp ;

  {
  {
#line 186
  tmp = inet_aton((char const   *)serverNameOrIP, & inp);
  }
#line 186
  if (tmp) {
#line 194
    target.sin_addr.s_addr = inp.s_addr;
  } else {
    {
#line 188
    he = gethostbyname((char const   *)serverNameOrIP);
    }
#line 188
    if (! he) {
      {
#line 189
      herror("gethostbyname");
      }
#line 190
      return (-1);
    }
    {
#line 192
    memcpy((void */* __restrict  */)(& target.sin_addr.s_addr), (void const   */* __restrict  */)*(he->h_addr_list + 0),
           (size_t )he->h_length);
    }
  }
  {
#line 196
  target.sin_family = (sa_family_t )2;
#line 198
  s = socket(2, 3, 1);
  }
#line 198
  if (s == -1) {
    {
#line 199
    perror("socket");
    }
#line 200
    return (-1);
  }
  {
#line 203
  icmp_tunnel(s, isServer, & target, tun_fd, packetsize, (u_int16_t )id);
#line 205
  close(s);
  }
#line 207
  return (0);
}
}
#line 213 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/it.c"
unsigned short in_cksum(unsigned short *addr , int len ) 
{ 
  int nleft ;
  unsigned short *w ;
  int sum ;
  unsigned short answer ;
  unsigned short *tmp ;

  {
#line 214
  nleft = len;
#line 215
  w = addr;
#line 216
  sum = 0;
#line 217
  answer = (unsigned short)0;
  {
#line 218
  while (1) {
    while_continue: /* CIL Label */ ;
#line 218
    if (! (nleft > 1)) {
#line 218
      goto while_break;
    }
#line 219
    tmp = w;
#line 219
    w ++;
#line 219
    sum += (int )*tmp;
#line 220
    nleft -= 2;
  }
  while_break: /* CIL Label */ ;
  }
#line 222
  if (nleft == 1) {
#line 223
    *((unsigned char *)(& answer)) = *((unsigned char *)w);
#line 224
    sum += (int )answer;
  }
#line 226
  sum = (sum >> 16) + (sum & 65535);
#line 227
  sum += sum >> 16;
#line 228
  answer = (unsigned short )(~ (sum & 65535));
#line 229
  return (answer);
}
}
#line 144 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,2), __leaf__)) strcmp)(char const   *__s1 ,
                                                                                               char const   *__s2 )  __attribute__((__pure__)) ;
#line 30 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/icmptx.c"
int const   mtu  =    (int const   )65536;
#line 34 "/home/june/repo/benchmarks/collector/temp/icmptx-0.2/icmptx.c"
int main(int argc , char **argv ) 
{ 
  int tun_fd ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;

  {
#line 35
  tun_fd = 0;
#line 37
  if (argc != 3) {
    {
#line 38
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Usage: %s [-s|-c] server\n       -s Server Mode\n       -c Client Mode\n   server The host name or IP address of the server\n",
            *(argv + 0));
    }
#line 39
    return (1);
  }
  {
#line 41
  tmp = strcmp((char const   *)*(argv + 1), "-c");
  }
#line 41
  if (tmp) {
    {
#line 41
    tmp___0 = strcmp((char const   *)*(argv + 1), "-s");
    }
#line 41
    if (tmp___0) {
      {
#line 42
      fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Usage: %s [-s|-c] server\n       -s Server Mode\n       -c Client Mode\n   server The host name or IP address of the server\n",
              *(argv + 0));
      }
#line 43
      return (1);
    }
  }
  {
#line 46
  tun_fd = tun_open();
  }
#line 46
  if (tun_fd < 1) {
    {
#line 47
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Could not create tunnel device. Fatal.\n");
    }
#line 48
    return (1);
  }
  {
#line 51
  tmp___1 = strcmp((char const   *)*(argv + 1), "-s");
  }
#line 51
  if (tmp___1) {
#line 51
    tmp___2 = 0;
  } else {
#line 51
    tmp___2 = 1;
  }
  {
#line 51
  run_icmp_tunnel(7537, (int )mtu, tmp___2, *(argv + 2), tun_fd);
#line 54
  tun_close(tun_fd);
  }
#line 56
  return (0);
}
}
