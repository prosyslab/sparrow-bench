/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is false */

#line 212 "/usr/lib/gcc/x86_64-linux-gnu/4.8/include/stddef.h"
typedef unsigned long size_t;
#line 131 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off_t;
#line 132 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off64_t;
#line 44 "/usr/include/stdio.h"
struct _IO_FILE;
#line 48 "/usr/include/stdio.h"
typedef struct _IO_FILE FILE;
#line 154 "/usr/include/libio.h"
typedef void _IO_lock_t;
#line 160 "/usr/include/libio.h"
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
#line 245 "/usr/include/libio.h"
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15UL * sizeof(int ) - 4UL * sizeof(void *)) - sizeof(size_t )] ;
};
#line 315 "/usr/include/libio.h"
typedef struct _IO_FILE _IO_FILE;
#line 26 "/home/wheatley/newnew/temp/pgn-extract-17.14/bool.h"
enum __anonenum_Boolean_26 {
    FALSE = 0,
    TRUE = 1
} ;
#line 26 "/home/wheatley/newnew/temp/pgn-extract-17.14/bool.h"
typedef enum __anonenum_Boolean_26 Boolean;
#line 30 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
enum __anonenum_Piece_28 {
    OFF = 0,
    EMPTY = 1,
    PAWN = 2,
    KNIGHT = 3,
    BISHOP = 4,
    ROOK = 5,
    QUEEN = 6,
    KING = 7,
    NUM_PIECE_VALUES = 8
} ;
#line 30 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
typedef enum __anonenum_Piece_28 Piece;
#line 40
enum __anonenum_MoveClass_29 {
    PAWN_MOVE = 0,
    PAWN_MOVE_WITH_PROMOTION = 1,
    ENPASSANT_PAWN_MOVE = 2,
    PIECE_MOVE = 3,
    KINGSIDE_CASTLE = 4,
    QUEENSIDE_CASTLE = 5,
    NULL_MOVE = 6,
    UNKNOWN_MOVE = 7
} ;
#line 40 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
typedef enum __anonenum_MoveClass_29 MoveClass;
#line 46 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
typedef char Rank;
#line 47 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
typedef char Col;
#line 76 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
typedef unsigned long HashCode;
#line 36 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
enum __anonenum_OutputFormat_31 {
    SOURCE = 0,
    SAN = 1,
    EPD = 2,
    CM = 3,
    LALG = 4,
    HALG = 5,
    ELALG = 6,
    UCI = 7
} ;
#line 36 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef enum __anonenum_OutputFormat_31 OutputFormat;
#line 43
enum __anonenum_CheckStatus_32 {
    NOCHECK = 0,
    CHECK = 1,
    CHECKMATE = 2
} ;
#line 43 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef enum __anonenum_CheckStatus_32 CheckStatus;
#line 48 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
struct string_list {
   char const   *str ;
   struct string_list *next ;
};
#line 48 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef struct string_list StringList;
#line 56 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
struct comment_list {
   StringList *Comment ;
   struct comment_list *next ;
};
#line 56 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef struct comment_list CommentList;
#line 61
struct move;
#line 61 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
struct variation {
   CommentList *prefix_comment ;
   struct move *moves ;
   CommentList *suffix_comment ;
   struct variation *next ;
};
#line 61 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef struct variation Variation;
#line 76 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
struct move {
   unsigned char move[16] ;
   MoveClass class ;
   Col from_col ;
   Rank from_rank ;
   Col to_col ;
   Rank to_rank ;
   Piece piece_to_move ;
   Piece captured_piece ;
   Piece promoted_piece ;
   CheckStatus check_status ;
   char *epd ;
   StringList *Nags ;
   CommentList *Comment ;
   char *terminating_result ;
   Variation *Variants ;
   struct move *prev ;
   struct move *next ;
};
#line 76 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef struct move Move;
#line 113 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
struct __anonstruct_Game_33 {
   char **tags ;
   int tags_length ;
   CommentList *prefix_comment ;
   HashCode final_hash_value ;
   HashCode cumulative_hash_value ;
   HashCode fuzzy_duplicate_hash ;
   Move *moves ;
   Boolean moves_checked ;
   Boolean moves_ok ;
};
#line 113 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef struct __anonstruct_Game_33 Game;
#line 144
enum __anonenum_SourceFileType_34 {
    NORMALFILE = 0,
    CHECKFILE = 1,
    ECOFILE = 2
} ;
#line 144 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef enum __anonenum_SourceFileType_34 SourceFileType;
#line 153
enum __anonenum_EcoDivision_35 {
    DONT_DIVIDE = 0,
    MIN_ECO_LEVEL = 1,
    MAX_ECO_LEVEL = 10
} ;
#line 153 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef enum __anonenum_EcoDivision_35 EcoDivision;
#line 162
enum __anonenum_TagOutputForm_36 {
    ALL_TAGS = 0,
    SEVEN_TAG_ROSTER = 1,
    NO_TAGS = 2
} ;
#line 162 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef enum __anonenum_TagOutputForm_36 TagOutputForm;
#line 169 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
struct __anonstruct_StateInfo_37 {
   Boolean check_only ;
   Boolean verbose ;
   Boolean keep_NAGs ;
   Boolean keep_comments ;
   Boolean keep_variations ;
   TagOutputForm tag_output_format ;
   Boolean match_permutations ;
   Boolean positional_variations ;
   Boolean use_soundex ;
   Boolean suppress_duplicates ;
   Boolean suppress_originals ;
   Boolean fuzzy_match_duplicates ;
   int fuzzy_match_depth ;
   Boolean check_tags ;
   Boolean add_ECO ;
   Boolean parsing_ECO_file ;
   EcoDivision ECO_level ;
   OutputFormat output_format ;
   unsigned int max_line_length ;
   Boolean use_virtual_hash_table ;
   Boolean check_move_bounds ;
   Boolean match_only_checkmate ;
   Boolean match_only_stalemate ;
   Boolean keep_move_numbers ;
   Boolean keep_results ;
   Boolean keep_checks ;
   Boolean output_evaluation ;
   unsigned int depth_of_positional_search ;
   unsigned long num_games_processed ;
   unsigned long num_games_matched ;
   unsigned int games_per_file ;
   unsigned int next_file_number ;
   unsigned int lower_move_bound ;
   unsigned int upper_move_bound ;
   unsigned int output_ply_limit ;
   Boolean output_FEN_string ;
   Boolean add_FEN_comments ;
   Boolean add_position_match_comments ;
   char const   *position_match_comment ;
   char const   *current_input_file ;
   SourceFileType current_file_type ;
   char const   *eco_file ;
   FILE *outputfile ;
   char const   *output_filename ;
   FILE *logfile ;
   FILE *duplicate_file ;
   FILE *non_matching_file ;
};
#line 169 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
typedef struct __anonstruct_StateInfo_37 StateInfo;
#line 26 "/home/wheatley/newnew/temp/pgn-extract-17.14/tokens.h"
enum __anonenum_TokenType_38 {
    EOF_TOKEN = 0,
    TAG = 1,
    STRING = 2,
    COMMENT = 3,
    NAG = 4,
    CHECK_SYMBOL = 5,
    MOVE_NUMBER = 6,
    RAV_START = 7,
    RAV_END = 8,
    MOVE = 9,
    TERMINATING_RESULT = 10,
    WHITESPACE = 11,
    TAG_START = 12,
    TAG_END = 13,
    DOUBLE_QUOTE = 14,
    COMMENT_START = 15,
    COMMENT_END = 16,
    ANNOTATE = 17,
    DOT = 18,
    PERCENT = 19,
    ESCAPE = 20,
    ALPHA = 21,
    DIGIT = 22,
    STAR = 23,
    DASH = 24,
    EOS = 25,
    OPERATOR = 26,
    NO_TOKEN = 27,
    ERROR_TOKEN = 28
} ;
#line 26 "/home/wheatley/newnew/temp/pgn-extract-17.14/tokens.h"
typedef enum __anonenum_TokenType_38 TokenType;
#line 43 "/home/wheatley/newnew/temp/pgn-extract-17.14/tokens.h"
union __anonunion_YYSTYPE_39 {
   char *token_string ;
   Move *move_details ;
   unsigned int move_number ;
   StringList *nags ;
   Variation *variation_details ;
   CommentList *comment ;
   unsigned int tag_index ;
};
#line 43 "/home/wheatley/newnew/temp/pgn-extract-17.14/tokens.h"
typedef union __anonunion_YYSTYPE_39 YYSTYPE;
#line 32 "/home/wheatley/newnew/temp/pgn-extract-17.14/taglist.h"
enum __anonenum_TagName_40 {
    ANNOTATOR_TAG = 0,
    BLACK_TAG = 1,
    BLACK_ELO_TAG = 2,
    BLACK_NA_TAG = 3,
    BLACK_TITLE_TAG = 4,
    BLACK_TYPE_TAG = 5,
    BLACK_USCF_TAG = 6,
    BOARD_TAG = 7,
    DATE_TAG = 8,
    ECO_TAG = 9,
    PSEUDO_ELO_TAG = 10,
    EVENT_TAG = 11,
    EVENT_DATE_TAG = 12,
    EVENT_SPONSOR_TAG = 13,
    FEN_TAG = 14,
    PSEUDO_FEN_PATTERN_TAG = 15,
    LONG_ECO_TAG = 16,
    MODE_TAG = 17,
    NIC_TAG = 18,
    OPENING_TAG = 19,
    PSEUDO_PLAYER_TAG = 20,
    PLY_COUNT_TAG = 21,
    RESULT_TAG = 22,
    ROUND_TAG = 23,
    SECTION_TAG = 24,
    SETUP_TAG = 25,
    SITE_TAG = 26,
    STAGE_TAG = 27,
    SUB_VARIATION_TAG = 28,
    TERMINATION_TAG = 29,
    TIME_TAG = 30,
    TIME_CONTROL_TAG = 31,
    UTC_DATE_TAG = 32,
    UTC_TIME_TAG = 33,
    VARIATION_TAG = 34,
    WHITE_TAG = 35,
    WHITE_ELO_TAG = 36,
    WHITE_NA_TAG = 37,
    WHITE_TITLE_TAG = 38,
    WHITE_TYPE_TAG = 39,
    WHITE_USCF_TAG = 40,
    ORIGINAL_NUMBER_OF_TAGS = 41
} ;
#line 32 "/home/wheatley/newnew/temp/pgn-extract-17.14/taglist.h"
typedef enum __anonenum_TagName_40 TagName;
#line 55 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
struct __anonstruct_Game_Header_43 {
   char **Tags ;
   int header_tags_length ;
   CommentList *prefix_comment ;
};
#line 36 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.h"
enum __anonenum_TagOperator_38 {
    NONE = 0,
    LESS_THAN = 1,
    GREATER_THAN = 2,
    EQUAL_TO = 3,
    NOT_EQUAL_TO = 4,
    LESS_THAN_OR_EQUAL_TO = 5,
    GREATER_THAN_OR_EQUAL_TO = 6
} ;
#line 36 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.h"
typedef enum __anonenum_TagOperator_38 TagOperator;
#line 38 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
struct __anonstruct_TagSelection_40 {
   char *tag_string ;
   TagOperator operator ;
};
#line 38 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
typedef struct __anonstruct_TagSelection_40 TagSelection;
#line 49 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
struct __anonstruct_StringArray_41 {
   unsigned int num_allocated_elements ;
   unsigned int num_used_elements ;
   TagSelection *tag_strings ;
};
#line 49 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
typedef struct __anonstruct_StringArray_41 StringArray;
#line 24 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.h"
struct __anonstruct_FILE_LIST_44 {
   char const   **files ;
   SourceFileType *file_type ;
   unsigned int num_files ;
   unsigned int max_files ;
};
#line 24 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.h"
typedef struct __anonstruct_FILE_LIST_44 FILE_LIST;
#line 91 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
struct __anonstruct_LinePair_46 {
   char *line ;
   unsigned char *linep ;
   TokenType token ;
};
#line 91 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
typedef struct __anonstruct_LinePair_46 LinePair;
#line 29 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
enum __anonenum_Colour_27 {
    BLACK = 0,
    WHITE = 1
} ;
#line 29 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
typedef enum __anonenum_Colour_27 Colour;
#line 78 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
struct __anonstruct_Board_30 {
   Piece board[12][12] ;
   Colour to_move ;
   unsigned int move_number ;
   Boolean WKingCastle ;
   Boolean WQueenCastle ;
   Boolean BKingCastle ;
   Boolean BQueenCastle ;
   Col WKingCol ;
   Rank WKingRank ;
   Col BKingCol ;
   Rank BKingRank ;
   Boolean EnPassant ;
   Rank ep_rank ;
   Col ep_col ;
   HashCode hash_value ;
   unsigned int halfmove_clock ;
};
#line 78 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
typedef struct __anonstruct_Board_30 Board;
#line 106 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
struct move_pair {
   Col from_col ;
   Rank from_rank ;
   Col to_col ;
   Rank to_rank ;
   struct move_pair *next ;
};
#line 106 "/home/wheatley/newnew/temp/pgn-extract-17.14/defs.h"
typedef struct move_pair MovePair;
#line 69 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
struct __anonstruct_variant_move_43 {
   char *move ;
   Boolean matched ;
};
#line 69 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
typedef struct __anonstruct_variant_move_43 variant_move;
#line 87 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
struct variation_list {
   variant_move *moves ;
   unsigned int num_white_any_moves ;
   unsigned int num_black_any_moves ;
   unsigned int num_white_disallowed_moves ;
   unsigned int num_black_disallowed_moves ;
   unsigned int length ;
   struct variation_list *next ;
};
#line 87 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
typedef struct variation_list variation_list;
#line 24 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.h"
struct EcoLog {
   HashCode required_hash_value ;
   HashCode cumulative_hash_value ;
   int half_moves ;
   char const   *ECO_tag ;
   char const   *Opening_tag ;
   char const   *Variation_tag ;
   char const   *Sub_Variation_tag ;
   struct EcoLog *next ;
};
#line 24 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.h"
typedef struct EcoLog EcoLog;
#line 27 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.h"
struct HashLog {
   HashCode final_hash_value ;
   HashCode cumulative_hash_value ;
   int file_number ;
   struct HashLog *next ;
};
#line 27 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.h"
typedef struct HashLog HashLog;
#line 47 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
enum __anonenum_Occurs_42 {
    EXACTLY = 0,
    NUM_OR_MORE = 1,
    NUM_OR_LESS = 2,
    SAME_AS_OPPONENT = 3,
    NOT_SAME_AS_OPPONENT = 4,
    LESS_THAN_OPPONENT = 5,
    MORE_THAN_OPPONENT = 6,
    LESS_EQ_THAN_OPPONENT = 7,
    MORE_EQ_THAN_OPPONENT = 8
} ;
#line 47 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
typedef enum __anonenum_Occurs_42 Occurs;
#line 58 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
struct ending_details {
   int num_pieces[2][8] ;
   Occurs occurs[2][8] ;
   int num_minor_pieces[2] ;
   Occurs minor_occurs[2] ;
   unsigned int move_depth ;
   unsigned int match_depth[2] ;
   struct ending_details *next ;
};
#line 58 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
typedef struct ending_details Ending_details;
#line 131 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
struct __anonstruct_formats_42 {
   char const   *arg ;
   OutputFormat format ;
};
#line 67 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
struct __anonstruct_LogHeaderEntry_45 {
   long head ;
   long tail ;
};
#line 67 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
typedef struct __anonstruct_LogHeaderEntry_45 LogHeaderEntry;
#line 87 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
struct VirtualHashLog {
   HashCode final_hash_value ;
   HashCode cumulative_hash_value ;
   int file_number ;
   long next ;
};
#line 87 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
typedef struct VirtualHashLog VirtualHashLog;
#line 24 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.h"
enum __anonenum_ArgType_42 {
    SEVEN_TAG_ROSTER_ARGUMENT = 55,
    GAMES_PER_FILE_ARGUMENT = 35,
    ALTERNATIVE_HELP_ARGUMENT = 63,
    LONG_FORM_ARGUMENT = 45,
    APPEND_TO_OUTPUT_FILE_ARGUMENT = 97,
    BOUNDS_ARGUMENT = 98,
    CHECK_FILE_ARGUMENT = 99,
    DUPLICATES_FILE_ARGUMENT = 100,
    USE_ECO_FILE_ARGUMENT = 101,
    FILE_OF_FILES_ARGUMENT = 102,
    HELP_ARGUMENT = 104,
    WRITE_TO_LOG_FILE_ARGUMENT = 108,
    NON_MATCHING_GAMES_ARGUMENT = 110,
    WRITE_TO_OUTPUT_FILE_ARGUMENT = 111,
    CHECK_ONLY_ARGUMENT = 114,
    KEEP_SILENT_ARGUMENT = 115,
    TAGS_ARGUMENT = 116,
    MOVES_ARGUMENT = 118,
    LINE_WIDTH_ARGUMENT = 119,
    POSITIONS_ARGUMENT = 120,
    ENDINGS_ARGUMENT = 122,
    FILE_OF_ARGUMENTS_ARGUMENT = 65,
    DONT_KEEP_COMMENTS_ARGUMENT = 67,
    DONT_KEEP_DUPLICATES_ARGUMENT = 68,
    ECO_OUTPUT_LEVEL_ARGUMENT = 69,
    OUTPUT_FEN_STRING_ARGUMENT = 70,
    APPEND_TO_LOG_FILE_ARGUMENT = 76,
    MATCH_CHECKMATE_ARGUMENT = 77,
    DONT_KEEP_NAGS_ARGUMENT = 78,
    DONT_MATCH_PERMUTATIONS_ARGUMENT = 80,
    TAG_ROSTER_ARGUMENT = 82,
    USE_SOUNDEX_ARGUMENT = 83,
    TAG_EXTRACTION_ARGUMENT = 84,
    SUPPRESS_ORIGINALS_ARGUMENT = 85,
    DONT_KEEP_VARIATIONS_ARGUMENT = 86,
    OUTPUT_FORMAT_ARGUMENT = 87,
    USE_VIRTUAL_HASH_TABLE_ARGUMENT = 90,
    NO_ARGUMENT_MATCH = 0
} ;
#line 24 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.h"
typedef enum __anonenum_ArgType_42 ArgType;
#line 435 "/usr/include/libio.h"
extern int _IO_putc(int __c , _IO_FILE *__fp ) ;
#line 170 "/usr/include/stdio.h"
extern struct _IO_FILE *stderr ;
#line 237
extern int fclose(FILE *__stream ) ;
#line 242
extern int fflush(FILE *__stream ) ;
#line 272
extern FILE *fopen(char const   * __restrict  __filename , char const   * __restrict  __modes ) ;
#line 356
extern int fprintf(FILE * __restrict  __stream , char const   * __restrict  __format 
                   , ...) ;
#line 364
extern  __attribute__((__nothrow__)) int sprintf(char * __restrict  __s , char const   * __restrict  __format 
                                                 , ...) ;
#line 483 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void ( __attribute__((__leaf__)) free)(void *__ptr ) ;
#line 543
extern  __attribute__((__nothrow__, __noreturn__)) void ( __attribute__((__leaf__)) exit)(int __status ) ;
#line 137 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strcat)(char * __restrict  __dest ,
                                                                                                 char const   * __restrict  __src ) ;
#line 144
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,2), __leaf__)) strcmp)(char const   *__s1 ,
                                                                                               char const   *__s2 )  __attribute__((__pure__)) ;
#line 23 "/home/wheatley/newnew/temp/pgn-extract-17.14/mymalloc.h"
void *MallocOrDie(size_t nbytes ) ;
#line 24
void *ReallocOrDie(void *space , size_t nbytes ) ;
#line 54 "/home/wheatley/newnew/temp/pgn-extract-17.14/typedef.h"
StringList *SaveStringListItem(StringList *list , char const   *str ) ;
#line 268
StateInfo GlobalState ;
#line 269
FILE *MustOpen(char const   *filename___0 , char const   *mode ) ;
#line 56 "/home/wheatley/newnew/temp/pgn-extract-17.14/tokens.h"
YYSTYPE yylval ;
#line 58 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.h"
void restart_lex_for_new_game(void) ;
#line 59
void free_move_list(Move *move_list ) ;
#line 64
void print_error_context(FILE *fp ) ;
#line 66
TokenType next_token(void) ;
#line 67
TokenType skip_to_next_game(TokenType token ) ;
#line 68
char const   *tag_header_string(TagName tag ) ;
#line 27 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.h"
Boolean check_textual_variations(Game game_details ) ;
#line 28
Boolean check_move_bounds(unsigned int plycount ) ;
#line 31
Boolean check_for_only_checkmate(Move const   *moves ) ;
#line 44 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.h"
Boolean CheckTagDetailsNotECO(char **Details , int num_details ) ;
#line 45
Boolean CheckECOTag(char **Details ) ;
#line 24 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.h"
Boolean apply_move_list(Game *game_details , unsigned int *plycount ) ;
#line 25
Boolean apply_eco_move_list(Game *game_details , unsigned int *number_of_half_moves ) ;
#line 27
char *StringCopy(char const   *str ) ;
#line 23 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.h"
void output_game(Game current_game , FILE *outputfile ) ;
#line 24
void print_str(FILE *fp , char const   *str ) ;
#line 25
void terminate_line(FILE *fp ) ;
#line 27
char const   *output_file_suffix(OutputFormat format ) ;
#line 44 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.h"
FILE *open_eco_output_file(EcoDivision ECO_level , char const   *eco ) ;
#line 46
void save_eco_details(Game game_details , unsigned int number_of_half_moves ) ;
#line 22 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.h"
Boolean check_for_ending(Move *moves ) ;
#line 23 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.h"
int yyparse(SourceFileType file_type ) ;
#line 24
void DealWithGame(Move *move_list ) ;
#line 25
void free_string_list(StringList *list ) ;
#line 26
void init_game_header(void) ;
#line 27
void increase_game_header_tags_length(int new_length ) ;
#line 28
void report_details(FILE *outfp ) ;
#line 29
void append_comments_to_move(Move *move , CommentList *Comment ) ;
#line 40 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.h"
char const   *previous_occurance(Game game_details , int plycount ) ;
#line 43 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static TokenType Symbol  =    (TokenType )27;
#line 49 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static unsigned int RAV_level  =    0U;
#line 55 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static struct __anonstruct_Game_Header_43 Game_Header  ;
#line 62
static void ParseOptGameList(SourceFileType file_type ) ;
#line 63
static Boolean ParseGame(Move **returned_move_list ) ;
#line 64
Boolean ParseOptTagList(void) ;
#line 65
Boolean ParseTag(void) ;
#line 66
static Move *ParseMoveList(void) ;
#line 67
static Move *ParseMoveAndVariants(void) ;
#line 68
static Move *ParseMove(void) ;
#line 69
static Move *ParseMoveUnit(void) ;
#line 70
static CommentList *ParseOptCommentList(void) ;
#line 71
Boolean ParseOptMoveNumber(void) ;
#line 72
static StringList *ParseOptNAGList(void) ;
#line 73
static Variation *ParseOptVariantList(void) ;
#line 74
static Variation *ParseVariant(void) ;
#line 75
static char *ParseResult(void) ;
#line 77
static void setup_for_new_game(void) ;
#line 78
void free_tags(void) ;
#line 79
static void check_result(char **Tags , char const   *terminating_result ) ;
#line 80
static void free_comment_list(CommentList *comment_list ) ;
#line 81
static void DealWithEcoLine(Move *move_list ) ;
#line 88 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
void init_game_header(void) 
{ 
  int i ;
  void *tmp ;

  {
  {
#line 92
  Game_Header.header_tags_length = 41;
#line 93
  tmp = MallocOrDie((unsigned long )Game_Header.header_tags_length * sizeof(*(Game_Header.Tags)));
#line 93
  Game_Header.Tags = (char **)tmp;
#line 95
  i = 0;
  }
  {
#line 95
  while (1) {
    while_continue: /* CIL Label */ ;
#line 95
    if (! (i < Game_Header.header_tags_length)) {
#line 95
      goto while_break;
    }
#line 96
    *(Game_Header.Tags + i) = (char *)((void *)0);
#line 95
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 98
  return;
}
}
#line 100 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
void increase_game_header_tags_length(int new_length ) 
{ 
  int i ;
  void *tmp ;

  {
#line 103
  if (new_length < 0) {
    {
#line 104
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: inappropriate length %d ",
            new_length);
#line 106
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)" passed to increase_game_header_tags().\n");
#line 108
    exit(1);
    }
  } else
#line 103
  if (new_length <= Game_Header.header_tags_length) {
    {
#line 104
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: inappropriate length %d ",
            new_length);
#line 106
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)" passed to increase_game_header_tags().\n");
#line 108
    exit(1);
    }
  }
  {
#line 110
  tmp = ReallocOrDie((void *)Game_Header.Tags, (unsigned long )new_length * sizeof(*(Game_Header.Tags)));
#line 110
  Game_Header.Tags = (char **)tmp;
#line 112
  i = Game_Header.header_tags_length;
  }
  {
#line 112
  while (1) {
    while_continue: /* CIL Label */ ;
#line 112
    if (! (i < new_length)) {
#line 112
      goto while_break;
    }
#line 113
    *(Game_Header.Tags + i) = (char *)((void *)0);
#line 112
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 115
  Game_Header.header_tags_length = new_length;
#line 116
  return;
}
}
#line 119 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
FILE *MustOpen(char const   *filename___0 , char const   *mode ) 
{ 
  FILE *fp ;

  {
  {
#line 123
  fp = fopen((char const   */* __restrict  */)filename___0, (char const   */* __restrict  */)mode);
  }
#line 124
  if ((unsigned long )fp == (unsigned long )((void *)0)) {
    {
#line 125
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unable to open the file: \"%s\"\n",
            filename___0);
#line 127
    exit(1);
    }
  }
#line 129
  return (fp);
}
}
#line 135 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
void report_details(FILE *outfp ) 
{ 


  {
#line 138
  if ((unsigned long )*(Game_Header.Tags + 35) != (unsigned long )((void *)0)) {
    {
#line 139
    fprintf((FILE */* __restrict  */)outfp, (char const   */* __restrict  */)"%s - ",
            *(Game_Header.Tags + 35));
    }
  }
#line 141
  if ((unsigned long )*(Game_Header.Tags + 1) != (unsigned long )((void *)0)) {
    {
#line 142
    fprintf((FILE */* __restrict  */)outfp, (char const   */* __restrict  */)"%s ",
            *(Game_Header.Tags + 1));
    }
  }
#line 145
  if ((unsigned long )*(Game_Header.Tags + 11) != (unsigned long )((void *)0)) {
    {
#line 146
    fprintf((FILE */* __restrict  */)outfp, (char const   */* __restrict  */)"%s ",
            *(Game_Header.Tags + 11));
    }
  }
#line 148
  if ((unsigned long )*(Game_Header.Tags + 26) != (unsigned long )((void *)0)) {
    {
#line 149
    fprintf((FILE */* __restrict  */)outfp, (char const   */* __restrict  */)"%s ",
            *(Game_Header.Tags + 26));
    }
  }
#line 152
  if ((unsigned long )*(Game_Header.Tags + 8) != (unsigned long )((void *)0)) {
    {
#line 153
    fprintf((FILE */* __restrict  */)outfp, (char const   */* __restrict  */)"%s ",
            *(Game_Header.Tags + 8));
    }
  }
  {
#line 155
  _IO_putc('\n', outfp);
#line 156
  fflush(outfp);
  }
#line 157
  return;
}
}
#line 163 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static void check_result(char **Tags , char const   *terminating_result ) 
{ 
  char *result_tag ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;

  {
#line 165
  result_tag = *(Tags + 22);
#line 167
  if ((unsigned long )terminating_result != (unsigned long )((void *)0)) {
#line 168
    if ((unsigned long )result_tag == (unsigned long )((void *)0)) {
      {
#line 171
      result_tag = StringCopy(terminating_result);
#line 172
      *(Tags + 22) = result_tag;
      }
    } else
#line 168
    if ((int )*result_tag == 0) {
      {
#line 171
      result_tag = StringCopy(terminating_result);
#line 172
      *(Tags + 22) = result_tag;
      }
    } else {
      {
#line 168
      tmp___1 = strcmp((char const   *)result_tag, "?");
      }
#line 168
      if (tmp___1 == 0) {
        {
#line 171
        result_tag = StringCopy(terminating_result);
#line 172
        *(Tags + 22) = result_tag;
        }
      } else
#line 174
      if ((unsigned long )result_tag != (unsigned long )((void *)0)) {
        {
#line 174
        tmp = strcmp(terminating_result, "*");
        }
#line 174
        if (tmp != 0) {
          {
#line 174
          tmp___0 = strcmp((char const   *)result_tag, terminating_result);
          }
#line 174
          if (tmp___0 != 0) {
            {
#line 177
            print_error_context(GlobalState.logfile);
#line 178
            fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Inconsistent result strings in the following game.\n");
#line 180
            report_details(GlobalState.logfile);
            }
          }
        }
      }
    }
  }
#line 186
  return;
}
}
#line 194 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static FILE *select_output_file(StateInfo *GameState , char const   *eco ) 
{ 
  char filename___0[50] ;
  char const   *tmp ;

  {
#line 197
  if (GameState->games_per_file > 0U) {
#line 198
    if (GameState->num_games_matched % (unsigned long )GameState->games_per_file == 0UL) {
#line 202
      if ((unsigned long )GameState->outputfile != (unsigned long )((void *)0)) {
        {
#line 203
        fclose(GameState->outputfile);
        }
      }
      {
#line 205
      tmp = output_file_suffix(GameState->output_format);
#line 205
      sprintf((char */* __restrict  */)(filename___0), (char const   */* __restrict  */)"%u%s",
              GameState->next_file_number, tmp);
#line 208
      GameState->outputfile = MustOpen((char const   *)(filename___0), "w");
#line 209
      (GameState->next_file_number) ++;
      }
    }
  } else
#line 212
  if ((unsigned int )GameState->ECO_level > 0U) {
#line 214
    if ((unsigned long )GameState->outputfile != (unsigned long )((void *)0)) {
      {
#line 218
      fclose(GameState->outputfile);
#line 219
      GameState->outputfile = open_eco_output_file(GameState->ECO_level, eco);
      }
    }
  }
#line 226
  return (GameState->outputfile);
}
}
#line 229 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static void ParseOptGameList(SourceFileType file_type ) 
{ 
  Move *move_list ;
  Boolean tmp ;

  {
#line 231
  move_list = (Move *)((void *)0);
  {
#line 233
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 233
    tmp = ParseGame(& move_list);
    }
#line 233
    if (! tmp) {
#line 233
      goto while_break;
    }
#line 234
    if ((unsigned int )file_type == 0U) {
      {
#line 235
      DealWithGame(move_list);
      }
    } else
#line 237
    if ((unsigned int )file_type == 1U) {
      {
#line 238
      DealWithGame(move_list);
      }
    } else
#line 240
    if ((unsigned int )file_type == 2U) {
#line 241
      if ((unsigned long )move_list != (unsigned long )((void *)0)) {
        {
#line 242
        DealWithEcoLine(move_list);
        }
      } else {
        {
#line 245
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"ECO line with zero moves.\n");
#line 246
        report_details(GlobalState.logfile);
        }
      }
    } else {
      {
#line 251
      free_tags();
#line 252
      free_move_list(move_list);
      }
    }
    {
#line 254
    move_list = (Move *)((void *)0);
#line 255
    setup_for_new_game();
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 257
  return;
}
}
#line 262 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static Boolean ParseGame(Move **returned_move_list ) 
{ 
  Boolean something_found ;
  CommentList *prefix_comment ;
  Move *move_list ;
  char *result ;
  CommentList *hanging_comment ;
  Boolean tmp ;
  Move *last_move___0 ;

  {
  {
#line 264
  something_found = (Boolean )0;
#line 266
  move_list = (Move *)((void *)0);
#line 274
  *returned_move_list = (Move *)((void *)0);
#line 276
  Symbol = skip_to_next_game(Symbol);
#line 277
  prefix_comment = ParseOptCommentList();
  }
#line 278
  if ((unsigned long )prefix_comment != (unsigned long )((void *)0)) {
    {
#line 283
    something_found = (Boolean )1;
#line 284
    free_comment_list(prefix_comment);
#line 285
    prefix_comment = (CommentList *)((void *)0);
    }
  }
  {
#line 287
  tmp = ParseOptTagList();
  }
#line 287
  if (tmp) {
#line 288
    something_found = (Boolean )1;
  }
  {
#line 291
  move_list = ParseMoveList();
#line 294
  hanging_comment = ParseOptCommentList();
#line 298
  result = ParseResult();
  }
#line 299
  if ((unsigned long )move_list != (unsigned long )((void *)0)) {
#line 301
    last_move___0 = move_list;
    {
#line 303
    while (1) {
      while_continue: /* CIL Label */ ;
#line 303
      if (! ((unsigned long )last_move___0->next != (unsigned long )((void *)0))) {
#line 303
        goto while_break;
      }
#line 304
      last_move___0 = last_move___0->next;
    }
    while_break: /* CIL Label */ ;
    }
#line 306
    if ((unsigned long )hanging_comment != (unsigned long )((void *)0)) {
      {
#line 307
      append_comments_to_move(last_move___0, hanging_comment);
      }
    }
#line 309
    if ((unsigned long )result != (unsigned long )((void *)0)) {
      {
#line 311
      last_move___0->terminating_result = result;
#line 312
      check_result(Game_Header.Tags, (char const   *)result);
#line 313
      *returned_move_list = move_list;
      }
    } else {
      {
#line 316
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Missing result.\n");
#line 317
      report_details(GlobalState.logfile);
      }
    }
#line 319
    something_found = (Boolean )1;
  } else {
    {
#line 323
    free((void *)hanging_comment);
#line 324
    hanging_comment = (CommentList *)((void *)0);
#line 332
    check_result(Game_Header.Tags, (char const   *)result);
    }
#line 333
    if ((unsigned long )result != (unsigned long )((void *)0)) {
      {
#line 334
      free((void *)result);
      }
    }
#line 336
    *returned_move_list = (Move *)((void *)0);
  }
#line 338
  return ((Boolean )((unsigned int )Symbol != 0U));
}
}
#line 341 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
Boolean ParseOptTagList(void) 
{ 
  Boolean something_found ;
  CommentList *prefix_comment ;
  Boolean tmp ;
  char const   *tmp___0 ;
  char const   *tmp___1 ;
  int tmp___2 ;

  {
#line 343
  something_found = (Boolean )0;
  {
#line 346
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 346
    tmp = ParseTag();
    }
#line 346
    if (! tmp) {
#line 346
      goto while_break;
    }
#line 347
    something_found = (Boolean )1;
  }
  while_break: /* CIL Label */ ;
  }
#line 349
  if (something_found) {
#line 351
    if ((unsigned long )*(Game_Header.Tags + 25) != (unsigned long )((void *)0)) {
      {
#line 351
      tmp___2 = strcmp((char const   *)*(Game_Header.Tags + 25), "1");
      }
#line 351
      if (tmp___2 == 0) {
#line 354
        if ((unsigned long )*(Game_Header.Tags + 14) == (unsigned long )((void *)0)) {
          {
#line 355
          tmp___0 = tag_header_string((TagName )25);
#line 355
          tmp___1 = tag_header_string((TagName )14);
#line 355
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Missing %s Tag to accompany %s Tag.\n",
                  tmp___1, tmp___0);
          }
        }
      }
    }
  }
  {
#line 362
  prefix_comment = ParseOptCommentList();
  }
#line 363
  if ((unsigned long )prefix_comment != (unsigned long )((void *)0)) {
#line 364
    Game_Header.prefix_comment = prefix_comment;
#line 365
    something_found = (Boolean )1;
  }
#line 367
  return (something_found);
}
}
#line 370 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
Boolean ParseTag(void) 
{ 
  Boolean TagFound ;
  TagName tag_index ;
  char *tag_string ;

  {
#line 372
  TagFound = (Boolean )1;
#line 374
  if ((unsigned int )Symbol == 1U) {
    {
#line 375
    tag_index = (TagName )yylval.tag_index;
#line 377
    Symbol = next_token();
    }
#line 378
    if ((unsigned int )Symbol == 2U) {
#line 379
      tag_string = yylval.token_string;
#line 381
      if ((unsigned int )tag_index < (unsigned int )Game_Header.header_tags_length) {
#line 382
        *(Game_Header.Tags + tag_index) = tag_string;
      } else {
        {
#line 385
        print_error_context(GlobalState.logfile);
#line 386
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Illegal tag index %d for %s\n",
                (unsigned int )tag_index, tag_string);
#line 389
        exit(1);
        }
      }
      {
#line 391
      Symbol = next_token();
      }
    } else {
      {
#line 394
      print_error_context(GlobalState.logfile);
#line 395
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Missing tag string.\n");
      }
    }
  } else
#line 398
  if ((unsigned int )Symbol == 2U) {
    {
#line 399
    print_error_context(GlobalState.logfile);
#line 400
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Missing tag for %s.\n",
            yylval.token_string);
#line 401
    free((void *)yylval.token_string);
#line 402
    Symbol = next_token();
    }
  } else {
#line 405
    TagFound = (Boolean )0;
  }
#line 407
  return (TagFound);
}
}
#line 411 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static Move *ParseMoveList(void) 
{ 
  Move *head ;
  Move *tail ;
  Move *next_move ;

  {
  {
#line 413
  head = (Move *)((void *)0);
#line 413
  tail = (Move *)((void *)0);
#line 415
  head = ParseMoveAndVariants();
  }
#line 416
  if ((unsigned long )head != (unsigned long )((void *)0)) {
#line 419
    tail = head;
    {
#line 420
    while (1) {
      while_continue: /* CIL Label */ ;
      {
#line 420
      next_move = ParseMoveAndVariants();
      }
#line 420
      if (! ((unsigned long )next_move != (unsigned long )((void *)0))) {
#line 420
        goto while_break;
      }
#line 421
      tail->next = next_move;
#line 422
      tail = next_move;
    }
    while_break: /* CIL Label */ ;
    }
  }
#line 425
  return (head);
}
}
#line 428 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static Move *ParseMoveAndVariants(void) 
{ 
  Move *move_details ;
  CommentList *comment ;

  {
  {
#line 432
  move_details = ParseMove();
  }
#line 433
  if ((unsigned long )move_details != (unsigned long )((void *)0)) {
    {
#line 436
    move_details->Variants = ParseOptVariantList();
#line 437
    comment = ParseOptCommentList();
    }
#line 438
    if ((unsigned long )comment != (unsigned long )((void *)0)) {
      {
#line 439
      append_comments_to_move(move_details, comment);
      }
    }
  }
#line 442
  return (move_details);
}
}
#line 446 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static Move *ParseMove(void) 
{ 
  Move *move_details ;
  CommentList *comment ;

  {
  {
#line 448
  move_details = (Move *)((void *)0);
#line 450
  ParseOptMoveNumber();
#line 453
  move_details = ParseMoveUnit();
  }
#line 454
  if ((unsigned long )move_details != (unsigned long )((void *)0)) {
    {
#line 457
    move_details->Nags = ParseOptNAGList();
#line 458
    comment = ParseOptCommentList();
    }
#line 459
    if ((unsigned long )comment != (unsigned long )((void *)0)) {
      {
#line 460
      append_comments_to_move(move_details, comment);
      }
    }
  }
#line 463
  return (move_details);
}
}
#line 466 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static Move *ParseMoveUnit(void) 
{ 
  Move *move_details ;

  {
#line 468
  move_details = (Move *)((void *)0);
#line 470
  if ((unsigned int )Symbol == 9U) {
#line 471
    move_details = yylval.move_details;
#line 473
    if ((unsigned int )move_details->class == 6U) {
#line 473
      if (RAV_level == 0U) {
        {
#line 474
        print_error_context(GlobalState.logfile);
#line 475
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Null moves (--) only allowed in variations.\n");
        }
      }
    }
    {
#line 478
    Symbol = next_token();
    }
#line 479
    if ((unsigned int )Symbol == 5U) {
      {
#line 480
      strcat((char */* __restrict  */)((char *)(move_details->move)), (char const   */* __restrict  */)"+");
#line 481
      Symbol = next_token();
      }
#line 483
      if ((unsigned int )Symbol == 5U) {
        {
#line 484
        Symbol = next_token();
        }
      }
    }
    {
#line 487
    move_details->Comment = ParseOptCommentList();
    }
  }
#line 489
  return (move_details);
}
}
#line 492 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static CommentList *ParseOptCommentList(void) 
{ 
  CommentList *head ;
  CommentList *tail ;

  {
#line 494
  head = (CommentList *)((void *)0);
#line 494
  tail = (CommentList *)((void *)0);
  {
#line 496
  while (1) {
    while_continue: /* CIL Label */ ;
#line 496
    if (! ((unsigned int )Symbol == 3U)) {
#line 496
      goto while_break;
    }
#line 497
    if ((unsigned long )head == (unsigned long )((void *)0)) {
#line 498
      tail = yylval.comment;
#line 498
      head = tail;
    } else {
#line 501
      tail->next = yylval.comment;
#line 502
      tail = tail->next;
    }
    {
#line 504
    Symbol = next_token();
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 506
  return (head);
}
}
#line 509 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
Boolean ParseOptMoveNumber(void) 
{ 
  Boolean something_found ;

  {
#line 511
  something_found = (Boolean )0;
#line 513
  if ((unsigned int )Symbol == 6U) {
    {
#line 514
    Symbol = next_token();
#line 515
    something_found = (Boolean )1;
    }
  }
#line 517
  return (something_found);
}
}
#line 520 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static StringList *ParseOptNAGList(void) 
{ 
  StringList *nags ;

  {
#line 522
  nags = (StringList *)((void *)0);
  {
#line 524
  while (1) {
    while_continue: /* CIL Label */ ;
#line 524
    if (! ((unsigned int )Symbol == 4U)) {
#line 524
      goto while_break;
    }
#line 525
    if (GlobalState.keep_NAGs) {
      {
#line 526
      nags = SaveStringListItem(nags, (char const   *)yylval.token_string);
      }
    } else {
      {
#line 529
      free((void *)yylval.token_string);
      }
    }
    {
#line 531
    Symbol = next_token();
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 533
  return (nags);
}
}
#line 536 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static Variation *ParseOptVariantList(void) 
{ 
  Variation *head ;
  Variation *tail ;
  Variation *variation ;

  {
#line 538
  head = (Variation *)((void *)0);
#line 538
  tail = (Variation *)((void *)0);
  {
#line 541
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 541
    variation = ParseVariant();
    }
#line 541
    if (! ((unsigned long )variation != (unsigned long )((void *)0))) {
#line 541
      goto while_break;
    }
#line 542
    if ((unsigned long )head == (unsigned long )((void *)0)) {
#line 543
      tail = variation;
#line 543
      head = tail;
    } else {
#line 546
      tail->next = variation;
#line 547
      tail = variation;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 550
  return (head);
}
}
#line 553 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static Variation *ParseVariant(void) 
{ 
  Variation *variation ;
  CommentList *prefix_comment ;
  CommentList *suffix_comment ;
  char *result ;
  Move *moves ;
  void *tmp ;
  Move *last_move___0 ;
  CommentList *trailing_comment ;

  {
#line 555
  variation = (Variation *)((void *)0);
#line 557
  if ((unsigned int )Symbol == 7U) {
    {
#line 560
    result = (char *)((void *)0);
#line 563
    RAV_level ++;
#line 564
    tmp = MallocOrDie(sizeof(Variation ));
#line 564
    variation = (Variation *)tmp;
#line 566
    Symbol = next_token();
#line 567
    prefix_comment = ParseOptCommentList();
#line 570
    moves = ParseMoveList();
    }
#line 571
    if ((unsigned long )moves == (unsigned long )((void *)0)) {
      {
#line 572
      print_error_context(GlobalState.logfile);
#line 573
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Missing move list in variation.\n");
      }
    }
    {
#line 575
    result = ParseResult();
    }
#line 576
    if ((unsigned long )result != (unsigned long )((void *)0)) {
#line 576
      if ((unsigned long )moves != (unsigned long )((void *)0)) {
#line 580
        last_move___0 = moves;
        {
#line 583
        while (1) {
          while_continue: /* CIL Label */ ;
#line 583
          if (! ((unsigned long )last_move___0->next != (unsigned long )((void *)0))) {
#line 583
            goto while_break;
          }
#line 584
          last_move___0 = last_move___0->next;
        }
        while_break: /* CIL Label */ ;
        }
        {
#line 586
        last_move___0->terminating_result = result;
#line 590
        trailing_comment = ParseOptCommentList();
        }
#line 591
        if ((unsigned long )trailing_comment != (unsigned long )((void *)0)) {
          {
#line 592
          append_comments_to_move(last_move___0, trailing_comment);
          }
        }
      }
    }
#line 598
    if ((unsigned int )Symbol == 8U) {
      {
#line 599
      RAV_level --;
#line 600
      Symbol = next_token();
      }
    } else {
      {
#line 603
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Missing \')\' to close variation.\n");
      }
    }
    {
#line 605
    suffix_comment = ParseOptCommentList();
#line 608
    variation->prefix_comment = prefix_comment;
#line 609
    variation->suffix_comment = suffix_comment;
#line 610
    variation->moves = moves;
#line 611
    variation->next = (struct variation *)((void *)0);
    }
  }
#line 613
  return (variation);
}
}
#line 616 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static char *ParseResult(void) 
{ 
  char *result ;

  {
#line 618
  result = (char *)((void *)0);
#line 620
  if ((unsigned int )Symbol == 10U) {
#line 621
    result = yylval.token_string;
#line 622
    if (RAV_level == 0U) {
#line 626
      Symbol = (TokenType )27;
    } else {
      {
#line 629
      Symbol = next_token();
      }
    }
  }
#line 632
  return (result);
}
}
#line 635 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static void setup_for_new_game(void) 
{ 


  {
  {
#line 638
  restart_lex_for_new_game();
#line 639
  RAV_level = 0U;
  }
#line 640
  return;
}
}
#line 643 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
void free_tags(void) 
{ 
  int tag ;

  {
#line 647
  tag = 0;
  {
#line 647
  while (1) {
    while_continue: /* CIL Label */ ;
#line 647
    if (! (tag < Game_Header.header_tags_length)) {
#line 647
      goto while_break;
    }
#line 648
    if ((unsigned long )*(Game_Header.Tags + tag) != (unsigned long )((void *)0)) {
      {
#line 649
      free((void *)*(Game_Header.Tags + tag));
#line 650
      *(Game_Header.Tags + tag) = (char *)((void *)0);
      }
    }
#line 647
    tag ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 653
  return;
}
}
#line 656 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
void free_string_list(StringList *list ) 
{ 
  StringList *next ;

  {
  {
#line 660
  while (1) {
    while_continue: /* CIL Label */ ;
#line 660
    if (! ((unsigned long )list != (unsigned long )((void *)0))) {
#line 660
      goto while_break;
    }
#line 661
    next = list;
#line 662
    list = list->next;
#line 663
    if ((unsigned long )next->str != (unsigned long )((void *)0)) {
      {
#line 664
      free((void *)next->str);
      }
    }
    {
#line 666
    free((void *)next);
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 668
  return;
}
}
#line 670 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static void free_comment_list(CommentList *comment_list ) 
{ 
  CommentList *this_comment ;

  {
  {
#line 673
  while (1) {
    while_continue: /* CIL Label */ ;
#line 673
    if (! ((unsigned long )comment_list != (unsigned long )((void *)0))) {
#line 673
      goto while_break;
    }
#line 674
    this_comment = comment_list;
#line 676
    if ((unsigned long )comment_list->Comment != (unsigned long )((void *)0)) {
      {
#line 677
      free_string_list(comment_list->Comment);
      }
    }
    {
#line 679
    comment_list = comment_list->next;
#line 680
    free((void *)this_comment);
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 682
  return;
}
}
#line 684 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static void free_variation(Variation *variation ) 
{ 
  Variation *next ;

  {
  {
#line 688
  while (1) {
    while_continue: /* CIL Label */ ;
#line 688
    if (! ((unsigned long )variation != (unsigned long )((void *)0))) {
#line 688
      goto while_break;
    }
#line 689
    next = variation;
#line 690
    variation = variation->next;
#line 691
    if ((unsigned long )next->prefix_comment != (unsigned long )((void *)0)) {
      {
#line 692
      free_comment_list(next->prefix_comment);
      }
    }
#line 694
    if ((unsigned long )next->suffix_comment != (unsigned long )((void *)0)) {
      {
#line 695
      free_comment_list(next->suffix_comment);
      }
    }
#line 697
    if ((unsigned long )next->moves != (unsigned long )((void *)0)) {
      {
#line 698
      free_move_list((Move *)((void *)next->moves));
      }
    }
    {
#line 700
    free((void *)next);
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 702
  return;
}
}
#line 704 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
void free_move_list(Move *move_list ) 
{ 
  Move *next ;

  {
  {
#line 708
  while (1) {
    while_continue: /* CIL Label */ ;
#line 708
    if (! ((unsigned long )move_list != (unsigned long )((void *)0))) {
#line 708
      goto while_break;
    }
#line 709
    next = move_list;
#line 710
    move_list = move_list->next;
#line 711
    if ((unsigned long )next->Nags != (unsigned long )((void *)0)) {
      {
#line 712
      free_string_list(next->Nags);
      }
    }
#line 714
    if ((unsigned long )next->Comment != (unsigned long )((void *)0)) {
      {
#line 715
      free_comment_list(next->Comment);
      }
    }
#line 717
    if ((unsigned long )next->Variants != (unsigned long )((void *)0)) {
      {
#line 718
      free_variation(next->Variants);
      }
    }
#line 720
    if ((unsigned long )next->epd != (unsigned long )((void *)0)) {
      {
#line 721
      free((void *)next->epd);
      }
    }
#line 723
    if ((unsigned long )next->terminating_result != (unsigned long )((void *)0)) {
      {
#line 724
      free((void *)next->terminating_result);
      }
    }
    {
#line 726
    free((void *)next);
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 728
  return;
}
}
#line 733 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
StringList *SaveStringListItem(StringList *list , char const   *str ) 
{ 
  StringList *new_item ;
  void *tmp ;
  StringList *tail ;

  {
#line 736
  if ((unsigned long )str != (unsigned long )((void *)0)) {
    {
#line 739
    tmp = MallocOrDie(sizeof(*new_item));
#line 739
    new_item = (StringList *)tmp;
#line 740
    new_item->str = str;
#line 741
    new_item->next = (struct string_list *)((void *)0);
    }
#line 742
    if ((unsigned long )list == (unsigned long )((void *)0)) {
#line 743
      list = new_item;
    } else {
#line 746
      tail = list;
      {
#line 748
      while (1) {
        while_continue: /* CIL Label */ ;
#line 748
        if (! ((unsigned long )tail->next != (unsigned long )((void *)0))) {
#line 748
          goto while_break;
        }
#line 749
        tail = tail->next;
      }
      while_break: /* CIL Label */ ;
      }
#line 751
      tail->next = new_item;
    }
  }
#line 754
  return (list);
}
}
#line 760 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
void append_comments_to_move(Move *move , CommentList *Comment ) 
{ 
  CommentList *tail ;

  {
#line 763
  if ((unsigned long )Comment != (unsigned long )((void *)0)) {
#line 765
    if ((unsigned long )move->Comment == (unsigned long )((void *)0)) {
#line 766
      move->Comment = Comment;
    } else {
#line 772
      tail = move->Comment;
      {
#line 774
      while (1) {
        while_continue: /* CIL Label */ ;
#line 774
        if (! ((unsigned long )tail->next != (unsigned long )((void *)0))) {
#line 774
          goto while_break;
        }
#line 775
        tail = tail->next;
      }
      while_break: /* CIL Label */ ;
      }
#line 777
      tail->next = Comment;
    }
  }
#line 780
  return;
}
}
#line 851 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static char const   *last_input_file  =    (char const   *)((void *)0);
#line 782 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
void DealWithGame(Move *move_list ) 
{ 
  Game current_game ;
  Boolean game_output ;
  unsigned int plycount ;
  char const   *original_filename ;
  char const   *tmp ;
  FILE *outputfile ;
  FILE *tmp___0 ;
  Boolean tmp___1 ;
  Boolean tmp___2 ;
  Boolean tmp___3 ;
  Boolean tmp___4 ;
  Boolean tmp___5 ;
  Boolean tmp___6 ;
  Boolean tmp___7 ;

  {
  {
#line 789
  game_output = (Boolean )0;
#line 794
  (GlobalState.num_games_processed) ++;
#line 797
  current_game.tags = Game_Header.Tags;
#line 798
  current_game.tags_length = Game_Header.header_tags_length;
#line 799
  current_game.prefix_comment = Game_Header.prefix_comment;
#line 800
  current_game.moves = move_list;
#line 801
  current_game.moves_checked = (Boolean )0;
#line 802
  current_game.moves_ok = (Boolean )0;
#line 826
  tmp___1 = CheckTagDetailsNotECO(current_game.tags, current_game.tags_length);
  }
#line 826
  if (tmp___1) {
    {
#line 826
    tmp___2 = apply_move_list(& current_game, & plycount);
    }
#line 826
    if (tmp___2) {
      {
#line 826
      tmp___3 = check_move_bounds(plycount);
      }
#line 826
      if (tmp___3) {
        {
#line 826
        tmp___4 = check_textual_variations(current_game);
        }
#line 826
        if (tmp___4) {
          {
#line 826
          tmp___5 = check_for_ending(current_game.moves);
          }
#line 826
          if (tmp___5) {
            {
#line 826
            tmp___6 = check_for_only_checkmate((Move const   *)current_game.moves);
            }
#line 826
            if (tmp___6) {
              {
#line 826
              tmp___7 = CheckECOTag(current_game.tags);
              }
#line 826
              if (tmp___7) {
                {
#line 836
                tmp = previous_occurance(current_game, (int )plycount);
#line 836
                original_filename = tmp;
                }
#line 838
                if ((unsigned long )original_filename == (unsigned long )((void *)0)) {
#line 838
                  if (! GlobalState.suppress_originals) {
#line 838
                    goto _L___0;
                  }
                } else
                _L___0: /* CIL Label */ 
#line 841
                if ((unsigned long )original_filename == (unsigned long )((void *)0)) {
#line 841
                  goto _L;
                } else
#line 841
                if (! GlobalState.suppress_duplicates) {
                  _L: /* CIL Label */ 
#line 842
                  if (! GlobalState.check_only) {
#line 842
                    if ((unsigned int )GlobalState.current_file_type != 1U) {
                      {
#line 845
                      tmp___0 = select_output_file(& GlobalState, (char const   *)*(current_game.tags + 9));
#line 845
                      outputfile = tmp___0;
                      }
#line 849
                      if ((unsigned long )original_filename != (unsigned long )((void *)0)) {
#line 849
                        if ((unsigned long )GlobalState.duplicate_file != (unsigned long )((void *)0)) {
#line 853
                          outputfile = GlobalState.duplicate_file;
#line 854
                          if ((unsigned long )last_input_file != (unsigned long )GlobalState.current_input_file) {
#line 854
                            if ((unsigned long )GlobalState.current_input_file != (unsigned long )((void *)0)) {
                              {
#line 859
                              print_str(outputfile, "{ From: ");
#line 860
                              print_str(outputfile, GlobalState.current_input_file);
#line 862
                              print_str(outputfile, " }");
#line 863
                              terminate_line(outputfile);
#line 864
                              last_input_file = GlobalState.current_input_file;
                              }
                            }
                          }
                          {
#line 866
                          print_str(outputfile, "{ First found in: ");
#line 867
                          print_str(outputfile, original_filename);
#line 868
                          print_str(outputfile, " }");
#line 869
                          terminate_line(outputfile);
                          }
                        }
                      }
                      {
#line 872
                      output_game(current_game, outputfile);
#line 873
                      game_output = (Boolean )1;
                      }
                    }
                  }
#line 875
                  if ((unsigned int )GlobalState.current_file_type == 1U) {
#line 880
                    game_output = (Boolean )1;
                  } else {
#line 884
                    (GlobalState.num_games_matched) ++;
#line 885
                    if (GlobalState.verbose) {
                      {
#line 887
                      report_details(GlobalState.logfile);
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
#line 892
  if (! game_output) {
#line 892
    if ((unsigned long )GlobalState.non_matching_file != (unsigned long )((void *)0)) {
#line 894
      if (! current_game.moves_checked) {
        {
#line 896
        apply_move_list(& current_game, & plycount);
        }
      }
#line 898
      if (current_game.moves_ok) {
        {
#line 899
        output_game(current_game, GlobalState.non_matching_file);
        }
      }
    }
  }
#line 904
  if ((unsigned long )Game_Header.prefix_comment != (unsigned long )((void *)0)) {
    {
#line 905
    free_comment_list(Game_Header.prefix_comment);
    }
  }
  {
#line 910
  Game_Header.prefix_comment = (CommentList *)((void *)0);
#line 912
  free_tags();
#line 913
  free_move_list(current_game.moves);
  }
#line 914
  if (GlobalState.num_games_processed % 10UL == 0UL) {
    {
#line 915
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Games: %lu\r",
            GlobalState.num_games_processed);
    }
  }
#line 917
  return;
}
}
#line 919 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
static void DealWithEcoLine(Move *move_list ) 
{ 
  Game current_game ;
  unsigned int number_of_half_moves ;
  Boolean tmp ;

  {
  {
#line 928
  current_game.tags = Game_Header.Tags;
#line 929
  current_game.tags_length = Game_Header.header_tags_length;
#line 930
  current_game.prefix_comment = Game_Header.prefix_comment;
#line 931
  current_game.moves = move_list;
#line 932
  current_game.moves_checked = (Boolean )0;
#line 933
  current_game.moves_ok = (Boolean )0;
#line 941
  tmp = apply_eco_move_list(& current_game, & number_of_half_moves);
  }
#line 941
  if (tmp) {
#line 942
    if (current_game.moves_ok) {
      {
#line 944
      save_eco_details(current_game, number_of_half_moves);
      }
    }
  }
#line 949
  if ((unsigned long )Game_Header.prefix_comment != (unsigned long )((void *)0)) {
    {
#line 950
    free_comment_list(Game_Header.prefix_comment);
    }
  }
  {
#line 955
  Game_Header.prefix_comment = (CommentList *)((void *)0);
#line 957
  free_tags();
#line 958
  free_move_list(current_game.moves);
  }
#line 959
  return;
}
}
#line 964 "/home/wheatley/newnew/temp/pgn-extract-17.14/grammar.c"
int yyparse(SourceFileType file_type ) 
{ 


  {
  {
#line 967
  setup_for_new_game();
#line 968
  Symbol = skip_to_next_game((TokenType )27);
#line 969
  ParseOptGameList(file_type);
  }
#line 970
  if ((unsigned int )Symbol == 0U) {
#line 972
    return (0);
  } else {
    {
#line 975
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"End of input reached before end of file.\n");
    }
#line 976
    return (1);
  }
}
}
#line 433 "/usr/include/stdio.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) sscanf)(char const   * __restrict  __s ,
                                                                             char const   * __restrict  __format 
                                                                             , ...)  __asm__("__isoc99_sscanf")  ;
#line 480 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__warn_unused_result__,
__leaf__)) realloc)(void *__ptr , size_t __size ) ;
#line 129 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strcpy)(char * __restrict  __dest ,
                                                                                                 char const   * __restrict  __src ) ;
#line 147
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,2), __leaf__)) strncmp)(char const   *__s1 ,
                                                                                                char const   *__s2 ,
                                                                                                size_t __n )  __attribute__((__pure__)) ;
#line 399
extern  __attribute__((__nothrow__)) size_t ( __attribute__((__nonnull__(1), __leaf__)) strlen)(char const   *__s )  __attribute__((__pure__)) ;
#line 79 "/usr/include/ctype.h"
extern  __attribute__((__nothrow__)) unsigned short const   **( __attribute__((__leaf__)) __ctype_b_loc)(void)  __attribute__((__const__)) ;
#line 127
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) toupper)(int __c ) ;
#line 42 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.h"
void extract_tag_argument(char const   *argstr ) ;
#line 43
void add_tag_to_list(int tag , char const   *tagstr , TagOperator operator ) ;
#line 46
void init_tag_lists(void) ;
#line 73 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
static StringArray *TagLists  ;
#line 74 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
static int tag_list_length  =    0;
#line 76
static char *soundex(char const   *str ) ;
#line 77
static Boolean CheckList(int tag , char const   *tag_string , StringArray *list ) ;
#line 79 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
void init_tag_lists(void) 
{ 
  int i ;
  void *tmp ;

  {
  {
#line 82
  tag_list_length = 41;
#line 83
  tmp = MallocOrDie((unsigned long )tag_list_length * sizeof(*TagLists));
#line 83
  TagLists = (StringArray *)tmp;
#line 84
  i = 0;
  }
  {
#line 84
  while (1) {
    while_continue: /* CIL Label */ ;
#line 84
    if (! (i < tag_list_length)) {
#line 84
      goto while_break;
    }
#line 85
    (TagLists + i)->num_allocated_elements = 0U;
#line 86
    (TagLists + i)->num_used_elements = 0U;
#line 87
    (TagLists + i)->tag_strings = (TagSelection *)((void *)0);
#line 84
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 89
  return;
}
}
#line 94 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
static void extend_tag_list_length(int new_length ) 
{ 
  int i ;
  void *tmp ;

  {
#line 97
  if (new_length < tag_list_length) {
    {
#line 98
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: inappropriate call to extend_tag_list_length().\n");
#line 100
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"New length of %d is not greater than existing length of %d\n",
            new_length, tag_list_length);
#line 103
    exit(1);
    }
  } else {
    {
#line 107
    tmp = ReallocOrDie((void *)TagLists, (unsigned long )new_length * sizeof(*TagLists));
#line 107
    TagLists = (StringArray *)tmp;
#line 109
    i = tag_list_length;
    }
    {
#line 109
    while (1) {
      while_continue: /* CIL Label */ ;
#line 109
      if (! (i < new_length)) {
#line 109
        goto while_break;
      }
#line 110
      (TagLists + i)->num_allocated_elements = 0U;
#line 111
      (TagLists + i)->num_used_elements = 0U;
#line 112
      (TagLists + i)->tag_strings = (TagSelection *)((void *)0);
#line 109
      i ++;
    }
    while_break: /* CIL Label */ ;
    }
#line 114
    tag_list_length = new_length;
  }
#line 116
  return;
}
}
#line 123 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
static int add_to_taglist(char const   *str , StringArray *list ) 
{ 
  Boolean everything_ok ;
  void *tmp ;
  void *tmp___0 ;
  unsigned int ix ;
  size_t tmp___1 ;
  void *tmp___2 ;

  {
#line 125
  everything_ok = (Boolean )1;
#line 127
  if (list->num_allocated_elements == list->num_used_elements) {
#line 129
    if (list->num_allocated_elements == 0U) {
      {
#line 131
      tmp = MallocOrDie(11UL * sizeof(TagSelection ));
#line 131
      list->tag_strings = (TagSelection *)tmp;
      }
#line 133
      if ((unsigned long )list->tag_strings != (unsigned long )((void *)0)) {
#line 134
        list->num_allocated_elements = 10U;
#line 135
        list->num_used_elements = 0U;
      } else {
#line 138
        everything_ok = (Boolean )0;
      }
    } else {
      {
#line 142
      tmp___0 = realloc((void *)list->tag_strings, (unsigned long )((list->num_allocated_elements + 5U) + 1U) * sizeof(TagSelection ));
#line 142
      list->tag_strings = (TagSelection *)tmp___0;
      }
#line 145
      if ((unsigned long )list->tag_strings != (unsigned long )((void *)0)) {
#line 146
        list->num_allocated_elements += 5U;
      } else {
#line 149
        everything_ok = (Boolean )0;
      }
    }
  }
#line 153
  if (everything_ok) {
    {
#line 155
    ix = list->num_used_elements;
#line 157
    (list->tag_strings + ix)->operator = (TagOperator )0;
#line 158
    tmp___1 = strlen(str);
#line 158
    tmp___2 = MallocOrDie(tmp___1 + 1UL);
#line 158
    (list->tag_strings + ix)->tag_string = (char *)tmp___2;
    }
#line 159
    if ((unsigned long )(list->tag_strings + ix)->tag_string != (unsigned long )((void *)0)) {
      {
#line 160
      strcpy((char */* __restrict  */)(list->tag_strings + ix)->tag_string, (char const   */* __restrict  */)str);
#line 161
      (list->num_used_elements) ++;
#line 163
      (list->tag_strings + (ix + 1U))->tag_string = (char *)((void *)0);
      }
#line 164
      return ((int )ix);
    } else {
#line 167
      return (-1);
    }
  } else {
#line 171
    return (-1);
  }
}
}
#line 205 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
static char sbuf[51]  ;
#line 203 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
static char *soundex(char const   *str ) 
{ 
  unsigned int sindex ;
  char lastc ;
  char const   *mapping ;
  char initial_letter ;
  int tmp ;
  unsigned short const   **tmp___0 ;
  char ch ;
  char translation ;
  int tmp___1 ;
  unsigned short const   **tmp___2 ;
  unsigned short const   **tmp___3 ;

  {
  {
#line 207
  sindex = 0U;
#line 209
  lastc = (char )' ';
#line 211
  mapping = "01230120002455012622011202";
#line 212
  initial_letter = (char )*str;
#line 218
  tmp___0 = __ctype_b_loc();
  }
#line 218
  if ((int const   )*(*tmp___0 + (int )initial_letter) & 512) {
    {
#line 219
    tmp = toupper((int )initial_letter);
#line 219
    initial_letter = (char )tmp;
    }
  }
#line 221
  if ((int )initial_letter == 89) {
#line 222
    sbuf[sindex] = (char )'7';
#line 223
    str ++;
#line 224
    sindex ++;
  } else
#line 221
  if ((int )initial_letter == 74) {
#line 222
    sbuf[sindex] = (char )'7';
#line 223
    str ++;
#line 224
    sindex ++;
  }
  {
#line 227
  while (1) {
    while_continue: /* CIL Label */ ;
#line 227
    if ((int const   )*str != 0) {
#line 227
      if (! (sindex < 50U)) {
#line 227
        goto while_break;
      }
    } else {
#line 227
      goto while_break;
    }
    {
#line 228
    ch = (char )*str;
#line 233
    tmp___3 = __ctype_b_loc();
    }
#line 233
    if ((int const   )*(*tmp___3 + (int )ch) & 1024) {
#line 233
      if ((int )ch != (int )lastc) {
        {
#line 236
        tmp___2 = __ctype_b_loc();
        }
#line 236
        if ((int const   )*(*tmp___2 + (int )ch) & 512) {
          {
#line 237
          tmp___1 = toupper((int )ch);
#line 237
          ch = (char )tmp___1;
          }
        }
#line 240
        translation = (char )*(mapping + ((int )ch - 65));
#line 241
        if ((int )translation != 48) {
#line 241
          if ((int )translation != (int )lastc) {
#line 242
            sbuf[sindex] = translation;
#line 243
            sindex ++;
#line 244
            lastc = translation;
          }
        }
      }
    }
#line 247
    str ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 249
  sbuf[sindex] = (char )'\000';
#line 250
  return (sbuf);
}
}
#line 256 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
static Boolean soundex_tag(int tag ) 
{ 
  Boolean use_soundex ;

  {
#line 258
  use_soundex = (Boolean )0;
  {
#line 266
  if (tag == 0) {
#line 266
    goto case_0;
  }
#line 266
  if (tag == 26) {
#line 266
    goto case_0;
  }
#line 266
  if (tag == 11) {
#line 266
    goto case_0;
  }
#line 266
  if (tag == 20) {
#line 266
    goto case_0;
  }
#line 266
  if (tag == 1) {
#line 266
    goto case_0;
  }
#line 266
  if (tag == 35) {
#line 266
    goto case_0;
  }
#line 260
  goto switch_break;
  case_0: /* CIL Label */ 
  case_26: /* CIL Label */ 
  case_11: /* CIL Label */ 
  case_20: /* CIL Label */ 
  case_1: /* CIL Label */ 
  case_35: /* CIL Label */ 
#line 267
  use_soundex = (Boolean )1;
#line 268
  goto switch_break;
  switch_break: /* CIL Label */ ;
  }
#line 270
  return (use_soundex);
}
}
#line 277 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
void add_tag_to_list(int tag , char const   *tagstr , TagOperator operator ) 
{ 
  char const   *string_to_store ;
  int ix ;
  char *tmp ;
  Boolean tmp___0 ;

  {
#line 280
  if (tag >= tag_list_length) {
    {
#line 284
    extend_tag_list_length(tag + 1);
    }
  }
#line 286
  if (tag >= 0) {
#line 286
    if (tag < tag_list_length) {
#line 287
      string_to_store = tagstr;
#line 290
      if (GlobalState.use_soundex) {
        {
#line 291
        tmp___0 = soundex_tag(tag);
        }
#line 291
        if (tmp___0) {
          {
#line 292
          tmp = soundex(tagstr);
#line 292
          string_to_store = (char const   *)tmp;
          }
        }
      }
      {
#line 295
      ix = add_to_taglist(string_to_store, TagLists + tag);
      }
#line 296
      if (ix >= 0) {
#line 297
        ((TagLists + tag)->tag_strings + ix)->operator = operator;
      }
#line 300
      GlobalState.check_tags = (Boolean )1;
    } else {
      {
#line 303
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Illegal tag number %d in add_tag_to_list.\n",
              tag);
      }
    }
  } else {
    {
#line 303
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Illegal tag number %d in add_tag_to_list.\n",
            tag);
    }
  }
#line 306
  return;
}
}
#line 321 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
void extract_tag_argument(char const   *argstr ) 
{ 
  char const   *arg ;

  {
#line 323
  arg = argstr + 1;
  {
#line 326
  if ((int const   )*argstr == 97) {
#line 326
    goto case_97;
  }
#line 329
  if ((int const   )*argstr == 98) {
#line 329
    goto case_98;
  }
#line 332
  if ((int const   )*argstr == 100) {
#line 332
    goto case_100;
  }
#line 335
  if ((int const   )*argstr == 101) {
#line 335
    goto case_101;
  }
#line 338
  if ((int const   )*argstr == 112) {
#line 338
    goto case_112;
  }
#line 341
  if ((int const   )*argstr == 114) {
#line 341
    goto case_114;
  }
#line 344
  if ((int const   )*argstr == 119) {
#line 344
    goto case_119;
  }
#line 347
  goto switch_default;
  case_97: /* CIL Label */ 
  {
#line 327
  add_tag_to_list(0, arg, (TagOperator )0);
  }
#line 328
  goto switch_break;
  case_98: /* CIL Label */ 
  {
#line 330
  add_tag_to_list(1, arg, (TagOperator )0);
  }
#line 331
  goto switch_break;
  case_100: /* CIL Label */ 
  {
#line 333
  add_tag_to_list(8, arg, (TagOperator )0);
  }
#line 334
  goto switch_break;
  case_101: /* CIL Label */ 
  {
#line 336
  add_tag_to_list(9, arg, (TagOperator )0);
  }
#line 337
  goto switch_break;
  case_112: /* CIL Label */ 
  {
#line 339
  add_tag_to_list(20, arg, (TagOperator )0);
  }
#line 340
  goto switch_break;
  case_114: /* CIL Label */ 
  {
#line 342
  add_tag_to_list(22, arg, (TagOperator )0);
  }
#line 343
  goto switch_break;
  case_119: /* CIL Label */ 
  {
#line 345
  add_tag_to_list(35, arg, (TagOperator )0);
  }
#line 346
  goto switch_break;
  switch_default: /* CIL Label */ 
  {
#line 348
  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown type of tag extraction argument: %s\n",
          argstr);
#line 351
  exit(1);
  }
#line 352
  goto switch_break;
  switch_break: /* CIL Label */ ;
  }
#line 354
  return;
}
}
#line 369 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
static Boolean CheckDate(char const   *date_string , StringArray *list ) 
{ 
  unsigned int list_index ;
  Boolean wanted ;
  char const   *list_string ;
  TagOperator operator ;
  unsigned int game_date ;
  unsigned int list_date ;
  int tmp ;
  int tmp___0 ;
  size_t tmp___1 ;
  int tmp___2 ;

  {
#line 372
  wanted = (Boolean )1;
#line 374
  list_index = 0U;
  {
#line 374
  while (1) {
    while_continue: /* CIL Label */ ;
#line 374
    if (list_index < list->num_used_elements) {
#line 374
      if (! wanted) {
#line 374
        goto while_break;
      }
    } else {
#line 374
      goto while_break;
    }
#line 376
    list_string = (char const   *)(list->tag_strings + list_index)->tag_string;
#line 377
    operator = (list->tag_strings + list_index)->operator;
#line 379
    if ((int const   )*list_string == 98) {
#line 380
      operator = (TagOperator )1;
#line 381
      list_string ++;
    } else
#line 383
    if ((int const   )*list_string == 97) {
#line 384
      operator = (TagOperator )2;
#line 385
      list_string ++;
    }
#line 390
    if ((unsigned int )operator != 0U) {
      {
#line 394
      tmp = sscanf((char const   */* __restrict  */)list_string, (char const   */* __restrict  */)"%u",
                   & list_date);
      }
#line 394
      if (tmp == 1) {
        {
#line 394
        tmp___0 = sscanf((char const   */* __restrict  */)date_string, (char const   */* __restrict  */)"%u",
                         & game_date);
        }
#line 394
        if (tmp___0 == 1) {
#line 394
          if (game_date > 100U) {
#line 394
            if (game_date < 3000U) {
              {
#line 398
              if ((unsigned int )operator == 1U) {
#line 398
                goto case_1;
              }
#line 401
              if ((unsigned int )operator == 5U) {
#line 401
                goto case_5;
              }
#line 404
              if ((unsigned int )operator == 2U) {
#line 404
                goto case_2;
              }
#line 407
              if ((unsigned int )operator == 6U) {
#line 407
                goto case_6;
              }
#line 410
              if ((unsigned int )operator == 3U) {
#line 410
                goto case_3;
              }
#line 413
              if ((unsigned int )operator == 4U) {
#line 413
                goto case_4;
              }
#line 416
              if ((unsigned int )operator == 0U) {
#line 416
                goto case_0;
              }
#line 397
              goto switch_break;
              case_1: /* CIL Label */ 
#line 399
              wanted = (Boolean )(game_date < list_date);
#line 400
              goto switch_break;
              case_5: /* CIL Label */ 
#line 402
              wanted = (Boolean )(game_date <= list_date);
#line 403
              goto switch_break;
              case_2: /* CIL Label */ 
#line 405
              wanted = (Boolean )(game_date > list_date);
#line 406
              goto switch_break;
              case_6: /* CIL Label */ 
#line 408
              wanted = (Boolean )(game_date >= list_date);
#line 409
              goto switch_break;
              case_3: /* CIL Label */ 
#line 411
              wanted = (Boolean )(game_date == list_date);
#line 412
              goto switch_break;
              case_4: /* CIL Label */ 
#line 414
              wanted = (Boolean )(game_date != list_date);
#line 415
              goto switch_break;
              case_0: /* CIL Label */ 
#line 418
              goto switch_break;
              switch_break: /* CIL Label */ ;
              }
            }
          }
        }
      }
    } else {
      {
#line 427
      tmp___1 = strlen(list_string);
#line 427
      tmp___2 = strncmp(date_string, list_string, tmp___1);
#line 427
      wanted = (Boolean )(tmp___2 == 0);
      }
    }
#line 374
    list_index ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 430
  return (wanted);
}
}
#line 433 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
static Boolean CheckElo(char const   *elo_string , StringArray *list ) 
{ 
  unsigned int list_index ;
  Boolean wanted ;
  char const   *list_string ;
  TagOperator operator ;
  unsigned int game_elo ;
  unsigned int list_elo ;
  int tmp ;
  int tmp___0 ;
  size_t tmp___1 ;
  int tmp___2 ;

  {
#line 436
  wanted = (Boolean )1;
#line 438
  list_index = 0U;
  {
#line 438
  while (1) {
    while_continue: /* CIL Label */ ;
#line 438
    if (list_index < list->num_used_elements) {
#line 438
      if (! wanted) {
#line 438
        goto while_break;
      }
    } else {
#line 438
      goto while_break;
    }
#line 440
    list_string = (char const   *)(list->tag_strings + list_index)->tag_string;
#line 441
    operator = (list->tag_strings + list_index)->operator;
#line 443
    if ((unsigned int )operator != 0U) {
      {
#line 447
      tmp = sscanf((char const   */* __restrict  */)list_string, (char const   */* __restrict  */)"%u",
                   & list_elo);
      }
#line 447
      if (tmp == 1) {
        {
#line 447
        tmp___0 = sscanf((char const   */* __restrict  */)elo_string, (char const   */* __restrict  */)"%u",
                         & game_elo);
        }
#line 447
        if (tmp___0 == 1) {
          {
#line 450
          if ((unsigned int )operator == 1U) {
#line 450
            goto case_1;
          }
#line 453
          if ((unsigned int )operator == 5U) {
#line 453
            goto case_5;
          }
#line 456
          if ((unsigned int )operator == 2U) {
#line 456
            goto case_2;
          }
#line 459
          if ((unsigned int )operator == 6U) {
#line 459
            goto case_6;
          }
#line 462
          if ((unsigned int )operator == 3U) {
#line 462
            goto case_3;
          }
#line 465
          if ((unsigned int )operator == 4U) {
#line 465
            goto case_4;
          }
#line 468
          if ((unsigned int )operator == 0U) {
#line 468
            goto case_0;
          }
#line 449
          goto switch_break;
          case_1: /* CIL Label */ 
#line 451
          wanted = (Boolean )(game_elo < list_elo);
#line 452
          goto switch_break;
          case_5: /* CIL Label */ 
#line 454
          wanted = (Boolean )(game_elo <= list_elo);
#line 455
          goto switch_break;
          case_2: /* CIL Label */ 
#line 457
          wanted = (Boolean )(game_elo > list_elo);
#line 458
          goto switch_break;
          case_6: /* CIL Label */ 
#line 460
          wanted = (Boolean )(game_elo >= list_elo);
#line 461
          goto switch_break;
          case_3: /* CIL Label */ 
#line 463
          wanted = (Boolean )(game_elo == list_elo);
#line 464
          goto switch_break;
          case_4: /* CIL Label */ 
#line 466
          wanted = (Boolean )(game_elo != list_elo);
#line 467
          goto switch_break;
          case_0: /* CIL Label */ 
#line 470
          goto switch_break;
          switch_break: /* CIL Label */ ;
          }
        } else {
#line 475
          wanted = (Boolean )0;
        }
      } else {
#line 475
        wanted = (Boolean )0;
      }
    } else {
      {
#line 480
      tmp___1 = strlen(list_string);
#line 480
      tmp___2 = strncmp(elo_string, list_string, tmp___1);
      }
#line 480
      if (tmp___2 == 0) {
#line 481
        wanted = (Boolean )1;
      }
    }
#line 438
    list_index ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 485
  return (wanted);
}
}
#line 493 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
static Boolean CheckList(int tag , char const   *tag_string , StringArray *list ) 
{ 
  unsigned int list_index ;
  Boolean wanted ;
  char const   *search_str ;
  char *tmp ;
  Boolean tmp___0 ;
  char const   *list_string ;
  size_t tmp___1 ;
  int tmp___2 ;

  {
#line 496
  wanted = (Boolean )0;
#line 499
  if (GlobalState.use_soundex) {
    {
#line 499
    tmp___0 = soundex_tag(tag);
    }
#line 499
    if (tmp___0) {
      {
#line 500
      tmp = soundex(tag_string);
#line 500
      search_str = (char const   *)tmp;
      }
    } else {
#line 503
      search_str = tag_string;
    }
  } else {
#line 503
    search_str = tag_string;
  }
#line 505
  list_index = 0U;
  {
#line 505
  while (1) {
    while_continue: /* CIL Label */ ;
#line 505
    if (list_index < list->num_used_elements) {
#line 505
      if (! (! wanted)) {
#line 505
        goto while_break;
      }
    } else {
#line 505
      goto while_break;
    }
    {
#line 507
    list_string = (char const   *)(list->tag_strings + list_index)->tag_string;
#line 509
    tmp___1 = strlen(list_string);
#line 509
    tmp___2 = strncmp(search_str, list_string, tmp___1);
    }
#line 509
    if (tmp___2 == 0) {
#line 510
      wanted = (Boolean )1;
    }
#line 505
    list_index ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 513
  return (wanted);
}
}
#line 525 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
Boolean CheckTagDetailsNotECO(char **Details , int num_details ) 
{ 
  Boolean wanted ;
  int tag ;

  {
#line 527
  wanted = (Boolean )1;
#line 530
  if (GlobalState.check_tags) {
#line 532
    if (num_details < tag_list_length) {
      {
#line 533
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: mismatch in tag set lengths in ");
#line 535
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"CheckTagDetailsNotECO: %d vs %d\n",
              num_details, tag_list_length);
#line 538
      exit(1);
      }
    }
#line 545
    if ((TagLists + 20)->num_used_elements != 0U) {
#line 547
      if ((unsigned long )*(Details + 35) != (unsigned long )((void *)0)) {
        {
#line 548
        wanted = CheckList(35, (char const   *)*(Details + 35), TagLists + 20);
        }
#line 551
        if (! wanted) {
#line 551
          if ((unsigned long )*(Details + 1) != (unsigned long )((void *)0)) {
            {
#line 552
            wanted = CheckList(1, (char const   *)*(Details + 1), TagLists + 20);
            }
          }
        }
      } else
#line 556
      if ((unsigned long )*(Details + 1) != (unsigned long )((void *)0)) {
        {
#line 557
        wanted = CheckList(1, (char const   *)*(Details + 1), TagLists + 20);
        }
      } else {
#line 561
        wanted = (Boolean )0;
      }
    } else
#line 564
    if ((TagLists + 10)->num_used_elements != 0U) {
#line 566
      if ((unsigned long )*(Details + 36) != (unsigned long )((void *)0)) {
        {
#line 567
        wanted = CheckElo((char const   *)*(Details + 36), TagLists + 10);
        }
#line 570
        if (! wanted) {
#line 570
          if ((unsigned long )*(Details + 2) != (unsigned long )((void *)0)) {
            {
#line 571
            wanted = CheckElo((char const   *)*(Details + 2), TagLists + 10);
            }
          }
        }
      } else
#line 575
      if ((unsigned long )*(Details + 2) != (unsigned long )((void *)0)) {
        {
#line 576
        wanted = CheckElo((char const   *)*(Details + 2), TagLists + 10);
        }
      } else {
#line 580
        wanted = (Boolean )0;
      }
    }
#line 588
    tag = 0;
    {
#line 588
    while (1) {
      while_continue: /* CIL Label */ ;
#line 588
      if (tag < tag_list_length) {
#line 588
        if (! wanted) {
#line 588
          goto while_break;
        }
      } else {
#line 588
        goto while_break;
      }
#line 589
      if (! (tag == 20)) {
#line 591
        if (! (tag == 10)) {
#line 593
          if (! (tag == 9)) {
#line 596
            if ((TagLists + tag)->num_used_elements != 0U) {
#line 597
              if ((unsigned long )*(Details + tag) != (unsigned long )((void *)0)) {
#line 598
                if (tag == 8) {
                  {
#line 599
                  wanted = CheckDate((char const   *)*(Details + tag), TagLists + tag);
                  }
                } else
#line 601
                if (tag == 36) {
                  {
#line 602
                  wanted = CheckElo((char const   *)*(Details + tag), TagLists + tag);
                  }
                } else
#line 601
                if (tag == 2) {
                  {
#line 602
                  wanted = CheckElo((char const   *)*(Details + tag), TagLists + tag);
                  }
                } else {
                  {
#line 605
                  wanted = CheckList(tag, (char const   *)*(Details + tag), TagLists + tag);
                  }
                }
              } else {
#line 610
                wanted = (Boolean )0;
              }
            }
          }
        }
      }
#line 588
      tag ++;
    }
    while_break: /* CIL Label */ ;
    }
  }
#line 618
  return (wanted);
}
}
#line 622 "/home/wheatley/newnew/temp/pgn-extract-17.14/lists.c"
Boolean CheckECOTag(char **Details ) 
{ 
  Boolean wanted ;

  {
#line 624
  wanted = (Boolean )1;
#line 626
  if (GlobalState.check_tags) {
#line 627
    if ((TagLists + 9)->num_used_elements != 0U) {
#line 628
      if ((unsigned long )*(Details + 9) != (unsigned long )((void *)0)) {
        {
#line 629
        wanted = CheckList(9, (char const   *)*(Details + 9), TagLists + 9);
        }
      } else {
#line 633
        wanted = (Boolean )0;
      }
    }
  }
#line 637
  return (wanted);
}
}
#line 168 "/usr/include/stdio.h"
extern struct _IO_FILE *stdin ;
#line 846
extern void perror(char const   *__s ) ;
#line 515 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__, __noreturn__)) void ( __attribute__((__leaf__)) abort)(void) ;
#line 132 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strncpy)(char * __restrict  __dest ,
                                                                                                  char const   * __restrict  __src ,
                                                                                                  size_t __n ) ;
#line 287 "/usr/include/unistd.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1), __leaf__)) access)(char const   *__name ,
                                                                                             int __type ) ;
#line 56 "/home/wheatley/newnew/temp/pgn-extract-17.14/tokens.h"
YYSTYPE yylval  ;
#line 60 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.h"
void read_tag_file(char const   *TagFile ) ;
#line 61
void read_tag_roster_file(char const   *RosterFile ) ;
#line 62
Boolean process_tag_line(char const   *TagFile , char *line___1 ) ;
#line 63
Boolean process_roster_line(char *line___1 ) ;
#line 65
void init_lex_tables(void) ;
#line 69
Boolean open_first_file(void) ;
#line 70
char const   *input_file_name(int file_number ) ;
#line 71
int current_file_number(void) ;
#line 72
Boolean open_eco_file(char const   *eco_file ) ;
#line 73
int yywrap(void) ;
#line 74
void add_filename_to_source_list(char const   *filename___0 , SourceFileType file_type ) ;
#line 75
void add_filename_list_from_file(FILE *fp , SourceFileType file_type ) ;
#line 76
void reset_line_number(void) ;
#line 29 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.h"
void add_fen_positional_match(char const   *fen_string ) ;
#line 30
void add_fen_pattern_match(char const   *fen_pattern ) ;
#line 25 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.h"
Move *decode_move(unsigned char const   *move_string ) ;
#line 30
Boolean move_seems_valid(unsigned char const   *move_string ) ;
#line 23 "/home/wheatley/newnew/temp/pgn-extract-17.14/lines.h"
char *read_line(FILE *fpin ) ;
#line 24
Boolean non_blank_line(char const   *line___1 ) ;
#line 28 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.h"
void add_to_output_tag_order(TagName tag ) ;
#line 51 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static void save_string(char const   *str ) ;
#line 55
static void save_move(unsigned char const   *move ) ;
#line 56
static void save_q_castle(void) ;
#line 57
static void save_k_castle(void) ;
#line 58
static void terminate_input(void) ;
#line 59
static char *next_input_line(FILE *fp ) ;
#line 60
static Boolean extract_yytext(unsigned char const   *symbol_start , unsigned char const   *linep___0 ) ;
#line 62
static Boolean open_input(char const   *infile ) ;
#line 63
static Boolean open_input_file(int file_number ) ;
#line 65 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static unsigned long line_number  =    0UL;
#line 67 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static unsigned int RAV_level___0  =    0U;
#line 69 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static unsigned char last_move[16]  ;
#line 71 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static unsigned int games_in_file  =    0U;
#line 75 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static Boolean skipping_game  =    (Boolean )0;
#line 80 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static FILE *yyin  =    (FILE *)((void *)0);
#line 84 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static unsigned char yytext[101]  ;
#line 103 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static TokenType ChTab[256]  ;
#line 105 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static short MoveChars[256]  ;
#line 110 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static char const   **TagList  ;
#line 111 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static int tag_list_length___0  =    0;
#line 116 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static void init_tag_list(void) 
{ 
  int i ;
  void *tmp ;

  {
  {
#line 120
  tag_list_length___0 = 41;
#line 121
  tmp = MallocOrDie((unsigned long )tag_list_length___0 * sizeof(*TagList));
#line 121
  TagList = (char const   **)tmp;
#line 123
  i = 0;
  }
  {
#line 123
  while (1) {
    while_continue: /* CIL Label */ ;
#line 123
    if (! (i < tag_list_length___0)) {
#line 123
      goto while_break;
    }
#line 124
    *(TagList + i) = "";
#line 123
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 126
  *(TagList + 0) = "Annotator";
#line 127
  *(TagList + 1) = "Black";
#line 128
  *(TagList + 2) = "BlackElo";
#line 129
  *(TagList + 3) = "BlackNA";
#line 130
  *(TagList + 4) = "BlackTitle";
#line 131
  *(TagList + 5) = "BlackType";
#line 132
  *(TagList + 6) = "BlackUSCF";
#line 133
  *(TagList + 7) = "Board";
#line 134
  *(TagList + 8) = "Date";
#line 135
  *(TagList + 9) = "ECO";
#line 136
  *(TagList + 10) = "Elo";
#line 137
  *(TagList + 11) = "Event";
#line 138
  *(TagList + 12) = "EventDate";
#line 139
  *(TagList + 13) = "EventSponsor";
#line 140
  *(TagList + 14) = "FEN";
#line 141
  *(TagList + 15) = "FENPattern";
#line 142
  *(TagList + 16) = "LongECO";
#line 143
  *(TagList + 17) = "Mode";
#line 144
  *(TagList + 18) = "NIC";
#line 145
  *(TagList + 19) = "Opening";
#line 146
  *(TagList + 20) = "Player";
#line 147
  *(TagList + 21) = "PlyCount";
#line 148
  *(TagList + 22) = "Result";
#line 149
  *(TagList + 23) = "Round";
#line 150
  *(TagList + 24) = "Section";
#line 151
  *(TagList + 25) = "SetUp";
#line 152
  *(TagList + 26) = "Site";
#line 153
  *(TagList + 27) = "Stage";
#line 154
  *(TagList + 28) = "SubVariation";
#line 155
  *(TagList + 29) = "Termination";
#line 156
  *(TagList + 30) = "Time";
#line 157
  *(TagList + 31) = "TimeControl";
#line 158
  *(TagList + 32) = "UTCDate";
#line 159
  *(TagList + 33) = "UTCTime";
#line 160
  *(TagList + 34) = "Variation";
#line 161
  *(TagList + 35) = "White";
#line 162
  *(TagList + 36) = "WhiteElo";
#line 163
  *(TagList + 37) = "WhiteNA";
#line 164
  *(TagList + 38) = "WhiteTitle";
#line 165
  *(TagList + 39) = "WhiteType";
#line 166
  *(TagList + 40) = "WhiteUSCF";
#line 167
  return;
}
}
#line 173 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static TagName make_new_tag(char const   *tag ) 
{ 
  int tag_index ;
  void *tmp ;
  char *tmp___0 ;

  {
  {
#line 175
  tag_index = tag_list_length___0;
#line 176
  tag_list_length___0 ++;
#line 177
  tmp = ReallocOrDie((void *)TagList, (unsigned long )tag_list_length___0 * sizeof(*TagList));
#line 177
  TagList = (char const   **)tmp;
#line 179
  tmp___0 = StringCopy(tag);
#line 179
  *(TagList + tag_index) = (char const   *)tmp___0;
#line 183
  increase_game_header_tags_length(tag_list_length___0);
  }
#line 184
  return ((TagName )tag_index);
}
}
#line 187 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
char const   *tag_header_string(TagName tag ) 
{ 


  {
#line 190
  if ((unsigned int )tag >= 0U) {
#line 190
    if ((unsigned int )tag < (unsigned int )tag_list_length___0) {
#line 191
      return (*(TagList + tag));
    } else {
      {
#line 194
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error in tag_header_string(%d)\n",
              (unsigned int )tag);
      }
#line 196
      return ((char const   *)((void *)0));
    }
  } else {
    {
#line 194
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error in tag_header_string(%d)\n",
            (unsigned int )tag);
    }
#line 196
    return ((char const   *)((void *)0));
  }
}
}
#line 205 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
void init_lex_tables(void) 
{ 
  int i ;

  {
  {
#line 210
  yyin = stdin;
#line 211
  init_tag_list();
#line 213
  i = 0;
  }
  {
#line 213
  while (1) {
    while_continue: /* CIL Label */ ;
#line 213
    if (! (i < 256)) {
#line 213
      goto while_break;
    }
#line 214
    ChTab[i] = (TokenType )28;
#line 213
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 216
  ChTab[' '] = (TokenType )11;
#line 217
  ChTab['\t'] = (TokenType )11;
#line 219
  ChTab['\r'] = (TokenType )11;
#line 220
  ChTab['['] = (TokenType )12;
#line 221
  ChTab[']'] = (TokenType )13;
#line 222
  ChTab['\"'] = (TokenType )14;
#line 223
  ChTab['{'] = (TokenType )15;
#line 224
  ChTab['}'] = (TokenType )16;
#line 225
  ChTab['$'] = (TokenType )4;
#line 226
  ChTab['!'] = (TokenType )17;
#line 227
  ChTab['?'] = (TokenType )17;
#line 228
  ChTab['+'] = (TokenType )5;
#line 229
  ChTab['#'] = (TokenType )5;
#line 230
  ChTab['.'] = (TokenType )18;
#line 231
  ChTab['('] = (TokenType )7;
#line 232
  ChTab[')'] = (TokenType )8;
#line 233
  ChTab['%'] = (TokenType )19;
#line 234
  ChTab['\\'] = (TokenType )20;
#line 235
  ChTab['\000'] = (TokenType )25;
#line 236
  ChTab['*'] = (TokenType )23;
#line 237
  ChTab['-'] = (TokenType )24;
#line 240
  ChTab['<'] = (TokenType )26;
#line 241
  ChTab['>'] = (TokenType )26;
#line 242
  ChTab['='] = (TokenType )26;
#line 244
  i = '0';
  {
#line 244
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 244
    if (! (i <= 57)) {
#line 244
      goto while_break___0;
    }
#line 245
    ChTab[i] = (TokenType )22;
#line 244
    i ++;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 247
  i = 'A';
  {
#line 247
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 247
    if (! (i <= 90)) {
#line 247
      goto while_break___1;
    }
#line 248
    ChTab[i] = (TokenType )21;
#line 249
    ChTab[i + 32] = (TokenType )21;
#line 247
    i ++;
  }
  while_break___1: /* CIL Label */ ;
  }
#line 251
  ChTab['_'] = (TokenType )21;
#line 254
  ChTab[138] = (TokenType )21;
#line 255
  ChTab[224] = (TokenType )21;
#line 256
  ChTab[148] = (TokenType )21;
#line 257
  ChTab[139] = (TokenType )21;
#line 258
  ChTab[145] = (TokenType )21;
#line 261
  i = 0;
  {
#line 261
  while (1) {
    while_continue___2: /* CIL Label */ ;
#line 261
    if (! (i < 256)) {
#line 261
      goto while_break___2;
    }
#line 262
    MoveChars[i] = (short)0;
#line 261
    i ++;
  }
  while_break___2: /* CIL Label */ ;
  }
#line 265
  i = 'a';
  {
#line 265
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 265
    if (! (i <= 104)) {
#line 265
      goto while_break___3;
    }
#line 266
    MoveChars[i] = (short)1;
#line 265
    i ++;
  }
  while_break___3: /* CIL Label */ ;
  }
#line 269
  i = '1';
  {
#line 269
  while (1) {
    while_continue___4: /* CIL Label */ ;
#line 269
    if (! (i <= 56)) {
#line 269
      goto while_break___4;
    }
#line 270
    MoveChars[i] = (short)1;
#line 269
    i ++;
  }
  while_break___4: /* CIL Label */ ;
  }
#line 273
  MoveChars['K'] = (short)1;
#line 274
  MoveChars['Q'] = (short)1;
#line 275
  MoveChars['R'] = (short)1;
#line 276
  MoveChars['N'] = (short)1;
#line 277
  MoveChars['B'] = (short)1;
#line 279
  MoveChars['k'] = (short)1;
#line 280
  MoveChars['q'] = (short)1;
#line 281
  MoveChars['r'] = (short)1;
#line 282
  MoveChars['n'] = (short)1;
#line 283
  MoveChars['b'] = (short)1;
#line 285
  MoveChars['D'] = (short)1;
#line 286
  MoveChars['T'] = (short)1;
#line 287
  MoveChars['S'] = (short)1;
#line 288
  MoveChars['P'] = (short)1;
#line 289
  MoveChars['L'] = (short)1;
#line 291
  MoveChars[138] = (short)1;
#line 292
  MoveChars[224] = (short)1;
#line 293
  MoveChars[148] = (short)1;
#line 294
  MoveChars[139] = (short)1;
#line 295
  MoveChars[145] = (short)1;
#line 298
  MoveChars['x'] = (short)1;
#line 299
  MoveChars['X'] = (short)1;
#line 300
  MoveChars[':'] = (short)1;
#line 301
  MoveChars['-'] = (short)1;
#line 303
  MoveChars['='] = (short)1;
#line 305
  MoveChars['O'] = (short)1;
#line 306
  MoveChars['o'] = (short)1;
#line 307
  MoveChars['0'] = (short)1;
#line 309
  MoveChars['p'] = (short)1;
#line 310
  return;
}
}
#line 315 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static LinePair gather_string(char *line___1 , unsigned char *linep___0 ) 
{ 
  LinePair resulting_line ;
  char ch ;
  unsigned int len ;
  char *str ;
  unsigned char *tmp ;
  unsigned char *tmp___0 ;
  unsigned char *tmp___1 ;
  void *tmp___2 ;

  {
#line 319
  len = 0U;
  {
#line 322
  while (1) {
    while_continue: /* CIL Label */ ;
#line 322
    tmp = linep___0;
#line 322
    linep___0 ++;
#line 322
    ch = (char )*tmp;
#line 323
    len ++;
#line 324
    if ((int )ch == 92) {
#line 326
      len ++;
#line 327
      tmp___0 = linep___0;
#line 327
      linep___0 ++;
#line 327
      ch = (char )*tmp___0;
#line 328
      if ((int )ch != 0) {
#line 329
        len ++;
#line 330
        tmp___1 = linep___0;
#line 330
        linep___0 ++;
#line 330
        ch = (char )*tmp___1;
      }
    }
#line 322
    if ((int )ch != 34) {
#line 322
      if (! ((int )ch != 0)) {
#line 322
        goto while_break;
      }
    } else {
#line 322
      goto while_break;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 335
  len --;
#line 337
  tmp___2 = MallocOrDie((size_t )(len + 1U));
#line 337
  str = (char *)tmp___2;
#line 338
  strncpy((char */* __restrict  */)str, (char const   */* __restrict  */)((char const   *)((linep___0 - len) - 1)),
          (size_t )len);
#line 339
  *(str + len) = (char )'\000';
#line 341
  yylval.token_string = str;
  }
#line 346
  if ((int )ch == 0) {
#line 348
    if (! skipping_game) {
      {
#line 349
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Missing closing quote in %s\n",
              line___1);
      }
    }
#line 350
    if (len != 1U) {
#line 352
      linep___0 --;
#line 353
      *(str + (len - 1U)) = (char )'\000';
    }
  }
#line 359
  resulting_line.line = line___1;
#line 360
  resulting_line.linep = linep___0;
#line 361
  resulting_line.token = (TokenType )2;
#line 362
  return (resulting_line);
}
}
#line 368 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static LinePair gather_comment(char *line___1 , unsigned char *linep___0 ) 
{ 
  LinePair resulting_line ;
  char ch ;
  unsigned int len ;
  StringList *current_comment ;
  CommentList *comment ;
  unsigned char *tmp ;
  char *comment_str ;
  void *tmp___0 ;
  void *tmp___1 ;

  {
#line 372
  len = 0U;
#line 374
  current_comment = (StringList *)((void *)0);
  {
#line 378
  while (1) {
    while_continue: /* CIL Label */ ;
#line 380
    len = 0U;
    {
#line 381
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 381
      tmp = linep___0;
#line 381
      linep___0 ++;
#line 381
      ch = (char )*tmp;
#line 382
      len ++;
#line 381
      if ((int )ch != 125) {
#line 381
        if (! ((int )ch != 0)) {
#line 381
          goto while_break___0;
        }
      } else {
#line 381
        goto while_break___0;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 385
    len --;
#line 386
    if (GlobalState.keep_comments) {
      {
#line 390
      tmp___0 = MallocOrDie((size_t )(len + 1U));
#line 390
      comment_str = (char *)tmp___0;
#line 391
      strncpy((char */* __restrict  */)comment_str, (char const   */* __restrict  */)((char const   *)((linep___0 - len) - 1)),
              (size_t )len);
#line 392
      *(comment_str + len) = (char )'\000';
#line 393
      current_comment = SaveStringListItem(current_comment, (char const   *)comment_str);
      }
    }
#line 395
    if ((int )ch == 0) {
      {
#line 396
      line___1 = next_input_line(yyin);
#line 397
      linep___0 = (unsigned char *)line___1;
      }
    }
#line 378
    if ((int )ch != 125) {
#line 378
      if (! ((unsigned long )line___1 != (unsigned long )((void *)0))) {
#line 378
        goto while_break;
      }
    } else {
#line 378
      goto while_break;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 402
  tmp___1 = MallocOrDie(sizeof(*comment));
#line 402
  comment = (CommentList *)tmp___1;
#line 403
  comment->Comment = current_comment;
#line 404
  comment->next = (struct comment_list *)((void *)0);
#line 405
  yylval.comment = comment;
#line 407
  resulting_line.line = line___1;
#line 408
  resulting_line.linep = linep___0;
#line 409
  resulting_line.token = (TokenType )3;
  }
#line 410
  return (resulting_line);
}
}
#line 416 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static LinePair gather_possible_numeric(char *line___1 , unsigned char *linep___0 ,
                                        char initial_digit ) 
{ 
  LinePair resulting_line ;
  TokenType token ;
  unsigned char const   *symbol_start ;
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  int tmp___3 ;
  int tmp___4 ;
  unsigned short const   **tmp___5 ;
  Boolean tmp___6 ;

  {
#line 419
  token = (TokenType )6;
#line 421
  symbol_start = (unsigned char const   *)(linep___0 - 1);
#line 423
  if ((int )initial_digit == 48) {
    {
#line 425
    tmp___1 = strncmp((char const   *)linep___0, "-1", (size_t )2);
    }
#line 425
    if (tmp___1 == 0) {
      {
#line 426
      token = (TokenType )10;
#line 427
      save_string("0-1");
#line 428
      linep___0 += 2;
      }
    } else {
      {
#line 430
      tmp___0 = strncmp((char const   *)linep___0, "-0-0", (size_t )4);
      }
#line 430
      if (tmp___0 == 0) {
        {
#line 431
        token = (TokenType )9;
#line 432
        save_q_castle();
#line 433
        linep___0 += 4;
        }
      } else {
        {
#line 435
        tmp = strncmp((char const   *)linep___0, "-0", (size_t )2);
        }
#line 435
        if (tmp == 0) {
          {
#line 436
          token = (TokenType )9;
#line 437
          save_k_castle();
#line 438
          linep___0 += 2;
          }
        }
      }
    }
  } else
#line 444
  if ((int )initial_digit == 49) {
    {
#line 445
    tmp___4 = strncmp((char const   *)linep___0, "-0", (size_t )2);
    }
#line 445
    if (tmp___4 == 0) {
      {
#line 446
      token = (TokenType )10;
#line 447
      save_string("1-0");
#line 448
      linep___0 += 2;
      }
    } else {
      {
#line 450
      tmp___3 = strncmp((char const   *)linep___0, "/2", (size_t )2);
      }
#line 450
      if (tmp___3 == 0) {
        {
#line 451
        token = (TokenType )10;
#line 452
        linep___0 += 2;
#line 454
        tmp___2 = strncmp((char const   *)linep___0, "-1/2", (size_t )4);
        }
#line 454
        if (tmp___2 == 0) {
#line 455
          token = (TokenType )10;
#line 456
          linep___0 += 4;
        }
        {
#line 461
        save_string("1/2-1/2");
        }
      }
    }
  }
#line 470
  if ((unsigned int )token == 6U) {
    {
#line 472
    while (1) {
      while_continue: /* CIL Label */ ;
      {
#line 472
      tmp___5 = __ctype_b_loc();
      }
#line 472
      if (! ((int const   )*(*tmp___5 + (int )((unsigned int )*linep___0)) & 2048)) {
#line 472
        goto while_break;
      }
#line 473
      linep___0 ++;
    }
    while_break: /* CIL Label */ ;
    }
  }
#line 476
  if ((unsigned int )token == 6U) {
    {
#line 478
    tmp___6 = extract_yytext(symbol_start, (unsigned char const   *)linep___0);
    }
#line 478
    if (tmp___6) {
      {
#line 479
      yylval.move_number = 0U;
#line 480
      sscanf((char const   */* __restrict  */)((char const   *)(yytext)), (char const   */* __restrict  */)"%u",
             & yylval.move_number);
      }
      {
#line 482
      while (1) {
        while_continue___0: /* CIL Label */ ;
#line 482
        if (! ((int )*linep___0 == 46)) {
#line 482
          goto while_break___0;
        }
#line 483
        linep___0 ++;
      }
      while_break___0: /* CIL Label */ ;
      }
    } else {
#line 487
      token = (TokenType )27;
    }
  }
#line 493
  resulting_line.line = line___1;
#line 494
  resulting_line.linep = linep___0;
#line 495
  resulting_line.token = token;
#line 496
  return (resulting_line);
}
}
#line 506 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static int identify_tag(char const   *tag_string ) 
{ 
  int tag_index ;
  int tmp ;

  {
#line 510
  tag_index = 0;
  {
#line 510
  while (1) {
    while_continue: /* CIL Label */ ;
#line 510
    if (! (tag_index < tag_list_length___0)) {
#line 510
      goto while_break;
    }
    {
#line 511
    tmp = strcmp(tag_string, *(TagList + tag_index));
    }
#line 511
    if (tmp == 0) {
#line 512
      return (tag_index);
    }
#line 510
    tag_index ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 516
  return (-1);
}
}
#line 522 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static LinePair gather_tag(char *line___1 , unsigned char *linep___0 ) 
{ 
  LinePair resulting_line ;
  char ch ;
  unsigned int len ;
  unsigned char *tmp ;
  unsigned char *tmp___0 ;
  unsigned short const   **tmp___1 ;
  unsigned short const   **tmp___2 ;
  int tag_item ;
  char *tag_string ;
  void *tmp___3 ;
  TagName tmp___4 ;

  {
#line 526
  len = 0U;
  {
#line 528
  while (1) {
    while_continue: /* CIL Label */ ;
#line 530
    if ((int )*linep___0 == 0) {
      {
#line 531
      line___1 = next_input_line(yyin);
#line 532
      linep___0 = (unsigned char *)line___1;
      }
    }
#line 534
    if ((unsigned long )line___1 != (unsigned long )((void *)0)) {
      {
#line 535
      while (1) {
        while_continue___0: /* CIL Label */ ;
#line 535
        if (! ((unsigned int )ChTab[(unsigned int )*linep___0] == 11U)) {
#line 535
          goto while_break___0;
        }
#line 536
        linep___0 ++;
      }
      while_break___0: /* CIL Label */ ;
      }
    }
#line 528
    if ((unsigned long )line___1 != (unsigned long )((void *)0)) {
#line 528
      if (! ((unsigned int )ChTab[(unsigned int )*linep___0] == 0U)) {
#line 528
        goto while_break;
      }
    } else {
#line 528
      goto while_break;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 542
  if ((unsigned long )line___1 != (unsigned long )((void *)0)) {
#line 543
    tmp = linep___0;
#line 543
    linep___0 ++;
#line 543
    ch = (char )*tmp;
    {
#line 544
    while (1) {
      while_continue___1: /* CIL Label */ ;
      {
#line 544
      tmp___1 = __ctype_b_loc();
      }
#line 544
      if (! ((int const   )*(*tmp___1 + (int )((unsigned int )ch)) & 1024)) {
        {
#line 544
        tmp___2 = __ctype_b_loc();
        }
#line 544
        if (! ((int const   )*(*tmp___2 + (int )((unsigned int )ch)) & 2048)) {
#line 544
          if (! ((int )ch == 95)) {
#line 544
            goto while_break___1;
          }
        }
      }
#line 545
      len ++;
#line 546
      tmp___0 = linep___0;
#line 546
      linep___0 ++;
#line 546
      ch = (char )*tmp___0;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 549
    linep___0 --;
#line 550
    if (len > 0U) {
      {
#line 555
      tmp___3 = MallocOrDie((size_t )(len + 1U));
#line 555
      tag_string = (char *)tmp___3;
#line 556
      strncpy((char */* __restrict  */)tag_string, (char const   */* __restrict  */)((char const   *)(linep___0 - len)),
              (size_t )len);
#line 557
      *(tag_string + len) = (char )'\000';
#line 558
      tag_item = identify_tag((char const   *)tag_string);
      }
#line 559
      if (tag_item < 0) {
        {
#line 560
        tmp___4 = make_new_tag((char const   *)tag_string);
#line 560
        tag_item = (int )tmp___4;
        }
      }
#line 562
      if (tag_item >= 0) {
#line 562
        if (tag_item < tag_list_length___0) {
          {
#line 563
          yylval.tag_index = (unsigned int )tag_item;
#line 564
          resulting_line.token = (TokenType )1;
#line 565
          free((void *)tag_string);
          }
        } else {
          {
#line 568
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: invalid tag index %d in gather_tag.\n",
                  tag_item);
#line 571
          exit(1);
          }
        }
      } else {
        {
#line 568
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: invalid tag index %d in gather_tag.\n",
                tag_item);
#line 571
        exit(1);
        }
      }
    } else {
#line 575
      resulting_line.token = (TokenType )27;
    }
  } else {
#line 579
    resulting_line.token = (TokenType )27;
  }
#line 581
  resulting_line.line = line___1;
#line 582
  resulting_line.linep = linep___0;
#line 583
  return (resulting_line);
}
}
#line 586 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static Boolean extract_yytext(unsigned char const   *symbol_start , unsigned char const   *linep___0 ) 
{ 
  Boolean Ok ;
  long len ;

  {
#line 589
  Ok = (Boolean )1;
#line 590
  len = linep___0 - symbol_start;
#line 592
  if (len < 100L) {
    {
#line 593
    strncpy((char */* __restrict  */)((char *)(yytext)), (char const   */* __restrict  */)((char const   *)symbol_start),
            (size_t )len);
#line 594
    yytext[len] = (unsigned char )'\000';
    }
  } else {
    {
#line 597
    strncpy((char */* __restrict  */)((char *)(yytext)), (char const   */* __restrict  */)((char const   *)symbol_start),
            (size_t )100);
#line 598
    yytext[100] = (unsigned char )'\000';
    }
#line 599
    if (! skipping_game) {
      {
#line 600
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Symbol %s exceeds length of %u.\n",
              yytext, 100);
      }
    }
#line 602
    Ok = (Boolean )0;
  }
#line 604
  return (Ok);
}
}
#line 612
static TokenType get_next_symbol(void) ;
#line 612 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static char *line  =    (char *)((void *)0);
#line 613 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static unsigned char *linep  =    (unsigned char *)((void *)0);
#line 610 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static TokenType get_next_symbol(void) 
{ 
  TokenType token ;
  LinePair resulting_line ;
  unsigned char const   *symbol_start ;
  int next_char ;
  unsigned short const   **tmp ;
  Boolean tmp___0 ;
  Boolean tmp___1 ;
  Boolean tmp___2 ;
  Boolean tmp___3 ;

  {
  {
#line 618
  while (1) {
    while_continue: /* CIL Label */ ;
#line 623
    yytext[0] = (unsigned char )'\000';
#line 624
    if ((unsigned long )line == (unsigned long )((void *)0)) {
      {
#line 625
      line = next_input_line(yyin);
#line 626
      linep = (unsigned char *)line;
      }
#line 627
      if ((unsigned long )line != (unsigned long )((void *)0)) {
#line 628
        token = (TokenType )27;
      } else {
#line 631
        token = (TokenType )0;
      }
    } else {
#line 635
      next_char = (int )*linep & 255;
#line 638
      symbol_start = (unsigned char const   *)linep;
#line 639
      linep ++;
#line 640
      token = ChTab[next_char];
      {
#line 643
      if ((unsigned int )token == 11U) {
#line 643
        goto case_11;
      }
#line 648
      if ((unsigned int )token == 12U) {
#line 648
        goto case_12;
      }
#line 655
      if ((unsigned int )token == 13U) {
#line 655
        goto case_13;
      }
#line 658
      if ((unsigned int )token == 14U) {
#line 658
        goto case_14;
      }
#line 665
      if ((unsigned int )token == 15U) {
#line 665
        goto case_15;
      }
#line 672
      if ((unsigned int )token == 16U) {
#line 672
        goto case_16;
      }
#line 678
      if ((unsigned int )token == 4U) {
#line 678
        goto case_4;
      }
#line 689
      if ((unsigned int )token == 17U) {
#line 689
        goto case_17;
      }
#line 728
      if ((unsigned int )token == 5U) {
#line 728
        goto case_5;
      }
#line 734
      if ((unsigned int )token == 18U) {
#line 734
        goto case_18;
      }
#line 739
      if ((unsigned int )token == 19U) {
#line 739
        goto case_19;
      }
#line 745
      if ((unsigned int )token == 20U) {
#line 745
        goto case_20;
      }
#line 752
      if ((unsigned int )token == 21U) {
#line 752
        goto case_21;
      }
#line 792
      if ((unsigned int )token == 22U) {
#line 792
        goto case_22;
      }
#line 803
      if ((unsigned int )token == 0U) {
#line 803
        goto case_0;
      }
#line 805
      if ((unsigned int )token == 7U) {
#line 805
        goto case_7;
      }
#line 808
      if ((unsigned int )token == 8U) {
#line 808
        goto case_8;
      }
#line 820
      if ((unsigned int )token == 23U) {
#line 820
        goto case_23;
      }
#line 824
      if ((unsigned int )token == 24U) {
#line 824
        goto case_24;
      }
#line 836
      if ((unsigned int )token == 25U) {
#line 836
        goto case_25;
      }
#line 842
      if ((unsigned int )token == 28U) {
#line 842
        goto case_28;
      }
#line 853
      if ((unsigned int )token == 26U) {
#line 853
        goto case_26;
      }
#line 862
      goto switch_default___1;
      case_11: /* CIL Label */ 
      {
#line 644
      while (1) {
        while_continue___0: /* CIL Label */ ;
#line 644
        if (! ((unsigned int )ChTab[(unsigned int )*linep] == 11U)) {
#line 644
          goto while_break___0;
        }
#line 645
        linep ++;
      }
      while_break___0: /* CIL Label */ ;
      }
#line 646
      token = (TokenType )27;
#line 647
      goto switch_break;
      case_12: /* CIL Label */ 
      {
#line 649
      resulting_line = gather_tag(line, linep);
#line 651
      line = resulting_line.line;
#line 652
      linep = resulting_line.linep;
#line 653
      token = resulting_line.token;
      }
#line 654
      goto switch_break;
      case_13: /* CIL Label */ 
#line 656
      token = (TokenType )27;
#line 657
      goto switch_break;
      case_14: /* CIL Label */ 
      {
#line 659
      resulting_line = gather_string(line, linep);
#line 661
      line = resulting_line.line;
#line 662
      linep = resulting_line.linep;
#line 663
      token = resulting_line.token;
      }
#line 664
      goto switch_break;
      case_15: /* CIL Label */ 
      {
#line 666
      resulting_line = gather_comment(line, linep);
#line 668
      line = resulting_line.line;
#line 669
      linep = resulting_line.linep;
#line 670
      token = resulting_line.token;
      }
#line 671
      goto switch_break;
      case_16: /* CIL Label */ 
#line 673
      if (! skipping_game) {
        {
#line 674
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unmatched comment end.\n");
        }
      }
#line 676
      token = (TokenType )27;
#line 677
      goto switch_break;
      case_4: /* CIL Label */ 
      {
#line 679
      while (1) {
        while_continue___1: /* CIL Label */ ;
        {
#line 679
        tmp = __ctype_b_loc();
        }
#line 679
        if (! ((int const   )*(*tmp + (int )((unsigned int )*linep)) & 2048)) {
#line 679
          goto while_break___1;
        }
#line 680
        linep ++;
      }
      while_break___1: /* CIL Label */ ;
      }
      {
#line 682
      tmp___0 = extract_yytext(symbol_start, (unsigned char const   *)linep);
      }
#line 682
      if (tmp___0) {
        {
#line 683
        save_string((char const   *)(yytext));
        }
      } else {
#line 686
        token = (TokenType )27;
      }
#line 688
      goto switch_break;
      case_17: /* CIL Label */ 
#line 691
      token = (TokenType )27;
      {
#line 692
      while (1) {
        while_continue___2: /* CIL Label */ ;
#line 692
        if (! ((unsigned int )ChTab[(unsigned int )*linep] == 17U)) {
#line 692
          goto while_break___2;
        }
#line 693
        linep ++;
      }
      while_break___2: /* CIL Label */ ;
      }
      {
#line 695
      tmp___1 = extract_yytext(symbol_start, (unsigned char const   *)linep);
      }
#line 695
      if (tmp___1) {
        {
#line 697
        if ((int )yytext[0] == 33) {
#line 697
          goto case_33;
        }
#line 711
        if ((int )yytext[0] == 63) {
#line 711
          goto case_63___0;
        }
#line 696
        goto switch_break___0;
        case_33: /* CIL Label */ 
        {
#line 699
        if ((int )yytext[1] == 33) {
#line 699
          goto case_33___0;
        }
#line 702
        if ((int )yytext[1] == 63) {
#line 702
          goto case_63;
        }
#line 705
        goto switch_default;
        case_33___0: /* CIL Label */ 
        {
#line 700
        save_string("$3");
        }
#line 701
        goto switch_break___1;
        case_63: /* CIL Label */ 
        {
#line 703
        save_string("$5");
        }
#line 704
        goto switch_break___1;
        switch_default: /* CIL Label */ 
        {
#line 706
        save_string("$1");
        }
#line 707
        goto switch_break___1;
        switch_break___1: /* CIL Label */ ;
        }
#line 709
        token = (TokenType )4;
#line 710
        goto switch_break___0;
        case_63___0: /* CIL Label */ 
        {
#line 713
        if ((int )yytext[1] == 33) {
#line 713
          goto case_33___1;
        }
#line 716
        if ((int )yytext[1] == 63) {
#line 716
          goto case_63___1;
        }
#line 719
        goto switch_default___0;
        case_33___1: /* CIL Label */ 
        {
#line 714
        save_string("$6");
        }
#line 715
        goto switch_break___2;
        case_63___1: /* CIL Label */ 
        {
#line 717
        save_string("$4");
        }
#line 718
        goto switch_break___2;
        switch_default___0: /* CIL Label */ 
        {
#line 720
        save_string("$2");
        }
#line 721
        goto switch_break___2;
        switch_break___2: /* CIL Label */ ;
        }
#line 723
        token = (TokenType )4;
#line 724
        goto switch_break___0;
        switch_break___0: /* CIL Label */ ;
        }
      }
#line 727
      goto switch_break;
      case_5: /* CIL Label */ 
      {
#line 730
      while (1) {
        while_continue___3: /* CIL Label */ ;
#line 730
        if (! ((unsigned int )ChTab[(unsigned int )*linep] == 5U)) {
#line 730
          goto while_break___3;
        }
#line 731
        linep ++;
      }
      while_break___3: /* CIL Label */ ;
      }
#line 733
      goto switch_break;
      case_18: /* CIL Label */ 
      {
#line 735
      while (1) {
        while_continue___4: /* CIL Label */ ;
#line 735
        if (! ((unsigned int )ChTab[(unsigned int )*linep] == 18U)) {
#line 735
          goto while_break___4;
        }
#line 736
        linep ++;
      }
      while_break___4: /* CIL Label */ ;
      }
#line 737
      token = (TokenType )27;
#line 738
      goto switch_break;
      case_19: /* CIL Label */ 
      {
#line 741
      line = next_input_line(yyin);
#line 742
      linep = (unsigned char *)line;
#line 743
      token = (TokenType )27;
      }
#line 744
      goto switch_break;
      case_20: /* CIL Label */ 
#line 747
      if ((int )*linep != 0) {
#line 748
        linep ++;
      }
#line 750
      token = (TokenType )27;
#line 751
      goto switch_break;
      case_21: /* CIL Label */ 
#line 754
      if (MoveChars[next_char]) {
        {
#line 756
        while (1) {
          while_continue___5: /* CIL Label */ ;
#line 756
          if (! MoveChars[(int )*linep & 255]) {
#line 756
            goto while_break___5;
          }
#line 757
          linep ++;
        }
        while_break___5: /* CIL Label */ ;
        }
        {
#line 759
        tmp___3 = extract_yytext(symbol_start, (unsigned char const   *)linep);
        }
#line 759
        if (tmp___3) {
          {
#line 763
          tmp___2 = move_seems_valid((unsigned char const   *)(yytext));
          }
#line 763
          if (tmp___2) {
            {
#line 764
            save_move((unsigned char const   *)(yytext));
#line 765
            token = (TokenType )9;
            }
          } else {
#line 768
            if (! skipping_game) {
              {
#line 769
              print_error_context(GlobalState.logfile);
#line 770
              fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown move text %s.\n",
                      yytext);
              }
            }
#line 773
            token = (TokenType )27;
          }
        } else {
#line 777
          token = (TokenType )27;
        }
      } else {
#line 781
        if (! skipping_game) {
          {
#line 782
          print_error_context(GlobalState.logfile);
#line 783
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown character %c (Hex: %x).\n",
                  next_char, next_char);
          }
        }
        {
#line 788
        while (1) {
          while_continue___6: /* CIL Label */ ;
#line 788
          if (! ((unsigned int )ChTab[(unsigned int )*linep] == 28U)) {
#line 788
            goto while_break___6;
          }
#line 789
          linep ++;
        }
        while_break___6: /* CIL Label */ ;
        }
      }
#line 791
      goto switch_break;
      case_22: /* CIL Label */ 
      {
#line 796
      resulting_line = gather_possible_numeric(line, linep, (char )next_char);
#line 799
      line = resulting_line.line;
#line 800
      linep = resulting_line.linep;
#line 801
      token = resulting_line.token;
      }
#line 802
      goto switch_break;
      case_0: /* CIL Label */ 
#line 804
      goto switch_break;
      case_7: /* CIL Label */ 
#line 806
      RAV_level___0 ++;
#line 807
      goto switch_break;
      case_8: /* CIL Label */ 
#line 809
      if (RAV_level___0 > 0U) {
#line 810
        RAV_level___0 --;
      } else {
#line 813
        if (! skipping_game) {
          {
#line 814
          print_error_context(GlobalState.logfile);
#line 815
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Too many \')\' found.\n");
          }
        }
#line 817
        token = (TokenType )27;
      }
#line 819
      goto switch_break;
      case_23: /* CIL Label */ 
      {
#line 821
      save_string("*");
#line 822
      token = (TokenType )10;
      }
#line 823
      goto switch_break;
      case_24: /* CIL Label */ 
#line 825
      if ((unsigned int )ChTab[(unsigned int )*linep] == 24U) {
        {
#line 826
        linep ++;
#line 827
        save_move((unsigned char const   *)"--");
#line 828
        token = (TokenType )9;
        }
      } else {
        {
#line 831
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Single \'-\' not allowed.\n");
#line 832
        print_error_context(GlobalState.logfile);
#line 833
        token = (TokenType )27;
        }
      }
#line 835
      goto switch_break;
      case_25: /* CIL Label */ 
      {
#line 838
      line = next_input_line(yyin);
#line 839
      linep = (unsigned char *)line;
#line 840
      token = (TokenType )27;
      }
#line 841
      goto switch_break;
      case_28: /* CIL Label */ 
#line 843
      if (! skipping_game) {
        {
#line 844
        print_error_context(GlobalState.logfile);
#line 845
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown character %c (Hex: %x).\n",
                next_char, next_char);
        }
      }
      {
#line 850
      while (1) {
        while_continue___7: /* CIL Label */ ;
#line 850
        if (! ((unsigned int )ChTab[(unsigned int )*linep] == 28U)) {
#line 850
          goto while_break___7;
        }
#line 851
        linep ++;
      }
      while_break___7: /* CIL Label */ ;
      }
#line 852
      goto switch_break;
      case_26: /* CIL Label */ 
      {
#line 854
      print_error_context(GlobalState.logfile);
#line 855
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Operator in illegal context: %c.\n",
              (int const   )*symbol_start);
      }
      {
#line 858
      while (1) {
        while_continue___8: /* CIL Label */ ;
#line 858
        if (! ((unsigned int )ChTab[(unsigned int )*linep] == 26U)) {
#line 858
          goto while_break___8;
        }
#line 859
        linep ++;
      }
      while_break___8: /* CIL Label */ ;
      }
#line 860
      token = (TokenType )27;
#line 861
      goto switch_break;
      switch_default___1: /* CIL Label */ 
#line 863
      if (! skipping_game) {
        {
#line 864
        print_error_context(GlobalState.logfile);
#line 865
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Missing case for %d on char %x.\n",
                (unsigned int )token, next_char);
        }
      }
#line 869
      token = (TokenType )27;
#line 870
      goto switch_break;
      switch_break: /* CIL Label */ ;
      }
    }
#line 618
    if (! ((unsigned int )token == 27U)) {
#line 618
      goto while_break;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 874
  return (token);
}
}
#line 877 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
TokenType next_token(void) 
{ 
  TokenType token ;
  TokenType tmp ;
  int tmp___0 ;

  {
  {
#line 879
  tmp = get_next_symbol();
#line 879
  token = tmp;
  }
  {
#line 882
  while (1) {
    while_continue: /* CIL Label */ ;
#line 882
    if ((unsigned int )token == 0U) {
#line 882
      if (! GlobalState.parsing_ECO_file) {
        {
#line 882
        tmp___0 = yywrap();
        }
#line 882
        if (tmp___0) {
#line 882
          goto while_break;
        }
      } else {
#line 882
        goto while_break;
      }
    } else {
#line 882
      goto while_break;
    }
    {
#line 884
    token = get_next_symbol();
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 886
  return (token);
}
}
#line 892 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static Boolean skip_token(TokenType token ) 
{ 


  {
  {
#line 899
  if ((unsigned int )token == 0U) {
#line 899
    goto case_0;
  }
#line 899
  if ((unsigned int )token == 9U) {
#line 899
    goto case_0;
  }
#line 899
  if ((unsigned int )token == 1U) {
#line 899
    goto case_0;
  }
#line 899
  if ((unsigned int )token == 10U) {
#line 899
    goto case_0;
  }
#line 901
  goto switch_default;
  case_0: /* CIL Label */ 
  case_9: /* CIL Label */ 
  case_1: /* CIL Label */ 
  case_10: /* CIL Label */ 
#line 900
  return ((Boolean )0);
  switch_default: /* CIL Label */ 
#line 902
  return ((Boolean )1);
  switch_break: /* CIL Label */ ;
  }
}
}
#line 911 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
TokenType skip_to_next_game(TokenType token ) 
{ 
  Boolean tmp ;
  Boolean tmp___0 ;

  {
  {
#line 914
  tmp___0 = skip_token(token);
  }
#line 914
  if (tmp___0) {
#line 915
    skipping_game = (Boolean )1;
    {
#line 916
    while (1) {
      while_continue: /* CIL Label */ ;
#line 917
      if ((unsigned int )token == 3U) {
#line 919
        if ((unsigned long )yylval.comment != (unsigned long )((void *)0)) {
#line 919
          if ((unsigned long )(yylval.comment)->Comment != (unsigned long )((void *)0)) {
            {
#line 921
            free_string_list((yylval.comment)->Comment);
#line 922
            free((void *)yylval.comment);
#line 923
            yylval.comment = (CommentList *)((void *)0);
            }
          }
        }
      }
      {
#line 926
      token = next_token();
#line 916
      tmp = skip_token(token);
      }
#line 916
      if (! tmp) {
#line 916
        goto while_break;
      }
    }
    while_break: /* CIL Label */ ;
    }
#line 928
    skipping_game = (Boolean )0;
  }
#line 930
  return (token);
}
}
#line 934 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static void save_q_castle(void) 
{ 


  {
  {
#line 937
  save_move((unsigned char const   *)"O-O-O");
  }
#line 938
  return;
}
}
#line 941 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static void save_k_castle(void) 
{ 


  {
  {
#line 944
  save_move((unsigned char const   *)"O-O");
  }
#line 945
  return;
}
}
#line 948 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static void save_move(unsigned char const   *move ) 
{ 


  {
  {
#line 952
  yylval.move_details = decode_move(move);
#line 954
  strcpy((char */* __restrict  */)((char *)(last_move)), (char const   */* __restrict  */)((char const   *)move));
  }
#line 955
  return;
}
}
#line 957 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
void restart_lex_for_new_game(void) 
{ 


  {
#line 960
  last_move[0] = (unsigned char )'\000';
#line 961
  RAV_level___0 = 0U;
#line 962
  return;
}
}
#line 968 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static int current_file_num  =    0;
#line 973 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static FILE_LIST list_of_files  =    {(char const   **)((void *)0), (SourceFileType *)((void *)0), 0U, 0U};
#line 980 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
int current_file_number(void) 
{ 


  {
#line 983
  return (current_file_num);
}
}
#line 991 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
void add_filename_list_from_file(FILE *fp , SourceFileType file_type ) 
{ 
  void *tmp ;
  void *tmp___0 ;
  char *line___1 ;
  char *tmp___1 ;
  Boolean tmp___2 ;

  {
#line 994
  if ((unsigned long )list_of_files.files == (unsigned long )((void *)0)) {
#line 994
    goto _L;
  } else
#line 994
  if (list_of_files.max_files == 0U) {
    _L: /* CIL Label */ 
    {
#line 998
    tmp = MallocOrDie(11UL * sizeof(char const   *));
#line 998
    list_of_files.files = (char const   **)tmp;
#line 1000
    tmp___0 = MallocOrDie(11UL * sizeof(SourceFileType ));
#line 1000
    list_of_files.file_type = (SourceFileType *)tmp___0;
#line 1002
    list_of_files.max_files = 10U;
#line 1003
    list_of_files.num_files = 0U;
    }
  }
#line 1005
  if ((unsigned long )list_of_files.files != (unsigned long )((void *)0)) {
    {
#line 1007
    tmp___1 = read_line(fp);
#line 1007
    line___1 = tmp___1;
    }
    {
#line 1009
    while (1) {
      while_continue: /* CIL Label */ ;
#line 1009
      if (! ((unsigned long )line___1 != (unsigned long )((void *)0))) {
#line 1009
        goto while_break;
      }
      {
#line 1010
      tmp___2 = non_blank_line((char const   *)line___1);
      }
#line 1010
      if (tmp___2) {
        {
#line 1011
        add_filename_to_source_list((char const   *)line___1, file_type);
        }
      } else {
        {
#line 1014
        free((void *)line___1);
        }
      }
      {
#line 1016
      line___1 = read_line(fp);
      }
    }
    while_break: /* CIL Label */ ;
    }
  }
#line 1019
  return;
}
}
#line 1021 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
void add_filename_to_source_list(char const   *filename___0 , SourceFileType file_type ) 
{ 
  unsigned int location ;
  int tmp ;
  void *tmp___0 ;
  void *tmp___1 ;
  void *tmp___2 ;
  void *tmp___3 ;
  unsigned int j ;
  char *tmp___4 ;

  {
  {
#line 1024
  location = list_of_files.num_files;
#line 1026
  tmp = access(filename___0, 4);
  }
#line 1026
  if (tmp != 0) {
    {
#line 1027
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unable to find %s\n",
            filename___0);
#line 1028
    exit(1);
    }
  }
#line 1034
  if (list_of_files.num_files == list_of_files.max_files) {
#line 1039
    if ((unsigned long )list_of_files.files == (unsigned long )((void *)0)) {
#line 1039
      goto _L;
    } else
#line 1039
    if (list_of_files.max_files == 0U) {
      _L: /* CIL Label */ 
      {
#line 1043
      tmp___0 = MallocOrDie(11UL * sizeof(char const   *));
#line 1043
      list_of_files.files = (char const   **)tmp___0;
#line 1045
      tmp___1 = MallocOrDie(11UL * sizeof(SourceFileType ));
#line 1045
      list_of_files.file_type = (SourceFileType *)tmp___1;
#line 1048
      list_of_files.max_files = 10U;
#line 1049
      list_of_files.num_files = 0U;
      }
    } else {
      {
#line 1052
      tmp___2 = realloc((void *)list_of_files.files, (unsigned long )((list_of_files.max_files + 5U) + 1U) * sizeof(char const   *));
#line 1052
      list_of_files.files = (char const   **)tmp___2;
#line 1055
      tmp___3 = realloc((void *)list_of_files.file_type, (unsigned long )((list_of_files.max_files + 5U) + 1U) * sizeof(SourceFileType ));
#line 1055
      list_of_files.file_type = (SourceFileType *)tmp___3;
#line 1059
      list_of_files.max_files += 5U;
      }
#line 1060
      if ((unsigned long )list_of_files.files == (unsigned long )((void *)0)) {
#line 1060
        if ((unsigned long )list_of_files.file_type == (unsigned long )((void *)0)) {
          {
#line 1061
          perror("");
#line 1062
          abort();
          }
        }
      }
    }
  }
#line 1069
  if ((unsigned int )file_type == 1U) {
#line 1071
    location = 0U;
    {
#line 1071
    while (1) {
      while_continue: /* CIL Label */ ;
#line 1071
      if (location < list_of_files.num_files) {
#line 1071
        if (! ((unsigned int )*(list_of_files.file_type + location) == 1U)) {
#line 1071
          goto while_break;
        }
      } else {
#line 1071
        goto while_break;
      }
#line 1071
      location ++;
    }
    while_break: /* CIL Label */ ;
    }
#line 1075
    if (location < list_of_files.num_files) {
#line 1081
      j = list_of_files.num_files;
      {
#line 1081
      while (1) {
        while_continue___0: /* CIL Label */ ;
#line 1081
        if (! (j > location)) {
#line 1081
          goto while_break___0;
        }
#line 1082
        *(list_of_files.files + j) = *(list_of_files.files + (j - 1U));
#line 1083
        *(list_of_files.file_type + j) = *(list_of_files.file_type + (j - 1U));
#line 1081
        j --;
      }
      while_break___0: /* CIL Label */ ;
      }
    }
  }
  {
#line 1087
  tmp___4 = StringCopy(filename___0);
#line 1087
  *(list_of_files.files + location) = (char const   *)tmp___4;
#line 1088
  *(list_of_files.file_type + location) = file_type;
#line 1089
  (list_of_files.num_files) ++;
#line 1091
  *(list_of_files.files + list_of_files.num_files) = (char const   *)((char *)((void *)0));
  }
#line 1092
  return;
}
}
#line 1095 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static Boolean open_input(char const   *infile ) 
{ 


  {
  {
#line 1098
  yyin = fopen((char const   */* __restrict  */)infile, (char const   */* __restrict  */)"r");
  }
#line 1099
  if ((unsigned long )yyin != (unsigned long )((void *)0)) {
#line 1100
    GlobalState.current_input_file = infile;
#line 1101
    if (GlobalState.verbose) {
      {
#line 1102
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Processing %s\n",
              GlobalState.current_input_file);
      }
    }
  }
#line 1106
  return ((Boolean )((unsigned long )yyin != (unsigned long )((void *)0)));
}
}
#line 1110 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
Boolean open_eco_file(char const   *eco_file ) 
{ 
  Boolean tmp ;

  {
  {
#line 1113
  tmp = open_input(eco_file);
  }
#line 1113
  return (tmp);
}
}
#line 1117 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static Boolean open_input_file(int file_number ) 
{ 
  Boolean tmp ;

  {
  {
#line 1123
  tmp = open_input(*(list_of_files.files + file_number));
  }
#line 1123
  if (tmp) {
#line 1124
    GlobalState.current_file_type = *(list_of_files.file_type + file_number);
#line 1125
    return ((Boolean )1);
  } else {
#line 1128
    return ((Boolean )0);
  }
}
}
#line 1133 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
Boolean open_first_file(void) 
{ 
  Boolean ok ;
  char const   *tmp ;
  Boolean tmp___0 ;

  {
#line 1135
  ok = (Boolean )1;
#line 1137
  if (list_of_files.num_files == 0U) {
#line 1139
    yyin = stdin;
#line 1140
    GlobalState.current_input_file = "stdin";
#line 1144
    if (GlobalState.verbose) {
      {
#line 1145
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Processing %s\n",
              GlobalState.current_input_file);
      }
    }
  } else {
    {
#line 1149
    tmp___0 = open_input_file(0);
    }
#line 1149
    if (! tmp___0) {
      {
#line 1152
      tmp = input_file_name(0);
#line 1152
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unable to open the PGN file: %s\n",
              tmp);
#line 1154
      ok = (Boolean )0;
      }
    }
  }
#line 1156
  return (ok);
}
}
#line 1162 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
char const   *input_file_name(int file_number ) 
{ 


  {
#line 1165
  if ((unsigned int )file_number >= list_of_files.num_files) {
#line 1166
    return ((char const   *)((void *)0));
  } else
#line 1168
  if (file_number >= 0) {
#line 1169
    return (*(list_of_files.files + file_number));
  } else {
#line 1172
    return ((char const   *)((void *)0));
  }
}
}
#line 1178 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
void print_error_context(FILE *fp ) 
{ 


  {
#line 1181
  if ((unsigned long )GlobalState.current_input_file != (unsigned long )((void *)0)) {
    {
#line 1182
    fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"File %s: ",
            GlobalState.current_input_file);
    }
  }
  {
#line 1184
  fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"Line number: %lu\n",
          line_number);
  }
#line 1185
  return;
}
}
#line 1189 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static void save_string(char const   *str ) 
{ 
  size_t len ;
  size_t tmp ;
  char *token ;
  void *tmp___0 ;

  {
  {
#line 1191
  tmp = strlen(str);
#line 1191
  len = tmp;
#line 1194
  tmp___0 = MallocOrDie(len + 1UL);
#line 1194
  token = (char *)tmp___0;
#line 1195
  strcpy((char */* __restrict  */)token, (char const   */* __restrict  */)str);
#line 1196
  yylval.token_string = token;
  }
#line 1197
  return;
}
}
#line 1203 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static char *line___0  =    (char *)((void *)0);
#line 1200 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static char *next_input_line(FILE *fp ) 
{ 


  {
#line 1205
  if ((unsigned long )line___0 != (unsigned long )((void *)0)) {
    {
#line 1206
    free((void *)line___0);
    }
  }
  {
#line 1209
  line___0 = read_line(fp);
  }
#line 1211
  if ((unsigned long )line___0 != (unsigned long )((void *)0)) {
#line 1212
    line_number ++;
  }
#line 1214
  return (line___0);
}
}
#line 1218 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
int yywrap(void) 
{ 
  int time_to_exit ;
  char const   *tmp ;
  Boolean tmp___0 ;
  char const   *tmp___1 ;
  char const   *tmp___2 ;

  {
#line 1223
  if ((unsigned long )list_of_files.files == (unsigned long )((void *)0)) {
#line 1225
    time_to_exit = 1;
  } else {
    {
#line 1227
    tmp___2 = input_file_name(current_file_num);
    }
#line 1227
    if ((unsigned long )tmp___2 == (unsigned long )((void *)0)) {
#line 1229
      time_to_exit = 1;
    } else {
      {
#line 1233
      terminate_input();
#line 1235
      current_file_num ++;
#line 1236
      tmp___1 = input_file_name(current_file_num);
      }
#line 1236
      if ((unsigned long )tmp___1 == (unsigned long )((void *)0)) {
#line 1238
        time_to_exit = 1;
      } else {
        {
#line 1240
        tmp___0 = open_input_file(current_file_num);
        }
#line 1240
        if (tmp___0) {
          {
#line 1247
          time_to_exit = 0;
#line 1252
          GlobalState.current_file_type = *(list_of_files.file_type + current_file_num);
#line 1254
          restart_lex_for_new_game();
#line 1255
          games_in_file = 0U;
#line 1256
          reset_line_number();
          }
        } else {
          {
#line 1241
          tmp = input_file_name(current_file_num);
#line 1241
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unable to open the PGN file: %s\n",
                  tmp);
#line 1243
          time_to_exit = 1;
          }
        }
      }
    }
  }
#line 1259
  return (time_to_exit);
}
}
#line 1264 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
void reset_line_number(void) 
{ 


  {
#line 1267
  line_number = 0UL;
#line 1268
  return;
}
}
#line 1270 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
static void terminate_input(void) 
{ 


  {
#line 1273
  if ((unsigned long )yyin != (unsigned long )stdin) {
#line 1273
    if ((unsigned long )yyin != (unsigned long )((void *)0)) {
      {
#line 1274
      fclose(yyin);
#line 1275
      yyin = (FILE *)((void *)0);
      }
    }
  }
#line 1277
  return;
}
}
#line 1286 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
void read_tag_file(char const   *TagFile ) 
{ 
  Boolean keep_reading ;
  char *line___1 ;
  char *tmp ;

  {
  {
#line 1289
  yyin = fopen((char const   */* __restrict  */)TagFile, (char const   */* __restrict  */)"r");
  }
#line 1290
  if ((unsigned long )yyin != (unsigned long )((void *)0)) {
#line 1291
    keep_reading = (Boolean )1;
    {
#line 1293
    while (1) {
      while_continue: /* CIL Label */ ;
#line 1293
      if (! keep_reading) {
#line 1293
        goto while_break;
      }
      {
#line 1294
      tmp = next_input_line(yyin);
#line 1294
      line___1 = tmp;
      }
#line 1295
      if ((unsigned long )line___1 != (unsigned long )((void *)0)) {
        {
#line 1296
        keep_reading = process_tag_line(TagFile, line___1);
        }
      } else {
#line 1299
        keep_reading = (Boolean )0;
      }
    }
    while_break: /* CIL Label */ ;
    }
    {
#line 1302
    fclose(yyin);
#line 1304
    yywrap();
    }
  } else {
    {
#line 1307
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unable to open %s for reading.\n",
            TagFile);
#line 1309
    exit(1);
    }
  }
#line 1311
  return;
}
}
#line 1316 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
void read_tag_roster_file(char const   *RosterFile ) 
{ 
  Boolean keep_reading ;
  char *line___1 ;
  char *tmp ;

  {
  {
#line 1318
  keep_reading = (Boolean )1;
#line 1319
  yyin = MustOpen(RosterFile, "r");
  }
  {
#line 1321
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1321
    if (! keep_reading) {
#line 1321
      goto while_break;
    }
    {
#line 1322
    tmp = next_input_line(yyin);
#line 1322
    line___1 = tmp;
    }
#line 1323
    if ((unsigned long )line___1 != (unsigned long )((void *)0)) {
      {
#line 1324
      keep_reading = process_roster_line(line___1);
      }
    } else {
#line 1327
      keep_reading = (Boolean )0;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 1330
  fclose(yyin);
#line 1332
  yywrap();
  }
#line 1333
  return;
}
}
#line 1338 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
Boolean process_tag_line(char const   *TagFile , char *line___1 ) 
{ 
  Boolean keep_reading ;
  unsigned char *linep___0 ;
  LinePair resulting_line ;
  LinePair tmp ;
  TokenType tag_token ;
  int tag_index ;
  TagOperator operator ;
  Boolean tmp___0 ;

  {
  {
#line 1341
  keep_reading = (Boolean )1;
#line 1342
  tmp___0 = non_blank_line((char const   *)line___1);
  }
#line 1342
  if (tmp___0) {
    {
#line 1343
    linep___0 = (unsigned char *)line___1;
#line 1345
    tmp = gather_tag(line___1, linep___0);
#line 1345
    resulting_line = tmp;
#line 1349
    line___1 = resulting_line.line;
#line 1350
    linep___0 = resulting_line.linep;
#line 1351
    tag_token = resulting_line.token;
    }
#line 1352
    if ((unsigned int )tag_token != 27U) {
#line 1354
      tag_index = (int )yylval.tag_index;
#line 1356
      operator = (TagOperator )0;
      {
#line 1359
      while (1) {
        while_continue: /* CIL Label */ ;
#line 1359
        if (! ((unsigned int )ChTab[(unsigned int )*linep___0] == 11U)) {
#line 1359
          goto while_break;
        }
#line 1360
        linep___0 ++;
      }
      while_break: /* CIL Label */ ;
      }
#line 1363
      if ((unsigned int )ChTab[(unsigned int )*linep___0] == 26U) {
        {
#line 1365
        if ((int )*linep___0 == 60) {
#line 1365
          goto case_60;
        }
#line 1379
        if ((int )*linep___0 == 62) {
#line 1379
          goto case_62;
        }
#line 1389
        if ((int )*linep___0 == 61) {
#line 1389
          goto case_61;
        }
#line 1393
        goto switch_default;
        case_60: /* CIL Label */ 
#line 1366
        linep___0 ++;
#line 1367
        if ((int )*linep___0 == 61) {
#line 1368
          linep___0 ++;
#line 1369
          operator = (TagOperator )5;
        } else
#line 1371
        if ((int )*linep___0 == 62) {
#line 1372
          linep___0 ++;
#line 1373
          operator = (TagOperator )4;
        } else {
#line 1376
          operator = (TagOperator )1;
        }
#line 1378
        goto switch_break;
        case_62: /* CIL Label */ 
#line 1380
        linep___0 ++;
#line 1381
        if ((int )*linep___0 == 61) {
#line 1382
          linep___0 ++;
#line 1383
          operator = (TagOperator )6;
        } else {
#line 1386
          operator = (TagOperator )2;
        }
#line 1388
        goto switch_break;
        case_61: /* CIL Label */ 
#line 1390
        linep___0 ++;
#line 1391
        operator = (TagOperator )3;
#line 1392
        goto switch_break;
        switch_default: /* CIL Label */ 
        {
#line 1394
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: unknown operator in %s\n",
                line___1);
#line 1396
        linep___0 ++;
        }
#line 1397
        goto switch_break;
        switch_break: /* CIL Label */ ;
        }
        {
#line 1400
        while (1) {
          while_continue___0: /* CIL Label */ ;
#line 1400
          if (! ((unsigned int )ChTab[(unsigned int )*linep___0] == 11U)) {
#line 1400
            goto while_break___0;
          }
#line 1401
          linep___0 ++;
        }
        while_break___0: /* CIL Label */ ;
        }
      }
#line 1405
      if ((unsigned int )ChTab[(unsigned int )*linep___0] == 14U) {
        {
#line 1407
        linep___0 ++;
#line 1408
        resulting_line = gather_string(line___1, linep___0);
#line 1409
        line___1 = resulting_line.line;
#line 1410
        linep___0 = resulting_line.linep;
        }
#line 1411
        if ((unsigned int )tag_token == 1U) {
#line 1416
          if (tag_index == 14) {
            {
#line 1417
            add_fen_positional_match((char const   *)yylval.token_string);
#line 1418
            free((void *)yylval.token_string);
            }
          } else
#line 1420
          if (tag_index == 15) {
            {
#line 1421
            add_fen_pattern_match((char const   *)yylval.token_string);
#line 1422
            free((void *)yylval.token_string);
            }
          } else {
            {
#line 1425
            add_tag_to_list(tag_index, (char const   *)yylval.token_string, operator);
#line 1426
            free((void *)yylval.token_string);
            }
          }
        } else {
#line 1430
          if (! skipping_game) {
            {
#line 1431
            fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"File %s: unrecognised tag name %s\n",
                    TagFile, line___1);
            }
          }
          {
#line 1435
          free((void *)yylval.token_string);
          }
        }
      } else
#line 1439
      if (! skipping_game) {
        {
#line 1440
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"File %s: missing quoted tag string in %s at %s\n",
                TagFile, line___1, linep___0);
        }
      }
    } else {
#line 1448
      keep_reading = (Boolean )0;
    }
  }
#line 1451
  return (keep_reading);
}
}
#line 1457 "/home/wheatley/newnew/temp/pgn-extract-17.14/lex.c"
Boolean process_roster_line(char *line___1 ) 
{ 
  Boolean keep_reading ;
  unsigned char *linep___0 ;
  LinePair resulting_line ;
  LinePair tmp ;
  TokenType tag_token ;
  int tag_index ;
  Boolean tmp___0 ;

  {
  {
#line 1460
  keep_reading = (Boolean )1;
#line 1461
  tmp___0 = non_blank_line((char const   *)line___1);
  }
#line 1461
  if (tmp___0) {
    {
#line 1462
    linep___0 = (unsigned char *)line___1;
#line 1464
    tmp = gather_tag(line___1, linep___0);
#line 1464
    resulting_line = tmp;
#line 1468
    line___1 = resulting_line.line;
#line 1469
    linep___0 = resulting_line.linep;
#line 1470
    tag_token = resulting_line.token;
    }
#line 1471
    if ((unsigned int )tag_token != 27U) {
      {
#line 1473
      tag_index = (int )yylval.tag_index;
#line 1474
      add_to_output_tag_order((TagName )tag_index);
      }
    } else {
#line 1478
      keep_reading = (Boolean )0;
    }
  }
#line 1481
  return (keep_reading);
}
}
#line 342 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strstr)(char const   *__haystack ,
                                                                                                 char const   *__needle )  __attribute__((__pure__)) ;
#line 348
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(2), __leaf__)) strtok)(char * __restrict  __s ,
                                                                                               char const   * __restrict  __delim ) ;
#line 40 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.h"
MovePair *find_all_moves(Board const   *board , Colour colour ) ;
#line 23 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.h"
void add_positional_variations_from_file(FILE *fpin ) ;
#line 24
void add_positional_variation_from_line(char *line___1 ) ;
#line 25
void add_textual_variations_from_file(FILE *fpin ) ;
#line 26
void add_textual_variation_from_line(char *line___1 ) ;
#line 32
Boolean check_for_only_stalemate(Board const   *board , Move const   *moves ) ;
#line 23 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.h"
void store_hash_value(Move *move_details , char const   *fen___0 ) ;
#line 23 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.h"
void add_fen_pattern(char const   *fen_pattern ) ;
#line 109 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
static variation_list *games_to_keep  =    (variation_list *)((void *)0);
#line 111
static Boolean textual_variation_match(char const   *variation_move , unsigned char const   *actual_move ) ;
#line 122 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
static char *strip_move_number(char *str ) 
{ 
  unsigned short const   **tmp ;

  {
  {
#line 125
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 125
    tmp = __ctype_b_loc();
    }
#line 125
    if (! ((int const   )*(*tmp + (int )*str) & 2048)) {
#line 125
      goto while_break;
    }
#line 126
    str ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 128
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 128
    if (! ((int )*str == 46)) {
#line 128
      goto while_break___0;
    }
#line 129
    str ++;
  }
  while_break___0: /* CIL Label */ ;
  }
#line 131
  if ((int )*str != 0) {
#line 132
    return (str);
  } else {
#line 135
    return ((char *)((void *)0));
  }
}
}
#line 148 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
static variation_list *compose_variation(char *line___1 ) 
{ 
  variation_list *variation ;
  variant_move *move_list ;
  unsigned int num_moves ;
  unsigned int max_moves ;
  char *move ;
  void *tmp ;
  void *tmp___0 ;
  void *tmp___1 ;
  size_t tmp___2 ;

  {
  {
#line 153
  num_moves = 0U;
#line 154
  max_moves = 0U;
#line 157
  tmp = MallocOrDie(sizeof(variation_list ));
#line 157
  variation = (variation_list *)tmp;
#line 161
  variation->num_white_any_moves = 0U;
#line 162
  variation->num_black_any_moves = 0U;
#line 163
  variation->num_white_disallowed_moves = 0U;
#line 164
  variation->num_black_disallowed_moves = 0U;
#line 166
  tmp___0 = MallocOrDie(10UL * sizeof(*move_list));
#line 166
  move_list = (variant_move *)tmp___0;
#line 168
  max_moves = 10U;
#line 170
  move = strtok((char */* __restrict  */)line___1, (char const   */* __restrict  */)" ");
  }
  {
#line 171
  while (1) {
    while_continue: /* CIL Label */ ;
#line 171
    if (! ((unsigned long )move != (unsigned long )((void *)0))) {
#line 171
      goto while_break;
    }
    {
#line 172
    move = strip_move_number(move);
    }
#line 172
    if (! ((unsigned long )move == (unsigned long )((void *)0))) {
#line 177
      if (num_moves == max_moves) {
        {
#line 178
        tmp___1 = realloc((void *)move_list, (unsigned long )(max_moves + 5U) * sizeof(*move_list));
#line 178
        move_list = (variant_move *)tmp___1;
        }
#line 180
        if ((unsigned long )move_list == (unsigned long )((void *)0)) {
          {
#line 182
          free((void *)variation);
          }
#line 183
          return ((variation_list *)((void *)0));
        } else {
#line 186
          max_moves += 5U;
        }
      }
#line 192
      (move_list + num_moves)->move = move;
#line 193
      (move_list + num_moves)->matched = (Boolean )0;
#line 195
      if ((int )*move == 42) {
#line 197
        if (num_moves & 1U) {
#line 198
          (variation->num_black_any_moves) ++;
        } else {
#line 201
          (variation->num_white_any_moves) ++;
        }
        {
#line 204
        tmp___2 = strlen((char const   *)move);
        }
#line 204
        if (tmp___2 > 1UL) {
          {
#line 205
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Warning: %c in %s should not be followed by additional move text.\n",
                  (int )*move, move);
#line 208
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"It could give false matches.\n");
          }
        }
      } else
#line 211
      if ((int )*move == 33) {
#line 213
        if (num_moves & 1U) {
#line 214
          (variation->num_black_disallowed_moves) ++;
        } else {
#line 217
          (variation->num_white_disallowed_moves) ++;
        }
      }
#line 223
      num_moves ++;
    }
    {
#line 225
    move = strtok((char */* __restrict  */)((char *)((void *)0)), (char const   */* __restrict  */)" ");
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 227
  variation->moves = move_list;
#line 228
  variation->length = num_moves;
#line 229
  variation->next = (struct variation_list *)((void *)0);
#line 230
  return (variation);
}
}
#line 236 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
void add_textual_variations_from_file(FILE *fpin ) 
{ 
  char *line___1 ;

  {
  {
#line 240
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 240
    line___1 = read_line(fpin);
    }
#line 240
    if (! ((unsigned long )line___1 != (unsigned long )((void *)0))) {
#line 240
      goto while_break;
    }
    {
#line 241
    add_textual_variation_from_line(line___1);
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 243
  return;
}
}
#line 247 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
void add_textual_variation_from_line(char *line___1 ) 
{ 
  variation_list *next_variation ;
  variation_list *tmp ;
  Boolean tmp___0 ;

  {
  {
#line 250
  tmp___0 = non_blank_line((char const   *)line___1);
  }
#line 250
  if (tmp___0) {
    {
#line 251
    tmp = compose_variation(line___1);
#line 251
    next_variation = tmp;
    }
#line 252
    if ((unsigned long )next_variation != (unsigned long )((void *)0)) {
#line 253
      next_variation->next = games_to_keep;
#line 254
      games_to_keep = next_variation;
    }
  }
#line 257
  return;
}
}
#line 268 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
static Move *compose_positional_variation(char *line___1 ) 
{ 
  char *move ;
  Move *head ;
  Move *tail ;
  Boolean Ok ;
  unsigned int depth ;
  Move *next ;
  Move *tmp ;

  {
  {
#line 272
  head = (Move *)((void *)0);
#line 272
  tail = (Move *)((void *)0);
#line 273
  Ok = (Boolean )1;
#line 275
  depth = 0U;
#line 277
  move = strtok((char */* __restrict  */)line___1, (char const   */* __restrict  */)" ");
  }
  {
#line 278
  while (1) {
    while_continue: /* CIL Label */ ;
#line 278
    if (Ok) {
#line 278
      if ((unsigned long )move != (unsigned long )((void *)0)) {
#line 278
        if (! ((int )*move != 42)) {
#line 278
          goto while_break;
        }
      } else {
#line 278
        goto while_break;
      }
    } else {
#line 278
      goto while_break;
    }
    {
#line 279
    move = strip_move_number(move);
    }
#line 279
    if (! ((unsigned long )move == (unsigned long )((void *)0))) {
      {
#line 283
      tmp = decode_move((unsigned char const   *)((unsigned char *)move));
#line 283
      next = tmp;
      }
#line 285
      if ((unsigned long )next == (unsigned long )((void *)0)) {
        {
#line 286
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Failed to identify %s\n",
                move);
#line 287
        Ok = (Boolean )0;
        }
      } else {
#line 291
        if ((unsigned long )tail == (unsigned long )((void *)0)) {
#line 292
          head = next;
#line 293
          tail = next;
        } else {
#line 296
          tail->next = next;
#line 297
          tail = next;
        }
#line 299
        next->next = (struct move *)((void *)0);
      }
#line 301
      depth ++;
    }
    {
#line 304
    move = strtok((char */* __restrict  */)((void *)0), (char const   */* __restrict  */)" ");
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 306
  if (Ok) {
#line 312
    depth = (depth + 1U) / 2U + 4U;
#line 313
    if (depth > GlobalState.depth_of_positional_search) {
#line 314
      GlobalState.depth_of_positional_search = depth;
    }
  } else {
#line 318
    if ((unsigned long )head != (unsigned long )((void *)0)) {
      {
#line 319
      free_move_list(head);
      }
    }
#line 321
    head = (Move *)((void *)0);
  }
#line 323
  return (head);
}
}
#line 329 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
void add_positional_variations_from_file(FILE *fpin ) 
{ 
  char *line___1 ;

  {
  {
#line 333
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 333
    line___1 = read_line(fpin);
    }
#line 333
    if (! ((unsigned long )line___1 != (unsigned long )((void *)0))) {
#line 333
      goto while_break;
    }
    {
#line 334
    add_positional_variation_from_line(line___1);
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 336
  return;
}
}
#line 338 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
void add_positional_variation_from_line(char *line___1 ) 
{ 
  Move *next_variation ;
  Move *tmp ;
  Boolean tmp___0 ;

  {
  {
#line 341
  tmp___0 = non_blank_line((char const   *)line___1);
  }
#line 341
  if (tmp___0) {
    {
#line 342
    tmp = compose_positional_variation(line___1);
#line 342
    next_variation = tmp;
    }
#line 343
    if ((unsigned long )next_variation != (unsigned long )((void *)0)) {
      {
#line 347
      store_hash_value(next_variation, (char const   *)((void *)0));
#line 348
      free_move_list(next_variation);
#line 352
      GlobalState.positional_variations = (Boolean )1;
      }
    }
  }
#line 355
  return;
}
}
#line 359 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
void add_fen_positional_match(char const   *fen_string ) 
{ 


  {
  {
#line 362
  store_hash_value((Move *)((void *)0), fen_string);
#line 363
  GlobalState.positional_variations = (Boolean )1;
  }
#line 364
  return;
}
}
#line 368 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
void add_fen_pattern_match(char const   *fen_pattern ) 
{ 


  {
  {
#line 371
  add_fen_pattern(fen_pattern);
#line 372
  GlobalState.positional_variations = (Boolean )1;
  }
#line 373
  return;
}
}
#line 378 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
static Boolean move_char(char c ) 
{ 
  unsigned short const   **tmp ;
  unsigned short const   **tmp___0 ;
  int tmp___1 ;

  {
  {
#line 381
  tmp = __ctype_b_loc();
  }
#line 381
  if ((Boolean )((int const   )*(*tmp + (int )c) & 1024)) {
#line 381
    tmp___1 = 1;
  } else {
    {
#line 381
    tmp___0 = __ctype_b_loc();
    }
#line 381
    if ((int const   )*(*tmp___0 + (int )c) & 2048) {
#line 381
      tmp___1 = 1;
    } else
#line 381
    if ((int )c == 45) {
#line 381
      tmp___1 = 1;
    } else {
#line 381
      tmp___1 = 0;
    }
  }
#line 381
  return ((Boolean )tmp___1);
}
}
#line 390 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
static Boolean textual_variation_match(char const   *variation_move , unsigned char const   *actual_move ) 
{ 
  char const   *match_point ;
  Boolean found ;
  char *tmp ;
  Boolean tmp___0 ;
  size_t tmp___1 ;
  Boolean tmp___2 ;
  Boolean tmp___3 ;

  {
#line 393
  found = (Boolean )0;
#line 395
  match_point = variation_move;
  {
#line 395
  while (1) {
    while_continue: /* CIL Label */ ;
#line 395
    if (! found) {
#line 395
      if (! ((unsigned long )match_point != (unsigned long )((void *)0))) {
#line 395
        goto while_break;
      }
    } else {
#line 395
      goto while_break;
    }
    {
#line 397
    tmp = strstr(match_point, (char const   *)actual_move);
#line 397
    match_point = (char const   *)tmp;
    }
#line 398
    if ((unsigned long )match_point != (unsigned long )((void *)0)) {
#line 404
      found = (Boolean )1;
#line 405
      if ((unsigned long )match_point != (unsigned long )variation_move) {
        {
#line 406
        tmp___0 = move_char((char )*(match_point + -1));
        }
#line 406
        if (tmp___0) {
#line 407
          found = (Boolean )0;
        }
      }
      {
#line 410
      tmp___1 = strlen((char const   *)actual_move);
#line 410
      tmp___2 = move_char((char )*(match_point + tmp___1));
      }
#line 410
      if (tmp___2) {
#line 411
        found = (Boolean )0;
      }
#line 413
      if (! found) {
        {
#line 415
        while (1) {
          while_continue___0: /* CIL Label */ ;
          {
#line 415
          tmp___3 = move_char((char )*match_point);
          }
#line 415
          if (! tmp___3) {
#line 415
            goto while_break___0;
          }
#line 416
          match_point ++;
        }
        while_break___0: /* CIL Label */ ;
        }
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 421
  return (found);
}
}
#line 434 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
static Boolean straight_match(Move *current_game_head , variation_list variation ) 
{ 
  variant_move *moves_of_the_variation ;
  Move *next_move ;
  unsigned int move_index ;
  Boolean matches ;
  Boolean this_move_matches ;

  {
#line 440
  move_index = 0U;
#line 442
  matches = (Boolean )1;
#line 445
  next_move = current_game_head;
#line 450
  moves_of_the_variation = variation.moves;
#line 451
  move_index = 0U;
  {
#line 452
  while (1) {
    while_continue: /* CIL Label */ ;
#line 452
    if (matches) {
#line 452
      if ((unsigned long )next_move != (unsigned long )((void *)0)) {
#line 452
        if (! (move_index < variation.length)) {
#line 452
          goto while_break;
        }
      } else {
#line 452
        goto while_break;
      }
    } else {
#line 452
      goto while_break;
    }
#line 455
    if (! ((int )*((moves_of_the_variation + move_index)->move) == 42)) {
      {
#line 459
      this_move_matches = textual_variation_match((char const   *)(moves_of_the_variation + move_index)->move,
                                                  (unsigned char const   *)(next_move->move));
      }
#line 462
      if (this_move_matches) {
#line 464
        if ((int )*((moves_of_the_variation + move_index)->move) == 33) {
#line 466
          matches = (Boolean )0;
        }
      } else
#line 470
      if ((int )*((moves_of_the_variation + move_index)->move) != 33) {
#line 472
        matches = (Boolean )0;
      }
    }
#line 481
    if (matches) {
#line 482
      move_index ++;
#line 483
      next_move = next_move->next;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 489
  matches = (Boolean )(move_index == variation.length);
#line 490
  return (matches);
}
}
#line 513 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
static Boolean permutation_match(Move *current_game_head , variation_list variation ) 
{ 
  variant_move *moves_of_the_variation ;
  Move *next_move ;
  unsigned int variant_index ;
  Boolean matches ;
  unsigned int matched_moves ;
  Boolean white_to_move ;
  unsigned int tested_moves ;
  Boolean disallowed_move_found ;
  Boolean tmp ;
  Boolean this_move_matches ;
  Boolean tmp___0 ;

  {
#line 518
  variant_index = 0U;
#line 520
  matches = (Boolean )1;
#line 524
  matched_moves = 0U;
#line 525
  white_to_move = (Boolean )1;
#line 527
  moves_of_the_variation = variation.moves;
#line 529
  variant_index = 0U;
  {
#line 529
  while (1) {
    while_continue: /* CIL Label */ ;
#line 529
    if (! (variant_index < variation.length)) {
#line 529
      goto while_break;
    }
#line 530
    (moves_of_the_variation + variant_index)->matched = (Boolean )0;
#line 529
    variant_index ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 533
  next_move = current_game_head;
#line 539
  if (variation.num_white_disallowed_moves > 0U) {
#line 539
    goto _L;
  } else
#line 539
  if (variation.num_black_disallowed_moves > 0U) {
    _L: /* CIL Label */ 
#line 541
    tested_moves = 0U;
#line 542
    disallowed_move_found = (Boolean )0;
    {
#line 548
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 548
      if (! disallowed_move_found) {
#line 548
        if (tested_moves < variation.length) {
#line 548
          if (! ((unsigned long )next_move != (unsigned long )((void *)0))) {
#line 548
            goto while_break___0;
          }
        } else {
#line 548
          goto while_break___0;
        }
      } else {
#line 548
        goto while_break___0;
      }
#line 551
      if (white_to_move) {
#line 553
        variant_index = 0U;
      } else {
#line 557
        variant_index = 1U;
      }
      {
#line 560
      while (1) {
        while_continue___1: /* CIL Label */ ;
#line 560
        if (! disallowed_move_found) {
#line 560
          if (! (variant_index < variation.length)) {
#line 560
            goto while_break___1;
          }
        } else {
#line 560
          goto while_break___1;
        }
#line 561
        if ((int )*((moves_of_the_variation + variant_index)->move) == 33) {
          {
#line 561
          tmp = textual_variation_match((char const   *)(moves_of_the_variation + variant_index)->move,
                                        (unsigned char const   *)(next_move->move));
          }
#line 561
          if (tmp) {
#line 566
            disallowed_move_found = (Boolean )1;
          }
        }
#line 568
        if (! disallowed_move_found) {
#line 570
          variant_index += 2U;
        }
      }
      while_break___1: /* CIL Label */ ;
      }
#line 573
      if (! disallowed_move_found) {
#line 575
        tested_moves ++;
#line 576
        white_to_move = (Boolean )(! white_to_move);
#line 577
        next_move = next_move->next;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 580
    if (disallowed_move_found) {
#line 582
      matches = (Boolean )0;
    } else {
#line 586
      variant_index = 0U;
      {
#line 586
      while (1) {
        while_continue___2: /* CIL Label */ ;
#line 586
        if (! (variant_index < variation.length)) {
#line 586
          goto while_break___2;
        }
#line 587
        if ((int )*((moves_of_the_variation + variant_index)->move) == 33) {
#line 588
          (moves_of_the_variation + variant_index)->matched = (Boolean )1;
#line 589
          if ((variant_index & 1U) == 0U) {
#line 590
            (variation.num_white_any_moves) ++;
          } else {
#line 593
            (variation.num_black_any_moves) ++;
          }
        }
#line 586
        variant_index ++;
      }
      while_break___2: /* CIL Label */ ;
      }
    }
  }
#line 605
  next_move = current_game_head;
#line 606
  white_to_move = (Boolean )1;
  {
#line 611
  while (1) {
    while_continue___3: /* CIL Label */ ;
#line 611
    if (matches) {
#line 611
      if (matched_moves < variation.length) {
#line 611
        if (! ((unsigned long )next_move != (unsigned long )((void *)0))) {
#line 611
          goto while_break___3;
        }
      } else {
#line 611
        goto while_break___3;
      }
    } else {
#line 611
      goto while_break___3;
    }
#line 613
    matches = (Boolean )0;
#line 615
    if (white_to_move) {
#line 617
      variant_index = 0U;
    } else {
#line 621
      variant_index = 1U;
    }
    {
#line 624
    while (1) {
      while_continue___4: /* CIL Label */ ;
#line 624
      if (! matches) {
#line 624
        if (! (variant_index < variation.length)) {
#line 624
          goto while_break___4;
        }
      } else {
#line 624
        goto while_break___4;
      }
#line 625
      if (! (moves_of_the_variation + variant_index)->matched) {
        {
#line 629
        tmp___0 = textual_variation_match((char const   *)(moves_of_the_variation + variant_index)->move,
                                          (unsigned char const   *)(next_move->move));
#line 629
        this_move_matches = tmp___0;
        }
#line 632
        if (this_move_matches) {
#line 634
          (moves_of_the_variation + variant_index)->matched = (Boolean )1;
#line 635
          matches = (Boolean )1;
        }
      }
#line 638
      if (! matches) {
#line 640
        variant_index += 2U;
      }
    }
    while_break___4: /* CIL Label */ ;
    }
#line 644
    if (! matches) {
#line 646
      if (white_to_move) {
#line 646
        if (variation.num_white_any_moves > 0U) {
#line 647
          matches = (Boolean )1;
#line 648
          (variation.num_white_any_moves) --;
        } else {
#line 646
          goto _L___0;
        }
      } else
      _L___0: /* CIL Label */ 
#line 650
      if (! white_to_move) {
#line 650
        if (variation.num_black_any_moves > 0U) {
#line 651
          matches = (Boolean )1;
#line 652
          (variation.num_black_any_moves) --;
        }
      }
    }
#line 659
    if (matches) {
#line 661
      matched_moves ++;
#line 662
      next_move = next_move->next;
#line 663
      white_to_move = (Boolean )(! white_to_move);
    }
  }
  while_break___3: /* CIL Label */ ;
  }
#line 666
  if (matches) {
#line 668
    matches = (Boolean )(matched_moves == variation.length);
  }
#line 670
  return (matches);
}
}
#line 678 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
Boolean check_for_only_checkmate(Move const   *moves ) 
{ 


  {
#line 681
  if (GlobalState.match_only_checkmate) {
    {
#line 683
    while (1) {
      while_continue: /* CIL Label */ ;
#line 683
      if ((unsigned long )moves != (unsigned long )((void *)0)) {
#line 683
        if (! ((unsigned int const   )moves->check_status != 2U)) {
#line 683
          goto while_break;
        }
      } else {
#line 683
        goto while_break;
      }
#line 684
      moves = (Move const   *)moves->next;
    }
    while_break: /* CIL Label */ ;
    }
#line 686
    if ((unsigned long )moves == (unsigned long )((void *)0)) {
#line 687
      return ((Boolean )0);
    } else {
#line 690
      return ((Boolean )1);
    }
  } else {
#line 695
    return ((Boolean )1);
  }
}
}
#line 703 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
Boolean check_for_only_stalemate(Board const   *board , Move const   *moves ) 
{ 
  Move const   *move ;
  MovePair *available_moves ;

  {
#line 706
  if (GlobalState.match_only_stalemate) {
#line 707
    move = moves;
#line 708
    if ((unsigned long )move != (unsigned long )((void *)0)) {
      {
#line 712
      while (1) {
        while_continue: /* CIL Label */ ;
#line 712
        if (! ((unsigned long )move->next != (unsigned long )((void *)0))) {
#line 712
          goto while_break;
        }
#line 713
        move = (Move const   *)move->next;
      }
      while_break: /* CIL Label */ ;
      }
#line 715
      if ((unsigned int const   )move->check_status != 0U) {
#line 717
        return ((Boolean )0);
      }
      {
#line 720
      available_moves = find_all_moves(board, (Colour )board->to_move);
      }
#line 721
      if ((unsigned long )available_moves == (unsigned long )((void *)0)) {
#line 722
        return ((Boolean )1);
      } else {
#line 725
        return ((Boolean )0);
      }
    } else {
#line 729
      return ((Boolean )1);
    }
  } else {
#line 734
    return ((Boolean )1);
  }
}
}
#line 741 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
Boolean check_textual_variations(Game game_details ) 
{ 
  Boolean wanted ;
  variation_list *variation ;

  {
#line 743
  wanted = (Boolean )0;
#line 746
  if ((unsigned long )games_to_keep != (unsigned long )((void *)0)) {
#line 747
    variation = games_to_keep;
    {
#line 747
    while (1) {
      while_continue: /* CIL Label */ ;
#line 747
      if ((unsigned long )variation != (unsigned long )((void *)0)) {
#line 747
        if (! (! wanted)) {
#line 747
          goto while_break;
        }
      } else {
#line 747
        goto while_break;
      }
#line 749
      if (GlobalState.match_permutations) {
        {
#line 750
        wanted = permutation_match(game_details.moves, *variation);
        }
      } else {
        {
#line 753
        wanted = straight_match(game_details.moves, *variation);
        }
      }
#line 747
      variation = variation->next;
    }
    while_break: /* CIL Label */ ;
    }
  } else {
#line 761
    wanted = (Boolean )1;
  }
#line 763
  return (wanted);
}
}
#line 769 "/home/wheatley/newnew/temp/pgn-extract-17.14/moves.c"
Boolean check_move_bounds(unsigned int plycount ) 
{ 
  Boolean in_bounds ;
  unsigned int number_of_moves ;
  int tmp ;

  {
#line 771
  in_bounds = (Boolean )1;
#line 773
  number_of_moves = (plycount + 1U) / 2U;
#line 774
  if (GlobalState.check_move_bounds) {
#line 775
    if (GlobalState.lower_move_bound <= number_of_moves) {
#line 775
      if (number_of_moves <= GlobalState.upper_move_bound) {
#line 775
        tmp = 1;
      } else {
#line 775
        tmp = 0;
      }
    } else {
#line 775
      tmp = 0;
    }
#line 775
    in_bounds = (Boolean )tmp;
  }
#line 778
  return (in_bounds);
}
}
#line 124 "/usr/include/ctype.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) tolower)(int __c ) ;
#line 24 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.h"
Boolean determine_move_details(Colour colour , Move *move_details , Board *board ) ;
#line 25
HashCode HashLookup(Col col , Rank rank , Piece piece , Colour colour ) ;
#line 26
void make_move(Col from_col , Rank from_rank , Col to_col , Rank to_rank , Piece piece ,
               Colour colour , Board *board ) ;
#line 28
CheckStatus king_is_in_check(Board const   *board , Colour king_colour ) ;
#line 29
MovePair *find_pawn_moves(Col from_col , Rank from_rank , Col to_col , Rank to_rank ,
                          Colour colour , Board const   *board ) ;
#line 31
MovePair *find_knight_moves(Col to_col , Rank to_rank , Colour colour , Board const   *board ) ;
#line 32
MovePair *find_bishop_moves(Col to_col , Rank to_rank , Colour colour , Board const   *board ) ;
#line 33
MovePair *find_rook_moves(Col to_col , Rank to_rank , Colour colour , Board const   *board ) ;
#line 34
MovePair *find_queen_moves(Col to_col , Rank to_rank , Colour colour , Board const   *board ) ;
#line 35
MovePair *find_king_moves(Col to_col , Rank to_rank , Colour colour , Board const   *board ) ;
#line 36
MovePair *exclude_checks(Piece piece , Colour colour , MovePair *possibles , Board const   *board ) ;
#line 38
void free_move_pair_list(MovePair *move_list ) ;
#line 39
Boolean king_is_in_checkmate(Colour colour , Board *board ) ;
#line 26 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.h"
Board *rewrite_game(Move *moves , char const   *fen___0 ) ;
#line 28
Board *new_fen_board(char const   *fen___0 ) ;
#line 30
void set_output_piece_characters(char const   *letters ) ;
#line 31
char coloured_piece_to_SAN_letter(Piece coloured_piece ) ;
#line 32
void build_basic_EPD_string(Board const   *board , char *epd___0 ) ;
#line 33
char SAN_piece_letter(Piece piece ) ;
#line 34
char const   *piece_str(Piece piece ) ;
#line 35
void build_FEN_string(Board const   *board , char *fen___0 ) ;
#line 36
CommentList *create_match_comment(Move *move_details ) ;
#line 41 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.h"
EcoLog *eco_matches(HashCode current_hash_value , HashCode cumulative_hash_value ,
                    unsigned int half_moves_played___0 ) ;
#line 28 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.h"
Boolean is_col(char c ) ;
#line 29
Boolean is_rank(char c ) ;
#line 24 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.h"
char const   *matchBoard(Board const   *board ) ;
#line 50 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Boolean position_matches(Board const   *board ) ;
#line 51
static Boolean play_moves(Game *game_details , Board *board , Move *moves , unsigned int max_depth ,
                          Boolean check_move_validity ) ;
#line 53
static Boolean apply_variations(Game const   *game_details , Board const   *board ,
                                Variation *variation , Boolean check_move_validity ) ;
#line 55
static Boolean rewrite_variations(Board const   *board , Variation *variation , Boolean null_move_found ) ;
#line 56
static Boolean rewrite_moves(Board *board , Move *moves , Boolean null_move_found ) ;
#line 57
static void append_evaluation(Move *move_details , Board const   *board ) ;
#line 58
static void append_FEN_comment(Move *move_details , Board const   *board ) ;
#line 59
static double evaluate(Board const   *board ) ;
#line 60
static double shannonEvaluation(Board const   *board ) ;
#line 66 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static char SAN_piece_characters[8]  = 
#line 66
  {      (char )'?',      (char )'?',      (char )'P',      (char )'N', 
        (char )'B',      (char )'R',      (char )'Q',      (char )'K'};
#line 76 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static char const   *output_piece_characters[8]  = 
#line 76
  {      "?",      "?",      "P",      "N", 
        "B",      "R",      "Q",      "K"};
#line 99 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static char double_char_piece[3]  = {      (char )'X',      (char )'Y',      (char )'\000'};
#line 117 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static char single_char_piece[2]  = {      (char )'X',      (char )'\000'};
#line 82 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
void set_output_piece_characters(char const   *letters ) 
{ 
  Piece piece ;
  int piece_index ;
  char *tmp ;
  char *tmp___0 ;

  {
#line 84
  if ((unsigned long )letters == (unsigned long )((void *)0)) {
    {
#line 85
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"NULL string passed to set_output_piece_characters.\n");
    }
  } else {
#line 91
    piece_index = 0;
#line 91
    piece = (Piece )2;
    {
#line 91
    while (1) {
      while_continue: /* CIL Label */ ;
#line 91
      if ((unsigned int )piece <= 7U) {
#line 91
        if (! ((int const   )*(letters + piece_index) != 0)) {
#line 91
          goto while_break;
        }
      } else {
#line 91
        goto while_break;
      }
#line 97
      if ((int const   )*(letters + (piece_index + 1)) == 43) {
#line 100
        double_char_piece[0] = (char )*(letters + piece_index);
#line 101
        piece_index ++;
#line 103
        piece_index ++;
#line 104
        if ((int const   )*(letters + piece_index) != 0) {
          {
#line 105
          double_char_piece[1] = (char )*(letters + piece_index);
#line 106
          tmp = StringCopy((char const   *)(double_char_piece));
#line 106
          output_piece_characters[piece] = (char const   *)tmp;
#line 107
          piece_index ++;
          }
        } else {
          {
#line 110
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Missing piece letter following + in -Wsan%s.\n",
                  letters);
#line 113
          exit(1);
          }
        }
      } else {
        {
#line 118
        single_char_piece[0] = (char )*(letters + piece_index);
#line 119
        tmp___0 = StringCopy((char const   *)(single_char_piece));
#line 119
        output_piece_characters[piece] = (char const   *)tmp___0;
#line 120
        piece_index ++;
        }
      }
#line 91
      piece = (Piece )((unsigned int )piece + 1U);
    }
    while_break: /* CIL Label */ ;
    }
#line 123
    if ((unsigned int )piece < 8U) {
      {
#line 124
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Insufficient piece letters found with -Wsan%s.\n",
              letters);
#line 127
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"The argument should be of the form -Wsan%s.\n",
              "PNBRQK");
#line 130
      exit(1);
      }
    } else
#line 132
    if ((int const   )*(letters + piece_index) != 0) {
      {
#line 133
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Too many piece letters found with -Wsan%s.\n",
              letters);
#line 136
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"The argument should be of the form -Wsan%s.\n",
              "PNBRQK");
#line 139
      exit(1);
      }
    }
  }
#line 145
  return;
}
}
#line 147 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
char *StringCopy(char const   *str ) 
{ 
  char *result ;
  size_t len ;
  size_t tmp ;
  void *tmp___0 ;

  {
  {
#line 150
  tmp = strlen(str);
#line 150
  len = tmp;
#line 152
  tmp___0 = MallocOrDie(len + 1UL);
#line 152
  result = (char *)tmp___0;
#line 153
  strcpy((char */* __restrict  */)result, (char const   */* __restrict  */)str);
  }
#line 154
  return (result);
}
}
#line 158 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Board *allocate_new_board(void) 
{ 
  void *tmp ;

  {
  {
#line 161
  tmp = MallocOrDie(sizeof(Board ));
  }
#line 161
  return ((Board *)tmp);
}
}
#line 165 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static void free_board(Board *board ) 
{ 


  {
  {
#line 168
  free((void *)board);
  }
#line 169
  return;
}
}
#line 171 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Piece is_FEN_piece(char c ) 
{ 
  Piece piece ;

  {
#line 173
  piece = (Piece )1;
  {
#line 176
  if ((int )c == 107) {
#line 176
    goto case_107;
  }
#line 176
  if ((int )c == 75) {
#line 176
    goto case_107;
  }
#line 179
  if ((int )c == 113) {
#line 179
    goto case_113;
  }
#line 179
  if ((int )c == 81) {
#line 179
    goto case_113;
  }
#line 182
  if ((int )c == 114) {
#line 182
    goto case_114;
  }
#line 182
  if ((int )c == 82) {
#line 182
    goto case_114;
  }
#line 185
  if ((int )c == 110) {
#line 185
    goto case_110;
  }
#line 185
  if ((int )c == 78) {
#line 185
    goto case_110;
  }
#line 188
  if ((int )c == 98) {
#line 188
    goto case_98;
  }
#line 188
  if ((int )c == 66) {
#line 188
    goto case_98;
  }
#line 191
  if ((int )c == 112) {
#line 191
    goto case_112;
  }
#line 191
  if ((int )c == 80) {
#line 191
    goto case_112;
  }
#line 175
  goto switch_break;
  case_107: /* CIL Label */ 
  case_75: /* CIL Label */ 
#line 177
  piece = (Piece )7;
#line 178
  goto switch_break;
  case_113: /* CIL Label */ 
  case_81: /* CIL Label */ 
#line 180
  piece = (Piece )6;
#line 181
  goto switch_break;
  case_114: /* CIL Label */ 
  case_82: /* CIL Label */ 
#line 183
  piece = (Piece )5;
#line 184
  goto switch_break;
  case_110: /* CIL Label */ 
  case_78: /* CIL Label */ 
#line 186
  piece = (Piece )3;
#line 187
  goto switch_break;
  case_98: /* CIL Label */ 
  case_66: /* CIL Label */ 
#line 189
  piece = (Piece )4;
#line 190
  goto switch_break;
  case_112: /* CIL Label */ 
  case_80: /* CIL Label */ 
#line 192
  piece = (Piece )2;
#line 193
  goto switch_break;
  switch_break: /* CIL Label */ ;
  }
#line 195
  return (piece);
}
}
#line 199 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
char SAN_piece_letter(Piece piece ) 
{ 


  {
#line 202
  if ((unsigned int )piece >= 0U) {
#line 202
    if ((unsigned int )piece < 8U) {
#line 203
      return (SAN_piece_characters[piece]);
    } else {
#line 206
      return ((char )'?');
    }
  } else {
#line 206
    return ((char )'?');
  }
}
}
#line 211 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
char coloured_piece_to_SAN_letter(Piece coloured_piece ) 
{ 
  Piece piece ;
  char letter ;
  char tmp ;
  int tmp___0 ;

  {
  {
#line 213
  piece = (Piece )((unsigned int )coloured_piece >> 3);
#line 214
  tmp = SAN_piece_letter(piece);
#line 214
  letter = tmp;
  }
#line 215
  if (((unsigned int )coloured_piece & 1U) == 0U) {
    {
#line 216
    tmp___0 = tolower((int )letter);
#line 216
    letter = (char )tmp___0;
    }
  }
#line 218
  return (letter);
}
}
#line 235 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static struct __anonstruct_Board_30  const  initial_board  = 
#line 235
     {{{(Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0,
      (Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0}, {(Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0},
     {(Piece )0, (Piece )0, (Piece )1, (Piece )1, (Piece )1, (Piece )1, (Piece )1,
      (Piece )1, (Piece )1, (Piece )1, (Piece )0, (Piece )0}, {(Piece )0, (Piece )0,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )0, (Piece )0},
     {(Piece )0, (Piece )0, (Piece )1, (Piece )1, (Piece )1, (Piece )1, (Piece )1,
      (Piece )1, (Piece )1, (Piece )1, (Piece )0, (Piece )0}, {(Piece )0, (Piece )0,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )0, (Piece )0},
     {(Piece )0, (Piece )0, (Piece )1, (Piece )1, (Piece )1, (Piece )1, (Piece )1,
      (Piece )1, (Piece )1, (Piece )1, (Piece )0, (Piece )0}, {(Piece )0, (Piece )0,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )0, (Piece )0},
     {(Piece )0, (Piece )0, (Piece )1, (Piece )1, (Piece )1, (Piece )1, (Piece )1,
      (Piece )1, (Piece )1, (Piece )1, (Piece )0, (Piece )0}, {(Piece )0, (Piece )0,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )0, (Piece )0},
     {(Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0,
      (Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0}, {(Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0}},
    (Colour )1, 1U, (Boolean )0, (Boolean )0, (Boolean )0, (Boolean )0, (Col )'e',
    (Rank )'1', (Col )'e', (Rank )56, (Boolean )0, (Rank )0, (Col )0, 0UL, 0U};
#line 231 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
Board *new_fen_board(char const   *fen___0 ) 
{ 
  Board *new_board ;
  Board *tmp ;
  Rank rank ;
  Col col ;
  char const   *fen_char ;
  Boolean Ok ;
  Boolean try_to_parse_game ;
  Piece piece ;
  char ch ;
  Colour colour ;
  unsigned short const   **tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  unsigned short const   **tmp___3 ;
  Boolean tmp___4 ;
  Boolean tmp___5 ;
  Boolean tmp___6 ;
  Boolean tmp___7 ;
  Boolean tmp___8 ;
  unsigned int halfmove_clock ;
  unsigned short const   **tmp___9 ;
  unsigned short const   **tmp___10 ;
  unsigned int move_number ;
  unsigned short const   **tmp___11 ;
  unsigned short const   **tmp___12 ;
  unsigned short const   **tmp___13 ;

  {
  {
#line 233
  tmp = allocate_new_board();
#line 233
  new_board = tmp;
#line 265
  rank = (Rank )56;
#line 267
  fen_char = fen___0;
#line 268
  Ok = (Boolean )1;
#line 272
  try_to_parse_game = (Boolean )0;
#line 275
  *new_board = (Board )initial_board;
#line 277
  col = (Col )'a';
  }
  {
#line 278
  while (1) {
    while_continue: /* CIL Label */ ;
#line 278
    if (Ok) {
#line 278
      if ((int const   )*fen_char != 32) {
#line 278
        if ((int const   )*fen_char != 0) {
#line 278
          if (! ((int )rank >= 49)) {
#line 278
            goto while_break;
          }
        } else {
#line 278
          goto while_break;
        }
      } else {
#line 278
        goto while_break;
      }
    } else {
#line 278
      goto while_break;
    }
    {
#line 281
    ch = (char )*fen_char;
#line 284
    piece = is_FEN_piece(ch);
    }
#line 284
    if ((unsigned int )piece != 1U) {
      {
#line 285
      tmp___0 = __ctype_b_loc();
      }
#line 285
      if ((int const   )*(*tmp___0 + (int )ch) & 256) {
#line 286
        colour = (Colour )1;
      } else {
#line 289
        colour = (Colour )0;
      }
#line 291
      if ((int )col <= 104) {
#line 292
        if (49 <= (int )rank) {
#line 292
          if ((int )rank <= 56) {
#line 292
            tmp___1 = ((int )rank - 49) + 2;
          } else {
#line 292
            tmp___1 = 0;
          }
        } else {
#line 292
          tmp___1 = 0;
        }
#line 292
        if (97 <= (int )col) {
#line 292
          if ((int )col <= 104) {
#line 292
            tmp___2 = ((int )col - 97) + 2;
          } else {
#line 292
            tmp___2 = 0;
          }
        } else {
#line 292
          tmp___2 = 0;
        }
#line 292
        new_board->board[tmp___1][tmp___2] = (Piece )(((unsigned int )piece << 3) | (unsigned int )colour);
#line 294
        if ((unsigned int )piece == 7U) {
#line 295
          if ((unsigned int )colour == 1U) {
#line 296
            new_board->WKingCol = col;
#line 297
            new_board->WKingRank = rank;
          } else {
#line 300
            new_board->BKingCol = col;
#line 301
            new_board->BKingRank = rank;
          }
        }
#line 304
        col = (Col )((int )col + 1);
#line 305
        fen_char ++;
      } else {
#line 308
        Ok = (Boolean )0;
      }
    } else {
      {
#line 311
      tmp___3 = __ctype_b_loc();
      }
#line 311
      if ((int const   )*(*tmp___3 + (int )ch) & 2048) {
#line 312
        if (49 <= (int )ch) {
#line 312
          if ((int )ch <= 56) {
#line 313
            col = (Col )((int )col + ((int )ch - 48));
#line 318
            if ((int )col <= 105) {
#line 319
              fen_char ++;
            } else {
#line 322
              Ok = (Boolean )0;
            }
          } else {
#line 326
            Ok = (Boolean )0;
          }
        } else {
#line 326
          Ok = (Boolean )0;
        }
      } else
#line 329
      if ((int )ch == 47) {
#line 333
        if ((int )col == 105) {
#line 334
          col = (Col )'a';
#line 335
          rank = (Rank )((int )rank - 1);
#line 336
          fen_char ++;
        } else {
#line 339
          Ok = (Boolean )0;
        }
      } else {
#line 344
        Ok = (Boolean )0;
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 350
  if ((int const   )*fen_char == 32) {
#line 352
    fen_char ++;
  } else {
#line 355
    Ok = (Boolean )0;
  }
#line 357
  if ((int const   )*fen_char == 119) {
#line 358
    new_board->to_move = (Colour )1;
#line 359
    fen_char ++;
  } else
#line 361
  if ((int const   )*fen_char == 98) {
#line 362
    new_board->to_move = (Colour )0;
#line 363
    fen_char ++;
  } else {
#line 366
    Ok = (Boolean )0;
  }
#line 368
  if ((int const   )*fen_char == 32) {
#line 369
    fen_char ++;
  } else {
#line 372
    Ok = (Boolean )0;
  }
#line 375
  if ((int const   )*fen_char == 45) {
#line 377
    tmp___6 = (Boolean )0;
#line 377
    new_board->BQueenCastle = tmp___6;
#line 377
    tmp___5 = tmp___6;
#line 377
    new_board->BKingCastle = tmp___5;
#line 377
    tmp___4 = tmp___5;
#line 377
    new_board->WQueenCastle = tmp___4;
#line 377
    new_board->WKingCastle = tmp___4;
#line 379
    fen_char ++;
  } else {
#line 383
    if ((int const   )*fen_char == 32) {
#line 384
      Ok = (Boolean )0;
    }
#line 386
    if ((int const   )*fen_char == 75) {
#line 387
      new_board->WKingCastle = (Boolean )1;
#line 388
      fen_char ++;
    }
#line 390
    if ((int const   )*fen_char == 81) {
#line 391
      new_board->WQueenCastle = (Boolean )1;
#line 392
      fen_char ++;
    }
#line 394
    if ((int const   )*fen_char == 107) {
#line 395
      new_board->BKingCastle = (Boolean )1;
#line 396
      fen_char ++;
    }
#line 398
    if ((int const   )*fen_char == 113) {
#line 399
      new_board->BQueenCastle = (Boolean )1;
#line 400
      fen_char ++;
    }
  }
#line 403
  if ((int const   )*fen_char == 32) {
#line 404
    fen_char ++;
  } else {
#line 407
    Ok = (Boolean )0;
  }
#line 412
  if (Ok) {
#line 413
    try_to_parse_game = (Boolean )1;
  }
#line 416
  if ((int const   )*fen_char == 45) {
#line 418
    fen_char ++;
  } else {
    {
#line 420
    tmp___8 = is_col((char )*fen_char);
    }
#line 420
    if (tmp___8) {
      {
#line 421
      col = (Col )*fen_char;
#line 422
      fen_char ++;
#line 423
      tmp___7 = is_rank((char )*fen_char);
      }
#line 423
      if (tmp___7) {
#line 424
        rank = (Rank )*fen_char;
#line 425
        fen_char ++;
#line 429
        if ((unsigned int )new_board->to_move == 1U) {
#line 429
          if ((int )rank == 54) {
#line 432
            new_board->EnPassant = (Boolean )1;
#line 433
            new_board->ep_rank = rank;
#line 434
            new_board->ep_col = col;
          } else {
#line 429
            goto _L;
          }
        } else
        _L: /* CIL Label */ 
#line 429
        if ((unsigned int )new_board->to_move == 0U) {
#line 429
          if ((int )rank == 51) {
#line 432
            new_board->EnPassant = (Boolean )1;
#line 433
            new_board->ep_rank = rank;
#line 434
            new_board->ep_col = col;
          } else {
#line 437
            Ok = (Boolean )0;
          }
        } else {
#line 437
          Ok = (Boolean )0;
        }
      } else {
#line 441
        Ok = (Boolean )0;
      }
    } else {
#line 445
      Ok = (Boolean )0;
    }
  }
#line 447
  if ((int const   )*fen_char == 32) {
#line 448
    fen_char ++;
  } else {
#line 451
    Ok = (Boolean )0;
  }
  {
#line 456
  tmp___10 = __ctype_b_loc();
  }
#line 456
  if ((int const   )*(*tmp___10 + (int )*fen_char) & 2048) {
#line 457
    halfmove_clock = (unsigned int )((int const   )*fen_char - 48);
#line 458
    fen_char ++;
    {
#line 459
    while (1) {
      while_continue___0: /* CIL Label */ ;
      {
#line 459
      tmp___9 = __ctype_b_loc();
      }
#line 459
      if (! ((int const   )*(*tmp___9 + (int )*fen_char) & 2048)) {
#line 459
        goto while_break___0;
      }
#line 460
      halfmove_clock = halfmove_clock * 10U + (unsigned int )((int const   )*fen_char - 48);
#line 461
      fen_char ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 463
    new_board->halfmove_clock = halfmove_clock;
  } else {
#line 466
    Ok = (Boolean )0;
  }
#line 468
  if ((int const   )*fen_char == 32) {
#line 469
    fen_char ++;
  } else {
#line 472
    Ok = (Boolean )0;
  }
  {
#line 475
  tmp___12 = __ctype_b_loc();
  }
#line 475
  if ((int const   )*(*tmp___12 + (int )*fen_char) & 2048) {
#line 476
    move_number = 0U;
#line 478
    move_number = (unsigned int )((int const   )*fen_char - 48);
#line 479
    fen_char ++;
    {
#line 480
    while (1) {
      while_continue___1: /* CIL Label */ ;
      {
#line 480
      tmp___11 = __ctype_b_loc();
      }
#line 480
      if (! ((int const   )*(*tmp___11 + (int )*fen_char) & 2048)) {
#line 480
        goto while_break___1;
      }
#line 481
      move_number = move_number * 10U + (unsigned int )((int const   )*fen_char - 48);
#line 482
      fen_char ++;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 484
    if (move_number < 1U) {
#line 485
      move_number = 1U;
    }
#line 487
    new_board->move_number = move_number;
  } else {
#line 490
    Ok = (Boolean )0;
  }
  {
#line 493
  while (1) {
    while_continue___2: /* CIL Label */ ;
    {
#line 493
    tmp___13 = __ctype_b_loc();
    }
#line 493
    if (! ((int const   )*(*tmp___13 + (int )*fen_char) & 8192)) {
#line 493
      goto while_break___2;
    }
#line 494
    fen_char ++;
  }
  while_break___2: /* CIL Label */ ;
  }
#line 496
  if ((int const   )*fen_char != 0) {
#line 497
    Ok = (Boolean )0;
  }
#line 499
  if (! Ok) {
    {
#line 502
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Illegal FEN string %s at %s",
            fen___0, fen_char);
    }
#line 503
    if (try_to_parse_game) {
      {
#line 504
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)" Attempting to parse the game, anyway.");
      }
    } else {
      {
#line 507
      free_board((Board *)((void *)new_board));
#line 508
      new_board = (Board *)((void *)0);
      }
    }
    {
#line 510
    _IO_putc('\n', GlobalState.logfile);
    }
  }
#line 512
  return (new_board);
}
}
#line 525
static Board *new_game_board(char const   *fen___0 ) ;
#line 525 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static struct __anonstruct_Board_30  const  initial_board___0  = 
#line 525
     {{{(Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0,
      (Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0}, {(Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0,
                                                               (Piece )0, (Piece )0},
     {(Piece )0, (Piece )0, (Piece )((5 << 3) | 1), (Piece )((3 << 3) | 1), (Piece )((4 << 3) | 1),
      (Piece )((6 << 3) | 1), (Piece )((7 << 3) | 1), (Piece )((4 << 3) | 1), (Piece )((3 << 3) | 1),
      (Piece )((5 << 3) | 1), (Piece )0, (Piece )0}, {(Piece )0, (Piece )0, (Piece )((2 << 3) | 1),
                                                      (Piece )((2 << 3) | 1), (Piece )((2 << 3) | 1),
                                                      (Piece )((2 << 3) | 1), (Piece )((2 << 3) | 1),
                                                      (Piece )((2 << 3) | 1), (Piece )((2 << 3) | 1),
                                                      (Piece )((2 << 3) | 1), (Piece )0,
                                                      (Piece )0}, {(Piece )0, (Piece )0,
                                                                   (Piece )1, (Piece )1,
                                                                   (Piece )1, (Piece )1,
                                                                   (Piece )1, (Piece )1,
                                                                   (Piece )1, (Piece )1,
                                                                   (Piece )0, (Piece )0},
     {(Piece )0, (Piece )0, (Piece )1, (Piece )1, (Piece )1, (Piece )1, (Piece )1,
      (Piece )1, (Piece )1, (Piece )1, (Piece )0, (Piece )0}, {(Piece )0, (Piece )0,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )1, (Piece )1,
                                                               (Piece )0, (Piece )0},
     {(Piece )0, (Piece )0, (Piece )1, (Piece )1, (Piece )1, (Piece )1, (Piece )1,
      (Piece )1, (Piece )1, (Piece )1, (Piece )0, (Piece )0}, {(Piece )0, (Piece )0,
                                                               (Piece )(2 << 3), (Piece )(2 << 3),
                                                               (Piece )(2 << 3), (Piece )(2 << 3),
                                                               (Piece )(2 << 3), (Piece )(2 << 3),
                                                               (Piece )(2 << 3), (Piece )(2 << 3),
                                                               (Piece )0, (Piece )0},
     {(Piece )0, (Piece )0, (Piece )(5 << 3), (Piece )(3 << 3), (Piece )(4 << 3),
      (Piece )(6 << 3), (Piece )(7 << 3), (Piece )(4 << 3), (Piece )(3 << 3), (Piece )(5 << 3),
      (Piece )0, (Piece )0}, {(Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0,
                              (Piece )0, (Piece )0, (Piece )0, (Piece )0, (Piece )0,
                              (Piece )0, (Piece )0}, {(Piece )0, (Piece )0, (Piece )0,
                                                      (Piece )0, (Piece )0, (Piece )0,
                                                      (Piece )0, (Piece )0, (Piece )0,
                                                      (Piece )0, (Piece )0, (Piece )0}},
    (Colour )1, 1U, (Boolean )1, (Boolean )1, (Boolean )1, (Boolean )1, (Col )'e',
    (Rank )'1', (Col )'e', (Rank )56, (Boolean )0, (Rank )0, (Col )0, 0UL, 0U};
#line 522 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Board *new_game_board(char const   *fen___0 ) 
{ 
  Board *new_board ;
  Col col ;
  Rank rank ;
  Piece coloured_piece ;
  int tmp ;
  int tmp___0 ;
  Piece piece ;
  Colour colour ;
  HashCode tmp___1 ;

  {
#line 563
  if ((unsigned long )fen___0 != (unsigned long )((void *)0)) {
    {
#line 564
    new_board = new_fen_board(fen___0);
    }
  }
#line 569
  if ((unsigned long )fen___0 == (unsigned long )((void *)0)) {
    {
#line 571
    new_board = allocate_new_board();
#line 572
    *new_board = (Board )initial_board___0;
    }
  } else
#line 569
  if ((unsigned long )new_board == (unsigned long )((void *)0)) {
    {
#line 571
    new_board = allocate_new_board();
#line 572
    *new_board = (Board )initial_board___0;
    }
  }
#line 576
  col = (Col )'a';
  {
#line 576
  while (1) {
    while_continue: /* CIL Label */ ;
#line 576
    if (! ((int )col <= 104)) {
#line 576
      goto while_break;
    }
#line 579
    rank = (Rank )'1';
    {
#line 579
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 579
      if (! ((int )rank <= 56)) {
#line 579
        goto while_break___0;
      }
#line 581
      if (49 <= (int )rank) {
#line 581
        if ((int )rank <= 56) {
#line 581
          tmp = ((int )rank - 49) + 2;
        } else {
#line 581
          tmp = 0;
        }
      } else {
#line 581
        tmp = 0;
      }
#line 581
      if (97 <= (int )col) {
#line 581
        if ((int )col <= 104) {
#line 581
          tmp___0 = ((int )col - 97) + 2;
        } else {
#line 581
          tmp___0 = 0;
        }
      } else {
#line 581
        tmp___0 = 0;
      }
#line 581
      coloured_piece = new_board->board[tmp][tmp___0];
#line 583
      piece = (Piece )((unsigned int )coloured_piece >> 3);
#line 584
      colour = (Colour )((unsigned int )coloured_piece & 1U);
#line 586
      if ((unsigned int )coloured_piece != 1U) {
        {
#line 587
        tmp___1 = HashLookup(col, rank, piece, colour);
#line 587
        new_board->hash_value ^= tmp___1;
        }
      }
#line 579
      rank = (Rank )((int )rank + 1);
    }
    while_break___0: /* CIL Label */ ;
    }
#line 576
    col = (Col )((int )col + 1);
  }
  while_break: /* CIL Label */ ;
  }
#line 592
  return (new_board);
}
}
#line 596 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static void print_square(Col col , Rank rank , Board const   *board , FILE *outfp ) 
{ 
  short r ;
  int tmp ;
  short c ;
  int tmp___0 ;
  Piece coloured_piece ;
  char tmp___1 ;

  {
#line 598
  if (49 <= (int )rank) {
#line 598
    if ((int )rank <= 56) {
#line 598
      tmp = ((int )rank - 49) + 2;
    } else {
#line 598
      tmp = 0;
    }
  } else {
#line 598
    tmp = 0;
  }
#line 598
  r = (short )tmp;
#line 599
  if (97 <= (int )col) {
#line 599
    if ((int )col <= 104) {
#line 599
      tmp___0 = ((int )col - 97) + 2;
    } else {
#line 599
      tmp___0 = 0;
    }
  } else {
#line 599
    tmp___0 = 0;
  }
#line 599
  c = (short )tmp___0;
#line 601
  coloured_piece = board->board[r][c];
  {
#line 614
  if ((int )coloured_piece == 7 << 3) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == 6 << 3) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == 5 << 3) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == 4 << 3) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == 3 << 3) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == 2 << 3) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == ((7 << 3) | 1)) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == ((6 << 3) | 1)) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == ((5 << 3) | 1)) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == ((4 << 3) | 1)) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == ((3 << 3) | 1)) {
#line 614
    goto case_exp;
  }
#line 614
  if ((int )coloured_piece == ((2 << 3) | 1)) {
#line 614
    goto case_exp;
  }
#line 617
  if ((int )coloured_piece == 1) {
#line 617
    goto case_1;
  }
#line 620
  if ((int )coloured_piece == 0) {
#line 620
    goto case_0;
  }
#line 623
  goto switch_default;
  case_exp: /* CIL Label */ 
  case_exp___0: /* CIL Label */ 
  case_exp___1: /* CIL Label */ 
  case_exp___2: /* CIL Label */ 
  case_exp___3: /* CIL Label */ 
  case_exp___4: /* CIL Label */ 
  case_exp___5: /* CIL Label */ 
  case_exp___6: /* CIL Label */ 
  case_exp___7: /* CIL Label */ 
  case_exp___8: /* CIL Label */ 
  case_exp___9: /* CIL Label */ 
  case_exp___10: /* CIL Label */ 
  {
#line 615
  tmp___1 = coloured_piece_to_SAN_letter(coloured_piece);
#line 615
  _IO_putc((int )tmp___1, outfp);
  }
#line 616
  goto switch_break;
  case_1: /* CIL Label */ 
  {
#line 618
  _IO_putc('.', outfp);
  }
#line 619
  goto switch_break;
  case_0: /* CIL Label */ 
  {
#line 621
  _IO_putc('?', outfp);
  }
#line 622
  goto switch_break;
  switch_default: /* CIL Label */ 
  {
#line 624
  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Attempt to print illegal square %c%c in print_square.\n",
          (int )col, (int )rank);
  }
#line 627
  goto switch_break;
  switch_break: /* CIL Label */ ;
  }
#line 629
  return;
}
}
#line 632 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static void print_board(Board const   *board , FILE *outfp ) 
{ 
  Rank rank ;
  Col col ;

  {
#line 637
  rank = (Rank )56;
  {
#line 637
  while (1) {
    while_continue: /* CIL Label */ ;
#line 637
    if (! ((int )rank >= 49)) {
#line 637
      goto while_break;
    }
#line 638
    col = (Col )'a';
    {
#line 638
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 638
      if (! ((int )col <= 104)) {
#line 638
        goto while_break___0;
      }
      {
#line 639
      print_square(col, rank, board, outfp);
#line 638
      col = (Col )((int )col + 1);
      }
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 641
    _IO_putc('\n', outfp);
#line 637
    rank = (Rank )((int )rank - 1);
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 643
  _IO_putc('\n', outfp);
  }
#line 644
  return;
}
}
#line 690 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static int half_moves_played(Board const   *board ) 
{ 
  int half_moves ;

  {
#line 693
  half_moves = (int )(2U * (board->move_number - 1U));
#line 694
  if ((unsigned int const   )board->to_move == 0U) {
#line 695
    half_moves ++;
  }
#line 697
  return (half_moves);
}
}
#line 705 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Boolean apply_move(Colour colour , Move *move_details , Board *board ) 
{ 
  Boolean Ok ;
  Piece piece_to_move ;
  void *tmp ;
  Boolean tmp___0 ;
  Boolean tmp___1 ;

  {
  {
#line 708
  Ok = (Boolean )1;
#line 710
  tmp___1 = determine_move_details(colour, move_details, board);
  }
#line 710
  if (tmp___1) {
#line 711
    piece_to_move = move_details->piece_to_move;
#line 713
    if ((unsigned int )GlobalState.output_format == 2U) {
      {
#line 714
      tmp = MallocOrDie((size_t )100);
#line 714
      move_details->epd = (char *)tmp;
#line 715
      build_basic_EPD_string((Board const   *)board, move_details->epd);
      }
    }
#line 718
    if ((unsigned int )move_details->class != 6U) {
      {
#line 719
      make_move(move_details->from_col, move_details->from_rank, move_details->to_col,
                move_details->to_rank, piece_to_move, colour, board);
      }
    }
    {
#line 727
    if ((unsigned int )move_details->class == 2U) {
#line 727
      goto case_2;
    }
#line 727
    if ((unsigned int )move_details->class == 3U) {
#line 727
      goto case_2;
    }
#line 727
    if ((unsigned int )move_details->class == 0U) {
#line 727
      goto case_2;
    }
#line 730
    if ((unsigned int )move_details->class == 1U) {
#line 730
      goto case_1;
    }
#line 743
    if ((unsigned int )move_details->class == 4U) {
#line 743
      goto case_4;
    }
#line 750
    if ((unsigned int )move_details->class == 5U) {
#line 750
      goto case_5;
    }
#line 757
    if ((unsigned int )move_details->class == 6U) {
#line 757
      goto case_6;
    }
#line 761
    goto switch_default;
    case_2: /* CIL Label */ 
    case_3: /* CIL Label */ 
    case_0: /* CIL Label */ 
#line 729
    goto switch_break;
    case_1: /* CIL Label */ 
#line 731
    if ((unsigned int )move_details->class == 1U) {
#line 732
      if ((unsigned int )move_details->promoted_piece != 1U) {
        {
#line 734
        make_move(move_details->to_col, move_details->to_rank, move_details->to_col,
                  move_details->to_rank, move_details->promoted_piece, colour, board);
        }
      } else {
#line 739
        Ok = (Boolean )0;
      }
    }
#line 742
    goto switch_break;
    case_4: /* CIL Label */ 
    {
#line 745
    piece_to_move = (Piece )5;
#line 746
    make_move((Col )104, move_details->from_rank, (Col )((int )move_details->to_col - 1),
              move_details->to_rank, piece_to_move, colour, board);
    }
#line 749
    goto switch_break;
    case_5: /* CIL Label */ 
    {
#line 752
    piece_to_move = (Piece )5;
#line 753
    make_move((Col )'a', move_details->from_rank, (Col )((int )move_details->to_col + 1),
              move_details->to_rank, piece_to_move, colour, board);
    }
#line 756
    goto switch_break;
    case_6: /* CIL Label */ 
#line 759
    goto switch_break;
    switch_default: /* CIL Label */ 
#line 762
    Ok = (Boolean )0;
#line 763
    goto switch_break;
    switch_break: /* CIL Label */ ;
    }
#line 766
    if (Ok) {
      {
#line 767
      move_details->check_status = king_is_in_check((Board const   *)board, (Colour )(! colour));
      }
#line 769
      if ((unsigned int )move_details->check_status == 1U) {
        {
#line 771
        tmp___0 = king_is_in_checkmate((Colour )(! colour), board);
        }
#line 771
        if (tmp___0) {
#line 772
          move_details->check_status = (CheckStatus )2;
        }
      }
#line 776
      if ((unsigned int )piece_to_move == 2U) {
#line 778
        board->halfmove_clock = 0U;
      } else
#line 776
      if ((unsigned int )move_details->captured_piece != 1U) {
#line 778
        board->halfmove_clock = 0U;
      } else {
#line 781
        (board->halfmove_clock) ++;
      }
    }
  } else {
#line 786
    Ok = (Boolean )0;
  }
#line 788
  return (Ok);
}
}
#line 797 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Boolean play_moves(Game *game_details , Board *board , Move *moves , unsigned int max_depth ,
                          Boolean check_move_validity ) 
{ 
  Boolean game_ok ;
  Boolean game_matches ;
  int tmp ;
  Move *next_move ;
  EcoLog *eco_match ;
  CommentList *comment ;
  CommentList *tmp___0 ;
  Boolean tmp___1 ;
  Boolean tmp___2 ;
  CommentList *comment___0 ;
  CommentList *tmp___3 ;
  Boolean tmp___4 ;
  int plies ;
  int half_moves ;
  int tmp___5 ;
  EcoLog *entry ;
  EcoLog *tmp___6 ;
  char const   *tmp___7 ;
  Boolean tmp___8 ;

  {
#line 800
  game_ok = (Boolean )1;
#line 802
  if (GlobalState.positional_variations) {
#line 802
    tmp = 0;
  } else {
#line 802
    tmp = 1;
  }
#line 802
  game_matches = (Boolean )tmp;
#line 803
  next_move = moves;
#line 805
  eco_match = (EcoLog *)((void *)0);
#line 812
  if (! game_matches) {
    {
#line 812
    tmp___1 = position_matches((Board const   *)board);
    }
#line 812
    if (tmp___1) {
#line 813
      game_matches = (Boolean )1;
#line 814
      if (GlobalState.add_position_match_comments) {
        {
#line 815
        tmp___0 = create_match_comment(next_move);
#line 815
        comment = tmp___0;
#line 816
        comment->next = game_details->prefix_comment;
#line 817
        game_details->prefix_comment = comment;
        }
      }
    }
  }
  {
#line 824
  while (1) {
    while_continue: /* CIL Label */ ;
#line 824
    if (game_ok) {
#line 824
      if ((unsigned long )next_move != (unsigned long )((void *)0)) {
#line 824
        if (! game_matches) {
#line 824
          if (! (board->move_number <= max_depth)) {
#line 824
            goto while_break;
          }
        }
      } else {
#line 824
        goto while_break;
      }
    } else {
#line 824
      goto while_break;
    }
#line 826
    if ((int )next_move->move[0] != 0) {
#line 828
      if ((unsigned long )next_move->Variants != (unsigned long )((void *)0)) {
#line 828
        if (GlobalState.keep_variations) {
          {
#line 829
          tmp___2 = apply_variations((Game const   *)game_details, (Board const   *)board,
                                     next_move->Variants, check_move_validity);
#line 829
          game_matches = (Boolean )((unsigned int )game_matches | (unsigned int )tmp___2);
          }
        }
      }
#line 842
      if (check_move_validity) {
        {
#line 843
        tmp___8 = apply_move(board->to_move, next_move, board);
        }
#line 843
        if (tmp___8) {
#line 845
          if (! game_matches) {
            {
#line 845
            tmp___4 = position_matches((Board const   *)board);
            }
#line 845
            if (tmp___4) {
#line 846
              game_matches = (Boolean )1;
#line 847
              if (GlobalState.add_position_match_comments) {
                {
#line 848
                tmp___3 = create_match_comment(next_move);
#line 848
                comment___0 = tmp___3;
#line 849
                append_comments_to_move(next_move, comment___0);
                }
              }
            }
          }
#line 853
          game_details->cumulative_hash_value += board->hash_value;
#line 854
          if (GlobalState.fuzzy_match_duplicates) {
#line 855
            plies = (int )(2U * board->move_number - 1U);
#line 857
            if ((unsigned int )board->to_move == 0U) {
#line 858
              plies ++;
            }
#line 861
            if (GlobalState.fuzzy_match_depth == plies) {
#line 863
              game_details->fuzzy_duplicate_hash = board->hash_value;
            }
          }
#line 866
          board->to_move = (Colour )(! board->to_move);
#line 867
          if ((unsigned int )board->to_move == 1U) {
#line 868
            (board->move_number) ++;
          }
#line 870
          if (GlobalState.add_ECO) {
#line 870
            if (! GlobalState.parsing_ECO_file) {
              {
#line 871
              tmp___5 = half_moves_played((Board const   *)board);
#line 871
              half_moves = tmp___5;
#line 872
              tmp___6 = eco_matches(board->hash_value, game_details->cumulative_hash_value,
                                    (unsigned int )half_moves);
#line 872
              entry = tmp___6;
              }
#line 876
              if ((unsigned long )entry != (unsigned long )((void *)0)) {
#line 886
                if ((unsigned long )eco_match == (unsigned long )((void *)0)) {
#line 888
                  eco_match = entry;
                } else {
#line 898
                  eco_match = entry;
                }
              }
            }
          }
#line 902
          next_move = next_move->next;
        } else {
          {
#line 905
          print_error_context(GlobalState.logfile);
          }
#line 906
          if ((unsigned int )board->to_move == 1U) {
#line 906
            tmp___7 = ".";
          } else {
#line 906
            tmp___7 = "...";
          }
          {
#line 906
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Failed to make move %u%s %s in the game:\n",
                  board->move_number, tmp___7, next_move->move);
#line 911
          print_board((Board const   *)board, GlobalState.logfile);
#line 912
          report_details(GlobalState.logfile);
#line 913
          game_ok = (Boolean )0;
          }
        }
      } else {
#line 918
        board->to_move = (Colour )(! board->to_move);
#line 919
        if ((unsigned int )board->to_move == 1U) {
#line 920
          (board->move_number) ++;
        }
#line 922
        next_move = next_move->next;
      }
    } else {
      {
#line 927
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Empty move in play_moves.\n");
#line 929
      report_details(GlobalState.logfile);
#line 930
      game_ok = (Boolean )0;
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 933
  if (game_ok) {
#line 934
    if ((unsigned long )eco_match != (unsigned long )((void *)0)) {
#line 936
      if ((unsigned long )*(game_details->tags + 9) != (unsigned long )((void *)0)) {
        {
#line 937
        free((void *)*(game_details->tags + 9));
#line 938
        *(game_details->tags + 9) = (char *)((void *)0);
        }
      }
#line 940
      if ((unsigned long )*(game_details->tags + 19) != (unsigned long )((void *)0)) {
        {
#line 941
        free((void *)*(game_details->tags + 19));
#line 942
        *(game_details->tags + 19) = (char *)((void *)0);
        }
      }
#line 944
      if ((unsigned long )*(game_details->tags + 34) != (unsigned long )((void *)0)) {
        {
#line 945
        free((void *)*(game_details->tags + 34));
#line 946
        *(game_details->tags + 34) = (char *)((void *)0);
        }
      }
#line 948
      if ((unsigned long )*(game_details->tags + 28) != (unsigned long )((void *)0)) {
        {
#line 949
        free((void *)*(game_details->tags + 28));
#line 950
        *(game_details->tags + 28) = (char *)((void *)0);
        }
      }
#line 953
      if ((unsigned long )eco_match->ECO_tag != (unsigned long )((void *)0)) {
        {
#line 954
        *(game_details->tags + 9) = StringCopy(eco_match->ECO_tag);
        }
      }
#line 956
      if ((unsigned long )eco_match->Opening_tag != (unsigned long )((void *)0)) {
        {
#line 957
        *(game_details->tags + 19) = StringCopy(eco_match->Opening_tag);
        }
      }
#line 959
      if ((unsigned long )eco_match->Variation_tag != (unsigned long )((void *)0)) {
        {
#line 960
        *(game_details->tags + 34) = StringCopy(eco_match->Variation_tag);
        }
      }
#line 963
      if ((unsigned long )eco_match->Sub_Variation_tag != (unsigned long )((void *)0)) {
        {
#line 964
        *(game_details->tags + 28) = StringCopy(eco_match->Sub_Variation_tag);
        }
      }
    }
  }
#line 970
  game_details->final_hash_value = board->hash_value;
#line 971
  game_details->moves_ok = game_ok;
#line 972
  if (! game_ok) {
#line 976
    if (! GlobalState.positional_variations) {
#line 978
      game_matches = (Boolean )0;
    }
  }
#line 981
  return (game_matches);
}
}
#line 989 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static void play_eco_moves(Game *game_details , Board *board , Move *moves ) 
{ 
  Boolean game_ok ;
  Move *next_move ;
  char const   *tmp ;
  Boolean tmp___0 ;

  {
#line 991
  game_ok = (Boolean )1;
#line 992
  next_move = moves;
  {
#line 998
  while (1) {
    while_continue: /* CIL Label */ ;
#line 998
    if (game_ok) {
#line 998
      if (! ((unsigned long )next_move != (unsigned long )((void *)0))) {
#line 998
        goto while_break;
      }
    } else {
#line 998
      goto while_break;
    }
#line 999
    if ((int )next_move->move[0] != 0) {
      {
#line 1001
      tmp___0 = apply_move(board->to_move, next_move, board);
      }
#line 1001
      if (tmp___0) {
#line 1003
        game_details->cumulative_hash_value += board->hash_value;
#line 1004
        board->to_move = (Colour )(! board->to_move);
#line 1005
        if ((unsigned int )board->to_move == 1U) {
#line 1006
          (board->move_number) ++;
        }
#line 1008
        next_move = next_move->next;
      } else {
        {
#line 1011
        print_error_context(GlobalState.logfile);
        }
#line 1012
        if ((unsigned int )board->to_move == 1U) {
#line 1012
          tmp = ".";
        } else {
#line 1012
          tmp = "...";
        }
        {
#line 1012
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Failed to make move %u%s %s in the game:\n",
                board->move_number, tmp, next_move->move);
#line 1017
        print_board((Board const   *)board, GlobalState.logfile);
#line 1018
        report_details(GlobalState.logfile);
#line 1019
        game_ok = (Boolean )0;
        }
      }
    } else {
      {
#line 1024
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Empty move in play_eco_moves.\n");
#line 1026
      report_details(GlobalState.logfile);
#line 1027
      game_ok = (Boolean )0;
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 1031
  game_details->final_hash_value = board->hash_value;
#line 1032
  game_details->moves_ok = game_ok;
#line 1033
  return;
}
}
#line 1041 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Boolean apply_variations(Game const   *game_details , Board const   *board ,
                                Variation *variation , Boolean check_move_validity ) 
{ 
  Boolean variation_matches ;
  int tmp ;
  Game *copy_game ;
  void *tmp___0 ;
  Board *copy_board ;
  Board *tmp___1 ;
  Boolean tmp___2 ;

  {
#line 1045
  if (GlobalState.positional_variations) {
#line 1045
    tmp = 0;
  } else {
#line 1045
    tmp = 1;
  }
  {
#line 1045
  variation_matches = (Boolean )tmp;
#line 1051
  tmp___0 = MallocOrDie(sizeof(*copy_game));
#line 1051
  copy_game = (Game *)tmp___0;
#line 1052
  tmp___1 = allocate_new_board();
#line 1052
  copy_board = tmp___1;
  }
  {
#line 1054
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1054
    if (! ((unsigned long )variation != (unsigned long )((void *)0))) {
#line 1054
      goto while_break;
    }
    {
#line 1056
    *copy_game = (Game )*game_details;
#line 1057
    *copy_board = (Board )*board;
#line 1064
    tmp___2 = play_moves(copy_game, copy_board, variation->moves, 300U, check_move_validity);
#line 1064
    variation_matches = (Boolean )((unsigned int )variation_matches | (unsigned int )tmp___2);
#line 1067
    variation = variation->next;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 1069
  free((void *)copy_game);
#line 1070
  free_board((Board *)((void *)copy_board));
  }
#line 1071
  return (variation_matches);
}
}
#line 1080 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
Boolean apply_move_list(Game *game_details , unsigned int *plycount ) 
{ 
  Move *moves ;
  Board *board ;
  Board *tmp ;
  Boolean game_matches ;
  unsigned int max_depth ;

  {
  {
#line 1082
  moves = game_details->moves;
#line 1083
  tmp = new_game_board((char const   *)*(game_details->tags + 14));
#line 1083
  board = tmp;
#line 1086
  max_depth = GlobalState.depth_of_positional_search;
  }
#line 1089
  if (max_depth == 0U) {
#line 1091
    max_depth = 300U;
  }
  {
#line 1095
  game_details->cumulative_hash_value = (HashCode )0;
#line 1100
  game_matches = play_moves(game_details, board, moves, max_depth, (Boolean )1);
#line 1102
  game_details->moves_checked = (Boolean )1;
  }
#line 1105
  if ((unsigned int )board->to_move == 0U) {
#line 1106
    *plycount = 2U * board->move_number - 1U;
  } else {
#line 1110
    *plycount = 2U * (board->move_number - 1U);
  }
#line 1113
  if (game_matches) {
    {
#line 1114
    game_matches = check_for_only_stalemate((Board const   *)board, (Move const   *)moves);
    }
  }
  {
#line 1117
  free_board((Board *)((void *)board));
  }
#line 1118
  return (game_matches);
}
}
#line 1126 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
Boolean apply_eco_move_list(Game *game_details , unsigned int *number_of_half_moves ) 
{ 
  Move *moves ;
  Board *board ;
  Board *tmp ;
  int tmp___0 ;

  {
  {
#line 1128
  moves = game_details->moves;
#line 1129
  tmp = new_game_board((char const   *)*(game_details->tags + 14));
#line 1129
  board = tmp;
#line 1132
  game_details->cumulative_hash_value = (HashCode )0;
#line 1133
  play_eco_moves(game_details, board, moves);
#line 1134
  game_details->moves_checked = (Boolean )1;
#line 1136
  tmp___0 = half_moves_played((Board const   *)board);
#line 1136
  *number_of_half_moves = (unsigned int )tmp___0;
#line 1137
  free_board((Board *)((void *)board));
  }
#line 1138
  return (game_details->moves_ok);
}
}
#line 1143 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
char const   *piece_str(Piece piece ) 
{ 


  {
#line 1146
  if ((unsigned int )piece >= 0U) {
#line 1146
    if ((unsigned int )piece < 8U) {
#line 1147
      return (output_piece_characters[piece]);
    } else {
#line 1150
      return ("?");
    }
  } else {
#line 1150
    return ("?");
  }
}
}
#line 1157 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Boolean rewrite_SAN_string(Colour colour , Move *move_details , Board *board ) 
{ 
  Boolean Ok ;
  unsigned char const   *move ;
  MoveClass class ;
  MovePair *move_list ;
  Col to_col ;
  Rank to_rank ;
  unsigned char new_move_str[16] ;
  unsigned int tmp ;
  size_t new_move_index ;
  char const   *promoted_piece ;
  char const   *tmp___0 ;
  size_t tmp___1 ;
  char const   *piece ;
  char const   *tmp___2 ;
  size_t tmp___3 ;
  int col_times ;
  int rank_times ;
  MovePair *possible ;
  Col from_col ;
  Rank from_rank ;

  {
#line 1159
  Ok = (Boolean )1;
#line 1161
  if ((unsigned long )move_details == (unsigned long )((void *)0)) {
    {
#line 1163
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: NULL move details in rewrite_SAN_string.\n");
#line 1165
    Ok = (Boolean )0;
    }
  } else
#line 1167
  if ((int )move_details->move[0] == 0) {
    {
#line 1169
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Empty move in rewrite_SAN_string.\n");
#line 1170
    Ok = (Boolean )0;
    }
  } else {
#line 1173
    move = (unsigned char const   *)(move_details->move);
#line 1174
    class = move_details->class;
#line 1175
    move_list = (MovePair *)((void *)0);
#line 1176
    to_col = move_details->to_col;
#line 1177
    to_rank = move_details->to_rank;
#line 1178
    new_move_str[0] = (unsigned char )'\000';
#line 1178
    tmp = 1U;
    {
#line 1178
    while (1) {
      while_continue: /* CIL Label */ ;
#line 1178
      if (tmp >= 16U) {
#line 1178
        goto while_break;
      }
#line 1178
      new_move_str[tmp] = (unsigned char)0;
#line 1178
      tmp ++;
    }
    while_break: /* CIL Label */ ;
    }
    {
#line 1183
    if ((unsigned int )class == 1U) {
#line 1183
      goto case_1;
    }
#line 1183
    if ((unsigned int )class == 2U) {
#line 1183
      goto case_1;
    }
#line 1183
    if ((unsigned int )class == 0U) {
#line 1183
      goto case_1;
    }
#line 1188
    if ((unsigned int )class == 3U) {
#line 1188
      goto case_3;
    }
#line 1212
    if ((unsigned int )class == 5U) {
#line 1212
      goto case_5___0;
    }
#line 1212
    if ((unsigned int )class == 4U) {
#line 1212
      goto case_5___0;
    }
#line 1215
    if ((unsigned int )class == 6U) {
#line 1215
      goto case_6___0;
    }
#line 1219
    goto switch_default___0;
    case_1: /* CIL Label */ 
    case_2: /* CIL Label */ 
    case_0: /* CIL Label */ 
    {
#line 1184
    move_list = find_pawn_moves(move_details->from_col, (Rank )'0', to_col, to_rank,
                                colour, (Board const   *)board);
    }
#line 1187
    goto switch_break;
    case_3: /* CIL Label */ 
    {
#line 1190
    if ((unsigned int )move_details->piece_to_move == 7U) {
#line 1190
      goto case_7;
    }
#line 1193
    if ((unsigned int )move_details->piece_to_move == 6U) {
#line 1193
      goto case_6;
    }
#line 1196
    if ((unsigned int )move_details->piece_to_move == 5U) {
#line 1196
      goto case_5;
    }
#line 1199
    if ((unsigned int )move_details->piece_to_move == 3U) {
#line 1199
      goto case_3___0;
    }
#line 1202
    if ((unsigned int )move_details->piece_to_move == 4U) {
#line 1202
      goto case_4;
    }
#line 1205
    goto switch_default;
    case_7: /* CIL Label */ 
    {
#line 1191
    move_list = find_king_moves(to_col, to_rank, colour, (Board const   *)board);
    }
#line 1192
    goto switch_break___0;
    case_6: /* CIL Label */ 
    {
#line 1194
    move_list = find_queen_moves(to_col, to_rank, colour, (Board const   *)board);
    }
#line 1195
    goto switch_break___0;
    case_5: /* CIL Label */ 
    {
#line 1197
    move_list = find_rook_moves(to_col, to_rank, colour, (Board const   *)board);
    }
#line 1198
    goto switch_break___0;
    case_3___0: /* CIL Label */ 
    {
#line 1200
    move_list = find_knight_moves(to_col, to_rank, colour, (Board const   *)board);
    }
#line 1201
    goto switch_break___0;
    case_4: /* CIL Label */ 
    {
#line 1203
    move_list = find_bishop_moves(to_col, to_rank, colour, (Board const   *)board);
    }
#line 1204
    goto switch_break___0;
    switch_default: /* CIL Label */ 
    {
#line 1206
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown piece move %s\n",
            move);
#line 1207
    Ok = (Boolean )0;
    }
#line 1208
    goto switch_break___0;
    switch_break___0: /* CIL Label */ ;
    }
#line 1210
    goto switch_break;
    case_5___0: /* CIL Label */ 
    case_4___0: /* CIL Label */ 
#line 1214
    goto switch_break;
    case_6___0: /* CIL Label */ 
#line 1217
    goto switch_break;
    switch_default___0: /* CIL Label */ 
    {
#line 1220
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown move class in rewrite_SAN_string(%d).\n",
            (unsigned int )move_details->class);
#line 1223
    Ok = (Boolean )0;
    }
#line 1224
    goto switch_break;
    switch_break: /* CIL Label */ ;
    }
#line 1226
    if ((unsigned long )move_list != (unsigned long )((void *)0)) {
      {
#line 1227
      move_list = exclude_checks(move_details->piece_to_move, colour, move_list, (Board const   *)board);
      }
    }
#line 1230
    if ((unsigned long )move_list == (unsigned long )((void *)0)) {
#line 1230
      if ((unsigned int )class != 4U) {
#line 1230
        if ((unsigned int )class != 5U) {
#line 1230
          if ((unsigned int )class != 6U) {
#line 1232
            Ok = (Boolean )0;
          }
        }
      }
    }
#line 1237
    if (Ok) {
#line 1238
      new_move_index = (size_t )0;
      {
#line 1243
      if ((unsigned int )class == 1U) {
#line 1243
        goto case_1___0;
      }
#line 1243
      if ((unsigned int )class == 2U) {
#line 1243
        goto case_1___0;
      }
#line 1243
      if ((unsigned int )class == 0U) {
#line 1243
        goto case_1___0;
      }
#line 1271
      if ((unsigned int )class == 3U) {
#line 1271
        goto case_3___1;
      }
#line 1327
      if ((unsigned int )class == 4U) {
#line 1327
        goto case_4___1;
      }
#line 1330
      if ((unsigned int )class == 5U) {
#line 1330
        goto case_5___1;
      }
#line 1333
      if ((unsigned int )class == 6U) {
#line 1333
        goto case_6___1;
      }
#line 1337
      goto switch_default___1;
      case_1___0: /* CIL Label */ 
      case_2___0: /* CIL Label */ 
      case_0___0: /* CIL Label */ 
#line 1245
      if ((unsigned int )move_details->captured_piece != 1U) {
#line 1246
        new_move_str[new_move_index] = (unsigned char )move_details->from_col;
#line 1247
        new_move_index ++;
#line 1248
        new_move_str[new_move_index] = (unsigned char )'x';
#line 1249
        new_move_index ++;
      } else
#line 1251
      if ((unsigned long )move_list->next != (unsigned long )((void *)0)) {
#line 1252
        new_move_str[new_move_index] = (unsigned char )move_details->from_col;
#line 1253
        new_move_index ++;
      }
#line 1256
      new_move_str[new_move_index] = (unsigned char )to_col;
#line 1257
      new_move_index ++;
#line 1258
      new_move_str[new_move_index] = (unsigned char )to_rank;
#line 1259
      new_move_index ++;
#line 1260
      if ((unsigned int )class == 1U) {
        {
#line 1261
        tmp___0 = piece_str(move_details->promoted_piece);
#line 1261
        promoted_piece = tmp___0;
#line 1263
        new_move_str[new_move_index] = (unsigned char )'=';
#line 1264
        new_move_index ++;
#line 1265
        strcpy((char */* __restrict  */)((char *)(& new_move_str[new_move_index])),
               (char const   */* __restrict  */)promoted_piece);
#line 1267
        tmp___1 = strlen(promoted_piece);
#line 1267
        new_move_index += tmp___1;
        }
      }
#line 1269
      new_move_str[new_move_index] = (unsigned char )'\000';
#line 1270
      goto switch_break___1;
      case_3___1: /* CIL Label */ 
      {
#line 1272
      tmp___2 = piece_str(move_details->piece_to_move);
#line 1272
      piece = tmp___2;
#line 1273
      strcpy((char */* __restrict  */)((char *)(& new_move_str[0])), (char const   */* __restrict  */)piece);
#line 1274
      tmp___3 = strlen(piece);
#line 1274
      new_move_index += tmp___3;
      }
#line 1276
      if ((unsigned long )move_list->next != (unsigned long )((void *)0)) {
#line 1282
        col_times = 0;
#line 1282
        rank_times = 0;
#line 1284
        from_col = move_details->from_col;
#line 1285
        from_rank = move_details->from_rank;
#line 1287
        possible = move_list;
        {
#line 1287
        while (1) {
          while_continue___0: /* CIL Label */ ;
#line 1287
          if (! ((unsigned long )possible != (unsigned long )((void *)0))) {
#line 1287
            goto while_break___0;
          }
#line 1289
          if ((int )possible->from_col == (int )from_col) {
#line 1290
            col_times ++;
          }
#line 1292
          if ((int )possible->from_rank == (int )from_rank) {
#line 1293
            rank_times ++;
          }
#line 1287
          possible = possible->next;
        }
        while_break___0: /* CIL Label */ ;
        }
#line 1296
        if (col_times == 1) {
#line 1298
          new_move_str[new_move_index] = (unsigned char )from_col;
#line 1299
          new_move_index ++;
        } else
#line 1301
        if (rank_times == 1) {
#line 1303
          new_move_str[new_move_index] = (unsigned char )from_rank;
#line 1304
          new_move_index ++;
        } else {
#line 1308
          new_move_str[new_move_index] = (unsigned char )from_col;
#line 1309
          new_move_index ++;
#line 1310
          new_move_str[new_move_index] = (unsigned char )from_rank;
#line 1311
          new_move_index ++;
        }
      }
#line 1315
      if ((unsigned int )move_details->captured_piece != 1U) {
#line 1316
        new_move_str[new_move_index] = (unsigned char )'x';
#line 1317
        new_move_index ++;
      }
#line 1320
      new_move_str[new_move_index] = (unsigned char )to_col;
#line 1321
      new_move_index ++;
#line 1322
      new_move_str[new_move_index] = (unsigned char )to_rank;
#line 1323
      new_move_index ++;
#line 1324
      new_move_str[new_move_index] = (unsigned char )'\000';
#line 1326
      goto switch_break___1;
      case_4___1: /* CIL Label */ 
      {
#line 1328
      strcpy((char */* __restrict  */)((char *)(new_move_str)), (char const   */* __restrict  */)"O-O");
      }
#line 1329
      goto switch_break___1;
      case_5___1: /* CIL Label */ 
      {
#line 1331
      strcpy((char */* __restrict  */)((char *)(new_move_str)), (char const   */* __restrict  */)"O-O-O");
      }
#line 1332
      goto switch_break___1;
      case_6___1: /* CIL Label */ 
      {
#line 1334
      strcpy((char */* __restrict  */)((char *)(new_move_str)), (char const   */* __restrict  */)((char *)"--"));
      }
#line 1335
      goto switch_break___1;
      switch_default___1: /* CIL Label */ 
#line 1338
      Ok = (Boolean )0;
#line 1339
      goto switch_break___1;
      switch_break___1: /* CIL Label */ ;
      }
#line 1341
      if (Ok) {
#line 1342
        if ((unsigned int )move_details->check_status != 0U) {
#line 1343
          if ((unsigned int )move_details->check_status == 1U) {
            {
#line 1345
            strcat((char */* __restrict  */)((char *)(new_move_str)), (char const   */* __restrict  */)"+");
            }
          } else
#line 1348
          if ((unsigned int )GlobalState.output_format == 3U) {
            {
#line 1349
            strcat((char */* __restrict  */)((char *)(new_move_str)), (char const   */* __restrict  */)"++");
            }
          } else {
            {
#line 1352
            strcat((char */* __restrict  */)((char *)(new_move_str)), (char const   */* __restrict  */)"#");
            }
          }
        }
      }
      {
#line 1358
      strcpy((char */* __restrict  */)((char *)(move_details->move)), (char const   */* __restrict  */)((char const   *)(new_move_str)));
      }
    }
#line 1361
    if ((unsigned long )move_list != (unsigned long )((void *)0)) {
      {
#line 1362
      free_move_pair_list(move_list);
      }
    }
  }
#line 1365
  return (Ok);
}
}
#line 1371 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Boolean rewrite_move(Colour colour , Move *move_details , Board *board , Boolean null_move_found ) 
{ 
  Boolean Ok ;
  Piece piece_to_move ;
  Boolean tmp ;

  {
  {
#line 1374
  Ok = (Boolean )1;
#line 1376
  tmp = rewrite_SAN_string(colour, move_details, board);
  }
#line 1376
  if (tmp) {
#line 1377
    piece_to_move = move_details->piece_to_move;
#line 1379
    if ((unsigned int )move_details->class != 6U) {
      {
#line 1380
      make_move(move_details->from_col, move_details->from_rank, move_details->to_col,
                move_details->to_rank, piece_to_move, colour, board);
      }
    } else {
#line 1385
      null_move_found = (Boolean )1;
    }
    {
#line 1391
    if ((unsigned int )move_details->class == 2U) {
#line 1391
      goto case_2;
    }
#line 1391
    if ((unsigned int )move_details->class == 3U) {
#line 1391
      goto case_2;
    }
#line 1391
    if ((unsigned int )move_details->class == 0U) {
#line 1391
      goto case_2;
    }
#line 1394
    if ((unsigned int )move_details->class == 1U) {
#line 1394
      goto case_1;
    }
#line 1408
    if ((unsigned int )move_details->class == 4U) {
#line 1408
      goto case_4;
    }
#line 1415
    if ((unsigned int )move_details->class == 5U) {
#line 1415
      goto case_5;
    }
#line 1422
    if ((unsigned int )move_details->class == 6U) {
#line 1422
      goto case_6;
    }
#line 1426
    goto switch_default;
    case_2: /* CIL Label */ 
    case_3: /* CIL Label */ 
    case_0: /* CIL Label */ 
#line 1393
    goto switch_break;
    case_1: /* CIL Label */ 
#line 1395
    if ((unsigned int )move_details->class == 1U) {
#line 1396
      if ((unsigned int )move_details->promoted_piece != 1U) {
        {
#line 1399
        make_move(move_details->to_col, move_details->to_rank, move_details->to_col,
                  move_details->to_rank, move_details->promoted_piece, colour, board);
        }
      } else {
#line 1404
        Ok = (Boolean )0;
      }
    }
#line 1407
    goto switch_break;
    case_4: /* CIL Label */ 
    {
#line 1410
    piece_to_move = (Piece )5;
#line 1411
    make_move((Col )104, move_details->from_rank, (Col )((int )move_details->to_col - 1),
              move_details->to_rank, piece_to_move, colour, board);
    }
#line 1414
    goto switch_break;
    case_5: /* CIL Label */ 
    {
#line 1417
    piece_to_move = (Piece )5;
#line 1418
    make_move((Col )'a', move_details->from_rank, (Col )((int )move_details->to_col + 1),
              move_details->to_rank, piece_to_move, colour, board);
    }
#line 1421
    goto switch_break;
    case_6: /* CIL Label */ 
#line 1424
    goto switch_break;
    switch_default: /* CIL Label */ 
#line 1427
    Ok = (Boolean )0;
#line 1428
    goto switch_break;
    switch_break: /* CIL Label */ ;
    }
  } else {
#line 1432
    Ok = (Boolean )0;
  }
#line 1434
  return (Ok);
}
}
#line 1438 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Boolean rewrite_moves(Board *board , Move *moves , Boolean null_move_found ) 
{ 
  Boolean game_ok ;
  Move *move_details ;
  Boolean tmp ;
  char const   *tmp___0 ;
  Boolean tmp___1 ;

  {
#line 1440
  game_ok = (Boolean )1;
#line 1441
  move_details = moves;
  {
#line 1443
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1443
    if (game_ok) {
#line 1443
      if (! ((unsigned long )move_details != (unsigned long )((void *)0))) {
#line 1443
        goto while_break;
      }
    } else {
#line 1443
      goto while_break;
    }
#line 1444
    if ((int )move_details->move[0] != 0) {
#line 1446
      if ((unsigned long )move_details->Variants != (unsigned long )((void *)0)) {
#line 1446
        if (GlobalState.keep_variations) {
          {
#line 1446
          tmp = rewrite_variations((Board const   *)board, move_details->Variants,
                                   null_move_found);
          }
#line 1446
          if (! tmp) {
#line 1450
            game_ok = (Boolean )0;
          }
        }
      }
#line 1453
      if ((unsigned int )move_details->class == 6U) {
#line 1454
        null_move_found = (Boolean )1;
      }
      {
#line 1456
      tmp___1 = rewrite_move(board->to_move, move_details, board, null_move_found);
      }
#line 1456
      if (tmp___1) {
#line 1457
        board->to_move = (Colour )(! board->to_move);
#line 1459
        if (GlobalState.output_evaluation) {
          {
#line 1463
          append_evaluation(move_details, (Board const   *)board);
          }
        }
#line 1466
        if (GlobalState.add_FEN_comments) {
          {
#line 1470
          append_FEN_comment(move_details, (Board const   *)board);
          }
        }
#line 1473
        move_details = move_details->next;
#line 1474
        if ((unsigned int )board->to_move == 1U) {
#line 1475
          (board->move_number) ++;
        }
      } else {
#line 1479
        if ((unsigned int )board->to_move == 1U) {
#line 1479
          tmp___0 = ".";
        } else {
#line 1479
          tmp___0 = "...";
        }
        {
#line 1479
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Failed to rewrite move %u%s %s in the game:\n",
                board->move_number, tmp___0, move_details->move);
#line 1484
        report_details(GlobalState.logfile);
#line 1485
        print_board((Board const   *)board, GlobalState.logfile);
#line 1486
        game_ok = (Boolean )0;
        }
      }
    } else {
      {
#line 1491
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Empty move in rewrite_moves.\n");
#line 1493
      report_details(GlobalState.logfile);
#line 1494
      game_ok = (Boolean )0;
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 1497
  return (game_ok);
}
}
#line 1503 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Boolean rewrite_variations(Board const   *board , Variation *variation , Boolean null_move_found ) 
{ 
  Board *copy_board ;
  Board *tmp ;
  Boolean variations_ok ;

  {
  {
#line 1505
  tmp = allocate_new_board();
#line 1505
  copy_board = tmp;
#line 1506
  variations_ok = (Boolean )1;
  }
  {
#line 1508
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1508
    if ((unsigned long )variation != (unsigned long )((void *)0)) {
#line 1508
      if (! variations_ok) {
#line 1508
        goto while_break;
      }
    } else {
#line 1508
      goto while_break;
    }
    {
#line 1510
    *copy_board = (Board )*board;
#line 1512
    variations_ok = rewrite_moves(copy_board, variation->moves, null_move_found);
#line 1513
    variation = variation->next;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 1515
  free_board((Board *)((void *)copy_board));
  }
#line 1516
  return (variations_ok);
}
}
#line 1524 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
Board *rewrite_game(Move *moves , char const   *fen___0 ) 
{ 
  Board *board ;
  Board *tmp ;
  Boolean game_ok ;

  {
  {
#line 1526
  tmp = new_game_board(fen___0);
#line 1526
  board = tmp;
#line 1530
  game_ok = rewrite_moves(board, moves, (Boolean )0);
  }
#line 1531
  if (! game_ok) {
    {
#line 1532
    free_board((Board *)((void *)board));
#line 1533
    board = (Board *)((void *)0);
    }
  }
#line 1535
  return (board);
}
}
#line 1541 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static HashLog *codes_of_interest[53]  ;
#line 1546 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
void store_hash_value(Move *move_details , char const   *fen___0 ) 
{ 
  Move *move ;
  Board *board ;
  Board *tmp ;
  Boolean Ok ;
  char const   *tmp___0 ;
  Boolean tmp___1 ;
  HashLog *entry ;
  void *tmp___2 ;
  unsigned int ix ;

  {
  {
#line 1548
  move = move_details;
#line 1549
  tmp = new_game_board(fen___0);
#line 1549
  board = tmp;
#line 1550
  Ok = (Boolean )1;
  }
  {
#line 1552
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1552
    if ((unsigned long )move != (unsigned long )((void *)0)) {
#line 1552
      if (! Ok) {
#line 1552
        goto while_break;
      }
    } else {
#line 1552
      goto while_break;
    }
#line 1554
    if ((int )move->move[0] == 0) {
#line 1556
      move = move->next;
    } else {
      {
#line 1558
      tmp___1 = apply_move(board->to_move, move, board);
      }
#line 1558
      if (tmp___1) {
#line 1559
        board->to_move = (Colour )(! board->to_move);
#line 1560
        move = move->next;
#line 1561
        if ((unsigned int )board->to_move == 1U) {
#line 1562
          (board->move_number) ++;
        }
      } else {
        {
#line 1566
        print_error_context(GlobalState.logfile);
        }
#line 1567
        if ((unsigned int )board->to_move == 1U) {
#line 1567
          tmp___0 = ".";
        } else {
#line 1567
          tmp___0 = "...";
        }
        {
#line 1567
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Failed to make move %u%s %s\n",
                board->move_number, tmp___0, move->move);
#line 1571
        Ok = (Boolean )0;
        }
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 1575
  if (! Ok) {
    {
#line 1576
    exit(1);
    }
  } else {
    {
#line 1579
    tmp___2 = MallocOrDie(sizeof(*entry));
#line 1579
    entry = (HashLog *)tmp___2;
#line 1580
    ix = (unsigned int )(board->hash_value % 53UL);
#line 1585
    entry->cumulative_hash_value = (HashCode )0;
#line 1586
    entry->final_hash_value = board->hash_value;
#line 1588
    entry->next = codes_of_interest[ix];
#line 1589
    codes_of_interest[ix] = entry;
    }
  }
  {
#line 1591
  free_board((Board *)((void *)board));
  }
#line 1592
  return;
}
}
#line 1597 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static Boolean position_matches(Board const   *board ) 
{ 
  HashCode current_hash_value ;
  unsigned int ix ;
  Boolean found ;
  HashLog *entry ;
  char const   *matching_pattern ;
  char const   *tmp ;

  {
#line 1600
  current_hash_value = (HashCode )board->hash_value;
#line 1601
  ix = (unsigned int )(current_hash_value % 53UL);
#line 1602
  found = (Boolean )0;
#line 1605
  entry = codes_of_interest[ix];
  {
#line 1605
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1605
    if (! found) {
#line 1605
      if (! ((unsigned long )entry != (unsigned long )((void *)0))) {
#line 1605
        goto while_break;
      }
    } else {
#line 1605
      goto while_break;
    }
#line 1608
    if (entry->final_hash_value == current_hash_value) {
#line 1609
      found = (Boolean )1;
    }
#line 1605
    entry = entry->next;
  }
  while_break: /* CIL Label */ ;
  }
#line 1612
  if (! found) {
    {
#line 1613
    tmp = matchBoard(board);
#line 1613
    matching_pattern = tmp;
#line 1614
    found = (Boolean )((unsigned long )matching_pattern != (unsigned long )((void *)0));
    }
  }
#line 1616
  return (found);
}
}
#line 1620 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
void build_basic_EPD_string(Board const   *board , char *epd___0 ) 
{ 
  Rank rank ;
  int ix ;
  Boolean castling_allowed ;
  Col col ;
  int consecutive_spaces ;
  int coloured_piece ;
  int tmp ;
  int tmp___0 ;

  {
#line 1623
  ix = 0;
#line 1624
  castling_allowed = (Boolean )0;
#line 1625
  rank = (Rank )56;
  {
#line 1625
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1625
    if (! ((int )rank >= 49)) {
#line 1625
      goto while_break;
    }
#line 1627
    consecutive_spaces = 0;
#line 1628
    col = (Col )'a';
    {
#line 1628
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 1628
      if (! ((int )col <= 104)) {
#line 1628
        goto while_break___0;
      }
#line 1629
      if (49 <= (int )rank) {
#line 1629
        if ((int )rank <= 56) {
#line 1629
          tmp = ((int )rank - 49) + 2;
        } else {
#line 1629
          tmp = 0;
        }
      } else {
#line 1629
        tmp = 0;
      }
#line 1629
      if (97 <= (int )col) {
#line 1629
        if ((int )col <= 104) {
#line 1629
          tmp___0 = ((int )col - 97) + 2;
        } else {
#line 1629
          tmp___0 = 0;
        }
      } else {
#line 1629
        tmp___0 = 0;
      }
#line 1629
      coloured_piece = (int )board->board[tmp][tmp___0];
#line 1631
      if (coloured_piece != 1) {
#line 1632
        if (consecutive_spaces > 0) {
#line 1633
          *(epd___0 + ix) = (char )(48 + consecutive_spaces);
#line 1634
          ix ++;
#line 1635
          consecutive_spaces = 0;
        }
        {
#line 1637
        *(epd___0 + ix) = coloured_piece_to_SAN_letter((Piece )coloured_piece);
#line 1638
        ix ++;
        }
      } else {
#line 1641
        consecutive_spaces ++;
      }
#line 1628
      col = (Col )((int )col + 1);
    }
    while_break___0: /* CIL Label */ ;
    }
#line 1644
    if (consecutive_spaces > 0) {
#line 1645
      *(epd___0 + ix) = (char )(48 + consecutive_spaces);
#line 1646
      ix ++;
    }
#line 1649
    if ((int )rank != 49) {
#line 1650
      *(epd___0 + ix) = (char )'/';
#line 1650
      ix ++;
    }
#line 1625
    rank = (Rank )((int )rank - 1);
  }
  while_break: /* CIL Label */ ;
  }
#line 1653
  *(epd___0 + ix) = (char )' ';
#line 1653
  ix ++;
#line 1654
  *(epd___0 + ix) = (char )'\000';
#line 1655
  if ((unsigned int const   )board->to_move == 1U) {
#line 1655
    *(epd___0 + ix) = (char )'w';
  } else {
#line 1655
    *(epd___0 + ix) = (char )'b';
  }
#line 1655
  ix ++;
#line 1656
  *(epd___0 + ix) = (char )' ';
#line 1656
  ix ++;
#line 1659
  if (board->WKingCastle) {
#line 1660
    *(epd___0 + ix) = (char )'K';
#line 1660
    ix ++;
#line 1661
    castling_allowed = (Boolean )1;
  }
#line 1663
  if (board->WQueenCastle) {
#line 1664
    *(epd___0 + ix) = (char )'Q';
#line 1664
    ix ++;
#line 1665
    castling_allowed = (Boolean )1;
  }
#line 1667
  if (board->BKingCastle) {
#line 1668
    *(epd___0 + ix) = (char )'k';
#line 1668
    ix ++;
#line 1669
    castling_allowed = (Boolean )1;
  }
#line 1671
  if (board->BQueenCastle) {
#line 1672
    *(epd___0 + ix) = (char )'q';
#line 1672
    ix ++;
#line 1673
    castling_allowed = (Boolean )1;
  }
#line 1675
  if (! castling_allowed) {
#line 1677
    *(epd___0 + ix) = (char )'-';
#line 1678
    ix ++;
  }
#line 1680
  *(epd___0 + ix) = (char )' ';
#line 1680
  ix ++;
#line 1683
  if (board->EnPassant) {
#line 1684
    *(epd___0 + ix) = (char )board->ep_col;
#line 1684
    ix ++;
#line 1685
    *(epd___0 + ix) = (char )board->ep_rank;
#line 1685
    ix ++;
  } else {
#line 1688
    *(epd___0 + ix) = (char )'-';
#line 1688
    ix ++;
  }
#line 1690
  *(epd___0 + ix) = (char )'\000';
#line 1691
  return;
}
}
#line 1694 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
void build_FEN_string(Board const   *board , char *fen___0 ) 
{ 
  size_t ix ;
  int full_move_number ;
  unsigned int tmp ;

  {
#line 1698
  if ((unsigned int const   )board->to_move == 0U) {
#line 1698
    tmp = board->move_number;
  } else {
#line 1698
    tmp = board->move_number + 1U;
  }
  {
#line 1698
  full_move_number = (int )tmp;
#line 1701
  build_basic_EPD_string(board, fen___0);
#line 1703
  ix = strlen((char const   *)fen___0);
#line 1704
  *(fen___0 + ix) = (char )' ';
#line 1704
  ix ++;
#line 1707
  sprintf((char */* __restrict  */)(fen___0 + ix), (char const   */* __restrict  */)"%u",
          board->halfmove_clock);
#line 1708
  ix = strlen((char const   *)fen___0);
#line 1709
  *(fen___0 + ix) = (char )' ';
#line 1709
  ix ++;
#line 1712
  sprintf((char */* __restrict  */)(fen___0 + ix), (char const   */* __restrict  */)"%u",
          full_move_number);
  }
#line 1713
  return;
}
}
#line 1719 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static void append_FEN_comment(Move *move_details , Board const   *board ) 
{ 
  char *FEN_comment ;
  void *tmp ;
  CommentList *comment ;
  void *tmp___0 ;
  StringList *current_comment ;
  StringList *tmp___1 ;

  {
  {
#line 1722
  tmp = MallocOrDie((size_t )100);
#line 1722
  FEN_comment = (char *)tmp;
#line 1723
  tmp___0 = MallocOrDie(sizeof(*comment));
#line 1723
  comment = (CommentList *)tmp___0;
#line 1724
  tmp___1 = SaveStringListItem((StringList *)((void *)0), (char const   *)FEN_comment);
#line 1724
  current_comment = tmp___1;
#line 1726
  build_FEN_string(board, FEN_comment);
#line 1727
  comment->Comment = current_comment;
#line 1728
  comment->next = (struct comment_list *)((void *)0);
#line 1729
  append_comments_to_move(move_details, comment);
  }
#line 1730
  return;
}
}
#line 1736 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static void append_evaluation(Move *move_details , Board const   *board ) 
{ 
  CommentList *comment ;
  void *tmp ;
  char valueSpace[14] ;
  char *evaluation ;
  void *tmp___0 ;
  StringList *current_comment ;
  double value ;
  double tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;

  {
  {
#line 1739
  tmp = MallocOrDie(sizeof(*comment));
#line 1739
  comment = (CommentList *)tmp;
#line 1744
  valueSpace[0] = (char )'-';
#line 1744
  valueSpace[1] = (char )'0';
#line 1744
  valueSpace[2] = (char )'1';
#line 1744
  valueSpace[3] = (char )'2';
#line 1744
  valueSpace[4] = (char )'4';
#line 1744
  valueSpace[5] = (char )'5';
#line 1744
  valueSpace[6] = (char )'6';
#line 1744
  valueSpace[7] = (char )'7';
#line 1744
  valueSpace[8] = (char )'8';
#line 1744
  valueSpace[9] = (char )'9';
#line 1744
  valueSpace[10] = (char )'.';
#line 1744
  valueSpace[11] = (char )'0';
#line 1744
  valueSpace[12] = (char )'0';
#line 1744
  valueSpace[13] = (char )'\000';
#line 1745
  tmp___0 = MallocOrDie(sizeof(valueSpace));
#line 1745
  evaluation = (char *)tmp___0;
#line 1748
  tmp___1 = evaluate(board);
#line 1748
  value = tmp___1;
#line 1751
  sprintf((char */* __restrict  */)evaluation, (char const   */* __restrict  */)"%.2f",
          value);
#line 1752
  tmp___2 = strlen((char const   *)evaluation);
#line 1752
  tmp___3 = strlen((char const   *)(valueSpace));
  }
#line 1752
  if (tmp___2 > tmp___3) {
    {
#line 1753
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Overflow in evaluation space in append_evaluation()\n");
#line 1755
    exit(1);
    }
  }
  {
#line 1758
  current_comment = SaveStringListItem((StringList *)((void *)0), (char const   *)evaluation);
#line 1759
  comment->Comment = current_comment;
#line 1760
  comment->next = (struct comment_list *)((void *)0);
#line 1761
  append_comments_to_move(move_details, comment);
  }
#line 1762
  return;
}
}
#line 1767 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
CommentList *create_match_comment(Move *move_details ) 
{ 
  char *match_comment ;
  char *tmp ;
  StringList *current_comment ;
  StringList *tmp___0 ;
  CommentList *comment ;
  void *tmp___1 ;

  {
  {
#line 1771
  tmp = StringCopy(GlobalState.position_match_comment);
#line 1771
  match_comment = tmp;
#line 1772
  tmp___0 = SaveStringListItem((StringList *)((void *)0), (char const   *)match_comment);
#line 1772
  current_comment = tmp___0;
#line 1773
  tmp___1 = MallocOrDie(sizeof(*comment));
#line 1773
  comment = (CommentList *)tmp___1;
#line 1775
  comment->Comment = current_comment;
#line 1776
  comment->next = (struct comment_list *)((void *)0);
  }
#line 1777
  return (comment);
}
}
#line 1780 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static double evaluate(Board const   *board ) 
{ 
  double tmp ;

  {
  {
#line 1783
  tmp = shannonEvaluation(board);
  }
#line 1783
  return (tmp);
}
}
#line 1789 "/home/wheatley/newnew/temp/pgn-extract-17.14/apply.c"
static double shannonEvaluation(Board const   *board ) 
{ 
  MovePair *white_moves ;
  MovePair *black_moves ;
  int whiteMoveCount ;
  int blackMoveCount ;
  int whitePieceCount ;
  int blackPieceCount ;
  double shannonValue ;
  Rank rank ;
  Col col ;
  MovePair *m ;
  MovePair *m___0 ;
  short r ;
  int tmp ;
  short c ;
  int tmp___0 ;
  int pieceValue ;
  Piece occupant ;
  Piece piece ;

  {
  {
#line 1793
  whiteMoveCount = 0;
#line 1793
  blackMoveCount = 0;
#line 1794
  whitePieceCount = 0;
#line 1794
  blackPieceCount = 0;
#line 1795
  shannonValue = 0.0;
#line 1801
  white_moves = find_all_moves(board, (Colour )1);
  }
#line 1802
  if ((unsigned long )white_moves != (unsigned long )((void *)0)) {
#line 1804
    m = white_moves;
    {
#line 1804
    while (1) {
      while_continue: /* CIL Label */ ;
#line 1804
      if (! ((unsigned long )m != (unsigned long )((void *)0))) {
#line 1804
        goto while_break;
      }
#line 1805
      whiteMoveCount ++;
#line 1804
      m = m->next;
    }
    while_break: /* CIL Label */ ;
    }
    {
#line 1807
    free_move_pair_list(white_moves);
    }
  }
  {
#line 1810
  black_moves = find_all_moves(board, (Colour )0);
  }
#line 1811
  if ((unsigned long )black_moves != (unsigned long )((void *)0)) {
#line 1813
    m___0 = black_moves;
    {
#line 1813
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 1813
      if (! ((unsigned long )m___0 != (unsigned long )((void *)0))) {
#line 1813
        goto while_break___0;
      }
#line 1814
      blackMoveCount ++;
#line 1813
      m___0 = m___0->next;
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 1816
    free_move_pair_list(black_moves);
    }
  }
#line 1821
  rank = (Rank )56;
  {
#line 1821
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 1821
    if (! ((int )rank >= 49)) {
#line 1821
      goto while_break___1;
    }
#line 1822
    if (49 <= (int )rank) {
#line 1822
      if ((int )rank <= 56) {
#line 1822
        tmp = ((int )rank - 49) + 2;
      } else {
#line 1822
        tmp = 0;
      }
    } else {
#line 1822
      tmp = 0;
    }
#line 1822
    r = (short )tmp;
#line 1823
    col = (Col )'a';
    {
#line 1823
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 1823
      if (! ((int )col <= 104)) {
#line 1823
        goto while_break___2;
      }
#line 1824
      if (97 <= (int )col) {
#line 1824
        if ((int )col <= 104) {
#line 1824
          tmp___0 = ((int )col - 97) + 2;
        } else {
#line 1824
          tmp___0 = 0;
        }
      } else {
#line 1824
        tmp___0 = 0;
      }
#line 1824
      c = (short )tmp___0;
#line 1825
      pieceValue = 0;
#line 1826
      occupant = board->board[r][c];
#line 1827
      if ((unsigned int )occupant != 1U) {
#line 1829
        piece = (Piece )((unsigned int )occupant >> 3);
        {
#line 1832
        if ((unsigned int )piece == 2U) {
#line 1832
          goto case_2;
        }
#line 1836
        if ((unsigned int )piece == 3U) {
#line 1836
          goto case_3;
        }
#line 1836
        if ((unsigned int )piece == 4U) {
#line 1836
          goto case_3;
        }
#line 1839
        if ((unsigned int )piece == 5U) {
#line 1839
          goto case_5;
        }
#line 1842
        if ((unsigned int )piece == 6U) {
#line 1842
          goto case_6;
        }
#line 1845
        if ((unsigned int )piece == 7U) {
#line 1845
          goto case_7;
        }
#line 1847
        goto switch_default;
        case_2: /* CIL Label */ 
#line 1833
        pieceValue = 1;
#line 1834
        goto switch_break;
        case_3: /* CIL Label */ 
        case_4: /* CIL Label */ 
#line 1837
        pieceValue = 3;
#line 1838
        goto switch_break;
        case_5: /* CIL Label */ 
#line 1840
        pieceValue = 5;
#line 1841
        goto switch_break;
        case_6: /* CIL Label */ 
#line 1843
        pieceValue = 9;
#line 1844
        goto switch_break;
        case_7: /* CIL Label */ 
#line 1846
        goto switch_break;
        switch_default: /* CIL Label */ 
        {
#line 1848
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: unknown piece %d in append_evaluation().\n",
                (unsigned int )piece);
        }
        switch_break: /* CIL Label */ ;
        }
#line 1852
        if (((unsigned int )occupant & 1U) == 1U) {
#line 1853
          whitePieceCount += pieceValue;
        } else {
#line 1856
          blackPieceCount += pieceValue;
        }
      }
#line 1823
      col = (Col )((int )col + 1);
    }
    while_break___2: /* CIL Label */ ;
    }
#line 1821
    rank = (Rank )((int )rank - 1);
  }
  while_break___1: /* CIL Label */ ;
  }
#line 1862
  shannonValue = (double )(whitePieceCount - blackPieceCount) + (double )(whiteMoveCount - blackMoveCount) * 0.1;
#line 1864
  return (shannonValue);
}
}
#line 23 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.h"
Boolean build_endings(char const   *infile ) ;
#line 24
Boolean process_ending_line(char const   *line___1 ) ;
#line 81 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static Ending_details *endings_to_match  =    (Ending_details *)((void *)0);
#line 89 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static Piece is_English_piece(char c ) 
{ 
  Piece piece ;

  {
#line 91
  piece = (Piece )1;
  {
#line 94
  if ((int )c == 107) {
#line 94
    goto case_107;
  }
#line 94
  if ((int )c == 75) {
#line 94
    goto case_107;
  }
#line 97
  if ((int )c == 113) {
#line 97
    goto case_113;
  }
#line 97
  if ((int )c == 81) {
#line 97
    goto case_113;
  }
#line 100
  if ((int )c == 114) {
#line 100
    goto case_114;
  }
#line 100
  if ((int )c == 82) {
#line 100
    goto case_114;
  }
#line 103
  if ((int )c == 110) {
#line 103
    goto case_110;
  }
#line 103
  if ((int )c == 78) {
#line 103
    goto case_110;
  }
#line 106
  if ((int )c == 98) {
#line 106
    goto case_98;
  }
#line 106
  if ((int )c == 66) {
#line 106
    goto case_98;
  }
#line 109
  if ((int )c == 112) {
#line 109
    goto case_112;
  }
#line 109
  if ((int )c == 80) {
#line 109
    goto case_112;
  }
#line 93
  goto switch_break;
  case_107: /* CIL Label */ 
  case_75: /* CIL Label */ 
#line 95
  piece = (Piece )7;
#line 96
  goto switch_break;
  case_113: /* CIL Label */ 
  case_81: /* CIL Label */ 
#line 98
  piece = (Piece )6;
#line 99
  goto switch_break;
  case_114: /* CIL Label */ 
  case_82: /* CIL Label */ 
#line 101
  piece = (Piece )5;
#line 102
  goto switch_break;
  case_110: /* CIL Label */ 
  case_78: /* CIL Label */ 
#line 104
  piece = (Piece )3;
#line 105
  goto switch_break;
  case_98: /* CIL Label */ 
  case_66: /* CIL Label */ 
#line 107
  piece = (Piece )4;
#line 108
  goto switch_break;
  case_112: /* CIL Label */ 
  case_80: /* CIL Label */ 
#line 110
  piece = (Piece )2;
#line 111
  goto switch_break;
  switch_break: /* CIL Label */ ;
  }
#line 113
  return (piece);
}
}
#line 119 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static Ending_details *new_ending_details(void) 
{ 
  Ending_details *details ;
  void *tmp ;
  int c ;
  Piece piece ;

  {
  {
#line 121
  tmp = MallocOrDie(sizeof(Ending_details ));
#line 121
  details = (Ending_details *)tmp;
#line 125
  piece = (Piece )2;
  }
  {
#line 125
  while (1) {
    while_continue: /* CIL Label */ ;
#line 125
    if (! ((unsigned int )piece <= 7U)) {
#line 125
      goto while_break;
    }
#line 126
    c = 0;
    {
#line 126
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 126
      if (! (c < 2)) {
#line 126
        goto while_break___0;
      }
#line 127
      details->num_pieces[c][piece] = 0;
#line 128
      details->occurs[c][piece] = (Occurs )0;
#line 126
      c ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 125
    piece = (Piece )((unsigned int )piece + 1U);
  }
  while_break: /* CIL Label */ ;
  }
#line 132
  c = 0;
  {
#line 132
  while (1) {
    while_continue___1: /* CIL Label */ ;
#line 132
    if (! (c < 2)) {
#line 132
      goto while_break___1;
    }
#line 134
    details->num_pieces[c][7] = 1;
#line 135
    details->match_depth[c] = 0U;
#line 137
    details->num_minor_pieces[c] = 0;
#line 138
    details->minor_occurs[c] = (Occurs )0;
#line 132
    c ++;
  }
  while_break___1: /* CIL Label */ ;
  }
#line 143
  details->move_depth = 2U;
#line 144
  details->next = (struct ending_details *)((void *)0);
#line 145
  return (details);
}
}
#line 148 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static char const   *extract_combination(char const   *p , Occurs *p_occurs , int *p_number ,
                                         char const   *line___1 ) 
{ 
  Boolean Ok ;
  Occurs occurs ;
  int number ;
  unsigned short const   **tmp ;
  unsigned short const   **tmp___0 ;
  unsigned short const   **tmp___1 ;

  {
  {
#line 150
  Ok = (Boolean )1;
#line 151
  occurs = (Occurs )0;
#line 152
  number = 1;
#line 154
  tmp___1 = __ctype_b_loc();
  }
#line 154
  if ((int const   )*(*tmp___1 + (int )*p) & 2048) {
    {
#line 156
    number = (int )((int const   )*p - 48);
#line 157
    p ++;
#line 158
    tmp___0 = __ctype_b_loc();
    }
#line 158
    if ((int const   )*(*tmp___0 + (int )*p) & 2048) {
      {
#line 159
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Number > 9 is too big in %s.\n",
              line___1);
      }
      {
#line 161
      while (1) {
        while_continue: /* CIL Label */ ;
        {
#line 161
        tmp = __ctype_b_loc();
        }
#line 161
        if (! ((int const   )*(*tmp + (int )*p) & 2048)) {
#line 161
          goto while_break;
        }
#line 162
        p ++;
      }
      while_break: /* CIL Label */ ;
      }
#line 164
      Ok = (Boolean )0;
    }
  }
#line 167
  if (Ok) {
    {
#line 170
    if ((int const   )*p == 42) {
#line 170
      goto case_42;
    }
#line 175
    if ((int const   )*p == 43) {
#line 175
      goto case_43;
    }
#line 179
    if ((int const   )*p == 45) {
#line 179
      goto case_45;
    }
#line 183
    if ((int const   )*p == 63) {
#line 183
      goto case_63;
    }
#line 191
    if ((int const   )*p == 62) {
#line 191
      goto case_62;
    }
#line 191
    if ((int const   )*p == 60) {
#line 191
      goto case_62;
    }
#line 191
    if ((int const   )*p == 35) {
#line 191
      goto case_62;
    }
#line 191
    if ((int const   )*p == 61) {
#line 191
      goto case_62;
    }
#line 169
    goto switch_break;
    case_42: /* CIL Label */ 
#line 171
    number = 0;
#line 172
    occurs = (Occurs )1;
#line 173
    p ++;
#line 174
    goto switch_break;
    case_43: /* CIL Label */ 
#line 176
    occurs = (Occurs )1;
#line 177
    p ++;
#line 178
    goto switch_break;
    case_45: /* CIL Label */ 
#line 180
    occurs = (Occurs )2;
#line 181
    p ++;
#line 182
    goto switch_break;
    case_63: /* CIL Label */ 
#line 184
    number = 1;
#line 185
    occurs = (Occurs )2;
#line 186
    p ++;
#line 187
    goto switch_break;
    case_62: /* CIL Label */ 
    case_60: /* CIL Label */ 
    case_35: /* CIL Label */ 
    case_61: /* CIL Label */ 
    {
#line 193
    if ((int const   )*p == 61) {
#line 193
      goto case_61___0;
    }
#line 197
    if ((int const   )*p == 35) {
#line 197
      goto case_35___0;
    }
#line 201
    if ((int const   )*p == 60) {
#line 201
      goto case_60___0;
    }
#line 211
    if ((int const   )*p == 62) {
#line 211
      goto case_62___0;
    }
#line 192
    goto switch_break___0;
    case_61___0: /* CIL Label */ 
#line 194
    p ++;
#line 195
    occurs = (Occurs )3;
#line 196
    goto switch_break___0;
    case_35___0: /* CIL Label */ 
#line 198
    p ++;
#line 199
    occurs = (Occurs )4;
#line 200
    goto switch_break___0;
    case_60___0: /* CIL Label */ 
#line 202
    p ++;
#line 203
    if ((int const   )*p == 61) {
#line 204
      occurs = (Occurs )7;
#line 205
      p ++;
    } else {
#line 208
      occurs = (Occurs )5;
    }
#line 210
    goto switch_break___0;
    case_62___0: /* CIL Label */ 
#line 212
    p ++;
#line 213
    if ((int const   )*p == 61) {
#line 214
      occurs = (Occurs )8;
#line 215
      p ++;
    } else {
#line 218
      occurs = (Occurs )6;
    }
#line 220
    goto switch_break___0;
    switch_break___0: /* CIL Label */ ;
    }
#line 222
    goto switch_break;
    switch_break: /* CIL Label */ ;
    }
  }
#line 226
  if (Ok) {
#line 227
    *p_occurs = occurs;
#line 228
    *p_number = number;
#line 229
    return (p);
  } else {
#line 232
    return ((char const   *)((void *)0));
  }
}
}
#line 248 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static char const   *extract_piece_information(char const   *line___1 , Ending_details *details ,
                                               Colour colour ) 
{ 
  char const   *p ;
  Boolean Ok ;
  Piece piece ;
  Piece tmp ;
  Occurs occurs ;
  int number ;
  unsigned short const   **tmp___0 ;
  int tmp___1 ;
  unsigned short const   **tmp___2 ;

  {
#line 250
  p = line___1;
#line 251
  Ok = (Boolean )1;
  {
#line 253
  while (1) {
    while_continue: /* CIL Label */ ;
#line 253
    if (Ok) {
#line 253
      if ((int const   )*p != 0) {
        {
#line 253
        tmp___2 = __ctype_b_loc();
        }
#line 253
        if ((int const   )*(*tmp___2 + (int )*p) & 8192) {
#line 253
          goto while_break;
        }
      } else {
#line 253
        goto while_break;
      }
    } else {
#line 253
      goto while_break;
    }
    {
#line 254
    tmp = is_English_piece((char )*p);
#line 254
    piece = tmp;
#line 256
    occurs = (Occurs )0;
#line 257
    number = 1;
    }
#line 259
    if ((unsigned int )piece != 1U) {
      {
#line 262
      p ++;
#line 263
      p = extract_combination(p, & occurs, & number, line___1);
      }
#line 264
      if ((unsigned long )p != (unsigned long )((void *)0)) {
#line 265
        if ((unsigned int )piece == 7U) {
#line 265
          if (number != 1) {
            {
#line 266
            fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"A king must occur exactly once.\n");
#line 267
            number = 1;
            }
          } else {
#line 265
            goto _L;
          }
        } else
        _L: /* CIL Label */ 
#line 269
        if ((unsigned int )piece == 2U) {
#line 269
          if (number > 8) {
            {
#line 270
            fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"No more than 8 pawns are allowed.\n");
#line 272
            number = 8;
            }
          }
        }
#line 274
        details->num_pieces[colour][piece] = number;
#line 275
        details->occurs[colour][piece] = occurs;
      } else {
#line 278
        Ok = (Boolean )0;
      }
    } else {
      {
#line 281
      tmp___0 = __ctype_b_loc();
      }
#line 281
      if ((int const   )*(*tmp___0 + (int )*p) & 1024) {
        {
#line 281
        tmp___1 = toupper((int )*p);
        }
#line 281
        if (tmp___1 == 76) {
          {
#line 282
          p ++;
#line 283
          p = extract_combination(p, & occurs, & number, line___1);
          }
#line 284
          if ((unsigned long )p != (unsigned long )((void *)0)) {
#line 285
            details->num_minor_pieces[colour] = number;
#line 286
            details->minor_occurs[colour] = occurs;
          } else {
#line 289
            Ok = (Boolean )0;
          }
        } else {
          {
#line 293
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown symbol at %s\n",
                  p);
#line 294
          Ok = (Boolean )0;
          }
        }
      } else {
        {
#line 293
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown symbol at %s\n",
                p);
#line 294
        Ok = (Boolean )0;
        }
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 297
  if (Ok) {
#line 299
    if (details->num_minor_pieces[colour] > 0) {
#line 299
      goto _L___0;
    } else
#line 299
    if ((unsigned int )details->minor_occurs[colour] != 0U) {
      _L___0: /* CIL Label */ 
#line 302
      if (details->num_pieces[colour][4] > 0) {
        {
#line 306
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Warning: the mixture of minor pieces in %s is not guaranteed to work.\n",
                line___1);
#line 309
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"In a single set it is advisable to stick to either L or B and/or N.\n");
        }
      } else
#line 302
      if ((unsigned int )details->occurs[colour][4] != 0U) {
        {
#line 306
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Warning: the mixture of minor pieces in %s is not guaranteed to work.\n",
                line___1);
#line 309
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"In a single set it is advisable to stick to either L or B and/or N.\n");
        }
      } else
#line 302
      if (details->num_pieces[colour][3] > 0) {
        {
#line 306
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Warning: the mixture of minor pieces in %s is not guaranteed to work.\n",
                line___1);
#line 309
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"In a single set it is advisable to stick to either L or B and/or N.\n");
        }
      } else
#line 302
      if ((unsigned int )details->occurs[colour][3] != 0U) {
        {
#line 306
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Warning: the mixture of minor pieces in %s is not guaranteed to work.\n",
                line___1);
#line 309
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"In a single set it is advisable to stick to either L or B and/or N.\n");
        }
      }
    }
#line 313
    return (p);
  } else {
#line 316
    return ((char const   *)((void *)0));
  }
}
}
#line 320 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static Boolean decompose_line(char const   *line___1 , Ending_details *details ) 
{ 
  char const   *p ;
  Boolean Ok ;
  unsigned short const   **tmp ;
  unsigned int depth ;
  unsigned short const   **tmp___0 ;
  unsigned short const   **tmp___1 ;
  unsigned short const   **tmp___2 ;
  unsigned short const   **tmp___3 ;
  Piece piece ;

  {
#line 322
  p = line___1;
#line 323
  Ok = (Boolean )1;
  {
#line 326
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 326
    tmp = __ctype_b_loc();
    }
#line 326
    if (! ((int const   )*(*tmp + (int )*p) & 8192)) {
#line 326
      goto while_break;
    }
#line 327
    p ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 331
  tmp___2 = __ctype_b_loc();
  }
#line 331
  if ((int const   )*(*tmp___2 + (int )*p) & 2048) {
#line 334
    depth = (unsigned int )((int const   )*p - 48);
#line 335
    p ++;
    {
#line 336
    while (1) {
      while_continue___0: /* CIL Label */ ;
      {
#line 336
      tmp___0 = __ctype_b_loc();
      }
#line 336
      if (! ((int const   )*(*tmp___0 + (int )*p) & 2048)) {
#line 336
        goto while_break___0;
      }
#line 337
      depth = depth * 10U + (unsigned int )((int const   )*p - 48);
#line 338
      p ++;
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 340
    while (1) {
      while_continue___1: /* CIL Label */ ;
      {
#line 340
      tmp___1 = __ctype_b_loc();
      }
#line 340
      if (! ((int const   )*(*tmp___1 + (int )*p) & 8192)) {
#line 340
        goto while_break___1;
      }
#line 341
      p ++;
    }
    while_break___1: /* CIL Label */ ;
    }
#line 343
    details->move_depth = depth;
  }
  {
#line 347
  p = extract_piece_information(p, details, (Colour )1);
  }
#line 348
  if ((unsigned long )p != (unsigned long )((void *)0)) {
    {
#line 349
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 349
      if ((int const   )*p != 0) {
        {
#line 349
        tmp___3 = __ctype_b_loc();
        }
#line 349
        if (! ((int const   )*(*tmp___3 + (int )*p) & 8192)) {
#line 349
          goto while_break___2;
        }
      } else {
#line 349
        goto while_break___2;
      }
#line 350
      p ++;
    }
    while_break___2: /* CIL Label */ ;
    }
#line 352
    if ((int const   )*p != 0) {
      {
#line 353
      p = extract_piece_information(p, details, (Colour )0);
      }
    } else {
#line 359
      piece = (Piece )2;
      {
#line 359
      while (1) {
        while_continue___3: /* CIL Label */ ;
#line 359
        if (! ((unsigned int )piece <= 7U)) {
#line 359
          goto while_break___3;
        }
#line 360
        details->num_pieces[0][piece] = 0;
#line 361
        details->occurs[0][piece] = (Occurs )1;
#line 359
        piece = (Piece )((unsigned int )piece + 1U);
      }
      while_break___3: /* CIL Label */ ;
      }
#line 363
      details->num_pieces[0][7] = 1;
#line 364
      details->occurs[0][7] = (Occurs )0;
    }
  }
#line 367
  if (! ((unsigned long )p != (unsigned long )((void *)0))) {
#line 371
    Ok = (Boolean )0;
  }
#line 373
  return (Ok);
}
}
#line 379 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static void reset_match_depths(Ending_details *endings ) 
{ 


  {
  {
#line 382
  while (1) {
    while_continue: /* CIL Label */ ;
#line 382
    if (! ((unsigned long )endings != (unsigned long )((void *)0))) {
#line 382
      goto while_break;
    }
#line 383
    endings->match_depth[1] = 0U;
#line 384
    endings->match_depth[0] = 0U;
#line 382
    endings = endings->next;
  }
  while_break: /* CIL Label */ ;
  }
#line 386
  return;
}
}
#line 389 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static Boolean piece_match(int num_available , int num_to_find , int num_opponents ,
                           Occurs occurs ) 
{ 
  Boolean match ;

  {
#line 391
  match = (Boolean )0;
  {
#line 394
  if ((unsigned int )occurs == 0U) {
#line 394
    goto case_0;
  }
#line 397
  if ((unsigned int )occurs == 1U) {
#line 397
    goto case_1;
  }
#line 400
  if ((unsigned int )occurs == 2U) {
#line 400
    goto case_2;
  }
#line 403
  if ((unsigned int )occurs == 3U) {
#line 403
    goto case_3;
  }
#line 406
  if ((unsigned int )occurs == 4U) {
#line 406
    goto case_4;
  }
#line 409
  if ((unsigned int )occurs == 5U) {
#line 409
    goto case_5;
  }
#line 412
  if ((unsigned int )occurs == 6U) {
#line 412
    goto case_6;
  }
#line 415
  if ((unsigned int )occurs == 7U) {
#line 415
    goto case_7;
  }
#line 421
  if ((unsigned int )occurs == 8U) {
#line 421
    goto case_8;
  }
#line 427
  goto switch_default;
  case_0: /* CIL Label */ 
#line 395
  match = (Boolean )(num_available == num_to_find);
#line 396
  goto switch_break;
  case_1: /* CIL Label */ 
#line 398
  match = (Boolean )(num_available >= num_to_find);
#line 399
  goto switch_break;
  case_2: /* CIL Label */ 
#line 401
  match = (Boolean )(num_available <= num_to_find);
#line 402
  goto switch_break;
  case_3: /* CIL Label */ 
#line 404
  match = (Boolean )(num_available == num_opponents);
#line 405
  goto switch_break;
  case_4: /* CIL Label */ 
#line 407
  match = (Boolean )(num_available != num_opponents);
#line 408
  goto switch_break;
  case_5: /* CIL Label */ 
#line 410
  match = (Boolean )(num_available + num_to_find <= num_opponents);
#line 411
  goto switch_break;
  case_6: /* CIL Label */ 
#line 413
  match = (Boolean )(num_available - num_to_find >= num_opponents);
#line 414
  goto switch_break;
  case_7: /* CIL Label */ 
#line 419
  match = (Boolean )(num_available + num_to_find == num_opponents);
#line 420
  goto switch_break;
  case_8: /* CIL Label */ 
#line 425
  match = (Boolean )(num_available - num_to_find == num_opponents);
#line 426
  goto switch_break;
  switch_default: /* CIL Label */ 
  {
#line 428
  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Inconsistent state %d in piece_match.\n",
          (unsigned int )occurs);
#line 430
  match = (Boolean )0;
  }
  switch_break: /* CIL Label */ ;
  }
#line 432
  return (match);
}
}
#line 438 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static Boolean piece_set_match(Ending_details *details_to_find , int (*num_pieces)[8] ,
                               Colour game_colour , Colour piece_set_colour ) 
{ 
  Boolean match ;
  Piece piece ;
  Boolean minor_failure ;
  int num_available ;
  int num_opponents ;
  int num_to_find ;
  Occurs occurs ;
  int num_to_find___0 ;
  Occurs occurs___0 ;
  int num_available___0 ;
  int num_opponents___0 ;

  {
#line 442
  match = (Boolean )1;
#line 445
  minor_failure = (Boolean )0;
#line 448
  piece = (Piece )2;
  {
#line 448
  while (1) {
    while_continue: /* CIL Label */ ;
#line 448
    if ((unsigned int )piece < 7U) {
#line 448
      if (! match) {
#line 448
        goto while_break;
      }
    } else {
#line 448
      goto while_break;
    }
    {
#line 449
    num_available = (*(num_pieces + game_colour))[piece];
#line 450
    num_opponents = (*(num_pieces + ! game_colour))[piece];
#line 451
    num_to_find = details_to_find->num_pieces[piece_set_colour][piece];
#line 452
    occurs = details_to_find->occurs[piece_set_colour][piece];
#line 454
    match = piece_match(num_available, num_to_find, num_opponents, occurs);
    }
#line 455
    if (! match) {
#line 456
      if ((unsigned int )piece == 3U) {
#line 457
        minor_failure = (Boolean )1;
#line 459
        match = (Boolean )1;
      } else
#line 456
      if ((unsigned int )piece == 4U) {
#line 457
        minor_failure = (Boolean )1;
#line 459
        match = (Boolean )1;
      } else {
#line 462
        minor_failure = (Boolean )0;
      }
    }
#line 448
    piece = (Piece )((unsigned int )piece + 1U);
  }
  while_break: /* CIL Label */ ;
  }
#line 466
  if (match) {
#line 470
    num_to_find___0 = details_to_find->num_minor_pieces[piece_set_colour];
#line 471
    occurs___0 = details_to_find->minor_occurs[piece_set_colour];
#line 473
    if (num_to_find___0 > 0) {
      {
#line 474
      num_available___0 = (*(num_pieces + game_colour))[4] + (*(num_pieces + game_colour))[3];
#line 477
      num_opponents___0 = (*(num_pieces + ! game_colour))[4] + (*(num_pieces + ! game_colour))[3];
#line 480
      match = piece_match(num_available___0, num_to_find___0, num_opponents___0, occurs___0);
      }
    } else
#line 473
    if ((unsigned int )occurs___0 != 0U) {
      {
#line 474
      num_available___0 = (*(num_pieces + game_colour))[4] + (*(num_pieces + game_colour))[3];
#line 477
      num_opponents___0 = (*(num_pieces + ! game_colour))[4] + (*(num_pieces + ! game_colour))[3];
#line 480
      match = piece_match(num_available___0, num_to_find___0, num_opponents___0, occurs___0);
      }
    } else
#line 482
    if (minor_failure) {
#line 486
      match = (Boolean )0;
    }
  }
#line 492
  return (match);
}
}
#line 498 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static Boolean ending_match(Ending_details *details_to_find , int (*num_pieces)[8] ,
                            Boolean white_first ) 
{ 
  Boolean match ;
  Colour game_colour ;
  int tmp ;
  Colour piece_set_colour ;

  {
#line 501
  match = (Boolean )1;
#line 503
  if (white_first) {
#line 503
    tmp = 1;
  } else {
#line 503
    tmp = 0;
  }
  {
#line 503
  game_colour = (Colour )tmp;
#line 504
  piece_set_colour = (Colour )1;
#line 506
  match = piece_set_match(details_to_find, num_pieces, game_colour, piece_set_colour);
  }
#line 508
  if (match) {
    {
#line 509
    game_colour = (Colour )(! game_colour);
#line 510
    piece_set_colour = (Colour )(! piece_set_colour);
#line 511
    match = piece_set_match(details_to_find, num_pieces, game_colour, piece_set_colour);
#line 514
    game_colour = (Colour )(! game_colour);
    }
  }
#line 517
  if (match) {
#line 518
    (details_to_find->match_depth[game_colour]) ++;
#line 519
    if (details_to_find->match_depth[game_colour] < details_to_find->move_depth) {
#line 521
      match = (Boolean )0;
    }
  } else {
#line 526
    details_to_find->match_depth[game_colour] = 0U;
  }
#line 528
  return (match);
}
}
#line 531 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
static Boolean look_for_ending(Move *moves , Ending_details *details_to_find ) 
{ 
  Boolean game_ok ;
  Boolean game_matches ;
  Boolean match_comment_added ;
  Move *next_move ;
  Colour colour ;
  int num_pieces[2][8] ;
  unsigned int move_number ;
  Boolean tmp ;
  Boolean tmp___0 ;
  CommentList *comment ;
  CommentList *tmp___1 ;

  {
  {
#line 533
  game_ok = (Boolean )1;
#line 534
  game_matches = (Boolean )0;
#line 535
  match_comment_added = (Boolean )0;
#line 536
  next_move = moves;
#line 537
  colour = (Colour )1;
#line 539
  num_pieces[0][0] = 0;
#line 539
  num_pieces[0][1] = 0;
#line 539
  num_pieces[0][2] = 8;
#line 539
  num_pieces[0][3] = 2;
#line 539
  num_pieces[0][4] = 2;
#line 539
  num_pieces[0][5] = 2;
#line 539
  num_pieces[0][6] = 1;
#line 539
  num_pieces[0][7] = 1;
#line 539
  num_pieces[1][0] = 0;
#line 539
  num_pieces[1][1] = 0;
#line 539
  num_pieces[1][2] = 8;
#line 539
  num_pieces[1][3] = 2;
#line 539
  num_pieces[1][4] = 2;
#line 539
  num_pieces[1][5] = 2;
#line 539
  num_pieces[1][6] = 1;
#line 539
  num_pieces[1][7] = 1;
#line 545
  move_number = 1U;
#line 548
  reset_match_depths(endings_to_match);
  }
  {
#line 553
  while (1) {
    while_continue: /* CIL Label */ ;
#line 553
    if (game_ok) {
#line 553
      if ((unsigned long )next_move != (unsigned long )((void *)0)) {
#line 553
        if (! (! game_matches)) {
#line 553
          goto while_break;
        }
      } else {
#line 553
        goto while_break;
      }
    } else {
#line 553
      goto while_break;
    }
    {
#line 559
    tmp = ending_match(details_to_find, (int (*)[8])(num_pieces), (Boolean )1);
#line 559
    tmp___0 = ending_match(details_to_find, (int (*)[8])(num_pieces), (Boolean )0);
#line 559
    game_matches = (Boolean )((unsigned int )tmp | (unsigned int )tmp___0);
    }
#line 561
    if (! game_matches) {
#line 562
      if ((int )next_move->move[0] != 0) {
#line 564
        if ((unsigned int )next_move->captured_piece != 1U) {
#line 565
          (num_pieces[! colour][next_move->captured_piece]) --;
        }
#line 567
        if ((unsigned int )next_move->promoted_piece != 1U) {
#line 568
          (num_pieces[! colour][next_move->promoted_piece]) ++;
#line 570
          (num_pieces[! colour][2]) --;
        }
#line 573
        colour = (Colour )(! colour);
#line 574
        next_move = next_move->next;
#line 575
        if ((unsigned int )colour == 1U) {
#line 576
          move_number ++;
        }
      } else {
        {
#line 581
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Empty move in look_for_ending.\n");
#line 583
        game_ok = (Boolean )0;
        }
      }
    } else
#line 590
    if (GlobalState.add_position_match_comments) {
#line 590
      if (! match_comment_added) {
#line 591
        if ((unsigned long )next_move != (unsigned long )((void *)0)) {
          {
#line 592
          tmp___1 = create_match_comment(next_move);
#line 592
          comment = tmp___1;
#line 593
          append_comments_to_move(next_move, comment);
          }
        }
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 598
  if (! game_ok) {
#line 599
    game_matches = (Boolean )0;
  }
#line 601
  return (game_matches);
}
}
#line 604 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
Boolean check_for_ending(Move *moves ) 
{ 
  Boolean matches ;
  int tmp ;
  Ending_details *details ;

  {
#line 607
  if ((unsigned long )endings_to_match == (unsigned long )((void *)0)) {
#line 607
    tmp = 1;
  } else {
#line 607
    tmp = 0;
  }
#line 607
  matches = (Boolean )tmp;
#line 610
  details = endings_to_match;
  {
#line 610
  while (1) {
    while_continue: /* CIL Label */ ;
#line 610
    if (! matches) {
#line 610
      if (! ((unsigned long )details != (unsigned long )((void *)0))) {
#line 610
        goto while_break;
      }
    } else {
#line 610
      goto while_break;
    }
    {
#line 612
    matches = look_for_ending(moves, details);
#line 610
    details = details->next;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 614
  return (matches);
}
}
#line 617 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
Boolean process_ending_line(char const   *line___1 ) 
{ 
  Boolean Ok ;
  Ending_details *details ;
  Ending_details *tmp ;
  Boolean tmp___0 ;
  Boolean tmp___1 ;

  {
  {
#line 619
  Ok = (Boolean )1;
#line 621
  tmp___1 = non_blank_line(line___1);
  }
#line 621
  if (tmp___1) {
    {
#line 622
    tmp = new_ending_details();
#line 622
    details = tmp;
#line 624
    tmp___0 = decompose_line(line___1, details);
    }
#line 624
    if (tmp___0) {
#line 626
      details->next = endings_to_match;
#line 627
      endings_to_match = details;
    } else {
#line 630
      Ok = (Boolean )0;
    }
  }
#line 633
  return (Ok);
}
}
#line 636 "/home/wheatley/newnew/temp/pgn-extract-17.14/end.c"
Boolean build_endings(char const   *infile ) 
{ 
  FILE *fp ;
  FILE *tmp ;
  Boolean Ok ;
  char *line___1 ;
  Boolean tmp___0 ;

  {
  {
#line 638
  tmp = fopen((char const   */* __restrict  */)infile, (char const   */* __restrict  */)"r");
#line 638
  fp = tmp;
#line 639
  Ok = (Boolean )1;
  }
#line 641
  if ((unsigned long )fp == (unsigned long )((void *)0)) {
    {
#line 642
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Cannot open %s for reading.\n",
            infile);
#line 643
    exit(1);
    }
  } else {
    {
#line 647
    while (1) {
      while_continue: /* CIL Label */ ;
      {
#line 647
      line___1 = read_line(fp);
      }
#line 647
      if (! ((unsigned long )line___1 != (unsigned long )((void *)0))) {
#line 647
        goto while_break;
      }
      {
#line 648
      tmp___0 = process_ending_line((char const   *)line___1);
#line 648
      Ok = (Boolean )((unsigned int )Ok & (unsigned int )tmp___0);
#line 649
      free((void *)line___1);
      }
    }
    while_break: /* CIL Label */ ;
    }
    {
#line 651
    fclose(fp);
    }
  }
#line 653
  return (Ok);
}
}
#line 466 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) malloc)(size_t __size )  __attribute__((__malloc__)) ;
#line 26 "/home/wheatley/newnew/temp/pgn-extract-17.14/mymalloc.c"
void *MallocOrDie(size_t nbytes ) 
{ 
  void *result ;

  {
  {
#line 30
  result = malloc(nbytes);
  }
#line 31
  if ((unsigned long )result == (unsigned long )((void *)0)) {
    {
#line 32
    perror("Malloc Or Die");
#line 33
    abort();
    }
  }
#line 35
  return (result);
}
}
#line 38 "/home/wheatley/newnew/temp/pgn-extract-17.14/mymalloc.c"
void *ReallocOrDie(void *space , size_t nbytes ) 
{ 
  void *result ;

  {
  {
#line 42
  result = realloc(space, nbytes);
  }
#line 43
  if ((unsigned long )result == (unsigned long )((void *)0)) {
    {
#line 44
    perror("Realloc Or Die");
#line 45
    abort();
    }
  }
#line 47
  return (result);
}
}
#line 169 "/usr/include/stdio.h"
extern struct _IO_FILE *stdout ;
#line 23 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.h"
void init_hashtab(void) ;
#line 29 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.h"
void set_output_line_length(unsigned int length ) ;
#line 38 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.h"
void init_duplicate_hash_table(void) ;
#line 39
void clear_duplicate_hash_table(void) ;
#line 66 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.h"
void process_argument(char arg_letter , char const   *associated_value ) ;
#line 67
int process_long_form_argument(char const   *argument , char const   *associated_value ) ;
#line 61 "/home/wheatley/newnew/temp/pgn-extract-17.14/main.c"
StateInfo GlobalState  = 
#line 61 "/home/wheatley/newnew/temp/pgn-extract-17.14/main.c"
     {(Boolean )0, (Boolean )1, (Boolean )1, (Boolean )1, (Boolean )1, (TagOutputForm )0,
    (Boolean )1, (Boolean )0, (Boolean )0, (Boolean )0, (Boolean )0, (Boolean )0,
    0, (Boolean )0, (Boolean )0, (Boolean )0, (EcoDivision )0, (OutputFormat )1, 75U,
    (Boolean )0, (Boolean )0, (Boolean )0, (Boolean )0, (Boolean )1, (Boolean )1,
    (Boolean )1, (Boolean )0, 0U, 0UL, 0UL, 0U, 1U, 0U, 10000U, 4294967295U, (Boolean )0,
    (Boolean )0, (Boolean )0, "MATCH", (char const   *)((char *)((void *)0)), (SourceFileType )0,
    "eco.pgn", (FILE *)((void *)0), (char const   *)((char *)((void *)0)), (FILE *)((void *)0),
    (FILE *)((void *)0), (FILE *)((void *)0)};
#line 112 "/home/wheatley/newnew/temp/pgn-extract-17.14/main.c"
static void init_default_global_state(void) 
{ 


  {
  {
#line 115
  GlobalState.outputfile = stdout;
#line 116
  GlobalState.logfile = stderr;
#line 117
  set_output_line_length(75U);
  }
#line 118
  return;
}
}
#line 120 "/home/wheatley/newnew/temp/pgn-extract-17.14/main.c"
int main(int argc , char **argv ) 
{ 
  int argnum ;
  char const   *argument ;
  int args_processed ;
  char const   *possible_associated_value ;
  char argument_letter ;
  char const   *filename___0 ;
  char argument_letter___0 ;
  char const   *associated_value ;
  char const   *filename___1 ;
  char argument_letter___1 ;
  Boolean tmp ;
  Boolean tmp___0 ;
  char const   *tmp___1 ;

  {
  {
#line 125
  init_default_global_state();
#line 127
  init_game_header();
#line 129
  init_tag_lists();
#line 131
  init_hashtab();
#line 133
  init_lex_tables();
#line 135
  argnum = 1;
  }
  {
#line 135
  while (1) {
    while_continue: /* CIL Label */ ;
#line 135
    if (! (argnum < argc)) {
#line 135
      goto while_break;
    }
#line 136
    argument = (char const   *)*(argv + argnum);
#line 137
    if ((int const   )*(argument + 0) == 45) {
      {
#line 152
      if ((int const   )*(argument + 1) == 90) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 70) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 85) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 77) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 83) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 115) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 114) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 80) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 78) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 86) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 68) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 67) {
#line 152
        goto case_90;
      }
#line 152
      if ((int const   )*(argument + 1) == 55) {
#line 152
        goto case_90;
      }
#line 158
      if ((int const   )*(argument + 1) == 63) {
#line 158
        goto case_63;
      }
#line 166
      if ((int const   )*(argument + 1) == 84) {
#line 166
        goto case_84;
      }
#line 177
      if ((int const   )*(argument + 1) == 104) {
#line 177
        goto case_104;
      }
#line 177
      if ((int const   )*(argument + 1) == 87) {
#line 177
        goto case_104;
      }
#line 177
      if ((int const   )*(argument + 1) == 101) {
#line 177
        goto case_104;
      }
#line 183
      if ((int const   )*(argument + 1) == 45) {
#line 183
        goto case_45;
      }
#line 214
      if ((int const   )*(argument + 1) == 82) {
#line 214
        goto case_82;
      }
#line 214
      if ((int const   )*(argument + 1) == 111) {
#line 214
        goto case_82;
      }
#line 214
      if ((int const   )*(argument + 1) == 110) {
#line 214
        goto case_82;
      }
#line 214
      if ((int const   )*(argument + 1) == 76) {
#line 214
        goto case_82;
      }
#line 214
      if ((int const   )*(argument + 1) == 108) {
#line 214
        goto case_82;
      }
#line 214
      if ((int const   )*(argument + 1) == 102) {
#line 214
        goto case_82;
      }
#line 214
      if ((int const   )*(argument + 1) == 100) {
#line 214
        goto case_82;
      }
#line 214
      if ((int const   )*(argument + 1) == 99) {
#line 214
        goto case_82;
      }
#line 214
      if ((int const   )*(argument + 1) == 97) {
#line 214
        goto case_82;
      }
#line 214
      if ((int const   )*(argument + 1) == 65) {
#line 214
        goto case_82;
      }
#line 246
      if ((int const   )*(argument + 1) == 35) {
#line 246
        goto case_35;
      }
#line 246
      if ((int const   )*(argument + 1) == 119) {
#line 246
        goto case_35;
      }
#line 246
      if ((int const   )*(argument + 1) == 69) {
#line 246
        goto case_35;
      }
#line 246
      if ((int const   )*(argument + 1) == 98) {
#line 246
        goto case_35;
      }
#line 281
      if ((int const   )*(argument + 1) == 122) {
#line 281
        goto case_122;
      }
#line 281
      if ((int const   )*(argument + 1) == 120) {
#line 281
        goto case_122;
      }
#line 281
      if ((int const   )*(argument + 1) == 118) {
#line 281
        goto case_122;
      }
#line 281
      if ((int const   )*(argument + 1) == 116) {
#line 281
        goto case_122;
      }
#line 312
      goto switch_default;
      case_90: /* CIL Label */ 
      case_70: /* CIL Label */ 
      case_85: /* CIL Label */ 
      case_77: /* CIL Label */ 
      case_83: /* CIL Label */ 
      case_115: /* CIL Label */ 
      case_114: /* CIL Label */ 
      case_80: /* CIL Label */ 
      case_78: /* CIL Label */ 
      case_86: /* CIL Label */ 
      case_68: /* CIL Label */ 
      case_67: /* CIL Label */ 
      case_55: /* CIL Label */ 
      {
#line 153
      process_argument((char )*(argument + 1), "");
#line 154
      argnum ++;
      }
#line 155
      goto switch_break;
      case_63: /* CIL Label */ 
      {
#line 159
      process_argument((char)104, "");
#line 160
      argnum ++;
      }
#line 161
      goto switch_break;
      case_84: /* CIL Label */ 
      {
#line 167
      process_argument((char )*(argument + 1), argument + 2);
#line 168
      argnum ++;
      }
#line 169
      goto switch_break;
      case_104: /* CIL Label */ 
      case_87: /* CIL Label */ 
      case_101: /* CIL Label */ 
      {
#line 178
      process_argument((char )*(argument + 1), argument + 2);
#line 179
      argnum ++;
      }
#line 180
      goto switch_break;
      case_45: /* CIL Label */ 
#line 190
      possible_associated_value = "";
#line 191
      if (argnum + 1 < argc) {
#line 192
        possible_associated_value = (char const   *)*(argv + (argnum + 1));
      }
      {
#line 197
      args_processed = process_long_form_argument(argument + 2, possible_associated_value);
#line 200
      argnum += args_processed;
      }
#line 202
      goto switch_break;
      case_82: /* CIL Label */ 
      case_111: /* CIL Label */ 
      case_110: /* CIL Label */ 
      case_76: /* CIL Label */ 
      case_108: /* CIL Label */ 
      case_102: /* CIL Label */ 
      case_100: /* CIL Label */ 
      case_99: /* CIL Label */ 
      case_97: /* CIL Label */ 
      case_65: /* CIL Label */ 
#line 216
      argument_letter = (char )*(argument + 1);
#line 217
      filename___0 = argument + 2;
#line 218
      if ((int const   )*filename___0 == 0) {
#line 220
        argnum ++;
#line 221
        if (argnum < argc) {
#line 222
          filename___0 = (char const   *)*(argv + argnum);
#line 223
          argnum ++;
        }
#line 228
        if ((int const   )*filename___0 == 0) {
          {
#line 229
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: -%c filename\n",
                  (int )argument_letter);
#line 232
          exit(1);
          }
        } else
#line 228
        if ((int const   )*filename___0 == 45) {
          {
#line 229
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: -%c filename\n",
                  (int )argument_letter);
#line 232
          exit(1);
          }
        }
      } else {
#line 236
        argnum ++;
      }
      {
#line 238
      process_argument((char )*(argument + 1), filename___0);
      }
#line 240
      goto switch_break;
      case_35: /* CIL Label */ 
      case_119: /* CIL Label */ 
      case_69: /* CIL Label */ 
      case_98: /* CIL Label */ 
#line 248
      argument_letter___0 = (char )*(argument + 1);
#line 249
      associated_value = argument + 2;
#line 250
      if ((int const   )*associated_value == 0) {
#line 252
        argnum ++;
#line 253
        if (argnum < argc) {
#line 254
          associated_value = (char const   *)*(argv + argnum);
#line 255
          argnum ++;
        }
#line 260
        if ((int const   )*associated_value == 0) {
          {
#line 262
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: -%c value\n",
                  (int )argument_letter___0);
#line 265
          exit(1);
          }
        } else
#line 260
        if ((int const   )*associated_value == 45) {
          {
#line 262
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: -%c value\n",
                  (int )argument_letter___0);
#line 265
          exit(1);
          }
        }
      } else {
#line 269
        argnum ++;
      }
      {
#line 271
      process_argument((char )*(argument + 1), associated_value);
      }
#line 273
      goto switch_break;
      case_122: /* CIL Label */ 
      case_120: /* CIL Label */ 
      case_118: /* CIL Label */ 
      case_116: /* CIL Label */ 
#line 287
      filename___1 = argument + 2;
#line 288
      argument_letter___1 = (char )*(argument + 1);
#line 289
      if ((int const   )*filename___1 == 0) {
#line 291
        argnum ++;
#line 292
        if (argnum < argc) {
#line 293
          filename___1 = (char const   *)*(argv + argnum);
#line 294
          argnum ++;
        }
#line 299
        if ((int const   )*filename___1 == 0) {
          {
#line 300
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: -%cfilename or -%c filename\n",
                  (int )argument_letter___1, (int )argument_letter___1);
#line 303
          exit(1);
          }
        } else
#line 299
        if ((int const   )*filename___1 == 45) {
          {
#line 300
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: -%cfilename or -%c filename\n",
                  (int )argument_letter___1, (int )argument_letter___1);
#line 303
          exit(1);
          }
        }
      } else {
#line 307
        argnum ++;
      }
      {
#line 309
      process_argument(argument_letter___1, filename___1);
      }
#line 311
      goto switch_break;
      switch_default: /* CIL Label */ 
      {
#line 313
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown flag %s. Use -%c for usage details.\n",
              argument, 104);
#line 316
      exit(1);
      }
#line 317
      goto switch_break;
      switch_break: /* CIL Label */ ;
      }
    } else {
      {
#line 322
      add_filename_to_source_list(argument, (SourceFileType )0);
#line 323
      argnum ++;
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 327
  init_duplicate_hash_table();
  }
#line 329
  if (GlobalState.add_ECO) {
    {
#line 331
    tmp = open_eco_file(GlobalState.eco_file);
    }
#line 331
    if (tmp) {
      {
#line 333
      GlobalState.parsing_ECO_file = (Boolean )1;
#line 334
      yyparse((SourceFileType )2);
#line 335
      reset_line_number();
#line 336
      GlobalState.parsing_ECO_file = (Boolean )0;
      }
    } else {
      {
#line 339
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unable to open the ECO file %s.\n",
              GlobalState.eco_file);
#line 341
      exit(1);
      }
    }
  }
  {
#line 346
  tmp___0 = open_first_file();
  }
#line 346
  if (! tmp___0) {
    {
#line 347
    exit(1);
    }
  }
  {
#line 349
  yyparse(GlobalState.current_file_type);
#line 351
  clear_duplicate_hash_table();
  }
#line 352
  if (GlobalState.verbose) {
#line 353
    if (GlobalState.num_games_matched == 1UL) {
#line 353
      tmp___1 = "";
    } else {
#line 353
      tmp___1 = "s";
    }
    {
#line 353
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"%lu game%s matched out of %lu.\n",
            GlobalState.num_games_matched, tmp___1, GlobalState.num_games_processed);
    }
  }
#line 358
  if ((unsigned long )GlobalState.logfile != (unsigned long )stderr) {
#line 358
    if ((unsigned long )GlobalState.logfile != (unsigned long )((void *)0)) {
      {
#line 359
      fclose(GlobalState.logfile);
      }
    }
  }
#line 361
  return (0);
}
}
#line 434 "/usr/include/libio.h"
extern int _IO_getc(_IO_FILE *__fp ) ;
#line 702 "/usr/include/stdio.h"
extern int ungetc(int __c , FILE *__stream ) ;
#line 25 "/home/wheatley/newnew/temp/pgn-extract-17.14/lines.h"
Boolean blank_line(char const   *line___1 ) ;
#line 26
Boolean comment_line(char const   *line___1 ) ;
#line 41 "/home/wheatley/newnew/temp/pgn-extract-17.14/lines.c"
char *read_line(FILE *fpin ) 
{ 
  char *line___1 ;
  unsigned int len ;
  unsigned int max_length ;
  int ch ;
  void *tmp ;
  void *tmp___0 ;

  {
  {
#line 43
  line___1 = (char *)((void *)0);
#line 44
  len = 0U;
#line 48
  ch = _IO_getc(fpin);
  }
#line 49
  if (ch != -1) {
    {
#line 50
    tmp = MallocOrDie((size_t )81);
#line 50
    line___1 = (char *)tmp;
#line 51
    max_length = 80U;
    }
    {
#line 52
    while (1) {
      while_continue: /* CIL Label */ ;
#line 52
      if (ch != 10) {
#line 52
        if (ch != 13) {
#line 52
          if (! (ch != -1)) {
#line 52
            goto while_break;
          }
        } else {
#line 52
          goto while_break;
        }
      } else {
#line 52
        goto while_break;
      }
#line 54
      if (len == max_length) {
        {
#line 55
        tmp___0 = ReallocOrDie((void *)line___1, (size_t )((max_length + 20U) + 1U));
#line 55
        line___1 = (char *)tmp___0;
        }
#line 57
        if ((unsigned long )line___1 == (unsigned long )((void *)0)) {
#line 58
          return ((char *)((void *)0));
        }
#line 60
        max_length += 20U;
      }
      {
#line 62
      *(line___1 + len) = (char )ch;
#line 63
      len ++;
#line 64
      ch = _IO_getc(fpin);
      }
    }
    while_break: /* CIL Label */ ;
    }
#line 66
    *(line___1 + len) = (char )'\000';
#line 67
    if (ch == 13) {
      {
#line 69
      ch = _IO_getc(fpin);
      }
#line 70
      if (ch != 10) {
#line 70
        if (ch != -1) {
          {
#line 71
          ungetc(ch, fpin);
          }
        }
      }
    }
  }
#line 75
  return (line___1);
}
}
#line 81 "/home/wheatley/newnew/temp/pgn-extract-17.14/lines.c"
Boolean non_blank_line(char const   *line___1 ) 
{ 
  Boolean blank ;
  unsigned short const   **tmp ;
  Boolean tmp___0 ;

  {
#line 83
  blank = (Boolean )1;
#line 85
  if ((unsigned long )line___1 != (unsigned long )((void *)0)) {
    {
#line 86
    tmp___0 = comment_line(line___1);
    }
#line 86
    if (! tmp___0) {
      {
#line 90
      while (1) {
        while_continue: /* CIL Label */ ;
#line 90
        if (blank) {
#line 90
          if (! ((int const   )*line___1 != 0)) {
#line 90
            goto while_break;
          }
        } else {
#line 90
          goto while_break;
        }
        {
#line 91
        tmp = __ctype_b_loc();
        }
#line 91
        if ((int const   )*(*tmp + (int )*line___1) & 8192) {
#line 95
          line___1 ++;
        } else {
#line 92
          blank = (Boolean )0;
        }
      }
      while_break: /* CIL Label */ ;
      }
    }
  }
#line 100
  return ((Boolean )(! blank));
}
}
#line 103 "/home/wheatley/newnew/temp/pgn-extract-17.14/lines.c"
Boolean blank_line(char const   *line___1 ) 
{ 
  Boolean tmp ;
  int tmp___0 ;

  {
  {
#line 106
  tmp = non_blank_line(line___1);
  }
#line 106
  if (tmp) {
#line 106
    tmp___0 = 0;
  } else {
#line 106
    tmp___0 = 1;
  }
#line 106
  return ((Boolean )tmp___0);
}
}
#line 111 "/home/wheatley/newnew/temp/pgn-extract-17.14/lines.c"
Boolean comment_line(char const   *line___1 ) 
{ 


  {
#line 114
  return ((Boolean )((int const   )*line___1 == 37));
}
}
#line 23 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.h"
Move *new_move_structure(void) ;
#line 24
Piece is_piece(unsigned char const   *move ) ;
#line 26
Move *decode_algebraic(Move *move_details , Board *board ) ;
#line 27
Boolean is_check(char c ) ;
#line 46 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.c"
Boolean is_col(char c ) 
{ 
  int tmp ;

  {
#line 49
  if (97 <= (int )c) {
#line 49
    if ((int )c <= 104) {
#line 49
      tmp = 1;
    } else {
#line 49
      tmp = 0;
    }
  } else {
#line 49
    tmp = 0;
  }
#line 49
  return ((Boolean )tmp);
}
}
#line 53 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.c"
Boolean is_rank(char c ) 
{ 
  int tmp ;

  {
#line 56
  if (49 <= (int )c) {
#line 56
    if ((int )c <= 56) {
#line 56
      tmp = 1;
    } else {
#line 56
      tmp = 0;
    }
  } else {
#line 56
    tmp = 0;
  }
#line 56
  return ((Boolean )tmp);
}
}
#line 64 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.c"
Piece is_piece(unsigned char const   *move ) 
{ 
  Piece piece ;

  {
#line 66
  piece = (Piece )1;
  {
#line 69
  if ((int const   )*move == 107) {
#line 69
    goto case_107;
  }
#line 69
  if ((int const   )*move == 75) {
#line 69
    goto case_107;
  }
#line 74
  if ((int const   )*move == 148) {
#line 74
    goto case_148;
  }
#line 74
  if ((int const   )*move == 68) {
#line 74
    goto case_148;
  }
#line 74
  if ((int const   )*move == 113) {
#line 74
    goto case_148;
  }
#line 74
  if ((int const   )*move == 81) {
#line 74
    goto case_148;
  }
#line 79
  if ((int const   )*move == 139) {
#line 79
    goto case_139;
  }
#line 79
  if ((int const   )*move == 84) {
#line 79
    goto case_139;
  }
#line 79
  if ((int const   )*move == 114) {
#line 79
    goto case_139;
  }
#line 79
  if ((int const   )*move == 82) {
#line 79
    goto case_139;
  }
#line 84
  if ((int const   )*move == 83) {
#line 84
    goto case_83;
  }
#line 84
  if ((int const   )*move == 80) {
#line 84
    goto case_83;
  }
#line 84
  if ((int const   )*move == 110) {
#line 84
    goto case_83;
  }
#line 84
  if ((int const   )*move == 78) {
#line 84
    goto case_83;
  }
#line 89
  if ((int const   )*move == 145) {
#line 89
    goto case_145;
  }
#line 89
  if ((int const   )*move == 76) {
#line 89
    goto case_145;
  }
#line 89
  if ((int const   )*move == 66) {
#line 89
    goto case_145;
  }
#line 93
  if ((int const   )*move == 138) {
#line 93
    goto case_138;
  }
#line 68
  goto switch_break;
  case_107: /* CIL Label */ 
  case_75: /* CIL Label */ 
#line 70
  piece = (Piece )7;
#line 71
  goto switch_break;
  case_148: /* CIL Label */ 
  case_68: /* CIL Label */ 
  case_113: /* CIL Label */ 
  case_81: /* CIL Label */ 
#line 75
  piece = (Piece )6;
#line 76
  goto switch_break;
  case_139: /* CIL Label */ 
  case_84: /* CIL Label */ 
  case_114: /* CIL Label */ 
  case_82: /* CIL Label */ 
#line 80
  piece = (Piece )5;
#line 81
  goto switch_break;
  case_83: /* CIL Label */ 
  case_80: /* CIL Label */ 
  case_110: /* CIL Label */ 
  case_78: /* CIL Label */ 
#line 85
  piece = (Piece )3;
#line 86
  goto switch_break;
  case_145: /* CIL Label */ 
  case_76: /* CIL Label */ 
  case_66: /* CIL Label */ 
#line 91
  piece = (Piece )4;
#line 92
  goto switch_break;
  case_138: /* CIL Label */ 
#line 94
  if (((int const   )*(move + 1) & 255) == 224) {
#line 95
    piece = (Piece )7;
  } else {
#line 98
    piece = (Piece )3;
  }
#line 100
  goto switch_break;
  switch_break: /* CIL Label */ ;
  }
#line 102
  return (piece);
}
}
#line 111 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.c"
static Boolean is_capture(char c ) 
{ 
  int tmp ;

  {
#line 114
  if ((int )c == 120) {
#line 114
    tmp = 1;
  } else
#line 114
  if ((int )c == 88) {
#line 114
    tmp = 1;
  } else
#line 114
  if ((int )c == 58) {
#line 114
    tmp = 1;
  } else
#line 114
  if ((int )c == 45) {
#line 114
    tmp = 1;
  } else {
#line 114
    tmp = 0;
  }
#line 114
  return ((Boolean )tmp);
}
}
#line 117 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.c"
static Boolean is_castling_character(char c ) 
{ 
  int tmp ;

  {
#line 120
  if ((int )c == 79) {
#line 120
    tmp = 1;
  } else
#line 120
  if ((int )c == 48) {
#line 120
    tmp = 1;
  } else
#line 120
  if ((int )c == 111) {
#line 120
    tmp = 1;
  } else {
#line 120
    tmp = 0;
  }
#line 120
  return ((Boolean )tmp);
}
}
#line 123 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.c"
Boolean is_check(char c ) 
{ 
  int tmp ;

  {
#line 126
  if ((int )c == 43) {
#line 126
    tmp = 1;
  } else
#line 126
  if ((int )c == 35) {
#line 126
    tmp = 1;
  } else {
#line 126
    tmp = 0;
  }
#line 126
  return ((Boolean )tmp);
}
}
#line 132 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.c"
Move *new_move_structure(void) 
{ 
  Move *move ;
  void *tmp ;

  {
  {
#line 134
  tmp = MallocOrDie(sizeof(Move ));
#line 134
  move = (Move *)tmp;
#line 136
  move->terminating_result = (char *)((void *)0);
#line 137
  move->epd = (char *)((void *)0);
#line 138
  move->Nags = (StringList *)((void *)0);
#line 139
  move->Comment = (CommentList *)((void *)0);
#line 140
  move->Variants = (Variation *)((void *)0);
#line 141
  move->next = (struct move *)((void *)0);
  }
#line 142
  return (move);
}
}
#line 152 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.c"
Move *decode_move(unsigned char const   *move_string ) 
{ 
  Rank from_rank ;
  Rank to_rank ;
  Col from_col ;
  Col to_col ;
  MoveClass class ;
  Boolean Ok ;
  Col col ;
  Rank rank ;
  unsigned char const   *move ;
  Move *move_details ;
  Piece piece_to_move ;
  Boolean tmp ;
  Boolean tmp___0 ;
  Boolean tmp___1 ;
  Boolean tmp___2 ;
  Boolean tmp___3 ;
  Boolean tmp___4 ;
  Boolean tmp___5 ;
  Piece tmp___6 ;
  Boolean tmp___7 ;
  Boolean tmp___8 ;
  Boolean tmp___9 ;
  Boolean tmp___10 ;
  Boolean tmp___11 ;
  Boolean tmp___12 ;
  Boolean tmp___13 ;
  Boolean tmp___14 ;
  Boolean tmp___15 ;
  Boolean tmp___16 ;
  Boolean tmp___17 ;
  Boolean tmp___18 ;
  Boolean tmp___19 ;
  Boolean tmp___20 ;
  Boolean tmp___21 ;
  Boolean tmp___22 ;
  Boolean tmp___23 ;
  int tmp___24 ;
  Boolean tmp___25 ;
  Boolean tmp___26 ;
  Boolean tmp___27 ;
  int tmp___28 ;
  int tmp___29 ;

  {
  {
#line 155
  from_rank = (Rank )0;
#line 155
  to_rank = (Rank )0;
#line 156
  from_col = (Col )0;
#line 156
  to_col = (Col )0;
#line 158
  Ok = (Boolean )1;
#line 160
  col = (Col )0;
#line 161
  rank = (Rank )0;
#line 163
  move = move_string;
#line 166
  piece_to_move = (Piece )1;
#line 169
  tmp___26 = is_col((char )*move);
  }
#line 169
  if (tmp___26) {
    {
#line 171
    class = (MoveClass )0;
#line 172
    piece_to_move = (Piece )2;
#line 173
    col = (Col )*move;
#line 174
    move ++;
#line 175
    tmp___5 = is_rank((char )*move);
    }
#line 175
    if (tmp___5) {
      {
#line 177
      rank = (Rank )*move;
#line 178
      move ++;
#line 179
      tmp = is_capture((char )*move);
      }
#line 179
      if (tmp) {
#line 180
        move ++;
      }
      {
#line 182
      tmp___1 = is_col((char )*move);
      }
#line 182
      if (tmp___1) {
        {
#line 183
        from_col = col;
#line 184
        from_rank = rank;
#line 185
        to_col = (Col )*move;
#line 186
        move ++;
#line 187
        tmp___0 = is_rank((char )*move);
        }
#line 187
        if (tmp___0) {
#line 188
          to_rank = (Rank )*move;
#line 189
          move ++;
        }
      } else {
#line 193
        to_col = col;
#line 194
        to_rank = rank;
      }
    } else {
      {
#line 198
      tmp___2 = is_capture((char )*move);
      }
#line 198
      if (tmp___2) {
#line 200
        move ++;
      }
      {
#line 202
      tmp___4 = is_col((char )*move);
      }
#line 202
      if (tmp___4) {
        {
#line 204
        from_col = col;
#line 205
        to_col = (Col )*move;
#line 206
        move ++;
#line 207
        tmp___3 = is_rank((char )*move);
        }
#line 207
        if (tmp___3) {
#line 208
          to_rank = (Rank )*move;
#line 209
          move ++;
#line 211
          if ((int )from_col != 98) {
#line 211
            if ((int )from_col != (int )to_col + 1) {
#line 211
              if ((int )from_col != (int )to_col - 1) {
#line 213
                Ok = (Boolean )0;
              }
            }
          }
        } else
#line 218
        if ((int )from_col != (int )to_col + 1) {
#line 218
          if ((int )from_col != (int )to_col - 1) {
#line 219
            Ok = (Boolean )0;
          }
        }
      } else {
        {
#line 224
        print_error_context(GlobalState.logfile);
#line 225
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown pawn move %s.\n",
                move_string);
#line 226
        Ok = (Boolean )0;
        }
      }
    }
#line 229
    if (Ok) {
#line 231
      if ((int const   )*move == 61) {
#line 232
        move ++;
      }
      {
#line 234
      tmp___6 = is_piece(move);
      }
#line 234
      if ((unsigned int )tmp___6 != 1U) {
#line 235
        class = (MoveClass )1;
#line 239
        move ++;
      }
    }
  } else {
    {
#line 243
    piece_to_move = is_piece(move);
    }
#line 243
    if ((unsigned int )piece_to_move != 1U) {
#line 244
      class = (MoveClass )3;
#line 246
      if (((int const   )*move & 255) == 138) {
#line 246
        if ((unsigned int )piece_to_move == 7U) {
#line 248
          move ++;
        }
      }
      {
#line 250
      move ++;
#line 251
      tmp___21 = is_rank((char )*move);
      }
#line 251
      if (tmp___21) {
        {
#line 255
        from_rank = (Rank )*move;
#line 256
        move ++;
#line 257
        tmp___7 = is_capture((char )*move);
        }
#line 257
        if (tmp___7) {
#line 258
          move ++;
        }
        {
#line 260
        tmp___9 = is_col((char )*move);
        }
#line 260
        if (tmp___9) {
          {
#line 261
          to_col = (Col )*move;
#line 262
          move ++;
#line 263
          tmp___8 = is_rank((char )*move);
          }
#line 263
          if (tmp___8) {
#line 264
            to_rank = (Rank )*move;
#line 265
            move ++;
          }
        } else {
          {
#line 269
          Ok = (Boolean )0;
#line 270
          print_error_context(GlobalState.logfile);
#line 271
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown piece move %s.\n",
                  move_string);
          }
        }
      } else {
        {
#line 275
        tmp___20 = is_capture((char )*move);
        }
#line 275
        if (tmp___20) {
          {
#line 277
          move ++;
#line 278
          tmp___11 = is_col((char )*move);
          }
#line 278
          if (tmp___11) {
            {
#line 279
            to_col = (Col )*move;
#line 280
            move ++;
#line 281
            tmp___10 = is_rank((char )*move);
            }
#line 281
            if (tmp___10) {
#line 282
              to_rank = (Rank )*move;
#line 283
              move ++;
            } else {
              {
#line 286
              Ok = (Boolean )0;
#line 287
              print_error_context(GlobalState.logfile);
#line 288
              fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown piece move %s.\n",
                      move_string);
              }
            }
          } else {
            {
#line 293
            Ok = (Boolean )0;
#line 294
            print_error_context(GlobalState.logfile);
#line 295
            fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown piece move %s.\n",
                    move_string);
            }
          }
        } else {
          {
#line 298
          tmp___19 = is_col((char )*move);
          }
#line 298
          if (tmp___19) {
            {
#line 299
            col = (Col )*move;
#line 300
            move ++;
#line 301
            tmp___12 = is_capture((char )*move);
            }
#line 301
            if (tmp___12) {
#line 302
              move ++;
            }
            {
#line 304
            tmp___18 = is_rank((char )*move);
            }
#line 304
            if (tmp___18) {
              {
#line 306
              rank = (Rank )*move;
#line 307
              move ++;
#line 308
              tmp___13 = is_capture((char )*move);
              }
#line 308
              if (tmp___13) {
#line 309
                move ++;
              }
              {
#line 311
              tmp___15 = is_col((char )*move);
              }
#line 311
              if (tmp___15) {
                {
#line 313
                from_col = col;
#line 314
                from_rank = rank;
#line 315
                to_col = (Col )*move;
#line 316
                move ++;
#line 317
                tmp___14 = is_rank((char )*move);
                }
#line 317
                if (tmp___14) {
#line 318
                  to_rank = (Rank )*move;
#line 319
                  move ++;
                } else {
                  {
#line 322
                  Ok = (Boolean )0;
#line 323
                  print_error_context(GlobalState.logfile);
#line 324
                  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown piece move %s.\n",
                          move_string);
                  }
                }
              } else {
#line 329
                to_col = col;
#line 330
                to_rank = rank;
              }
            } else {
              {
#line 333
              tmp___17 = is_col((char )*move);
              }
#line 333
              if (tmp___17) {
                {
#line 335
                from_col = col;
#line 336
                to_col = (Col )*move;
#line 337
                move ++;
#line 338
                tmp___16 = is_rank((char )*move);
                }
#line 338
                if (tmp___16) {
#line 339
                  to_rank = (Rank )*move;
#line 340
                  move ++;
                }
              } else {
                {
#line 344
                Ok = (Boolean )0;
#line 345
                print_error_context(GlobalState.logfile);
#line 346
                fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown piece move %s.\n",
                        move_string);
                }
              }
            }
          } else {
            {
#line 350
            Ok = (Boolean )0;
#line 351
            print_error_context(GlobalState.logfile);
#line 352
            fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown piece move %s.\n",
                    move_string);
            }
          }
        }
      }
    } else {
      {
#line 356
      tmp___25 = is_castling_character((char )*move);
      }
#line 356
      if (tmp___25) {
#line 358
        move ++;
#line 360
        if ((int const   )*move == 45) {
#line 361
          move ++;
        }
        {
#line 363
        tmp___23 = is_castling_character((char )*move);
        }
#line 363
        if (tmp___23) {
#line 364
          move ++;
#line 365
          if ((int const   )*move == 45) {
#line 366
            move ++;
          }
          {
#line 368
          tmp___22 = is_castling_character((char )*move);
          }
#line 368
          if (tmp___22) {
#line 369
            class = (MoveClass )5;
#line 370
            move ++;
          } else {
#line 373
            class = (MoveClass )4;
          }
        } else {
          {
#line 377
          print_error_context(GlobalState.logfile);
#line 378
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown castling move %s.\n",
                  move_string);
#line 379
          Ok = (Boolean )0;
          }
        }
      } else {
        {
#line 382
        tmp___24 = strcmp((char const   *)((char *)move_string), "--");
        }
#line 382
        if (tmp___24 == 0) {
#line 383
          class = (MoveClass )6;
        } else {
          {
#line 386
          print_error_context(GlobalState.logfile);
#line 387
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown move %s.\n",
                  move_string);
#line 388
          Ok = (Boolean )0;
          }
        }
      }
    }
  }
#line 390
  if (Ok) {
#line 390
    if ((unsigned int )class != 6U) {
      {
#line 392
      while (1) {
        while_continue: /* CIL Label */ ;
        {
#line 392
        tmp___27 = is_check((char )*move);
        }
#line 392
        if (! tmp___27) {
#line 392
          goto while_break;
        }
#line 393
        move ++;
      }
      while_break: /* CIL Label */ ;
      }
#line 395
      if (! ((int const   )*move == 0)) {
        {
#line 398
        tmp___28 = strcmp((char const   *)move, "ep");
        }
#line 398
        if (tmp___28 == 0) {
#line 398
          goto _L;
        } else {
          {
#line 398
          tmp___29 = strcmp((char const   *)move, "e.p.");
          }
#line 398
          if (tmp___29 == 0) {
            _L: /* CIL Label */ 
#line 398
            if ((unsigned int )class == 0U) {
#line 402
              class = (MoveClass )2;
            } else {
              {
#line 405
              Ok = (Boolean )0;
#line 406
              print_error_context(GlobalState.logfile);
#line 407
              fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown text trailing move %s <%s>.\n",
                      move_string, move);
              }
            }
          } else {
            {
#line 405
            Ok = (Boolean )0;
#line 406
            print_error_context(GlobalState.logfile);
#line 407
            fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown text trailing move %s <%s>.\n",
                    move_string, move);
            }
          }
        }
      }
    }
  }
#line 412
  if (! Ok) {
#line 413
    class = (MoveClass )7;
  }
  {
#line 415
  move_details = new_move_structure();
#line 416
  strcpy((char */* __restrict  */)((char *)(move_details->move)), (char const   */* __restrict  */)((char const   *)move_string));
#line 417
  move_details->class = class;
#line 418
  move_details->piece_to_move = piece_to_move;
#line 419
  move_details->from_col = from_col;
#line 420
  move_details->from_rank = from_rank;
#line 421
  move_details->to_col = to_col;
#line 422
  move_details->to_rank = to_rank;
#line 423
  move_details->captured_piece = (Piece )1;
#line 424
  move_details->check_status = (CheckStatus )0;
  }
#line 425
  return (move_details);
}
}
#line 428 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.c"
Move *decode_algebraic(Move *move_details , Board *board ) 
{ 
  short from_r ;
  int tmp ;
  short from_c ;
  int tmp___0 ;
  Piece piece_to_move ;

  {
#line 430
  if (49 <= (int )move_details->from_rank) {
#line 430
    if ((int )move_details->from_rank <= 56) {
#line 430
      tmp = ((int )move_details->from_rank - 49) + 2;
    } else {
#line 430
      tmp = 0;
    }
  } else {
#line 430
    tmp = 0;
  }
#line 430
  from_r = (short )tmp;
#line 431
  if (97 <= (int )move_details->from_col) {
#line 431
    if ((int )move_details->from_col <= 104) {
#line 431
      tmp___0 = ((int )move_details->from_col - 97) + 2;
    } else {
#line 431
      tmp___0 = 0;
    }
  } else {
#line 431
    tmp___0 = 0;
  }
#line 431
  from_c = (short )tmp___0;
#line 432
  piece_to_move = (Piece )((unsigned int )board->board[from_r][from_c] >> 3);
#line 434
  if ((unsigned int )piece_to_move != 1U) {
#line 436
    if ((unsigned int )piece_to_move == 7U) {
#line 436
      if ((int )move_details->from_col == 101) {
#line 437
        if ((int )move_details->to_col == 103) {
#line 438
          move_details->class = (MoveClass )4;
        } else
#line 440
        if ((int )move_details->to_col == 99) {
#line 441
          move_details->class = (MoveClass )5;
        } else {
#line 444
          move_details->class = (MoveClass )3;
#line 445
          move_details->piece_to_move = piece_to_move;
        }
      } else {
#line 436
        goto _L;
      }
    } else {
      _L: /* CIL Label */ 
#line 449
      if ((unsigned int )piece_to_move == 2U) {
#line 450
        move_details->class = (MoveClass )0;
      } else {
#line 453
        move_details->class = (MoveClass )3;
      }
#line 455
      move_details->piece_to_move = piece_to_move;
    }
#line 457
    move_details->captured_piece = (Piece )1;
#line 458
    move_details->check_status = (CheckStatus )0;
  }
#line 460
  return (move_details);
}
}
#line 466 "/home/wheatley/newnew/temp/pgn-extract-17.14/decode.c"
Boolean move_seems_valid(unsigned char const   *move_string ) 
{ 
  MoveClass class ;
  Boolean Ok ;
  unsigned char const   *move ;
  Boolean tmp ;
  Boolean tmp___0 ;
  Boolean tmp___1 ;
  Boolean tmp___2 ;
  Boolean tmp___3 ;
  Boolean tmp___4 ;
  Boolean tmp___5 ;
  Piece tmp___6 ;
  Piece tmp___7 ;
  Boolean tmp___8 ;
  Boolean tmp___9 ;
  Boolean tmp___10 ;
  Boolean tmp___11 ;
  Boolean tmp___12 ;
  Boolean tmp___13 ;
  Boolean tmp___14 ;
  Boolean tmp___15 ;
  Boolean tmp___16 ;
  Boolean tmp___17 ;
  Boolean tmp___18 ;
  Boolean tmp___19 ;
  Boolean tmp___20 ;
  Boolean tmp___21 ;
  Boolean tmp___22 ;
  Boolean tmp___23 ;
  Boolean tmp___24 ;
  Boolean tmp___25 ;
  Piece tmp___26 ;
  Boolean tmp___27 ;
  Boolean tmp___28 ;
  int tmp___29 ;
  int tmp___30 ;

  {
  {
#line 469
  Ok = (Boolean )1;
#line 471
  move = move_string;
#line 474
  tmp___27 = is_col((char )*move);
  }
#line 474
  if (tmp___27) {
    {
#line 476
    class = (MoveClass )0;
#line 477
    move ++;
#line 478
    tmp___5 = is_rank((char )*move);
    }
#line 478
    if (tmp___5) {
      {
#line 480
      move ++;
#line 481
      tmp = is_capture((char )*move);
      }
#line 481
      if (tmp) {
#line 482
        move ++;
      }
      {
#line 484
      tmp___1 = is_col((char )*move);
      }
#line 484
      if (tmp___1) {
        {
#line 485
        move ++;
#line 486
        tmp___0 = is_rank((char )*move);
        }
#line 486
        if (tmp___0) {
#line 487
          move ++;
        }
      }
    } else {
      {
#line 494
      tmp___2 = is_capture((char )*move);
      }
#line 494
      if (tmp___2) {
#line 496
        move ++;
      }
      {
#line 498
      tmp___4 = is_col((char )*move);
      }
#line 498
      if (tmp___4) {
        {
#line 500
        move ++;
#line 501
        tmp___3 = is_rank((char )*move);
        }
#line 501
        if (tmp___3) {
#line 502
          move ++;
        }
      } else {
#line 506
        Ok = (Boolean )0;
      }
    }
#line 509
    if (Ok) {
#line 511
      if ((int const   )*move == 61) {
#line 512
        move ++;
      }
      {
#line 514
      tmp___6 = is_piece(move);
      }
#line 514
      if ((unsigned int )tmp___6 != 1U) {
#line 515
        class = (MoveClass )1;
#line 519
        move ++;
      }
    }
  } else {
    {
#line 523
    tmp___26 = is_piece(move);
    }
#line 523
    if ((unsigned int )tmp___26 != 1U) {
#line 524
      class = (MoveClass )3;
#line 526
      if (((int const   )*move & 255) == 138) {
        {
#line 526
        tmp___7 = is_piece(move);
        }
#line 526
        if ((unsigned int )tmp___7 == 7U) {
#line 528
          move ++;
        }
      }
      {
#line 530
      move ++;
#line 531
      tmp___22 = is_rank((char )*move);
      }
#line 531
      if (tmp___22) {
        {
#line 535
        move ++;
#line 536
        tmp___8 = is_capture((char )*move);
        }
#line 536
        if (tmp___8) {
#line 537
          move ++;
        }
        {
#line 539
        tmp___10 = is_col((char )*move);
        }
#line 539
        if (tmp___10) {
          {
#line 540
          move ++;
#line 541
          tmp___9 = is_rank((char )*move);
          }
#line 541
          if (tmp___9) {
#line 542
            move ++;
          }
        } else {
#line 546
          Ok = (Boolean )0;
        }
      } else {
        {
#line 550
        tmp___21 = is_capture((char )*move);
        }
#line 550
        if (tmp___21) {
          {
#line 552
          move ++;
#line 553
          tmp___12 = is_col((char )*move);
          }
#line 553
          if (tmp___12) {
            {
#line 554
            move ++;
#line 555
            tmp___11 = is_rank((char )*move);
            }
#line 555
            if (tmp___11) {
#line 556
              move ++;
            } else {
#line 559
              Ok = (Boolean )0;
            }
          } else {
#line 563
            Ok = (Boolean )0;
          }
        } else {
          {
#line 566
          tmp___20 = is_col((char )*move);
          }
#line 566
          if (tmp___20) {
            {
#line 567
            move ++;
#line 568
            tmp___13 = is_capture((char )*move);
            }
#line 568
            if (tmp___13) {
#line 569
              move ++;
            }
            {
#line 571
            tmp___19 = is_rank((char )*move);
            }
#line 571
            if (tmp___19) {
              {
#line 573
              move ++;
#line 574
              tmp___14 = is_capture((char )*move);
              }
#line 574
              if (tmp___14) {
#line 575
                move ++;
              }
              {
#line 577
              tmp___16 = is_col((char )*move);
              }
#line 577
              if (tmp___16) {
                {
#line 579
                move ++;
#line 580
                tmp___15 = is_rank((char )*move);
                }
#line 580
                if (tmp___15) {
#line 581
                  move ++;
                } else {
#line 584
                  Ok = (Boolean )0;
                }
              }
            } else {
              {
#line 588
              tmp___18 = is_col((char )*move);
              }
#line 588
              if (tmp___18) {
                {
#line 590
                move ++;
#line 591
                tmp___17 = is_rank((char )*move);
                }
#line 591
                if (tmp___17) {
#line 592
                  move ++;
                } else {
#line 595
                  Ok = (Boolean )0;
                }
              } else {
#line 599
                Ok = (Boolean )0;
              }
            }
          } else {
#line 603
            Ok = (Boolean )0;
          }
        }
      }
    } else {
      {
#line 607
      tmp___25 = is_castling_character((char )*move);
      }
#line 607
      if (tmp___25) {
#line 609
        move ++;
#line 611
        if ((int const   )*move == 45) {
#line 612
          move ++;
        }
        {
#line 614
        tmp___24 = is_castling_character((char )*move);
        }
#line 614
        if (tmp___24) {
#line 615
          move ++;
#line 616
          if ((int const   )*move == 45) {
#line 617
            move ++;
          }
          {
#line 619
          tmp___23 = is_castling_character((char )*move);
          }
#line 619
          if (tmp___23) {
#line 620
            class = (MoveClass )5;
#line 621
            move ++;
          } else {
#line 624
            class = (MoveClass )4;
          }
        } else {
#line 628
          Ok = (Boolean )0;
        }
      } else {
#line 632
        Ok = (Boolean )0;
      }
    }
  }
#line 634
  if (Ok) {
    {
#line 636
    while (1) {
      while_continue: /* CIL Label */ ;
      {
#line 636
      tmp___28 = is_check((char )*move);
      }
#line 636
      if (! tmp___28) {
#line 636
        goto while_break;
      }
#line 637
      move ++;
    }
    while_break: /* CIL Label */ ;
    }
#line 639
    if (! ((int const   )*move == 0)) {
      {
#line 642
      tmp___29 = strcmp((char const   *)move, "ep");
      }
#line 642
      if (tmp___29 == 0) {
#line 642
        goto _L;
      } else {
        {
#line 642
        tmp___30 = strcmp((char const   *)move, "e.p.");
        }
#line 642
        if (tmp___30 == 0) {
          _L: /* CIL Label */ 
#line 642
          if ((unsigned int )class == 0U) {
#line 646
            class = (MoveClass )2;
          } else {
#line 649
            Ok = (Boolean )0;
          }
        } else {
#line 649
          Ok = (Boolean )0;
        }
      }
    }
  }
#line 652
  return (Ok);
}
}
#line 715 "/usr/include/stdio.h"
extern size_t fwrite(void const   * __restrict  __ptr , size_t __size , size_t __n ,
                     FILE * __restrict  __s ) ;
#line 236 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1), __leaf__)) strchr)(char const   *__s ,
                                                                                               int __c )  __attribute__((__pure__)) ;
#line 26 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.h"
OutputFormat which_output_format(char const   *arg ) ;
#line 52 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static size_t line_length  =    (size_t )0;
#line 54 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char *output_line  =    (char *)((void *)0);
#line 56
static Boolean print_move(FILE *outputfile , unsigned int move_number , unsigned int print_move_number ,
                          Boolean white_to_move , Move const   *move_details ) ;
#line 59
static void output_STR(FILE *outfp , char **Tags ) ;
#line 60
static void show_tags(FILE *outfp , char **Tags , int tags_length ) ;
#line 61
static char promoted_piece_letter(Piece piece ) ;
#line 62
static void print_algebraic_game(Game current_game , FILE *outputfile , unsigned int move_number ,
                                 Boolean white_to_move , Board *final_board ) ;
#line 65
static void print_epd_game(Game current_game , FILE *outputfile , unsigned int move_number ,
                           Boolean white_to_move , Board *final_board ) ;
#line 68
static void print_epd_move_list(Game current_game , FILE *outputfile , unsigned int move_number ,
                                Boolean white_to_move , Board *final_board ) ;
#line 71
static char const   *build_FEN_comment(Board const   *board ) ;
#line 83 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static int DefaultTagOrder[39]  = 
#line 83
  {      11,      26,      8,      23, 
        35,      1,      22,      38, 
        4,      36,      2,      40, 
        6,      39,      5,      37, 
        3,      9,      18,      19, 
        34,      28,      16,      31, 
        0,      12,      13,      24, 
        27,      7,      30,      32, 
        33,      25,      14,      29, 
        17,      21,      -1};
#line 112 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static int *TagOrder  =    (int *)((void *)0);
#line 113 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static int tag_order_space  =    0;
#line 115 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
void set_output_line_length(unsigned int length ) 
{ 
  void *tmp ;

  {
#line 118
  if ((unsigned long )output_line != (unsigned long )((void *)0)) {
    {
#line 119
    free((void *)output_line);
    }
  }
  {
#line 121
  tmp = MallocOrDie((size_t )(length + 1U));
#line 121
  output_line = (char *)tmp;
#line 122
  GlobalState.max_line_length = length;
  }
#line 123
  return;
}
}
#line 128 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
OutputFormat which_output_format(char const   *arg ) 
{ 
  int i ;
  struct __anonstruct_formats_42 formats[15] ;
  char const   *format_prefix ;
  size_t format_prefix_len ;
  size_t tmp ;
  OutputFormat format ;
  size_t tmp___0 ;
  int tmp___1 ;

  {
#line 131
  formats[0].arg = "san";
#line 131
  formats[0].format = (OutputFormat )1;
#line 131
  formats[1].arg = "SAN";
#line 131
  formats[1].format = (OutputFormat )1;
#line 131
  formats[2].arg = "epd";
#line 131
  formats[2].format = (OutputFormat )2;
#line 131
  formats[3].arg = "EPD";
#line 131
  formats[3].format = (OutputFormat )2;
#line 131
  formats[4].arg = "lalg";
#line 131
  formats[4].format = (OutputFormat )4;
#line 131
  formats[5].arg = "halg";
#line 131
  formats[5].format = (OutputFormat )5;
#line 131
  formats[6].arg = "CM";
#line 131
  formats[6].format = (OutputFormat )3;
#line 131
  formats[7].arg = "LALG";
#line 131
  formats[7].format = (OutputFormat )4;
#line 131
  formats[8].arg = "HALG";
#line 131
  formats[8].format = (OutputFormat )5;
#line 131
  formats[9].arg = "ELALG";
#line 131
  formats[9].format = (OutputFormat )6;
#line 131
  formats[10].arg = "elalg";
#line 131
  formats[10].format = (OutputFormat )6;
#line 131
  formats[11].arg = "uci";
#line 131
  formats[11].format = (OutputFormat )7;
#line 131
  formats[12].arg = "cm";
#line 131
  formats[12].format = (OutputFormat )3;
#line 131
  formats[13].arg = "";
#line 131
  formats[13].format = (OutputFormat )0;
#line 131
  formats[14].arg = (char const   *)((void *)0);
#line 131
  formats[14].format = (OutputFormat )1;
#line 153
  i = 0;
  {
#line 153
  while (1) {
    while_continue: /* CIL Label */ ;
#line 153
    if (! ((unsigned long )formats[i].arg != (unsigned long )((void *)0))) {
#line 153
      goto while_break;
    }
    {
#line 154
    format_prefix = formats[i].arg;
#line 155
    tmp = strlen(format_prefix);
#line 155
    format_prefix_len = tmp;
#line 156
    tmp___1 = strncmp(arg, format_prefix, format_prefix_len);
    }
#line 156
    if (tmp___1 == 0) {
#line 157
      format = formats[i].format;
#line 159
      if ((int const   )*format_prefix == 0) {
#line 159
        if ((int const   )*arg != 0) {
          {
#line 160
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown output format %s.\n",
                  arg);
#line 162
          exit(1);
          }
        }
      }
#line 168
      if ((unsigned int )format == 1U) {
#line 168
        goto _L;
      } else
#line 168
      if ((unsigned int )format == 6U) {
        _L: /* CIL Label */ 
        {
#line 168
        tmp___0 = strlen(arg);
        }
#line 168
        if (tmp___0 > format_prefix_len) {
          {
#line 170
          set_output_piece_characters(arg + format_prefix_len);
          }
        }
      }
#line 172
      return (format);
    }
#line 153
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 175
  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown output format %s.\n",
          arg);
  }
#line 176
  return ((OutputFormat )1);
}
}
#line 184 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char const   PGN_suffix[5]  = {      (char const   )'.',      (char const   )'p',      (char const   )'g',      (char const   )'n', 
        (char const   )'\000'};
#line 185 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char const   EPD_suffix[5]  = {      (char const   )'.',      (char const   )'e',      (char const   )'p',      (char const   )'d', 
        (char const   )'\000'};
#line 186 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char const   CM_suffix[4]  = {      (char const   )'.',      (char const   )'c',      (char const   )'m',      (char const   )'\000'};
#line 180 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
char const   *output_file_suffix(OutputFormat format ) 
{ 


  {
  {
#line 193
  if ((unsigned int )format == 6U) {
#line 193
    goto case_6;
  }
#line 193
  if ((unsigned int )format == 5U) {
#line 193
    goto case_6;
  }
#line 193
  if ((unsigned int )format == 4U) {
#line 193
    goto case_6;
  }
#line 193
  if ((unsigned int )format == 1U) {
#line 193
    goto case_6;
  }
#line 193
  if ((unsigned int )format == 0U) {
#line 193
    goto case_6;
  }
#line 195
  if ((unsigned int )format == 2U) {
#line 195
    goto case_2;
  }
#line 197
  if ((unsigned int )format == 3U) {
#line 197
    goto case_3;
  }
#line 199
  goto switch_default;
  case_6: /* CIL Label */ 
  case_5: /* CIL Label */ 
  case_4: /* CIL Label */ 
  case_1: /* CIL Label */ 
  case_0: /* CIL Label */ 
#line 194
  return (PGN_suffix);
  case_2: /* CIL Label */ 
#line 196
  return (EPD_suffix);
  case_3: /* CIL Label */ 
#line 198
  return (CM_suffix);
  switch_default: /* CIL Label */ 
#line 200
  return (PGN_suffix);
  switch_break: /* CIL Label */ ;
  }
}
}
#line 204 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char const   *select_tag_string(TagName tag ) 
{ 
  char const   *tag_string ;

  {
#line 208
  if ((unsigned int )tag == 20U) {
#line 209
    tag_string = (char const   *)((void *)0);
  } else
#line 208
  if ((unsigned int )tag == 10U) {
#line 209
    tag_string = (char const   *)((void *)0);
  } else
#line 208
  if ((unsigned int )tag == 15U) {
#line 209
    tag_string = (char const   *)((void *)0);
  } else {
    {
#line 212
    tag_string = tag_header_string(tag);
    }
  }
#line 214
  return (tag_string);
}
}
#line 217 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static Boolean is_STR(TagName tag ) 
{ 


  {
  {
#line 227
  if ((unsigned int )tag == 22U) {
#line 227
    goto case_22;
  }
#line 227
  if ((unsigned int )tag == 1U) {
#line 227
    goto case_22;
  }
#line 227
  if ((unsigned int )tag == 35U) {
#line 227
    goto case_22;
  }
#line 227
  if ((unsigned int )tag == 23U) {
#line 227
    goto case_22;
  }
#line 227
  if ((unsigned int )tag == 8U) {
#line 227
    goto case_22;
  }
#line 227
  if ((unsigned int )tag == 26U) {
#line 227
    goto case_22;
  }
#line 227
  if ((unsigned int )tag == 11U) {
#line 227
    goto case_22;
  }
#line 229
  goto switch_default;
  case_22: /* CIL Label */ 
  case_1: /* CIL Label */ 
  case_35: /* CIL Label */ 
  case_23: /* CIL Label */ 
  case_8: /* CIL Label */ 
  case_26: /* CIL Label */ 
  case_11: /* CIL Label */ 
#line 228
  return ((Boolean )1);
  switch_default: /* CIL Label */ 
#line 230
  return ((Boolean )0);
  switch_break: /* CIL Label */ ;
  }
}
}
#line 237 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void output_tag(TagName tag , char **Tags , FILE *outfp ) 
{ 
  char const   *tag_string ;
  size_t tmp ;
  Boolean tmp___0 ;

  {
  {
#line 242
  tmp___0 = is_STR(tag);
  }
#line 242
  if (tmp___0) {
#line 242
    goto _L;
  } else
#line 242
  if ((unsigned long )*(Tags + tag) != (unsigned long )((void *)0)) {
    _L: /* CIL Label */ 
    {
#line 243
    tag_string = select_tag_string(tag);
    }
#line 245
    if ((unsigned long )tag_string != (unsigned long )((void *)0)) {
      {
#line 246
      fprintf((FILE */* __restrict  */)outfp, (char const   */* __restrict  */)"[%s \"",
              tag_string);
      }
#line 247
      if ((unsigned long )*(Tags + tag) != (unsigned long )((void *)0)) {
        {
#line 248
        tmp = strlen((char const   *)*(Tags + tag));
#line 248
        fwrite((void const   */* __restrict  */)*(Tags + tag), sizeof(char ), tmp,
               (FILE */* __restrict  */)outfp);
        }
      } else
#line 251
      if ((unsigned int )tag == 8U) {
        {
#line 252
        fprintf((FILE */* __restrict  */)outfp, (char const   */* __restrict  */)"????.??.??");
        }
      } else {
        {
#line 255
        fprintf((FILE */* __restrict  */)outfp, (char const   */* __restrict  */)"?");
        }
      }
      {
#line 258
      fprintf((FILE */* __restrict  */)outfp, (char const   */* __restrict  */)"\"]\n");
      }
    }
  }
#line 261
  return;
}
}
#line 264 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void output_STR(FILE *outfp , char **Tags ) 
{ 
  unsigned int tag_index ;

  {
#line 271
  tag_index = 0U;
  {
#line 271
  while (1) {
    while_continue: /* CIL Label */ ;
#line 271
    if (! (tag_index < 7U)) {
#line 271
      goto while_break;
    }
    {
#line 272
    output_tag((TagName )DefaultTagOrder[tag_index], Tags, outfp);
#line 271
    tag_index ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 274
  return;
}
}
#line 279 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void show_tags(FILE *outfp , char **Tags , int tags_length ) 
{ 
  int tag_index ;
  char **copy_of_tags ;
  void *tmp ;
  int i ;
  TagName tag ;
  TagName tag___0 ;

  {
  {
#line 288
  tmp = MallocOrDie((unsigned long )tags_length * sizeof(*copy_of_tags));
#line 288
  copy_of_tags = (char **)tmp;
#line 291
  i = 0;
  }
  {
#line 291
  while (1) {
    while_continue: /* CIL Label */ ;
#line 291
    if (! (i < tags_length)) {
#line 291
      goto while_break;
    }
#line 292
    *(copy_of_tags + i) = *(Tags + i);
#line 291
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 296
  if ((unsigned long )TagOrder == (unsigned long )((void *)0)) {
#line 301
    tag_index = 0;
    {
#line 301
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 301
      if (! (DefaultTagOrder[tag_index] >= 0)) {
#line 301
        goto while_break___0;
      }
      {
#line 302
      tag = (TagName )DefaultTagOrder[tag_index];
#line 303
      output_tag(tag, copy_of_tags, outfp);
#line 304
      *(copy_of_tags + tag) = (char *)((void *)0);
#line 301
      tag_index ++;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 307
    tag_index = 0;
    {
#line 307
    while (1) {
      while_continue___1: /* CIL Label */ ;
#line 307
      if (! (tag_index < tags_length)) {
#line 307
        goto while_break___1;
      }
#line 308
      if ((unsigned long )*(copy_of_tags + tag_index) != (unsigned long )((void *)0)) {
        {
#line 309
        output_tag((TagName )tag_index, copy_of_tags, outfp);
        }
      }
#line 307
      tag_index ++;
    }
    while_break___1: /* CIL Label */ ;
    }
  } else {
#line 314
    tag_index = 0;
    {
#line 314
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 314
      if (! (*(TagOrder + tag_index) >= 0)) {
#line 314
        goto while_break___2;
      }
      {
#line 315
      tag___0 = (TagName )*(TagOrder + tag_index);
#line 316
      output_tag(tag___0, copy_of_tags, outfp);
#line 317
      *(copy_of_tags + tag___0) = (char *)((void *)0);
#line 314
      tag_index ++;
      }
    }
    while_break___2: /* CIL Label */ ;
    }
  }
  {
#line 320
  free((void *)copy_of_tags);
#line 321
  _IO_putc('\n', outfp);
  }
#line 322
  return;
}
}
#line 327 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void check_line_length(FILE *fp , size_t len ) 
{ 


  {
#line 330
  if (line_length + len > (size_t )GlobalState.max_line_length) {
    {
#line 331
    terminate_line(fp);
    }
  }
#line 333
  return;
}
}
#line 338 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void single_char(FILE *fp , char ch ) 
{ 


  {
  {
#line 341
  check_line_length(fp, (size_t )1);
#line 342
  *(output_line + line_length) = ch;
#line 343
  line_length ++;
  }
#line 344
  return;
}
}
#line 347 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void print_separator(FILE *fp ) 
{ 


  {
  {
#line 353
  check_line_length(fp, (size_t )2);
  }
#line 354
  if (line_length != 0UL) {
#line 355
    *(output_line + line_length) = (char )' ';
#line 356
    line_length ++;
  }
#line 358
  return;
}
}
#line 361 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
void terminate_line(FILE *fp ) 
{ 


  {
  {
#line 365
  while (1) {
    while_continue: /* CIL Label */ ;
#line 365
    if (line_length >= 1UL) {
#line 365
      if (! ((int )*(output_line + (line_length - 1UL)) == 32)) {
#line 365
        goto while_break;
      }
    } else {
#line 365
      goto while_break;
    }
#line 366
    line_length --;
  }
  while_break: /* CIL Label */ ;
  }
#line 368
  if (line_length > 0UL) {
    {
#line 369
    *(output_line + line_length) = (char )'\000';
#line 370
    fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"%s\n",
            output_line);
#line 371
    line_length = (size_t )0;
    }
  }
#line 373
  return;
}
}
#line 378 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
void print_str(FILE *fp , char const   *str ) 
{ 
  size_t len ;
  size_t tmp ;

  {
  {
#line 380
  tmp = strlen(str);
#line 380
  len = tmp;
#line 382
  check_line_length(fp, len);
  }
#line 383
  if (len > (size_t )GlobalState.max_line_length) {
    {
#line 384
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"String length %lu is too long for the line length of %lu:\n",
            len, (unsigned long )GlobalState.max_line_length);
#line 387
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"%s\n",
            str);
#line 388
    report_details(GlobalState.logfile);
#line 389
    fprintf((FILE */* __restrict  */)fp, (char const   */* __restrict  */)"%s\n",
            str);
    }
  } else {
    {
#line 392
    sprintf((char */* __restrict  */)(output_line + line_length), (char const   */* __restrict  */)"%s",
            str);
#line 393
    line_length += len;
    }
  }
#line 395
  return;
}
}
#line 397 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void print_comment_list(FILE *fp , CommentList *comment_list ) 
{ 
  CommentList *next_comment ;
  StringList *comment ;
  char *chunk ;
  char *str ;
  char *tmp ;

  {
#line 401
  next_comment = comment_list;
  {
#line 401
  while (1) {
    while_continue: /* CIL Label */ ;
#line 401
    if (! ((unsigned long )next_comment != (unsigned long )((void *)0))) {
#line 401
      goto while_break;
    }
#line 403
    comment = next_comment->Comment;
#line 405
    if ((unsigned long )comment != (unsigned long )((void *)0)) {
      {
#line 411
      single_char(fp, (char )'{');
      }
      {
#line 412
      while (1) {
        while_continue___0: /* CIL Label */ ;
#line 412
        if (! ((unsigned long )comment != (unsigned long )((void *)0))) {
#line 412
          goto while_break___0;
        }
        {
#line 414
        tmp = StringCopy(comment->str);
#line 414
        str = tmp;
#line 415
        chunk = strtok((char */* __restrict  */)str, (char const   */* __restrict  */)" ");
        }
        {
#line 416
        while (1) {
          while_continue___1: /* CIL Label */ ;
#line 416
          if (! ((unsigned long )chunk != (unsigned long )((void *)0))) {
#line 416
            goto while_break___1;
          }
          {
#line 417
          print_separator(fp);
#line 418
          print_str(fp, (char const   *)chunk);
#line 419
          chunk = strtok((char */* __restrict  */)((char *)((void *)0)), (char const   */* __restrict  */)" ");
          }
        }
        while_break___1: /* CIL Label */ ;
        }
        {
#line 421
        free((void *)str);
#line 412
        comment = comment->next;
        }
      }
      while_break___0: /* CIL Label */ ;
      }
      {
#line 423
      print_separator(fp);
#line 424
      single_char(fp, (char )'}');
      }
#line 425
      if ((unsigned long )next_comment->next != (unsigned long )((void *)0)) {
        {
#line 426
        print_separator(fp);
        }
      }
    }
#line 401
    next_comment = next_comment->next;
  }
  while_break: /* CIL Label */ ;
  }
#line 430
  return;
}
}
#line 432 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void print_move_list(FILE *outputfile , unsigned int move_number , Boolean white_to_move ,
                            Move const   *move_details , Board const   *final_board ) 
{ 
  unsigned int print_move_number ;
  Move const   *move ;
  Boolean keepPrinting ;
  unsigned int plies ;
  Boolean tmp ;
  char const   *tmp___0 ;

  {
#line 435
  print_move_number = 1U;
#line 436
  move = move_details;
#line 441
  plies = 2U * move_number - 1U;
#line 442
  if (! white_to_move) {
#line 443
    plies ++;
  }
#line 445
  if (GlobalState.output_ply_limit >= 0U) {
#line 445
    if (plies > GlobalState.output_ply_limit) {
#line 447
      keepPrinting = (Boolean )0;
    } else {
#line 450
      keepPrinting = (Boolean )1;
    }
  } else {
#line 450
    keepPrinting = (Boolean )1;
  }
  {
#line 453
  while (1) {
    while_continue: /* CIL Label */ ;
#line 453
    if ((unsigned long )move != (unsigned long )((void *)0)) {
#line 453
      if (! keepPrinting) {
#line 453
        goto while_break;
      }
    } else {
#line 453
      goto while_break;
    }
    {
#line 455
    tmp = print_move(outputfile, move_number, print_move_number, white_to_move, move);
#line 455
    print_move_number = (unsigned int )tmp;
    }
#line 462
    if (! GlobalState.check_only) {
#line 462
      if ((unsigned long )move != (unsigned long )((void *)0)) {
#line 462
        if ((unsigned long )move->terminating_result != (unsigned long )((void *)0)) {
#line 464
          if (GlobalState.output_FEN_string) {
#line 464
            if ((unsigned long )final_board != (unsigned long )((void *)0)) {
              {
#line 465
              print_separator(outputfile);
#line 466
              tmp___0 = build_FEN_comment(final_board);
#line 466
              print_str(outputfile, tmp___0);
              }
            }
          }
#line 468
          if (GlobalState.keep_results) {
            {
#line 469
            print_separator(outputfile);
#line 470
            print_str(outputfile, (char const   *)move->terminating_result);
            }
          }
        }
      }
    }
#line 473
    if ((int )move->move[0] != 0) {
#line 475
      if (white_to_move) {
#line 476
        white_to_move = (Boolean )0;
      } else {
#line 479
        move_number ++;
#line 480
        white_to_move = (Boolean )1;
      }
#line 482
      plies ++;
#line 483
      if (GlobalState.output_ply_limit >= 0U) {
#line 483
        if (plies > GlobalState.output_ply_limit) {
#line 485
          keepPrinting = (Boolean )0;
        }
      }
    }
#line 488
    move = (Move const   *)move->next;
#line 496
    if ((unsigned long )move != (unsigned long )((void *)0)) {
#line 496
      if (keepPrinting) {
        {
#line 497
        print_separator(outputfile);
        }
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 501
  if ((unsigned long )move != (unsigned long )((void *)0)) {
#line 501
    if (! keepPrinting) {
#line 505
      if (GlobalState.keep_results) {
        {
#line 507
        while (1) {
          while_continue___0: /* CIL Label */ ;
#line 507
          if (! ((unsigned long )move->next != (unsigned long )((void *)0))) {
#line 507
            goto while_break___0;
          }
#line 508
          move = (Move const   *)move->next;
        }
        while_break___0: /* CIL Label */ ;
        }
#line 510
        if ((unsigned long )move->terminating_result != (unsigned long )((void *)0)) {
          {
#line 511
          print_separator(outputfile);
#line 512
          print_str(outputfile, "*");
          }
        }
      }
    }
  }
#line 516
  return;
}
}
#line 547 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char small_number[9]  = 
#line 547
  {      (char )'9',      (char )'9',      (char )'9',      (char )'9', 
        (char )'9',      (char )'.',      (char )'.',      (char )'.', 
        (char )'\000'};
#line 524 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static Boolean print_move(FILE *outputfile , unsigned int move_number , unsigned int print_move_number ,
                          Boolean white_to_move , Move const   *move_details ) 
{ 
  Boolean something_printed ;
  StringList *nags ;
  Variation *variants ;
  unsigned char const   *move_text ;
  char const   *tmp ;
  char *check ;
  char *tmp___0 ;
  int len ;
  char *just_move ;
  void *tmp___1 ;
  char algebraic[16] ;
  char tmp___2 ;
  char algebraic___0[16] ;
  size_t ind ;
  char const   *tmp___3 ;
  size_t tmp___4 ;
  char const   *tmp___5 ;

  {
#line 527
  something_printed = (Boolean )0;
#line 529
  if ((unsigned long )move_details == (unsigned long )((void *)0)) {
    {
#line 531
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: NULL move in print_move.\n");
#line 533
    report_details(GlobalState.logfile);
    }
  } else
#line 536
  if (! GlobalState.check_only) {
#line 540
    nags = (StringList *)move_details->Nags;
#line 541
    variants = (Variation *)move_details->Variants;
#line 542
    move_text = (unsigned char const   *)(move_details->move);
#line 544
    if ((int const   )*move_text != 0) {
#line 545
      if (GlobalState.keep_move_numbers) {
#line 545
        if (white_to_move) {
#line 545
          goto _L;
        } else
#line 545
        if (print_move_number) {
          _L: /* CIL Label */ 
#line 550
          if (white_to_move) {
#line 550
            tmp = "";
          } else {
#line 550
            tmp = "..";
          }
          {
#line 550
          sprintf((char */* __restrict  */)(small_number), (char const   */* __restrict  */)"%u.%s",
                  move_number, tmp);
#line 551
          print_str(outputfile, (char const   *)(small_number));
#line 552
          print_separator(outputfile);
          }
        }
      }
      {
#line 556
      if ((unsigned int )GlobalState.output_format == 0U) {
#line 556
        goto case_0;
      }
#line 556
      if ((unsigned int )GlobalState.output_format == 1U) {
#line 556
        goto case_0;
      }
#line 584
      if ((unsigned int )GlobalState.output_format == 5U) {
#line 584
        goto case_5;
      }
#line 631
      if ((unsigned int )GlobalState.output_format == 6U) {
#line 631
        goto case_6___0;
      }
#line 631
      if ((unsigned int )GlobalState.output_format == 4U) {
#line 631
        goto case_6___0;
      }
#line 696
      goto switch_default;
      case_0: /* CIL Label */ 
      case_1: /* CIL Label */ 
#line 561
      if (GlobalState.keep_checks) {
        {
#line 562
        print_str(outputfile, (char const   *)move_text);
        }
      } else {
        {
#line 566
        tmp___0 = strchr((char const   *)move_text, '+');
#line 566
        check = tmp___0;
        }
#line 567
        if ((unsigned long )check == (unsigned long )((void *)0)) {
          {
#line 568
          check = strchr((char const   *)move_text, '#');
          }
        }
#line 570
        if ((unsigned long )check != (unsigned long )((void *)0)) {
          {
#line 572
          len = (int )(check - (char *)move_text);
#line 573
          tmp___1 = MallocOrDie((size_t )(len + 1));
#line 573
          just_move = (char *)tmp___1;
#line 574
          strncpy((char */* __restrict  */)just_move, (char const   */* __restrict  */)((char const   *)move_text),
                  (size_t )len);
#line 575
          *(just_move + len) = (char )'\000';
#line 576
          print_str(outputfile, (char const   *)just_move);
#line 577
          free((void *)just_move);
          }
        } else {
          {
#line 580
          print_str(outputfile, (char const   *)move_text);
          }
        }
      }
#line 583
      goto switch_break;
      case_5: /* CIL Label */ 
#line 587
      algebraic[0] = (char )'\000';
      {
#line 593
      if ((unsigned int const   )move_details->class == 3U) {
#line 593
        goto case_3;
      }
#line 593
      if ((unsigned int const   )move_details->class == 5U) {
#line 593
        goto case_3;
      }
#line 593
      if ((unsigned int const   )move_details->class == 4U) {
#line 593
        goto case_3;
      }
#line 593
      if ((unsigned int const   )move_details->class == 2U) {
#line 593
        goto case_3;
      }
#line 593
      if ((unsigned int const   )move_details->class == 0U) {
#line 593
        goto case_3;
      }
#line 600
      if ((unsigned int const   )move_details->class == 1U) {
#line 600
        goto case_1___0;
      }
#line 608
      if ((unsigned int const   )move_details->class == 6U) {
#line 608
        goto case_6;
      }
#line 611
      if ((unsigned int const   )move_details->class == 7U) {
#line 611
        goto case_7;
      }
#line 588
      goto switch_break___0;
      case_3: /* CIL Label */ 
      case_5___0: /* CIL Label */ 
      case_4: /* CIL Label */ 
      case_2: /* CIL Label */ 
      case_0___0: /* CIL Label */ 
      {
#line 594
      sprintf((char */* __restrict  */)(algebraic), (char const   */* __restrict  */)"%c%c-%c%c",
              (int const   )move_details->from_col, (int const   )move_details->from_rank,
              (int const   )move_details->to_col, (int const   )move_details->to_rank);
      }
#line 599
      goto switch_break___0;
      case_1___0: /* CIL Label */ 
      {
#line 601
      tmp___2 = promoted_piece_letter((Piece )move_details->promoted_piece);
#line 601
      sprintf((char */* __restrict  */)(algebraic), (char const   */* __restrict  */)"%c%c-%c%c%c",
              (int const   )move_details->from_col, (int const   )move_details->from_rank,
              (int const   )move_details->to_col, (int const   )move_details->to_rank,
              (int )tmp___2);
      }
#line 607
      goto switch_break___0;
      case_6: /* CIL Label */ 
      {
#line 609
      strcpy((char */* __restrict  */)(algebraic), (char const   */* __restrict  */)"--");
      }
#line 610
      goto switch_break___0;
      case_7: /* CIL Label */ 
      {
#line 612
      strcpy((char */* __restrict  */)(algebraic), (char const   */* __restrict  */)"???");
      }
#line 613
      goto switch_break___0;
      switch_break___0: /* CIL Label */ ;
      }
#line 615
      if (GlobalState.keep_checks) {
        {
#line 617
        if ((unsigned int const   )move_details->check_status == 0U) {
#line 617
          goto case_0___1;
        }
#line 619
        if ((unsigned int const   )move_details->check_status == 1U) {
#line 619
          goto case_1___1;
        }
#line 622
        if ((unsigned int const   )move_details->check_status == 2U) {
#line 622
          goto case_2___0;
        }
#line 616
        goto switch_break___1;
        case_0___1: /* CIL Label */ 
#line 618
        goto switch_break___1;
        case_1___1: /* CIL Label */ 
        {
#line 620
        strcat((char */* __restrict  */)(algebraic), (char const   */* __restrict  */)"+");
        }
#line 621
        goto switch_break___1;
        case_2___0: /* CIL Label */ 
        {
#line 623
        strcat((char */* __restrict  */)(algebraic), (char const   */* __restrict  */)"#");
        }
#line 624
        goto switch_break___1;
        switch_break___1: /* CIL Label */ ;
        }
      }
      {
#line 627
      print_str(outputfile, (char const   *)(algebraic));
      }
#line 629
      goto switch_break;
      case_6___0: /* CIL Label */ 
      case_4___0: /* CIL Label */ 
#line 633
      ind = (size_t )0;
#line 636
      if ((unsigned int )GlobalState.output_format == 6U) {
#line 636
        if ((unsigned int const   )move_details->class == 3U) {
          {
#line 638
          tmp___3 = piece_str((Piece )move_details->piece_to_move);
#line 638
          strcpy((char */* __restrict  */)(algebraic___0), (char const   */* __restrict  */)tmp___3);
#line 640
          ind = strlen((char const   *)(algebraic___0));
          }
        }
      }
#line 643
      if ((unsigned int const   )move_details->class != 6U) {
        {
#line 644
        sprintf((char */* __restrict  */)(& algebraic___0[ind]), (char const   */* __restrict  */)"%c%c%c%c",
                (int const   )move_details->from_col, (int const   )move_details->from_rank,
                (int const   )move_details->to_col, (int const   )move_details->to_rank);
#line 649
        ind += 4UL;
        }
      } else {
        {
#line 652
        strcpy((char */* __restrict  */)(algebraic___0), (char const   */* __restrict  */)"--");
#line 653
        tmp___4 = strlen("--");
#line 653
        ind += tmp___4;
        }
      }
      {
#line 660
      if ((unsigned int const   )move_details->class == 6U) {
#line 660
        goto case_6___1;
      }
#line 660
      if ((unsigned int const   )move_details->class == 3U) {
#line 660
        goto case_6___1;
      }
#line 660
      if ((unsigned int const   )move_details->class == 5U) {
#line 660
        goto case_6___1;
      }
#line 660
      if ((unsigned int const   )move_details->class == 4U) {
#line 660
        goto case_6___1;
      }
#line 660
      if ((unsigned int const   )move_details->class == 0U) {
#line 660
        goto case_6___1;
      }
#line 663
      if ((unsigned int const   )move_details->class == 2U) {
#line 663
        goto case_2___1;
      }
#line 669
      if ((unsigned int const   )move_details->class == 1U) {
#line 669
        goto case_1___2;
      }
#line 674
      if ((unsigned int const   )move_details->class == 7U) {
#line 674
        goto case_7___0;
      }
#line 655
      goto switch_break___2;
      case_6___1: /* CIL Label */ 
      case_3___0: /* CIL Label */ 
      case_5___1: /* CIL Label */ 
      case_4___1: /* CIL Label */ 
      case_0___2: /* CIL Label */ 
#line 662
      goto switch_break___2;
      case_2___1: /* CIL Label */ 
#line 664
      if ((unsigned int )GlobalState.output_format == 6U) {
        {
#line 665
        strcat((char */* __restrict  */)(algebraic___0), (char const   */* __restrict  */)"ep");
#line 666
        ind += 2UL;
        }
      }
#line 668
      goto switch_break___2;
      case_1___2: /* CIL Label */ 
      {
#line 670
      tmp___5 = piece_str((Piece )move_details->promoted_piece);
#line 670
      sprintf((char */* __restrict  */)(& algebraic___0[ind]), (char const   */* __restrict  */)"%s",
              tmp___5);
#line 672
      ind = strlen((char const   *)(algebraic___0));
      }
#line 673
      goto switch_break___2;
      case_7___0: /* CIL Label */ 
      {
#line 675
      strcpy((char */* __restrict  */)(algebraic___0), (char const   */* __restrict  */)"???");
#line 676
      ind += 3UL;
      }
#line 677
      goto switch_break___2;
      switch_break___2: /* CIL Label */ ;
      }
#line 679
      if (GlobalState.keep_checks) {
        {
#line 681
        if ((unsigned int const   )move_details->check_status == 0U) {
#line 681
          goto case_0___3;
        }
#line 683
        if ((unsigned int const   )move_details->check_status == 1U) {
#line 683
          goto case_1___3;
        }
#line 687
        if ((unsigned int const   )move_details->check_status == 2U) {
#line 687
          goto case_2___2;
        }
#line 680
        goto switch_break___3;
        case_0___3: /* CIL Label */ 
#line 682
        goto switch_break___3;
        case_1___3: /* CIL Label */ 
        {
#line 684
        strcat((char */* __restrict  */)(algebraic___0), (char const   */* __restrict  */)"+");
#line 685
        ind ++;
        }
#line 686
        goto switch_break___3;
        case_2___2: /* CIL Label */ 
        {
#line 688
        strcat((char */* __restrict  */)(algebraic___0), (char const   */* __restrict  */)"#");
#line 689
        ind ++;
        }
#line 690
        goto switch_break___3;
        switch_break___3: /* CIL Label */ ;
        }
      }
      {
#line 693
      print_str(outputfile, (char const   *)(algebraic___0));
      }
#line 695
      goto switch_break;
      switch_default: /* CIL Label */ 
      {
#line 697
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown output format %d in print_move()\n",
              (unsigned int )GlobalState.output_format);
#line 700
      exit(1);
      }
#line 701
      goto switch_break;
      switch_break: /* CIL Label */ ;
      }
    } else {
      {
#line 706
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Empty move in print_move.\n");
#line 708
      report_details(GlobalState.logfile);
      }
    }
#line 713
    if (GlobalState.keep_NAGs) {
      {
#line 714
      while (1) {
        while_continue: /* CIL Label */ ;
#line 714
        if (! ((unsigned long )nags != (unsigned long )((void *)0))) {
#line 714
          goto while_break;
        }
        {
#line 715
        print_separator(outputfile);
#line 716
        print_str(outputfile, nags->str);
#line 717
        nags = nags->next;
        }
      }
      while_break: /* CIL Label */ ;
      }
    }
#line 723
    if (GlobalState.keep_comments) {
#line 724
      if ((unsigned long )move_details->Comment != (unsigned long )((void *)0)) {
        {
#line 725
        print_separator(outputfile);
#line 726
        print_comment_list(outputfile, (CommentList *)move_details->Comment);
#line 727
        something_printed = (Boolean )1;
        }
      }
    }
#line 730
    if (GlobalState.keep_variations) {
#line 730
      if ((unsigned long )variants != (unsigned long )((void *)0)) {
        {
#line 731
        while (1) {
          while_continue___0: /* CIL Label */ ;
#line 731
          if (! ((unsigned long )variants != (unsigned long )((void *)0))) {
#line 731
            goto while_break___0;
          }
          {
#line 732
          print_separator(outputfile);
#line 733
          single_char(outputfile, (char )'(');
          }
#line 734
          if (GlobalState.keep_comments) {
#line 734
            if ((unsigned long )variants->prefix_comment != (unsigned long )((void *)0)) {
              {
#line 736
              print_comment_list(outputfile, variants->prefix_comment);
#line 737
              print_separator(outputfile);
              }
            }
          }
          {
#line 742
          print_move_list(outputfile, move_number, white_to_move, (Move const   *)variants->moves,
                          (Board const   *)((void *)0));
#line 745
          single_char(outputfile, (char )')');
          }
#line 746
          if (GlobalState.keep_comments) {
#line 746
            if ((unsigned long )variants->suffix_comment != (unsigned long )((void *)0)) {
              {
#line 748
              print_separator(outputfile);
#line 749
              print_comment_list(outputfile, variants->suffix_comment);
              }
            }
          }
#line 751
          variants = variants->next;
        }
        while_break___0: /* CIL Label */ ;
        }
#line 753
        something_printed = (Boolean )1;
      }
    }
  }
#line 757
  return (something_printed);
}
}
#line 761 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char promoted_piece_letter(Piece piece ) 
{ 


  {
  {
#line 765
  if ((unsigned int )piece == 6U) {
#line 765
    goto case_6;
  }
#line 767
  if ((unsigned int )piece == 5U) {
#line 767
    goto case_5;
  }
#line 769
  if ((unsigned int )piece == 4U) {
#line 769
    goto case_4;
  }
#line 771
  if ((unsigned int )piece == 3U) {
#line 771
    goto case_3;
  }
#line 773
  goto switch_default;
  case_6: /* CIL Label */ 
#line 766
  return ((char )'Q');
  case_5: /* CIL Label */ 
#line 768
  return ((char )'R');
  case_4: /* CIL Label */ 
#line 770
  return ((char )'B');
  case_3: /* CIL Label */ 
#line 772
  return ((char )'N');
  switch_default: /* CIL Label */ 
#line 774
  return ((char )'?');
  switch_break: /* CIL Label */ ;
  }
}
}
#line 779 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void output_cm_comment(CommentList *comment , FILE *outputfile , unsigned int indent ) 
{ 
  unsigned int indent_for_this_line ;
  char *chunk ;
  StringList *comment_str ;
  char *str ;
  char *tmp ;
  size_t len ;
  size_t tmp___0 ;

  {
  {
#line 784
  indent_for_this_line = 0U;
#line 786
  _IO_putc(';', outputfile);
#line 787
  line_length ++;
  }
  {
#line 788
  while (1) {
    while_continue: /* CIL Label */ ;
#line 788
    if (! ((unsigned long )comment != (unsigned long )((void *)0))) {
#line 788
      goto while_break;
    }
#line 793
    comment_str = comment->Comment;
    {
#line 795
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 795
      if (! ((unsigned long )comment_str != (unsigned long )((void *)0))) {
#line 795
        goto while_break___0;
      }
      {
#line 796
      tmp = StringCopy(comment_str->str);
#line 796
      str = tmp;
#line 797
      chunk = strtok((char */* __restrict  */)str, (char const   */* __restrict  */)" ");
      }
      {
#line 798
      while (1) {
        while_continue___1: /* CIL Label */ ;
#line 798
        if (! ((unsigned long )chunk != (unsigned long )((void *)0))) {
#line 798
          goto while_break___1;
        }
        {
#line 799
        tmp___0 = strlen((char const   *)chunk);
#line 799
        len = tmp___0;
        }
#line 801
        if ((line_length + 1UL) + len > (size_t )GlobalState.max_line_length) {
          {
#line 803
          indent_for_this_line = indent;
#line 804
          fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"\n%*s%c ",
                  indent_for_this_line, "", ';');
#line 806
          line_length = (size_t )(indent_for_this_line + 2U);
          }
        } else {
          {
#line 809
          _IO_putc(' ', outputfile);
#line 810
          line_length ++;
          }
        }
        {
#line 812
        fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%s",
                chunk);
#line 813
        line_length += len;
#line 814
        chunk = strtok((char */* __restrict  */)((char *)((void *)0)), (char const   */* __restrict  */)" ");
        }
      }
      while_break___1: /* CIL Label */ ;
      }
      {
#line 816
      free((void *)str);
#line 795
      comment_str = comment_str->next;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 818
    comment = comment->next;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 820
  _IO_putc('\n', outputfile);
#line 821
  line_length = (size_t )0;
  }
#line 822
  return;
}
}
#line 824 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void output_cm_result(char const   *result , FILE *outputfile ) 
{ 
  int tmp ;
  int tmp___0 ;
  int tmp___1 ;

  {
  {
#line 827
  fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%c ",
          ';');
#line 828
  tmp___1 = strcmp(result, "1-0");
  }
#line 828
  if (tmp___1 == 0) {
    {
#line 829
    fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"and black resigns");
    }
  } else {
    {
#line 831
    tmp___0 = strcmp(result, "0-1");
    }
#line 831
    if (tmp___0 == 0) {
      {
#line 832
      fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"and white resigns");
      }
    } else {
      {
#line 834
      tmp = strncmp(result, "1/2", (size_t )3);
      }
#line 834
      if (tmp == 0) {
        {
#line 835
        fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"draw");
        }
      } else {
        {
#line 838
        fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"incomplete result");
        }
      }
    }
  }
#line 840
  return;
}
}
#line 844 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void output_cm_game(FILE *outputfile , unsigned int move_number , Boolean white_to_move ,
                           Game const   game ) 
{ 
  Move const   *move ;
  char const   *tmp ;
  char const   *tmp___0 ;
  char const   *result ;
  char const   *result___0 ;

  {
#line 847
  move = (Move const   *)game.moves;
#line 849
  if (move_number != 1U) {
    {
#line 850
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unable to output CM games other than from the starting position.\n");
#line 852
    report_details(GlobalState.logfile);
    }
  } else
#line 849
  if (! white_to_move) {
    {
#line 850
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unable to output CM games other than from the starting position.\n");
#line 852
    report_details(GlobalState.logfile);
    }
  }
#line 854
  if ((unsigned long )*(game.tags + 35) != (unsigned long )((void *)0)) {
#line 854
    tmp = (char const   *)*(game.tags + 35);
  } else {
#line 854
    tmp = "";
  }
  {
#line 854
  fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"WHITE: %s\n",
          tmp);
  }
#line 856
  if ((unsigned long )*(game.tags + 1) != (unsigned long )((void *)0)) {
#line 856
    tmp___0 = (char const   *)*(game.tags + 1);
  } else {
#line 856
    tmp___0 = "";
  }
  {
#line 856
  fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"BLACK: %s\n",
          tmp___0);
#line 858
  _IO_putc('\n', outputfile);
  }
#line 860
  if ((unsigned long )game.prefix_comment != (unsigned long )((void *)0)) {
    {
#line 861
    line_length = (size_t )0;
#line 862
    output_cm_comment((CommentList *)game.prefix_comment, outputfile, 0U);
    }
  }
  {
#line 864
  while (1) {
    while_continue: /* CIL Label */ ;
#line 864
    if (! ((unsigned long )move != (unsigned long )((void *)0))) {
#line 864
      goto while_break;
    }
#line 865
    if ((int )move->move[0] != 0) {
#line 867
      if (white_to_move) {
        {
#line 868
        fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%*u. ",
                3, move_number);
#line 869
        fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%*s",
                -15, move->move);
#line 870
        white_to_move = (Boolean )0;
        }
      } else {
        {
#line 873
        fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%*s",
                -15, move->move);
#line 874
        move_number ++;
#line 875
        white_to_move = (Boolean )1;
        }
      }
    }
#line 878
    if ((unsigned long )move->Comment != (unsigned long )((void *)0)) {
#line 878
      if (GlobalState.keep_comments) {
#line 879
        result = (char const   *)move->terminating_result;
#line 881
        if (! white_to_move) {
          {
#line 882
          fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%*s",
                  -15, "...");
          }
        }
        {
#line 884
        line_length = (size_t )35;
#line 885
        output_cm_comment((CommentList *)move->Comment, outputfile, 35U);
        }
#line 886
        if ((unsigned long )result != (unsigned long )((void *)0)) {
#line 886
          if ((unsigned int const   )move->check_status != 2U) {
#line 888
            if (white_to_move) {
              {
#line 889
              fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%*s",
                      35, "");
              }
            } else {
              {
#line 893
              fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%*s %*s%*s",
                      4, "", -15, "...", 15, "");
              }
            }
            {
#line 897
            output_cm_result(result, outputfile);
#line 898
            _IO_putc('\n', outputfile);
            }
          } else {
#line 886
            goto _L;
          }
        } else
        _L: /* CIL Label */ 
#line 901
        if (! white_to_move) {
          {
#line 903
          fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%*s %*s",
                  4, "", -15, "...");
          }
        }
      } else {
#line 878
        goto _L___1;
      }
    } else
    _L___1: /* CIL Label */ 
#line 909
    if ((unsigned long )move->terminating_result != (unsigned long )((void *)0)) {
#line 909
      if ((unsigned int const   )move->check_status != 2U) {
#line 912
        result___0 = (char const   *)move->terminating_result;
#line 914
        if (! white_to_move) {
          {
#line 915
          fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%*s",
                  -15, "...");
          }
        }
        {
#line 917
        output_cm_result(result___0, outputfile);
        }
#line 918
        if (! white_to_move) {
          {
#line 919
          _IO_putc('\n', outputfile);
#line 920
          fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%*s %*s",
                  4, "", -15, "...");
          }
        }
        {
#line 923
        _IO_putc('\n', outputfile);
        }
      } else {
#line 909
        goto _L___0;
      }
    } else
    _L___0: /* CIL Label */ 
#line 926
    if (white_to_move) {
      {
#line 928
      _IO_putc('\n', outputfile);
      }
    }
#line 932
    move = (Move const   *)move->next;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 934
  _IO_putc('\n', outputfile);
  }
#line 935
  return;
}
}
#line 939 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
void output_game(Game current_game , FILE *outputfile ) 
{ 
  Boolean white_to_move ;
  unsigned int move_number ;
  Board *final_board ;
  Board *board ;
  Board *tmp ;

  {
#line 941
  white_to_move = (Boolean )1;
#line 942
  move_number = 1U;
#line 944
  final_board = (Board *)((void *)0);
#line 950
  if ((unsigned long )*(current_game.tags + 14) != (unsigned long )((void *)0)) {
    {
#line 951
    tmp = new_fen_board((char const   *)*(current_game.tags + 14));
#line 951
    board = tmp;
    }
#line 953
    if ((unsigned long )board != (unsigned long )((void *)0)) {
      {
#line 954
      move_number = board->move_number;
#line 955
      white_to_move = (Boolean )((unsigned int )board->to_move == 1U);
#line 956
      free((void *)board);
      }
    }
  }
#line 961
  line_length = (size_t )0;
#line 965
  if ((unsigned int )GlobalState.output_format != 0U) {
    {
#line 969
    final_board = rewrite_game(current_game.moves, (char const   *)*(current_game.tags + 14));
    }
  }
  {
#line 977
  if ((unsigned int )GlobalState.output_format == 6U) {
#line 977
    goto case_6;
  }
#line 977
  if ((unsigned int )GlobalState.output_format == 5U) {
#line 977
    goto case_6;
  }
#line 977
  if ((unsigned int )GlobalState.output_format == 4U) {
#line 977
    goto case_6;
  }
#line 977
  if ((unsigned int )GlobalState.output_format == 0U) {
#line 977
    goto case_6;
  }
#line 977
  if ((unsigned int )GlobalState.output_format == 1U) {
#line 977
    goto case_6;
  }
#line 981
  if ((unsigned int )GlobalState.output_format == 2U) {
#line 981
    goto case_2;
  }
#line 985
  if ((unsigned int )GlobalState.output_format == 3U) {
#line 985
    goto case_3;
  }
#line 988
  goto switch_default;
  case_6: /* CIL Label */ 
  case_5: /* CIL Label */ 
  case_4: /* CIL Label */ 
  case_0: /* CIL Label */ 
  case_1: /* CIL Label */ 
  {
#line 978
  print_algebraic_game(current_game, outputfile, move_number, white_to_move, final_board);
  }
#line 980
  goto switch_break;
  case_2: /* CIL Label */ 
  {
#line 982
  print_epd_game(current_game, outputfile, move_number, white_to_move, final_board);
  }
#line 984
  goto switch_break;
  case_3: /* CIL Label */ 
  {
#line 986
  output_cm_game(outputfile, move_number, white_to_move, (Game const   )current_game);
  }
#line 987
  goto switch_break;
  switch_default: /* CIL Label */ 
  {
#line 989
  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: unknown output type %d in output_game().\n",
          (unsigned int )GlobalState.output_format);
  }
#line 992
  goto switch_break;
  switch_break: /* CIL Label */ ;
  }
  {
#line 994
  fflush(outputfile);
  }
#line 995
  if ((unsigned long )final_board != (unsigned long )((void *)0)) {
    {
#line 996
    free((void *)final_board);
    }
  }
#line 998
  return;
}
}
#line 1001 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
void add_to_output_tag_order(TagName tag ) 
{ 
  int tag_index ;
  void *tmp ;
  void *tmp___0 ;
  char const   *tmp___1 ;

  {
#line 1005
  if ((unsigned long )TagOrder == (unsigned long )((void *)0)) {
    {
#line 1006
    tag_order_space = (int )(sizeof(DefaultTagOrder) / sizeof(DefaultTagOrder[0]));
#line 1007
    tmp = MallocOrDie((unsigned long )tag_order_space * sizeof(*TagOrder));
#line 1007
    TagOrder = (int *)tmp;
#line 1009
    *(TagOrder + 0) = -1;
    }
  }
#line 1014
  tag_index = 0;
  {
#line 1014
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1014
    if (*(TagOrder + tag_index) != -1) {
#line 1014
      if (! ((unsigned int )*(TagOrder + tag_index) != (unsigned int )tag)) {
#line 1014
        goto while_break;
      }
    } else {
#line 1014
      goto while_break;
    }
#line 1014
    tag_index ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 1018
  if (*(TagOrder + tag_index) == -1) {
#line 1020
    if (tag_index >= tag_order_space) {
      {
#line 1022
      tag_order_space += 10;
#line 1023
      tmp___0 = ReallocOrDie((void *)TagOrder, (unsigned long )tag_order_space * sizeof(*TagOrder));
#line 1023
      TagOrder = (int *)tmp___0;
      }
    }
#line 1026
    *(TagOrder + tag_index) = (int )tag;
#line 1027
    *(TagOrder + (tag_index + 1)) = -1;
  } else {
    {
#line 1030
    tmp___1 = select_tag_string(tag);
#line 1030
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Duplicate position for tag: %s\n",
            tmp___1);
    }
  }
#line 1033
  return;
}
}
#line 1037
static char const   *format_epd_game_comment(char **Tags ) ;
#line 1037 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char comment_prefix[4]  = {      (char )'c',      (char )'0',      (char )' ',      (char )'\000'};
#line 1038 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char player_separator[2]  = {      (char )'-',      (char )'\000'};
#line 1039 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static size_t prefix_and_separator_len  =    sizeof(comment_prefix) + sizeof(player_separator);
#line 1035 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char const   *format_epd_game_comment(char **Tags ) 
{ 
  size_t space_needed ;
  char *comment ;
  size_t tmp ;
  size_t tmp___0 ;
  size_t tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;
  void *tmp___4 ;
  size_t tmp___5 ;

  {
#line 1041
  space_needed = prefix_and_separator_len;
#line 1044
  if ((unsigned long )*(Tags + 35) != (unsigned long )((void *)0)) {
    {
#line 1045
    tmp = strlen((char const   *)*(Tags + 35));
#line 1045
    space_needed += tmp;
    }
  }
#line 1047
  if ((unsigned long )*(Tags + 1) != (unsigned long )((void *)0)) {
    {
#line 1048
    tmp___0 = strlen((char const   *)*(Tags + 1));
#line 1048
    space_needed += tmp___0;
    }
  }
#line 1051
  if ((unsigned long )*(Tags + 11) != (unsigned long )((void *)0)) {
    {
#line 1052
    tmp___1 = strlen((char const   *)*(Tags + 11));
#line 1052
    space_needed += 1UL + tmp___1;
    }
  }
#line 1054
  if ((unsigned long )*(Tags + 26) != (unsigned long )((void *)0)) {
    {
#line 1055
    tmp___2 = strlen((char const   *)*(Tags + 26));
#line 1055
    space_needed += 1UL + tmp___2;
    }
  }
#line 1057
  if ((unsigned long )*(Tags + 8) != (unsigned long )((void *)0)) {
    {
#line 1058
    tmp___3 = strlen((char const   *)*(Tags + 8));
#line 1058
    space_needed += 1UL + tmp___3;
    }
  }
  {
#line 1061
  space_needed ++;
#line 1063
  tmp___4 = MallocOrDie(space_needed + 1UL);
#line 1063
  comment = (char *)tmp___4;
#line 1065
  strcpy((char */* __restrict  */)comment, (char const   */* __restrict  */)(comment_prefix));
  }
#line 1066
  if ((unsigned long )*(Tags + 35) != (unsigned long )((void *)0)) {
    {
#line 1067
    strcat((char */* __restrict  */)comment, (char const   */* __restrict  */)*(Tags + 35));
    }
  }
  {
#line 1069
  strcat((char */* __restrict  */)comment, (char const   */* __restrict  */)(player_separator));
  }
#line 1070
  if ((unsigned long )*(Tags + 1) != (unsigned long )((void *)0)) {
    {
#line 1071
    strcat((char */* __restrict  */)comment, (char const   */* __restrict  */)*(Tags + 1));
    }
  }
#line 1073
  if ((unsigned long )*(Tags + 11) != (unsigned long )((void *)0)) {
    {
#line 1074
    strcat((char */* __restrict  */)comment, (char const   */* __restrict  */)" ");
#line 1075
    strcat((char */* __restrict  */)comment, (char const   */* __restrict  */)*(Tags + 11));
    }
  }
#line 1077
  if ((unsigned long )*(Tags + 26) != (unsigned long )((void *)0)) {
    {
#line 1078
    strcat((char */* __restrict  */)comment, (char const   */* __restrict  */)" ");
#line 1079
    strcat((char */* __restrict  */)comment, (char const   */* __restrict  */)*(Tags + 26));
    }
  }
#line 1081
  if ((unsigned long )*(Tags + 8) != (unsigned long )((void *)0)) {
    {
#line 1082
    strcat((char */* __restrict  */)comment, (char const   */* __restrict  */)" ");
#line 1083
    strcat((char */* __restrict  */)comment, (char const   */* __restrict  */)*(Tags + 8));
    }
  }
  {
#line 1085
  strcat((char */* __restrict  */)comment, (char const   */* __restrict  */)";");
#line 1086
  tmp___5 = strlen((char const   *)comment);
  }
#line 1086
  if (tmp___5 >= space_needed) {
    {
#line 1087
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: overflow in format_epd_game_comment\n");
    }
  }
#line 1090
  return ((char const   *)comment);
}
}
#line 1093 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void print_algebraic_game(Game current_game , FILE *outputfile , unsigned int move_number ,
                                 Boolean white_to_move , Board *final_board ) 
{ 


  {
#line 1099
  if ((unsigned int )GlobalState.tag_output_format == 0U) {
    {
#line 1100
    show_tags(outputfile, current_game.tags, current_game.tags_length);
    }
  } else
#line 1102
  if ((unsigned int )GlobalState.tag_output_format == 1U) {
    {
#line 1103
    output_STR(outputfile, current_game.tags);
    }
#line 1104
    if (GlobalState.add_ECO) {
#line 1104
      if (! GlobalState.parsing_ECO_file) {
        {
#line 1108
        output_tag((TagName )9, current_game.tags, outputfile);
#line 1109
        output_tag((TagName )19, current_game.tags, outputfile);
#line 1110
        output_tag((TagName )34, current_game.tags, outputfile);
#line 1111
        output_tag((TagName )28, current_game.tags, outputfile);
        }
      }
    }
    {
#line 1115
    output_tag((TagName )14, current_game.tags, outputfile);
#line 1116
    _IO_putc('\n', outputfile);
    }
  } else
#line 1118
  if (! ((unsigned int )GlobalState.tag_output_format == 2U)) {
    {
#line 1121
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown output form for tags: %d\n",
            (unsigned int )GlobalState.tag_output_format);
#line 1124
    exit(1);
    }
  }
#line 1126
  if (GlobalState.keep_comments) {
#line 1126
    if ((unsigned long )current_game.prefix_comment != (unsigned long )((void *)0)) {
      {
#line 1128
      print_comment_list(outputfile, current_game.prefix_comment);
#line 1130
      terminate_line(outputfile);
#line 1131
      _IO_putc('\n', outputfile);
      }
    }
  }
  {
#line 1133
  print_move_list(outputfile, move_number, white_to_move, (Move const   *)current_game.moves,
                  (Board const   *)final_board);
  }
#line 1136
  if ((unsigned long )current_game.moves == (unsigned long )((void *)0)) {
#line 1137
    if ((unsigned long )*(current_game.tags + 22) != (unsigned long )((void *)0)) {
      {
#line 1138
      print_str(outputfile, (char const   *)*(current_game.tags + 22));
      }
    } else {
      {
#line 1141
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Zero move game with no result\n");
      }
    }
  }
  {
#line 1145
  terminate_line(outputfile);
#line 1146
  _IO_putc('\n', outputfile);
  }
#line 1147
  return;
}
}
#line 1155 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char epd[100]  ;
#line 1149 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void print_epd_move_list(Game current_game , FILE *outputfile , unsigned int move_number ,
                                Boolean white_to_move , Board *final_board ) 
{ 
  Move const   *move ;
  char const   *game_comment ;
  char const   *tmp ;

  {
  {
#line 1153
  move = (Move const   *)current_game.moves;
#line 1154
  tmp = format_epd_game_comment(current_game.tags);
#line 1154
  game_comment = tmp;
  }
  {
#line 1157
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1157
    if (! ((unsigned long )move != (unsigned long )((void *)0))) {
#line 1157
      goto while_break;
    }
#line 1158
    if ((unsigned long )move->epd != (unsigned long )((void *)0)) {
      {
#line 1159
      fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%s",
              move->epd);
      }
    } else {
      {
#line 1162
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Missing EPD\n");
      }
    }
    {
#line 1164
    fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)" %s",
            game_comment);
#line 1165
    _IO_putc('\n', outputfile);
#line 1166
    move = (Move const   *)move->next;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 1168
  if ((unsigned long )final_board != (unsigned long )((void *)0)) {
    {
#line 1169
    build_basic_EPD_string((Board const   *)final_board, epd);
#line 1170
    fprintf((FILE */* __restrict  */)outputfile, (char const   */* __restrict  */)"%s %s",
            epd, game_comment);
#line 1171
    _IO_putc('\n', outputfile);
    }
  }
  {
#line 1173
  free((void *)game_comment);
  }
#line 1174
  return;
}
}
#line 1176 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static void print_epd_game(Game current_game , FILE *outputfile , unsigned int move_number ,
                           Boolean white_to_move , Board *final_board ) 
{ 


  {
#line 1181
  if (! GlobalState.check_only) {
    {
#line 1182
    print_epd_move_list(current_game, outputfile, move_number, white_to_move, final_board);
#line 1184
    _IO_putc('\n', outputfile);
    }
  }
#line 1186
  return;
}
}
#line 1196 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char fen[100]  ;
#line 1193 "/home/wheatley/newnew/temp/pgn-extract-17.14/output.c"
static char const   *build_FEN_comment(Board const   *board ) 
{ 
  size_t tmp ;
  size_t tmp___0 ;

  {
  {
#line 1197
  strcpy((char */* __restrict  */)(fen), (char const   */* __restrict  */)"{ \"");
#line 1198
  tmp = strlen((char const   *)(fen));
#line 1198
  build_FEN_string(board, & fen[tmp]);
#line 1199
  strcat((char */* __restrict  */)(fen), (char const   */* __restrict  */)"\" }");
#line 1201
  tmp___0 = strlen((char const   *)(fen));
  }
#line 1201
  if (tmp___0 >= 100UL) {
    {
#line 1202
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: string overflow in build_FEN_comment.\n");
    }
  }
#line 1205
  return ((char const   *)(fen));
}
}
#line 775 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) abs)(int __x )  __attribute__((__const__)) ;
#line 45 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.h"
void initEcoTable(void) ;
#line 48 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.c"
static unsigned int maximum_half_moves  =    6U;
#line 54 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.c"
static EcoLog **EcoTable  ;
#line 131 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.c"
void initEcoTable(void) 
{ 
  int i ;
  void *tmp ;

  {
#line 134
  if ((unsigned long )EcoTable == (unsigned long )((void *)0)) {
    {
#line 136
    tmp = MallocOrDie(4096UL * sizeof(EcoLog *));
#line 136
    EcoTable = (EcoLog **)tmp;
#line 138
    i = 0;
    }
    {
#line 138
    while (1) {
      while_continue: /* CIL Label */ ;
#line 138
      if (! (i < 4096)) {
#line 138
        goto while_break;
      }
#line 139
      *(EcoTable + i) = (EcoLog *)((void *)0);
#line 138
      i ++;
    }
    while_break: /* CIL Label */ ;
    }
  }
#line 142
  return;
}
}
#line 157 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.c"
static EcoLog *last_entry  =    (EcoLog *)((void *)0);
#line 146 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.c"
void save_eco_details(Game game_details , unsigned int number_of_half_moves ) 
{ 
  unsigned int ix ;
  EcoLog *entry ;
  Boolean can_save ;
  char const   *tag ;
  char const   *opening ;
  char const   *variation ;
  void *tmp ;
  char *tmp___0 ;
  int tmp___1 ;
  char *tmp___2 ;
  int tmp___3 ;
  char *tmp___4 ;
  char *tmp___5 ;

  {
#line 148
  ix = (unsigned int )(game_details.final_hash_value % 4096UL);
#line 149
  entry = (EcoLog *)((void *)0);
#line 151
  can_save = (Boolean )1;
#line 159
  entry = *(EcoTable + ix);
  {
#line 159
  while (1) {
    while_continue: /* CIL Label */ ;
#line 159
    if ((unsigned long )entry != (unsigned long )((void *)0)) {
#line 159
      if (! can_save) {
#line 159
        goto while_break;
      }
    } else {
#line 159
      goto while_break;
    }
#line 160
    if (entry->required_hash_value == game_details.final_hash_value) {
#line 160
      if ((unsigned int )entry->half_moves == number_of_half_moves) {
#line 160
        if (entry->cumulative_hash_value == game_details.cumulative_hash_value) {
#line 163
          tag = entry->ECO_tag;
#line 163
          opening = entry->Opening_tag;
#line 163
          variation = entry->Variation_tag;
#line 166
          if ((unsigned long )tag == (unsigned long )((void *)0)) {
#line 167
            tag = "";
          }
#line 169
          if ((unsigned long )opening == (unsigned long )((void *)0)) {
#line 170
            opening = "";
          }
#line 172
          if ((unsigned long )variation == (unsigned long )((void *)0)) {
#line 173
            variation = "";
          }
          {
#line 175
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"ECO hash collision of ");
#line 176
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"%s %s %s",
                  tag, opening, variation);
#line 177
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)" against ");
#line 178
          tag = (char const   *)*(game_details.tags + 9);
#line 179
          opening = (char const   *)*(game_details.tags + 19);
#line 180
          variation = (char const   *)*(game_details.tags + 34);
          }
#line 181
          if ((unsigned long )tag == (unsigned long )((void *)0)) {
#line 182
            tag = "";
          }
#line 184
          if ((unsigned long )opening == (unsigned long )((void *)0)) {
#line 185
            opening = "";
          }
#line 187
          if ((unsigned long )variation == (unsigned long )((void *)0)) {
#line 188
            variation = "";
          }
          {
#line 190
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"%s %s %s\n",
                  tag, opening, variation);
#line 191
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Possible duplicate move sequences.\n");
#line 193
          can_save = (Boolean )0;
          }
        }
      }
    }
#line 159
    entry = entry->next;
  }
  while_break: /* CIL Label */ ;
  }
#line 197
  if (can_save) {
    {
#line 199
    tmp = MallocOrDie(sizeof(*entry));
#line 199
    entry = (EcoLog *)tmp;
#line 201
    entry->required_hash_value = game_details.final_hash_value;
#line 202
    entry->cumulative_hash_value = game_details.cumulative_hash_value;
#line 206
    entry->half_moves = (int )number_of_half_moves;
    }
#line 208
    if (number_of_half_moves + 6U > maximum_half_moves) {
#line 209
      maximum_half_moves = number_of_half_moves + 6U;
    }
#line 211
    if ((unsigned long )*(game_details.tags + 9) != (unsigned long )((void *)0)) {
#line 212
      if ((unsigned long )last_entry != (unsigned long )((void *)0)) {
#line 212
        if ((unsigned long )last_entry->ECO_tag != (unsigned long )((void *)0)) {
          {
#line 212
          tmp___1 = strcmp(last_entry->ECO_tag, (char const   *)*(game_details.tags + 9));
          }
#line 212
          if (tmp___1 == 0) {
#line 215
            entry->ECO_tag = last_entry->ECO_tag;
          } else {
            {
#line 218
            tmp___0 = StringCopy((char const   *)*(game_details.tags + 9));
#line 218
            entry->ECO_tag = (char const   *)tmp___0;
            }
          }
        } else {
          {
#line 218
          tmp___0 = StringCopy((char const   *)*(game_details.tags + 9));
#line 218
          entry->ECO_tag = (char const   *)tmp___0;
          }
        }
      } else {
        {
#line 218
        tmp___0 = StringCopy((char const   *)*(game_details.tags + 9));
#line 218
        entry->ECO_tag = (char const   *)tmp___0;
        }
      }
    } else {
#line 222
      entry->ECO_tag = (char const   *)((void *)0);
    }
#line 224
    if ((unsigned long )*(game_details.tags + 19) != (unsigned long )((void *)0)) {
#line 225
      if ((unsigned long )last_entry != (unsigned long )((void *)0)) {
#line 225
        if ((unsigned long )last_entry->Opening_tag != (unsigned long )((void *)0)) {
          {
#line 225
          tmp___3 = strcmp(last_entry->Opening_tag, (char const   *)*(game_details.tags + 19));
          }
#line 225
          if (tmp___3 == 0) {
#line 229
            entry->Opening_tag = last_entry->Opening_tag;
          } else {
            {
#line 232
            tmp___2 = StringCopy((char const   *)*(game_details.tags + 19));
#line 232
            entry->Opening_tag = (char const   *)tmp___2;
            }
          }
        } else {
          {
#line 232
          tmp___2 = StringCopy((char const   *)*(game_details.tags + 19));
#line 232
          entry->Opening_tag = (char const   *)tmp___2;
          }
        }
      } else {
        {
#line 232
        tmp___2 = StringCopy((char const   *)*(game_details.tags + 19));
#line 232
        entry->Opening_tag = (char const   *)tmp___2;
        }
      }
    } else {
#line 236
      entry->Opening_tag = (char const   *)((void *)0);
    }
#line 238
    if ((unsigned long )*(game_details.tags + 34) != (unsigned long )((void *)0)) {
      {
#line 239
      tmp___4 = StringCopy((char const   *)*(game_details.tags + 34));
#line 239
      entry->Variation_tag = (char const   *)tmp___4;
      }
    } else {
#line 242
      entry->Variation_tag = (char const   *)((void *)0);
    }
#line 244
    if ((unsigned long )*(game_details.tags + 28) != (unsigned long )((void *)0)) {
      {
#line 245
      tmp___5 = StringCopy((char const   *)*(game_details.tags + 28));
#line 245
      entry->Sub_Variation_tag = (char const   *)tmp___5;
      }
    } else {
#line 249
      entry->Sub_Variation_tag = (char const   *)((void *)0);
    }
#line 252
    entry->next = *(EcoTable + ix);
#line 253
    *(EcoTable + ix) = entry;
#line 255
    last_entry = entry;
  }
#line 257
  return;
}
}
#line 264 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.c"
EcoLog *eco_matches(HashCode current_hash_value , HashCode cumulative_hash_value ,
                    unsigned int half_moves_played___0 ) 
{ 
  EcoLog *possible ;
  unsigned int ix ;
  EcoLog *entry ;
  int tmp ;

  {
#line 268
  possible = (EcoLog *)((void *)0);
#line 271
  if (half_moves_played___0 <= maximum_half_moves) {
#line 273
    ix = (unsigned int )(current_hash_value % 4096UL);
#line 276
    entry = *(EcoTable + ix);
    {
#line 276
    while (1) {
      while_continue: /* CIL Label */ ;
#line 276
      if (! ((unsigned long )entry != (unsigned long )((void *)0))) {
#line 276
        goto while_break;
      }
#line 277
      if (entry->required_hash_value == current_hash_value) {
#line 279
        if (half_moves_played___0 == (unsigned int )entry->half_moves) {
#line 279
          if (entry->cumulative_hash_value == cumulative_hash_value) {
#line 281
            return (entry);
          } else {
#line 279
            goto _L;
          }
        } else {
          _L: /* CIL Label */ 
          {
#line 283
          tmp = abs((int )(half_moves_played___0 - (unsigned int )entry->half_moves));
          }
#line 283
          if (tmp <= 6) {
#line 286
            possible = entry;
          }
        }
      }
#line 276
      entry = entry->next;
    }
    while_break: /* CIL Label */ ;
    }
  }
#line 294
  return (possible);
}
}
#line 305 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.c"
static char const   suffix[5]  = {      (char const   )'.',      (char const   )'p',      (char const   )'g',      (char const   )'n', 
        (char const   )'\000'};
#line 307 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.c"
static char filename[15]  ;
#line 300 "/home/wheatley/newnew/temp/pgn-extract-17.14/eco.c"
FILE *open_eco_output_file(EcoDivision ECO_level , char const   *eco ) 
{ 
  unsigned short const   **tmp ;
  FILE *tmp___0 ;

  {
#line 309
  if ((unsigned long )eco == (unsigned long )((void *)0)) {
    {
#line 310
    strcpy((char */* __restrict  */)(filename), (char const   */* __restrict  */)"noeco.pgn");
    }
  } else {
    {
#line 309
    tmp = __ctype_b_loc();
    }
#line 309
    if ((int const   )*(*tmp + (int )*eco) & 1024) {
#line 312
      if ((unsigned int )ECO_level == 0U) {
        {
#line 313
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: ECO division in open_eco_output_file\n");
#line 315
        strcpy((char */* __restrict  */)(filename), (char const   */* __restrict  */)"noeco");
        }
      } else
#line 317
      if ((unsigned int )ECO_level == 0U) {
        {
#line 318
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: ECO division in open_eco_output_file\n");
#line 320
        strcpy((char */* __restrict  */)(filename), (char const   */* __restrict  */)"noeco");
        }
      } else {
        {
#line 323
        strncpy((char */* __restrict  */)(filename), (char const   */* __restrict  */)eco,
                (size_t )ECO_level);
#line 324
        filename[ECO_level] = (char )'\000';
#line 325
        strcat((char */* __restrict  */)(filename), (char const   */* __restrict  */)(suffix));
        }
      }
    } else {
      {
#line 310
      strcpy((char */* __restrict  */)(filename), (char const   */* __restrict  */)"noeco.pgn");
      }
    }
  }
  {
#line 327
  tmp___0 = MustOpen((char const   *)(filename), "a");
  }
#line 327
  return (tmp___0);
}
}
#line 709 "/usr/include/stdio.h"
extern size_t fread(void * __restrict  __ptr , size_t __size , size_t __n , FILE * __restrict  __stream ) ;
#line 749
extern int fseek(FILE *__stream , long __off , int __whence ) ;
#line 826 "/usr/include/unistd.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1), __leaf__)) unlink)(char const   *__name ) ;
#line 58 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
static char VIRTUAL_FILE[12]  = 
#line 58 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
  {      (char )'v',      (char )'i',      (char )'r',      (char )'t', 
        (char )'u',      (char )'a',      (char )'l',      (char )'.', 
        (char )'t',      (char )'m',      (char )'p',      (char )'\000'};
#line 75 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
static LogHeaderEntry *VirtualLogTable  =    (LogHeaderEntry *)((void *)0);
#line 81 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
static HashLog **LogTable  =    (HashLog **)((void *)0);
#line 100 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
static FILE *hash_file  =    (FILE *)((void *)0);
#line 102
static char const   *previous_virtual_occurance(Game game_details ) ;
#line 107 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
void init_duplicate_hash_table(void) 
{ 
  int i ;
  void *tmp ;
  long tmp___0 ;
  void *tmp___1 ;

  {
#line 111
  if (GlobalState.use_virtual_hash_table) {
    {
#line 112
    tmp = MallocOrDie(100003UL * sizeof(*VirtualLogTable));
#line 112
    VirtualLogTable = (LogHeaderEntry *)tmp;
#line 114
    i = 0;
    }
    {
#line 114
    while (1) {
      while_continue: /* CIL Label */ ;
#line 114
      if (! (i < 100003)) {
#line 114
        goto while_break;
      }
#line 115
      tmp___0 = -1L;
#line 115
      (VirtualLogTable + i)->tail = tmp___0;
#line 115
      (VirtualLogTable + i)->head = tmp___0;
#line 114
      i ++;
    }
    while_break: /* CIL Label */ ;
    }
    {
#line 117
    hash_file = fopen((char const   */* __restrict  */)(VIRTUAL_FILE), (char const   */* __restrict  */)"w+b");
    }
#line 118
    if ((unsigned long )hash_file == (unsigned long )((void *)0)) {
      {
#line 119
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unable to open %s\n",
              VIRTUAL_FILE);
      }
    }
  } else {
    {
#line 124
    tmp___1 = MallocOrDie(100003UL * sizeof(*LogTable));
#line 124
    LogTable = (HashLog **)tmp___1;
#line 125
    i = 0;
    }
    {
#line 125
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 125
      if (! (i < 100003)) {
#line 125
        goto while_break___0;
      }
#line 126
      *(LogTable + i) = (HashLog *)((void *)0);
#line 125
      i ++;
    }
    while_break___0: /* CIL Label */ ;
    }
  }
#line 129
  return;
}
}
#line 132 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
void clear_duplicate_hash_table(void) 
{ 


  {
#line 135
  if (GlobalState.use_virtual_hash_table) {
#line 136
    if ((unsigned long )hash_file != (unsigned long )((void *)0)) {
      {
#line 137
      fclose(hash_file);
#line 138
      unlink((char const   *)(VIRTUAL_FILE));
#line 139
      hash_file = (FILE *)((void *)0);
      }
    }
  }
#line 142
  return;
}
}
#line 145 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
static int retrieve_virtual_entry(long ix , VirtualHashLog *entry ) 
{ 
  size_t tmp ;
  int tmp___0 ;

  {
#line 148
  if ((unsigned long )hash_file == (unsigned long )((void *)0)) {
#line 149
    return (0);
  } else {
    {
#line 151
    tmp___0 = fseek(hash_file, ix, 0);
    }
#line 151
    if (tmp___0 != 0) {
      {
#line 152
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Fseek error to %ld in retrieve_virtual_entry\n",
              ix);
      }
#line 154
      return (0);
    } else {
      {
#line 156
      tmp = fread((void */* __restrict  */)((void *)entry), sizeof(*entry), (size_t )1,
                  (FILE */* __restrict  */)hash_file);
      }
#line 156
      if (tmp != 1UL) {
        {
#line 157
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Fread error from %ld in retrieve_virtual_entry\n",
                ix);
        }
#line 159
        return (0);
      } else {
#line 162
        return (1);
      }
    }
  }
}
}
#line 167 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
static int write_virtual_entry(long where , VirtualHashLog const   *entry ) 
{ 
  size_t tmp ;
  int tmp___0 ;

  {
  {
#line 170
  tmp___0 = fseek(hash_file, where, 0);
  }
#line 170
  if (tmp___0 != 0) {
    {
#line 171
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Fseek error to %ld in write_virtual_entry\n",
            where);
    }
#line 173
    return (0);
  } else {
    {
#line 175
    tmp = fwrite((void const   */* __restrict  */)((void *)entry), sizeof(*entry),
                 (size_t )1, (FILE */* __restrict  */)hash_file);
    }
#line 175
    if (tmp != 1UL) {
      {
#line 176
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Fwrite error from %ld in write_virtual_entry\n",
              where);
      }
#line 178
      return (0);
    } else {
#line 182
      return (1);
    }
  }
}
}
#line 231 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
static long next_free_entry  =    0L;
#line 192 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
static char const   *previous_virtual_occurance(Game game_details ) 
{ 
  unsigned int ix ;
  VirtualHashLog entry ;
  Boolean duplicate ;
  char const   *original_filename ;
  int keep_going ;
  int tmp ;
  long where_written ;
  long tmp___0 ;
  VirtualHashLog tail ;
  int tmp___1 ;
  int tmp___2 ;

  {
#line 194
  ix = (unsigned int )(game_details.final_hash_value % 100003UL);
#line 196
  duplicate = (Boolean )0;
#line 197
  original_filename = (char const   *)((void *)0);
#line 201
  if (GlobalState.suppress_duplicates) {
#line 201
    goto _L___0;
  } else
#line 201
  if (GlobalState.suppress_originals) {
#line 201
    goto _L___0;
  } else
#line 201
  if ((unsigned long )GlobalState.duplicate_file != (unsigned long )((void *)0)) {
    _L___0: /* CIL Label */ 
#line 203
    if (! ((VirtualLogTable + ix)->head < 0L)) {
      {
#line 207
      tmp = retrieve_virtual_entry((VirtualLogTable + ix)->head, & entry);
#line 207
      keep_going = tmp;
      }
      {
#line 210
      while (1) {
        while_continue: /* CIL Label */ ;
#line 210
        if (keep_going) {
#line 210
          if (! (! duplicate)) {
#line 210
            goto while_break;
          }
        } else {
#line 210
          goto while_break;
        }
#line 211
        if (entry.final_hash_value == game_details.final_hash_value) {
#line 211
          if (entry.cumulative_hash_value == game_details.cumulative_hash_value) {
            {
#line 216
            original_filename = input_file_name(entry.file_number);
#line 217
            duplicate = (Boolean )1;
            }
          } else {
#line 211
            goto _L;
          }
        } else
        _L: /* CIL Label */ 
#line 219
        if (entry.next >= 0L) {
          {
#line 220
          keep_going = retrieve_virtual_entry(entry.next, & entry);
          }
        } else {
#line 223
          keep_going = 0;
        }
      }
      while_break: /* CIL Label */ ;
      }
    }
#line 228
    if (! duplicate) {
      {
#line 234
      entry.final_hash_value = game_details.final_hash_value;
#line 235
      entry.cumulative_hash_value = game_details.cumulative_hash_value;
#line 236
      entry.file_number = current_file_number();
#line 237
      entry.next = -1L;
#line 240
      tmp___2 = write_virtual_entry(next_free_entry, (VirtualHashLog const   *)(& entry));
      }
#line 240
      if (tmp___2) {
#line 241
        where_written = next_free_entry;
#line 243
        next_free_entry = (long )((unsigned long )next_free_entry + sizeof(entry));
#line 246
        if ((VirtualLogTable + ix)->head < 0L) {
#line 248
          tmp___0 = where_written;
#line 248
          (VirtualLogTable + ix)->tail = tmp___0;
#line 248
          (VirtualLogTable + ix)->head = tmp___0;
        } else {
          {
#line 254
          tmp___1 = retrieve_virtual_entry((VirtualLogTable + ix)->tail, & tail);
          }
#line 254
          if (tmp___1) {
            {
#line 255
            tail.next = where_written;
#line 256
            write_virtual_entry((VirtualLogTable + ix)->tail, (VirtualHashLog const   *)(& tail));
#line 258
            (VirtualLogTable + ix)->tail = where_written;
            }
          }
        }
      }
    }
  }
#line 264
  return (original_filename);
}
}
#line 276 "/home/wheatley/newnew/temp/pgn-extract-17.14/hashing.c"
char const   *previous_occurance(Game game_details , int plycount ) 
{ 
  char const   *original_filename ;
  unsigned int ix ;
  HashLog *entry ;
  Boolean duplicate ;
  void *tmp ;

  {
#line 279
  original_filename = (char const   *)((void *)0);
#line 280
  if (GlobalState.use_virtual_hash_table) {
    {
#line 281
    original_filename = previous_virtual_occurance(game_details);
    }
  } else {
#line 284
    ix = (unsigned int )(game_details.final_hash_value % 100003UL);
#line 285
    entry = (HashLog *)((void *)0);
#line 286
    duplicate = (Boolean )0;
#line 289
    if (GlobalState.suppress_duplicates) {
#line 289
      goto _L___1;
    } else
#line 289
    if (GlobalState.suppress_originals) {
#line 289
      goto _L___1;
    } else
#line 289
    if (GlobalState.fuzzy_match_duplicates) {
#line 289
      goto _L___1;
    } else
#line 289
    if ((unsigned long )GlobalState.duplicate_file != (unsigned long )((void *)0)) {
      _L___1: /* CIL Label */ 
#line 292
      entry = *(LogTable + ix);
      {
#line 292
      while (1) {
        while_continue: /* CIL Label */ ;
#line 292
        if (! duplicate) {
#line 292
          if (! ((unsigned long )entry != (unsigned long )((void *)0))) {
#line 292
            goto while_break;
          }
        } else {
#line 292
          goto while_break;
        }
#line 294
        if (entry->final_hash_value == game_details.final_hash_value) {
#line 294
          if (entry->cumulative_hash_value == game_details.cumulative_hash_value) {
#line 297
            duplicate = (Boolean )1;
          } else {
#line 294
            goto _L___0;
          }
        } else
        _L___0: /* CIL Label */ 
#line 299
        if (GlobalState.fuzzy_match_duplicates) {
#line 300
          if (GlobalState.fuzzy_match_depth == 0) {
#line 300
            if (entry->final_hash_value == game_details.final_hash_value) {
#line 303
              duplicate = (Boolean )1;
            } else {
#line 300
              goto _L;
            }
          } else
          _L: /* CIL Label */ 
#line 307
          if (entry->final_hash_value == game_details.fuzzy_duplicate_hash) {
#line 308
            duplicate = (Boolean )1;
          }
        }
#line 312
        if (duplicate) {
          {
#line 316
          original_filename = input_file_name(entry->file_number);
          }
        }
#line 292
        entry = entry->next;
      }
      while_break: /* CIL Label */ ;
      }
#line 320
      if (! duplicate) {
        {
#line 322
        tmp = MallocOrDie(sizeof(*entry));
#line 322
        entry = (HashLog *)tmp;
        }
#line 324
        if (! GlobalState.fuzzy_match_duplicates) {
#line 326
          entry->final_hash_value = game_details.final_hash_value;
#line 327
          entry->cumulative_hash_value = game_details.cumulative_hash_value;
        } else
#line 329
        if (GlobalState.fuzzy_match_depth > 0) {
#line 329
          if (plycount >= GlobalState.fuzzy_match_depth) {
#line 332
            entry->final_hash_value = game_details.fuzzy_duplicate_hash;
#line 333
            entry->cumulative_hash_value = (HashCode )0;
          } else {
#line 337
            entry->final_hash_value = game_details.final_hash_value;
#line 338
            entry->cumulative_hash_value = game_details.cumulative_hash_value;
          }
        } else {
#line 337
          entry->final_hash_value = game_details.final_hash_value;
#line 338
          entry->cumulative_hash_value = game_details.cumulative_hash_value;
        }
        {
#line 340
        entry->file_number = current_file_number();
#line 342
        entry->next = *(LogTable + ix);
#line 343
        *(LogTable + ix) = entry;
        }
      }
    }
  }
#line 347
  return (original_filename);
}
}
#line 43 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static short Knight_moves[16]  = 
#line 43 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
  {      (short)1,      (short)2,      (short)1,      (short)-2, 
        (short)2,      (short)1,      (short)2,      (short)-1, 
        (short)-1,      (short)2,      (short)-1,      (short)-2, 
        (short)-2,      (short)1,      (short)-2,      (short)-1};
#line 56 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static short Bishop_moves[8]  = 
#line 56
  {      (short)1,      (short)1,      (short)1,      (short)-1, 
        (short)-1,      (short)1,      (short)-1,      (short)-1};
#line 65 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static short Rook_moves[8]  = 
#line 65
  {      (short)1,      (short)0,      (short)0,      (short)1, 
        (short)-1,      (short)0,      (short)0,      (short)-1};
#line 74 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static short King_moves[16]  = 
#line 74
  {      (short)1,      (short)0,      (short)1,      (short)1, 
        (short)1,      (short)-1,      (short)0,      (short)1, 
        (short)0,      (short)-1,      (short)-1,      (short)0, 
        (short)-1,      (short)1,      (short)-1,      (short)-1};
#line 87 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static short Queen_moves[16]  = 
#line 87
  {      (short)1,      (short)0,      (short)1,      (short)1, 
        (short)1,      (short)-1,      (short)0,      (short)1, 
        (short)0,      (short)-1,      (short)-1,      (short)0, 
        (short)-1,      (short)1,      (short)-1,      (short)-1};
#line 104 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static HashCode HashTab[8][8][6][2]  ;
#line 116 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static MovePair *move_pool  =    (MovePair *)((void *)0);
#line 118 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static MovePair *malloc_move(void) 
{ 
  MovePair *move ;
  void *tmp ;

  {
#line 122
  if ((unsigned long )move_pool != (unsigned long )((void *)0)) {
#line 123
    move = move_pool;
#line 124
    move_pool = move_pool->next;
  } else {
    {
#line 127
    tmp = MallocOrDie(sizeof(MovePair ));
#line 127
    move = (MovePair *)tmp;
    }
  }
#line 129
  move->next = (struct move_pair *)((void *)0);
#line 130
  return (move);
}
}
#line 134 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static MovePair *append_move_pair(Col from_col , Rank from_rank , Col to_col , Rank to_rank ,
                                  MovePair *moves ) 
{ 
  MovePair *move ;
  MovePair *tmp ;

  {
  {
#line 136
  tmp = malloc_move();
#line 136
  move = tmp;
#line 138
  move->from_rank = from_rank;
#line 139
  move->from_col = from_col;
#line 140
  move->to_rank = to_rank;
#line 141
  move->to_col = to_col;
#line 142
  move->next = moves;
  }
#line 143
  return (move);
}
}
#line 147 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static void free_move_pair(MovePair *move ) 
{ 


  {
#line 150
  move->next = move_pool;
#line 151
  move_pool = move;
#line 152
  return;
}
}
#line 155 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
void free_move_pair_list(MovePair *move_list ) 
{ 


  {
#line 158
  if ((unsigned long )move_list != (unsigned long )((void *)0)) {
    {
#line 159
    free_move_pair_list(move_list->next);
#line 160
    free_move_pair(move_list);
    }
  }
#line 162
  return;
}
}
#line 175 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static HashCode seed  =    (HashCode )0;
#line 169 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
void init_hashtab(void) 
{ 
  Piece piece ;
  Colour colour ;
  Rank rank ;
  Col col ;
  HashCode code ;

  {
#line 177
  col = (Col )'a';
  {
#line 177
  while (1) {
    while_continue: /* CIL Label */ ;
#line 177
    if (! ((int )col <= 104)) {
#line 177
      goto while_break;
    }
#line 178
    rank = (Rank )'1';
    {
#line 178
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 178
      if (! ((int )rank <= 56)) {
#line 178
        goto while_break___0;
      }
#line 179
      piece = (Piece )2;
      {
#line 179
      while (1) {
        while_continue___1: /* CIL Label */ ;
#line 179
        if (! ((unsigned int )piece <= 7U)) {
#line 179
          goto while_break___1;
        }
#line 180
        colour = (Colour )0;
        {
#line 180
        while (1) {
          while_continue___2: /* CIL Label */ ;
#line 180
          if (! ((unsigned int )colour <= 1U)) {
#line 180
            goto while_break___2;
          }
#line 187
          seed = seed * 1103515245UL + 123456789UL;
#line 192
          code = seed >> 7;
#line 193
          HashTab[(int )col - 97][(int )rank - 49][(unsigned int )piece - 2U][(unsigned int )colour] = code;
#line 180
          colour = (Colour )((unsigned int )colour + 1U);
        }
        while_break___2: /* CIL Label */ ;
        }
#line 179
        piece = (Piece )((unsigned int )piece + 1U);
      }
      while_break___1: /* CIL Label */ ;
      }
#line 178
      rank = (Rank )((int )rank + 1);
    }
    while_break___0: /* CIL Label */ ;
    }
#line 177
    col = (Col )((int )col + 1);
  }
  while_break: /* CIL Label */ ;
  }
#line 198
  return;
}
}
#line 201 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
HashCode HashLookup(Col col , Rank rank , Piece piece , Colour colour ) 
{ 


  {
#line 204
  return (HashTab[(int )col - 97][(int )rank - 49][(unsigned int )piece - 2U][(unsigned int )colour]);
}
}
#line 208 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean piece_is_colour(Piece coloured_piece , Colour colour ) 
{ 


  {
#line 211
  return ((Boolean )(((unsigned int )coloured_piece & 1U) == (unsigned int )colour));
}
}
#line 219 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
void make_move(Col from_col , Rank from_rank , Col to_col , Rank to_rank , Piece piece ,
               Colour colour , Board *board ) 
{ 
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  short from_r ;
  int tmp___1 ;
  short from_c ;
  int tmp___2 ;
  Boolean capture ;
  Boolean tmp___3 ;
  Boolean tmp___4 ;
  int tmp___5 ;
  int tmp___6 ;
  HashCode tmp___7 ;
  int tmp___8 ;
  int tmp___9 ;
  HashCode tmp___10 ;
  HashCode tmp___11 ;
  Piece coloured_piece ;
  Piece removed_piece ;
  Colour removed_colour ;
  HashCode tmp___12 ;
  HashCode tmp___13 ;

  {
#line 222
  if (49 <= (int )to_rank) {
#line 222
    if ((int )to_rank <= 56) {
#line 222
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 222
      tmp = 0;
    }
  } else {
#line 222
    tmp = 0;
  }
#line 222
  to_r = (short )tmp;
#line 223
  if (97 <= (int )to_col) {
#line 223
    if ((int )to_col <= 104) {
#line 223
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 223
      tmp___0 = 0;
    }
  } else {
#line 223
    tmp___0 = 0;
  }
#line 223
  to_c = (short )tmp___0;
#line 224
  if (49 <= (int )from_rank) {
#line 224
    if ((int )from_rank <= 56) {
#line 224
      tmp___1 = ((int )from_rank - 49) + 2;
    } else {
#line 224
      tmp___1 = 0;
    }
  } else {
#line 224
    tmp___1 = 0;
  }
#line 224
  from_r = (short )tmp___1;
#line 225
  if (97 <= (int )from_col) {
#line 225
    if ((int )from_col <= 104) {
#line 225
      tmp___2 = ((int )from_col - 97) + 2;
    } else {
#line 225
      tmp___2 = 0;
    }
  } else {
#line 225
    tmp___2 = 0;
  }
#line 225
  from_c = (short )tmp___2;
#line 227
  capture = (Boolean )0;
#line 230
  if ((unsigned int )piece == 7U) {
#line 231
    if ((unsigned int )colour == 1U) {
#line 232
      board->WKingCol = to_col;
#line 233
      board->WKingRank = to_rank;
#line 234
      tmp___3 = (Boolean )0;
#line 234
      board->WQueenCastle = tmp___3;
#line 234
      board->WKingCastle = tmp___3;
    } else {
#line 238
      board->BKingCol = to_col;
#line 239
      board->BKingRank = to_rank;
#line 240
      tmp___4 = (Boolean )0;
#line 240
      board->BQueenCastle = tmp___4;
#line 240
      board->BKingCastle = tmp___4;
    }
  } else
#line 244
  if ((unsigned int )piece == 5U) {
#line 246
    if ((unsigned int )colour == 1U) {
#line 247
      if ((int )from_rank == 49) {
#line 248
        if ((int )from_col == 97) {
#line 249
          board->WQueenCastle = (Boolean )0;
        } else
#line 251
        if ((int )from_col == 104) {
#line 252
          board->WKingCastle = (Boolean )0;
        }
      }
    } else
#line 260
    if ((int )from_rank == 56) {
#line 261
      if ((int )from_col == 97) {
#line 262
        board->BQueenCastle = (Boolean )0;
      } else
#line 264
      if ((int )from_col == 104) {
#line 265
        board->BKingCastle = (Boolean )0;
      }
    }
  }
#line 279
  if ((unsigned int )piece != 2U) {
#line 281
    board->EnPassant = (Boolean )0;
  } else
#line 284
  if ((unsigned int )colour == 1U) {
#line 285
    if ((int )from_rank == 50) {
#line 285
      if ((int )to_rank == 52) {
#line 287
        board->EnPassant = (Boolean )1;
#line 288
        board->ep_rank = (Rank )((int )to_rank - 1);
#line 289
        board->ep_col = to_col;
      } else {
#line 285
        goto _L;
      }
    } else
    _L: /* CIL Label */ 
#line 291
    if (board->EnPassant) {
#line 291
      if ((int )board->ep_rank == (int )to_rank) {
#line 291
        if ((int )board->ep_col == (int )to_col) {
#line 294
          if (49 <= (int )to_rank) {
#line 294
            if ((int )to_rank <= 56) {
#line 294
              tmp___5 = ((int )to_rank - 49) + 2;
            } else {
#line 294
              tmp___5 = 0;
            }
          } else {
#line 294
            tmp___5 = 0;
          }
#line 294
          if (97 <= (int )to_col) {
#line 294
            if ((int )to_col <= 104) {
#line 294
              tmp___6 = ((int )to_col - 97) + 2;
            } else {
#line 294
              tmp___6 = 0;
            }
          } else {
#line 294
            tmp___6 = 0;
          }
          {
#line 294
          board->board[tmp___5 - 1][tmp___6] = (Piece )1;
#line 295
          tmp___7 = HashLookup(to_col, (Rank )((int )to_rank - 1), (Piece )2, (Colour )0);
#line 295
          board->hash_value ^= tmp___7;
#line 296
          board->EnPassant = (Boolean )0;
          }
        } else {
#line 299
          board->EnPassant = (Boolean )0;
        }
      } else {
#line 299
        board->EnPassant = (Boolean )0;
      }
    } else {
#line 299
      board->EnPassant = (Boolean )0;
    }
  } else
#line 303
  if ((int )from_rank == 55) {
#line 303
    if ((int )to_rank == 53) {
#line 304
      board->EnPassant = (Boolean )1;
#line 305
      board->ep_rank = (Rank )((int )to_rank + 1);
#line 306
      board->ep_col = to_col;
    } else {
#line 303
      goto _L___0;
    }
  } else
  _L___0: /* CIL Label */ 
#line 308
  if (board->EnPassant) {
#line 308
    if ((int )board->ep_rank == (int )to_rank) {
#line 308
      if ((int )board->ep_col == (int )to_col) {
#line 311
        if (49 <= (int )to_rank) {
#line 311
          if ((int )to_rank <= 56) {
#line 311
            tmp___8 = ((int )to_rank - 49) + 2;
          } else {
#line 311
            tmp___8 = 0;
          }
        } else {
#line 311
          tmp___8 = 0;
        }
#line 311
        if (97 <= (int )to_col) {
#line 311
          if ((int )to_col <= 104) {
#line 311
            tmp___9 = ((int )to_col - 97) + 2;
          } else {
#line 311
            tmp___9 = 0;
          }
        } else {
#line 311
          tmp___9 = 0;
        }
        {
#line 311
        board->board[tmp___8 + 1][tmp___9] = (Piece )1;
#line 312
        tmp___10 = HashLookup(to_col, (Rank )((int )to_rank + 1), (Piece )2, (Colour )1);
#line 312
        board->hash_value ^= tmp___10;
#line 313
        board->EnPassant = (Boolean )0;
        }
      } else {
#line 316
        board->EnPassant = (Boolean )0;
      }
    } else {
#line 316
      board->EnPassant = (Boolean )0;
    }
  } else {
#line 316
    board->EnPassant = (Boolean )0;
  }
  {
#line 321
  board->board[from_r][from_c] = (Piece )1;
#line 322
  tmp___11 = HashLookup(from_col, from_rank, piece, colour);
#line 322
  board->hash_value ^= tmp___11;
  }
#line 323
  if ((unsigned int )board->board[to_r][to_c] != 1U) {
    {
#line 326
    coloured_piece = board->board[to_r][to_c];
#line 330
    removed_piece = (Piece )((unsigned int )coloured_piece >> 3);
#line 331
    removed_colour = (Colour )((unsigned int )coloured_piece & 1U);
#line 332
    tmp___12 = HashLookup(to_col, to_rank, removed_piece, removed_colour);
#line 332
    board->hash_value ^= tmp___12;
    }
#line 336
    if ((unsigned int )removed_piece == 5U) {
#line 337
      if ((unsigned int )removed_colour == 1U) {
#line 338
        if ((int )to_rank == 49) {
#line 339
          if ((int )to_col == 97) {
#line 340
            board->WQueenCastle = (Boolean )0;
          } else
#line 342
          if ((int )to_col == 104) {
#line 343
            board->WKingCastle = (Boolean )0;
          }
        }
      } else
#line 351
      if ((int )to_rank == 56) {
#line 352
        if ((int )to_col == 97) {
#line 353
          board->BQueenCastle = (Boolean )0;
        } else
#line 355
        if ((int )to_col == 104) {
#line 356
          board->BKingCastle = (Boolean )0;
        }
      }
    }
#line 364
    capture = (Boolean )1;
  }
#line 367
  if (capture) {
#line 368
    board->halfmove_clock = 0U;
  } else
#line 367
  if ((unsigned int )piece == 2U) {
#line 368
    board->halfmove_clock = 0U;
  } else {
#line 371
    (board->halfmove_clock) ++;
  }
  {
#line 374
  board->board[to_r][to_c] = (Piece )(((unsigned int )piece << 3) | (unsigned int )colour);
#line 376
  tmp___13 = HashLookup(to_col, to_rank, piece, colour);
#line 376
  board->hash_value ^= tmp___13;
  }
#line 377
  return;
}
}
#line 384 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
MovePair *find_pawn_moves(Col from_col , Rank from_rank , Col to_col , Rank to_rank ,
                          Colour colour , Board const   *board ) 
{ 
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  short from_r ;
  int tmp___1 ;
  short from_c ;
  int tmp___2 ;
  MovePair *move_list ;
  MovePair *move ;
  short offset ;
  int tmp___3 ;
  Piece piece_to_move ;
  int tmp___4 ;
  Boolean tmp___5 ;
  Piece occupant ;
  Boolean tmp___6 ;
  short start_rank ;
  short end_rank ;
  Piece occupant___0 ;
  Boolean tmp___7 ;

  {
#line 387
  if (49 <= (int )to_rank) {
#line 387
    if ((int )to_rank <= 56) {
#line 387
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 387
      tmp = 0;
    }
  } else {
#line 387
    tmp = 0;
  }
#line 387
  to_r = (short )tmp;
#line 388
  if (97 <= (int )to_col) {
#line 388
    if ((int )to_col <= 104) {
#line 388
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 388
      tmp___0 = 0;
    }
  } else {
#line 388
    tmp___0 = 0;
  }
#line 388
  to_c = (short )tmp___0;
#line 389
  if (49 <= (int )from_rank) {
#line 389
    if ((int )from_rank <= 56) {
#line 389
      tmp___1 = ((int )from_rank - 49) + 2;
    } else {
#line 389
      tmp___1 = 0;
    }
  } else {
#line 389
    tmp___1 = 0;
  }
#line 389
  from_r = (short )tmp___1;
#line 390
  if (97 <= (int )from_col) {
#line 390
    if ((int )from_col <= 104) {
#line 390
      tmp___2 = ((int )from_col - 97) + 2;
    } else {
#line 390
      tmp___2 = 0;
    }
  } else {
#line 390
    tmp___2 = 0;
  }
#line 390
  from_c = (short )tmp___2;
#line 391
  move_list = (MovePair *)((void *)0);
#line 392
  move = (MovePair *)((void *)0);
#line 394
  if ((unsigned int )colour == 1U) {
#line 394
    tmp___3 = 1;
  } else {
#line 394
    tmp___3 = -1;
  }
#line 394
  offset = (short )tmp___3;
#line 395
  piece_to_move = (Piece )((unsigned int )(2 << 3) | (unsigned int )colour);
#line 397
  if ((int )to_col != 0) {
#line 397
    if ((int )to_rank != 0) {
#line 399
      if ((unsigned int )board->board[to_r][to_c] == 1U) {
#line 401
        if ((unsigned int )board->board[(int )to_r - (int )offset][to_c] == (unsigned int )piece_to_move) {
          {
#line 403
          move = append_move_pair((Col )(((int )to_c + 97) - 2), (Rank )((((int )to_r - (int )offset) + 49) - 2),
                                  to_col, to_rank, (MovePair *)((void *)0));
          }
        } else
#line 406
        if ((unsigned int )board->board[(int )to_r - (int )offset][to_c] == 1U) {
#line 406
          if ((unsigned int )colour == 1U) {
#line 406
            tmp___4 = '4';
          } else {
#line 406
            tmp___4 = '5';
          }
#line 406
          if ((int )to_rank == tmp___4) {
#line 409
            if ((unsigned int )board->board[(int )to_r - 2 * (int )offset][to_c] == (unsigned int )piece_to_move) {
              {
#line 410
              move = append_move_pair((Col )(((int )to_c + 97) - 2), (Rank )((((int )to_r - 2 * (int )offset) + 49) - 2),
                                      to_col, to_rank, (MovePair *)((void *)0));
              }
            }
          } else {
#line 406
            goto _L;
          }
        } else
        _L: /* CIL Label */ 
#line 414
        if (board->EnPassant) {
#line 414
          if ((int const   )board->ep_rank == (int const   )to_rank) {
#line 414
            if ((int const   )board->ep_col == (int const   )to_col) {
#line 418
              if ((int )from_col != 0) {
#line 419
                from_r = (short )((int )to_r - (int )offset);
#line 420
                if ((unsigned int )board->board[from_r][from_c] == (unsigned int )piece_to_move) {
                  {
#line 421
                  move = append_move_pair((Col )(((int )from_c + 97) - 2), (Rank )(((int )from_r + 49) - 2),
                                          to_col, (Rank )(((int )to_r + 49) - 2),
                                          (MovePair *)((void *)0));
                  }
                }
              }
            }
          }
        }
      } else {
        {
#line 427
        tmp___5 = piece_is_colour(board->board[to_r][to_c], (Colour )(! colour));
        }
#line 427
        if (tmp___5) {
#line 429
          if ((int )from_col != 0) {
#line 431
            from_r = (short )((int )to_r - (int )offset);
#line 432
            if ((unsigned int )board->board[from_r][from_c] == (unsigned int )piece_to_move) {
              {
#line 433
              move = append_move_pair((Col )(((int )from_c + 97) - 2), (Rank )(((int )from_r + 49) - 2),
                                      to_col, to_rank, (MovePair *)((void *)0));
              }
            }
          }
        } else {
#line 440
          move = (MovePair *)((void *)0);
        }
      }
#line 442
      move_list = move;
    } else {
#line 397
      goto _L___3;
    }
  } else
  _L___3: /* CIL Label */ 
#line 444
  if ((int )from_col != 0) {
#line 444
    if ((int )to_col != 0) {
#line 446
      if ((int )from_col + 1 != (int )to_col) {
#line 446
        if (! ((int )from_col - 1 != (int )to_col)) {
#line 446
          goto _L___2;
        }
      } else
      _L___2: /* CIL Label */ 
#line 450
      if ((int )from_rank != 0) {
#line 454
        to_r = (short )((int )from_r - (int )offset);
#line 455
        if ((unsigned int )board->board[from_r][from_c] == (unsigned int )piece_to_move) {
#line 456
          occupant = board->board[to_r][to_c];
#line 458
          if ((unsigned int )occupant != 1U) {
            {
#line 458
            tmp___6 = piece_is_colour(occupant, (Colour )(! colour));
            }
#line 458
            if (tmp___6) {
              {
#line 460
              move = append_move_pair((Col )(((int )from_c + 97) - 2), (Rank )(((int )from_r + 49) - 2),
                                      to_col, (Rank )(((int )to_r + 49) - 2), (MovePair *)((void *)0));
              }
            } else {
#line 458
              goto _L___0;
            }
          } else
          _L___0: /* CIL Label */ 
#line 463
          if (board->EnPassant) {
#line 463
            if ((int const   )board->ep_rank == (int const   )(((int )to_r + 49) - 2)) {
#line 463
              if ((int const   )board->ep_col == (int const   )(((int )to_c + 97) - 2)) {
                {
#line 465
                move = append_move_pair((Col )(((int )from_c + 97) - 2), (Rank )(((int )from_r + 49) - 2),
                                        to_col, (Rank )(((int )to_r + 49) - 2), (MovePair *)((void *)0));
                }
              }
            }
          }
        }
      } else {
#line 477
        if ((unsigned int )colour == 1U) {
#line 478
          start_rank = (short)3;
#line 479
          end_rank = (short)9;
        } else {
#line 482
          start_rank = (short)8;
#line 483
          end_rank = (short)2;
        }
#line 485
        from_r = start_rank;
        {
#line 485
        while (1) {
          while_continue: /* CIL Label */ ;
#line 485
          if (! ((int )from_r != (int )end_rank)) {
#line 485
            goto while_break;
          }
#line 486
          to_r = (short )((int )from_r + (int )offset);
#line 487
          if ((unsigned int )board->board[from_r][from_c] == (unsigned int )piece_to_move) {
#line 488
            occupant___0 = board->board[to_r][to_c];
#line 490
            if ((unsigned int )occupant___0 != 1U) {
              {
#line 490
              tmp___7 = piece_is_colour(occupant___0, (Colour )(! colour));
              }
#line 490
              if (tmp___7) {
                {
#line 492
                move_list = append_move_pair((Col )(((int )from_c + 97) - 2), (Rank )(((int )from_r + 49) - 2),
                                             to_col, (Rank )(((int )to_r + 49) - 2),
                                             move_list);
                }
              } else {
#line 490
                goto _L___1;
              }
            } else
            _L___1: /* CIL Label */ 
#line 495
            if (board->EnPassant) {
#line 495
              if ((int const   )board->ep_rank == (int const   )(((int )to_r + 49) - 2)) {
#line 495
                if ((int const   )board->ep_col == (int const   )(((int )to_c + 97) - 2)) {
                  {
#line 497
                  move_list = append_move_pair((Col )(((int )from_c + 97) - 2), (Rank )(((int )from_r + 49) - 2),
                                               to_col, (Rank )(((int )to_r + 49) - 2),
                                               move_list);
                  }
                }
              }
            }
          }
#line 485
          from_r = (short )((int )from_r + (int )offset);
        }
        while_break: /* CIL Label */ ;
        }
      }
    }
  }
#line 505
  return (move_list);
}
}
#line 509 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
MovePair *find_knight_moves(Col to_col , Rank to_rank , Colour colour , Board const   *board ) 
{ 
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  unsigned int ix ;
  MovePair *move_list ;
  Piece target_piece ;
  short r ;
  short c ;

  {
#line 511
  if (49 <= (int )to_rank) {
#line 511
    if ((int )to_rank <= 56) {
#line 511
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 511
      tmp = 0;
    }
  } else {
#line 511
    tmp = 0;
  }
#line 511
  to_r = (short )tmp;
#line 512
  if (97 <= (int )to_col) {
#line 512
    if ((int )to_col <= 104) {
#line 512
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 512
      tmp___0 = 0;
    }
  } else {
#line 512
    tmp___0 = 0;
  }
#line 512
  to_c = (short )tmp___0;
#line 514
  move_list = (MovePair *)((void *)0);
#line 515
  target_piece = (Piece )((unsigned int )(3 << 3) | (unsigned int )colour);
#line 520
  ix = 0U;
  {
#line 520
  while (1) {
    while_continue: /* CIL Label */ ;
#line 520
    if (! (ix < 16U)) {
#line 520
      goto while_break;
    }
#line 521
    r = (short )((int )Knight_moves[ix] + (int )to_r);
#line 522
    c = (short )((int )Knight_moves[ix + 1U] + (int )to_c);
#line 524
    if ((unsigned int )board->board[r][c] == (unsigned int )target_piece) {
      {
#line 525
      move_list = append_move_pair((Col )(((int )c + 97) - 2), (Rank )(((int )r + 49) - 2),
                                   to_col, to_rank, move_list);
      }
    }
#line 520
    ix += 2U;
  }
  while_break: /* CIL Label */ ;
  }
#line 528
  return (move_list);
}
}
#line 532 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
MovePair *find_bishop_moves(Col to_col , Rank to_rank , Colour colour , Board const   *board ) 
{ 
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  unsigned int ix ;
  MovePair *move_list ;
  Piece target_piece ;
  short r ;
  short c ;

  {
#line 534
  if (49 <= (int )to_rank) {
#line 534
    if ((int )to_rank <= 56) {
#line 534
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 534
      tmp = 0;
    }
  } else {
#line 534
    tmp = 0;
  }
#line 534
  to_r = (short )tmp;
#line 535
  if (97 <= (int )to_col) {
#line 535
    if ((int )to_col <= 104) {
#line 535
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 535
      tmp___0 = 0;
    }
  } else {
#line 535
    tmp___0 = 0;
  }
#line 535
  to_c = (short )tmp___0;
#line 537
  move_list = (MovePair *)((void *)0);
#line 538
  target_piece = (Piece )((unsigned int )(4 << 3) | (unsigned int )colour);
#line 543
  ix = 0U;
  {
#line 543
  while (1) {
    while_continue: /* CIL Label */ ;
#line 543
    if (! (ix < 8U)) {
#line 543
      goto while_break;
    }
#line 544
    r = to_r;
#line 544
    c = to_c;
    {
#line 549
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 550
      r = (short )((int )r + (int )Bishop_moves[ix]);
#line 551
      c = (short )((int )c + (int )Bishop_moves[ix + 1U]);
#line 549
      if (! ((unsigned int )board->board[r][c] == 1U)) {
#line 549
        goto while_break___0;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 554
    if ((unsigned int )board->board[r][c] == (unsigned int )target_piece) {
      {
#line 555
      move_list = append_move_pair((Col )(((int )c + 97) - 2), (Rank )(((int )r + 49) - 2),
                                   to_col, to_rank, move_list);
      }
    }
#line 543
    ix += 2U;
  }
  while_break: /* CIL Label */ ;
  }
#line 558
  return (move_list);
}
}
#line 562 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
MovePair *find_rook_moves(Col to_col , Rank to_rank , Colour colour , Board const   *board ) 
{ 
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  unsigned int ix ;
  MovePair *move_list ;
  Piece target_piece ;
  short r ;
  short c ;

  {
#line 564
  if (49 <= (int )to_rank) {
#line 564
    if ((int )to_rank <= 56) {
#line 564
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 564
      tmp = 0;
    }
  } else {
#line 564
    tmp = 0;
  }
#line 564
  to_r = (short )tmp;
#line 565
  if (97 <= (int )to_col) {
#line 565
    if ((int )to_col <= 104) {
#line 565
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 565
      tmp___0 = 0;
    }
  } else {
#line 565
    tmp___0 = 0;
  }
#line 565
  to_c = (short )tmp___0;
#line 567
  move_list = (MovePair *)((void *)0);
#line 568
  target_piece = (Piece )((unsigned int )(5 << 3) | (unsigned int )colour);
#line 573
  ix = 0U;
  {
#line 573
  while (1) {
    while_continue: /* CIL Label */ ;
#line 573
    if (! (ix < 8U)) {
#line 573
      goto while_break;
    }
#line 574
    r = to_r;
#line 574
    c = to_c;
    {
#line 579
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 580
      r = (short )((int )r + (int )Rook_moves[ix]);
#line 581
      c = (short )((int )c + (int )Rook_moves[ix + 1U]);
#line 579
      if (! ((unsigned int )board->board[r][c] == 1U)) {
#line 579
        goto while_break___0;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 584
    if ((unsigned int )board->board[r][c] == (unsigned int )target_piece) {
      {
#line 585
      move_list = append_move_pair((Col )(((int )c + 97) - 2), (Rank )(((int )r + 49) - 2),
                                   to_col, to_rank, move_list);
      }
    }
#line 573
    ix += 2U;
  }
  while_break: /* CIL Label */ ;
  }
#line 588
  return (move_list);
}
}
#line 592 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
MovePair *find_queen_moves(Col to_col , Rank to_rank , Colour colour , Board const   *board ) 
{ 
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  unsigned int ix ;
  MovePair *move_list ;
  Piece target_piece ;
  short r ;
  short c ;

  {
#line 594
  if (49 <= (int )to_rank) {
#line 594
    if ((int )to_rank <= 56) {
#line 594
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 594
      tmp = 0;
    }
  } else {
#line 594
    tmp = 0;
  }
#line 594
  to_r = (short )tmp;
#line 595
  if (97 <= (int )to_col) {
#line 595
    if ((int )to_col <= 104) {
#line 595
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 595
      tmp___0 = 0;
    }
  } else {
#line 595
    tmp___0 = 0;
  }
#line 595
  to_c = (short )tmp___0;
#line 597
  move_list = (MovePair *)((void *)0);
#line 598
  target_piece = (Piece )((unsigned int )(6 << 3) | (unsigned int )colour);
#line 603
  ix = 0U;
  {
#line 603
  while (1) {
    while_continue: /* CIL Label */ ;
#line 603
    if (! (ix < 16U)) {
#line 603
      goto while_break;
    }
#line 604
    r = to_r;
#line 604
    c = to_c;
    {
#line 609
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 610
      r = (short )((int )r + (int )Queen_moves[ix]);
#line 611
      c = (short )((int )c + (int )Queen_moves[ix + 1U]);
#line 609
      if (! ((unsigned int )board->board[r][c] == 1U)) {
#line 609
        goto while_break___0;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 614
    if ((unsigned int )board->board[r][c] == (unsigned int )target_piece) {
      {
#line 615
      move_list = append_move_pair((Col )(((int )c + 97) - 2), (Rank )(((int )r + 49) - 2),
                                   to_col, to_rank, move_list);
      }
    }
#line 603
    ix += 2U;
  }
  while_break: /* CIL Label */ ;
  }
#line 618
  return (move_list);
}
}
#line 622 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
MovePair *find_king_moves(Col to_col , Rank to_rank , Colour colour , Board const   *board ) 
{ 
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  unsigned int ix ;
  MovePair *move_list ;
  Piece target_piece ;
  short r ;
  short c ;

  {
#line 624
  if (49 <= (int )to_rank) {
#line 624
    if ((int )to_rank <= 56) {
#line 624
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 624
      tmp = 0;
    }
  } else {
#line 624
    tmp = 0;
  }
#line 624
  to_r = (short )tmp;
#line 625
  if (97 <= (int )to_col) {
#line 625
    if ((int )to_col <= 104) {
#line 625
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 625
      tmp___0 = 0;
    }
  } else {
#line 625
    tmp___0 = 0;
  }
#line 625
  to_c = (short )tmp___0;
#line 627
  move_list = (MovePair *)((void *)0);
#line 628
  target_piece = (Piece )((unsigned int )(7 << 3) | (unsigned int )colour);
#line 633
  ix = 0U;
  {
#line 633
  while (1) {
    while_continue: /* CIL Label */ ;
#line 633
    if (! (ix < 16U)) {
#line 633
      goto while_break;
    }
#line 634
    r = (short )((int )King_moves[ix] + (int )to_r);
#line 635
    c = (short )((int )King_moves[ix + 1U] + (int )to_c);
#line 637
    if ((unsigned int )board->board[r][c] == (unsigned int )target_piece) {
      {
#line 638
      move_list = append_move_pair((Col )(((int )c + 97) - 2), (Rank )(((int )r + 49) - 2),
                                   to_col, to_rank, move_list);
      }
    }
#line 633
    ix += 2U;
  }
  while_break: /* CIL Label */ ;
  }
#line 641
  return (move_list);
}
}
#line 647 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
CheckStatus king_is_in_check(Board const   *board , Colour king_colour ) 
{ 
  MovePair *replies ;
  CheckStatus in_check ;
  Col king_col ;
  Rank king_rank ;
  Colour opponent_colour ;
  int tmp ;

  {
#line 649
  replies = (MovePair *)((void *)0);
#line 651
  in_check = (CheckStatus )0;
#line 654
  opponent_colour = (Colour )(! king_colour);
#line 657
  if ((unsigned int )king_colour == 1U) {
#line 658
    king_col = (Col )board->WKingCol;
#line 659
    king_rank = (Rank )board->WKingRank;
  } else {
#line 662
    king_col = (Col )board->BKingCol;
#line 663
    king_rank = (Rank )board->BKingRank;
  }
#line 669
  if ((int )king_col != 104) {
    {
#line 669
    replies = find_pawn_moves((Col )((int )king_col + 1), (Rank )0, king_col, king_rank,
                              opponent_colour, board);
    }
#line 669
    if (! ((unsigned long )replies != (unsigned long )((void *)0))) {
#line 669
      goto _L;
    }
  } else
  _L: /* CIL Label */ 
#line 674
  if ((int )king_col != 97) {
    {
#line 674
    replies = find_pawn_moves((Col )((int )king_col - 1), (Rank )0, king_col, king_rank,
                              opponent_colour, board);
    }
#line 674
    if ((unsigned long )replies != (unsigned long )((void *)0)) {
#line 674
      tmp = 1;
    } else {
#line 674
      tmp = 0;
    }
  } else {
#line 674
    tmp = 0;
  }
#line 680
  if (! ((unsigned long )replies != (unsigned long )((void *)0))) {
    {
#line 683
    replies = find_knight_moves(king_col, king_rank, opponent_colour, board);
    }
#line 683
    if (! ((unsigned long )replies != (unsigned long )((void *)0))) {
      {
#line 688
      replies = find_bishop_moves(king_col, king_rank, opponent_colour, board);
      }
#line 688
      if (! ((unsigned long )replies != (unsigned long )((void *)0))) {
        {
#line 693
        replies = find_rook_moves(king_col, king_rank, opponent_colour, board);
        }
#line 693
        if (! ((unsigned long )replies != (unsigned long )((void *)0))) {
          {
#line 698
          replies = find_queen_moves(king_col, king_rank, opponent_colour, board);
          }
#line 698
          if (! ((unsigned long )replies != (unsigned long )((void *)0))) {
            {
#line 703
            replies = find_king_moves(king_col, king_rank, opponent_colour, board);
            }
          }
        }
      }
    }
  }
#line 711
  if ((unsigned long )replies != (unsigned long )((void *)0)) {
    {
#line 712
    in_check = (CheckStatus )1;
#line 713
    free_move_pair_list(replies);
    }
  }
#line 715
  return (in_check);
}
}
#line 727 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
MovePair *exclude_checks(Piece piece , Colour colour , MovePair *possibles , Board const   *board ) 
{ 
  Board copy_board ;
  MovePair *valid_move_list ;
  MovePair *move ;
  MovePair *illegal_move ;
  MovePair *legal_move ;
  CheckStatus tmp ;

  {
#line 734
  valid_move_list = (MovePair *)((void *)0);
#line 740
  move = possibles;
  {
#line 740
  while (1) {
    while_continue: /* CIL Label */ ;
#line 740
    if (! ((unsigned long )move != (unsigned long )((void *)0))) {
#line 740
      goto while_break;
    }
    {
#line 742
    copy_board = (Board )*board;
#line 743
    make_move(move->from_col, move->from_rank, move->to_col, move->to_rank, piece,
              colour, & copy_board);
#line 745
    tmp = king_is_in_check((Board const   *)(& copy_board), colour);
    }
#line 745
    if ((unsigned int )tmp != 0U) {
      {
#line 746
      illegal_move = move;
#line 748
      move = move->next;
#line 750
      free_move_pair(illegal_move);
      }
    } else {
#line 754
      legal_move = move;
#line 756
      move = move->next;
#line 757
      legal_move->next = valid_move_list;
#line 758
      valid_move_list = legal_move;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 761
  return (valid_move_list);
}
}
#line 767 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean exclude_castling_across_checks(MoveClass class , Colour colour , Board const   *board ) 
{ 
  Boolean Ok ;
  MovePair *move ;
  MovePair *tmp ;
  Rank rank ;
  int tmp___0 ;
  Col to_col ;

  {
  {
#line 769
  Ok = (Boolean )1;
#line 770
  tmp = malloc_move();
#line 770
  move = tmp;
  }
#line 771
  if ((unsigned int )colour == 1U) {
#line 771
    tmp___0 = '1';
  } else {
#line 771
    tmp___0 = 56;
  }
#line 771
  rank = (Rank )tmp___0;
#line 774
  if ((unsigned int )class == 4U) {
#line 776
    to_col = (Col )'e';
    {
#line 776
    while (1) {
      while_continue: /* CIL Label */ ;
#line 776
      if ((int )to_col <= 103) {
#line 776
        if (! Ok) {
#line 776
          goto while_break;
        }
      } else {
#line 776
        goto while_break;
      }
      {
#line 777
      move->from_col = (Col )'e';
#line 778
      move->from_rank = rank;
#line 779
      move->to_col = to_col;
#line 780
      move->to_rank = rank;
#line 781
      move = exclude_checks((Piece )7, colour, move, board);
      }
#line 782
      if ((unsigned long )move == (unsigned long )((void *)0)) {
#line 783
        Ok = (Boolean )0;
      }
#line 776
      to_col = (Col )((int )to_col + 1);
    }
    while_break: /* CIL Label */ ;
    }
  } else {
#line 789
    to_col = (Col )'e';
    {
#line 789
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 789
      if ((int )to_col <= 99) {
#line 789
        if (! Ok) {
#line 789
          goto while_break___0;
        }
      } else {
#line 789
        goto while_break___0;
      }
      {
#line 790
      move->from_col = (Col )'e';
#line 791
      move->from_rank = rank;
#line 792
      move->to_col = to_col;
#line 793
      move->to_rank = rank;
#line 794
      move = exclude_checks((Piece )7, colour, move, board);
      }
#line 795
      if ((unsigned long )move == (unsigned long )((void *)0)) {
#line 796
        Ok = (Boolean )0;
      }
#line 789
      to_col = (Col )((int )to_col - 1);
    }
    while_break___0: /* CIL Label */ ;
    }
  }
#line 800
  if ((unsigned long )move != (unsigned long )((void *)0)) {
    {
#line 801
    free_move_pair(move);
    }
  }
#line 803
  return (Ok);
}
}
#line 810 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static MovePair *exclude_moves(Piece piece , Colour colour , Col from_col , Rank from_rank ,
                               MovePair *possibles , Board const   *board ) 
{ 
  MovePair *move_list ;
  MovePair *move ;
  MovePair *temp ;
  Boolean excluded ;

  {
#line 813
  move_list = (MovePair *)((void *)0);
#line 816
  if ((int )from_col != 0) {
#line 816
    goto _L;
  } else
#line 816
  if ((int )from_rank != 0) {
    _L: /* CIL Label */ 
#line 819
    move = possibles;
    {
#line 819
    while (1) {
      while_continue: /* CIL Label */ ;
#line 819
      if (! ((unsigned long )move != (unsigned long )((void *)0))) {
#line 819
        goto while_break;
      }
#line 820
      excluded = (Boolean )0;
#line 822
      if ((int )from_col != 0) {
#line 824
        if ((int )move->from_col != (int )from_col) {
#line 825
          excluded = (Boolean )1;
        }
      }
#line 828
      if ((int )from_rank != 0) {
#line 828
        if (! excluded) {
#line 829
          if ((int )move->from_rank != (int )from_rank) {
#line 830
            excluded = (Boolean )1;
          }
        }
      }
#line 833
      temp = move;
#line 834
      move = move->next;
#line 835
      if (! excluded) {
#line 837
        temp->next = move_list;
#line 838
        move_list = temp;
      } else {
        {
#line 842
        free_move_pair(temp);
        }
      }
    }
    while_break: /* CIL Label */ ;
    }
  } else {
#line 848
    move_list = possibles;
  }
#line 850
  if ((unsigned long )move_list != (unsigned long )((void *)0)) {
    {
#line 851
    move_list = exclude_checks(piece, colour, move_list, board);
    }
  }
#line 853
  return (move_list);
}
}
#line 861 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean pawn_move(Move *move_details , Colour colour , Board *board ) 
{ 
  Col from_col ;
  Rank from_rank ;
  Col to_col ;
  Rank to_rank ;
  MovePair *move_list ;
  Boolean Ok ;

  {
#line 863
  from_col = move_details->from_col;
#line 864
  from_rank = move_details->from_rank;
#line 865
  to_col = move_details->to_col;
#line 866
  to_rank = move_details->to_rank;
#line 869
  Ok = (Boolean )1;
#line 872
  if ((int )from_col != 0) {
#line 872
    if ((int )to_col != 0) {
#line 872
      if ((int )from_col != (int )to_col) {
#line 872
        if ((int )from_col != (int )to_col + 1) {
#line 872
          if ((int )from_col != (int )to_col - 1) {
#line 878
            Ok = (Boolean )0;
          } else {
#line 872
            goto _L___2;
          }
        } else {
#line 872
          goto _L___2;
        }
      } else {
#line 872
        goto _L___2;
      }
    } else {
#line 872
      goto _L___2;
    }
  } else {
    _L___2: /* CIL Label */ 
    {
#line 880
    move_list = find_pawn_moves(from_col, from_rank, to_col, to_rank, colour, (Board const   *)board);
    }
#line 880
    if ((unsigned long )move_list == (unsigned long )((void *)0)) {
#line 882
      Ok = (Boolean )0;
    } else {
      {
#line 888
      move_list = exclude_moves((Piece )2, colour, from_col, from_rank, move_list,
                                (Board const   *)board);
      }
#line 889
      if ((unsigned long )move_list != (unsigned long )((void *)0)) {
#line 890
        if ((unsigned long )move_list->next == (unsigned long )((void *)0)) {
#line 895
          move_details->from_col = move_list->from_col;
#line 896
          move_details->from_rank = move_list->from_rank;
#line 897
          move_details->to_col = move_list->to_col;
#line 898
          move_details->to_rank = move_list->to_rank;
        } else {
#line 902
          Ok = (Boolean )0;
        }
        {
#line 904
        free_move_pair_list(move_list);
        }
      } else {
#line 908
        Ok = (Boolean )0;
      }
    }
  }
#line 911
  return (Ok);
}
}
#line 915 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean promote(Move *move_details , Colour colour , Board *board ) 
{ 
  Col from_col ;
  Rank from_rank ;
  Col to_col ;
  Rank to_rank ;
  MovePair *move_list ;
  Boolean Ok ;

  {
#line 917
  from_col = move_details->from_col;
#line 918
  from_rank = move_details->from_rank;
#line 919
  to_col = move_details->to_col;
#line 920
  to_rank = move_details->to_rank;
#line 922
  Ok = (Boolean )0;
#line 924
  if ((int )to_rank == 0) {
#line 926
    if ((unsigned int )colour == 1U) {
#line 927
      to_rank = (Rank )56;
    } else {
#line 930
      to_rank = (Rank )'1';
    }
  }
#line 934
  if ((unsigned int )colour == 1U) {
#line 934
    if ((int )to_rank != 56) {
      {
#line 936
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Illegal pawn promotion to %c%c\n",
              (int )to_col, (int )to_rank);
      }
    } else {
#line 934
      goto _L___0;
    }
  } else
  _L___0: /* CIL Label */ 
#line 934
  if ((unsigned int )colour == 0U) {
#line 934
    if ((int )to_rank != 49) {
      {
#line 936
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Illegal pawn promotion to %c%c\n",
              (int )to_col, (int )to_rank);
      }
    } else {
#line 934
      goto _L;
    }
  } else {
    _L: /* CIL Label */ 
    {
#line 939
    move_list = find_pawn_moves(from_col, from_rank, to_col, to_rank, colour, (Board const   *)board);
    }
#line 940
    if ((unsigned long )move_list != (unsigned long )((void *)0)) {
#line 941
      if ((unsigned long )move_list->next == (unsigned long )((void *)0)) {
#line 946
        move_details->from_col = move_list->from_col;
#line 947
        move_details->from_rank = move_list->from_rank;
#line 948
        move_details->to_col = move_list->to_col;
#line 949
        move_details->to_rank = move_list->to_rank;
#line 950
        Ok = (Boolean )1;
      } else {
        {
#line 953
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Ambiguous pawn move to %c%c\n",
                (int )to_col, (int )to_rank);
        }
      }
      {
#line 955
      free_move_pair_list(move_list);
      }
    } else {
      {
#line 958
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Illegal pawn promotion to %c%c\n",
              (int )to_col, (int )to_rank);
      }
    }
  }
#line 961
  return (Ok);
}
}
#line 967 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean knight_move(Move *move_details , Colour colour , Board *board ) 
{ 
  Col from_col ;
  Rank from_rank ;
  Col to_col ;
  Rank to_rank ;
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  MovePair *move_list ;
  MovePair *tmp___1 ;
  Boolean Ok ;
  Piece occupant ;
  Boolean tmp___2 ;

  {
#line 969
  from_col = move_details->from_col;
#line 970
  from_rank = move_details->from_rank;
#line 971
  to_col = move_details->to_col;
#line 972
  to_rank = move_details->to_rank;
#line 973
  if (49 <= (int )to_rank) {
#line 973
    if ((int )to_rank <= 56) {
#line 973
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 973
      tmp = 0;
    }
  } else {
#line 973
    tmp = 0;
  }
#line 973
  to_r = (short )tmp;
#line 974
  if (97 <= (int )to_col) {
#line 974
    if ((int )to_col <= 104) {
#line 974
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 974
      tmp___0 = 0;
    }
  } else {
#line 974
    tmp___0 = 0;
  }
  {
#line 974
  to_c = (short )tmp___0;
#line 975
  tmp___1 = find_knight_moves(to_col, to_rank, colour, (Board const   *)board);
#line 975
  move_list = tmp___1;
#line 977
  Ok = (Boolean )1;
#line 979
  move_list = exclude_moves((Piece )3, colour, from_col, from_rank, move_list, (Board const   *)board);
  }
#line 981
  if ((unsigned long )move_list == (unsigned long )((void *)0)) {
    {
#line 982
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"No knight move possible to %c%c.\n",
            (int )to_col, (int )to_rank);
#line 983
    Ok = (Boolean )0;
    }
  } else
#line 985
  if ((unsigned long )move_list->next == (unsigned long )((void *)0)) {
#line 987
    occupant = board->board[to_r][to_c];
#line 989
    if ((unsigned int )occupant == 1U) {
#line 990
      move_details->from_col = move_list->from_col;
#line 991
      move_details->from_rank = move_list->from_rank;
    } else {
      {
#line 989
      tmp___2 = piece_is_colour(occupant, (Colour )(! colour));
      }
#line 989
      if (tmp___2) {
#line 990
        move_details->from_col = move_list->from_col;
#line 991
        move_details->from_rank = move_list->from_rank;
      } else {
        {
#line 994
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Knight destination square %c%c is illegal.\n",
                (int )to_col, (int )to_rank);
#line 996
        Ok = (Boolean )0;
        }
      }
    }
    {
#line 998
    free_move_pair(move_list);
    }
  } else {
    {
#line 1001
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Ambiguous knight move to %c%c.\n",
            (int )to_col, (int )to_rank);
#line 1002
    free_move_pair_list(move_list);
#line 1003
    Ok = (Boolean )0;
    }
  }
#line 1005
  return (Ok);
}
}
#line 1011 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean bishop_move(Move *move_details , Colour colour , Board *board ) 
{ 
  Col from_col ;
  Rank from_rank ;
  Col to_col ;
  Rank to_rank ;
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  MovePair *move_list ;
  MovePair *tmp___1 ;
  Boolean Ok ;
  Piece occupant ;
  Boolean tmp___2 ;

  {
#line 1013
  from_col = move_details->from_col;
#line 1014
  from_rank = move_details->from_rank;
#line 1015
  to_col = move_details->to_col;
#line 1016
  to_rank = move_details->to_rank;
#line 1017
  if (49 <= (int )to_rank) {
#line 1017
    if ((int )to_rank <= 56) {
#line 1017
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 1017
      tmp = 0;
    }
  } else {
#line 1017
    tmp = 0;
  }
#line 1017
  to_r = (short )tmp;
#line 1018
  if (97 <= (int )to_col) {
#line 1018
    if ((int )to_col <= 104) {
#line 1018
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 1018
      tmp___0 = 0;
    }
  } else {
#line 1018
    tmp___0 = 0;
  }
  {
#line 1018
  to_c = (short )tmp___0;
#line 1019
  tmp___1 = find_bishop_moves(to_col, to_rank, colour, (Board const   *)board);
#line 1019
  move_list = tmp___1;
#line 1021
  Ok = (Boolean )1;
#line 1023
  move_list = exclude_moves((Piece )4, colour, from_col, from_rank, move_list, (Board const   *)board);
  }
#line 1025
  if ((unsigned long )move_list == (unsigned long )((void *)0)) {
    {
#line 1026
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"No bishop move possible to %c%c.\n",
            (int )to_col, (int )to_rank);
#line 1027
    Ok = (Boolean )0;
    }
  } else
#line 1029
  if ((unsigned long )move_list->next == (unsigned long )((void *)0)) {
#line 1031
    occupant = board->board[to_r][to_c];
#line 1033
    if ((unsigned int )occupant == 1U) {
#line 1034
      move_details->from_col = move_list->from_col;
#line 1035
      move_details->from_rank = move_list->from_rank;
    } else {
      {
#line 1033
      tmp___2 = piece_is_colour(occupant, (Colour )(! colour));
      }
#line 1033
      if (tmp___2) {
#line 1034
        move_details->from_col = move_list->from_col;
#line 1035
        move_details->from_rank = move_list->from_rank;
      } else {
        {
#line 1038
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Bishop\'s destination square %c%c is illegal.\n",
                (int )to_col, (int )to_rank);
#line 1040
        Ok = (Boolean )0;
        }
      }
    }
    {
#line 1042
    free_move_pair(move_list);
    }
  } else {
    {
#line 1045
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Ambiguous bishop move to %c%c.\n",
            (int )to_col, (int )to_rank);
#line 1046
    free_move_pair_list(move_list);
#line 1047
    Ok = (Boolean )0;
    }
  }
#line 1049
  return (Ok);
}
}
#line 1055 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean rook_move(Move *move_details , Colour colour , Board *board ) 
{ 
  Col from_col ;
  Rank from_rank ;
  Col to_col ;
  Rank to_rank ;
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  MovePair *move_list ;
  MovePair *tmp___1 ;
  Boolean Ok ;
  Piece occupant ;
  Boolean tmp___2 ;

  {
#line 1057
  from_col = move_details->from_col;
#line 1058
  from_rank = move_details->from_rank;
#line 1059
  to_col = move_details->to_col;
#line 1060
  to_rank = move_details->to_rank;
#line 1061
  if (49 <= (int )to_rank) {
#line 1061
    if ((int )to_rank <= 56) {
#line 1061
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 1061
      tmp = 0;
    }
  } else {
#line 1061
    tmp = 0;
  }
#line 1061
  to_r = (short )tmp;
#line 1062
  if (97 <= (int )to_col) {
#line 1062
    if ((int )to_col <= 104) {
#line 1062
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 1062
      tmp___0 = 0;
    }
  } else {
#line 1062
    tmp___0 = 0;
  }
  {
#line 1062
  to_c = (short )tmp___0;
#line 1063
  tmp___1 = find_rook_moves(to_col, to_rank, colour, (Board const   *)board);
#line 1063
  move_list = tmp___1;
#line 1065
  Ok = (Boolean )1;
  }
#line 1067
  if ((unsigned long )move_list == (unsigned long )((void *)0)) {
    {
#line 1068
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"No rook move possible to %c%c.\n",
            (int )to_col, (int )to_rank);
#line 1069
    Ok = (Boolean )0;
    }
  } else {
    {
#line 1072
    move_list = exclude_moves((Piece )5, colour, from_col, from_rank, move_list, (Board const   *)board);
    }
#line 1074
    if ((unsigned long )move_list == (unsigned long )((void *)0)) {
      {
#line 1075
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Indicated rook move is excluded.\n");
#line 1076
      Ok = (Boolean )0;
      }
    } else
#line 1078
    if ((unsigned long )move_list->next == (unsigned long )((void *)0)) {
#line 1080
      occupant = board->board[to_r][to_c];
#line 1082
      if ((unsigned int )occupant == 1U) {
#line 1083
        move_details->from_col = move_list->from_col;
#line 1084
        move_details->from_rank = move_list->from_rank;
      } else {
        {
#line 1082
        tmp___2 = piece_is_colour(occupant, (Colour )(! colour));
        }
#line 1082
        if (tmp___2) {
#line 1083
          move_details->from_col = move_list->from_col;
#line 1084
          move_details->from_rank = move_list->from_rank;
        } else {
          {
#line 1087
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Rook\'s destination square %c%c is illegal.\n",
                  (int )to_col, (int )to_rank);
#line 1090
          Ok = (Boolean )0;
          }
        }
      }
      {
#line 1092
      free_move_pair(move_list);
      }
    } else {
      {
#line 1095
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Ambiguous rook move to %c%c.\n",
              (int )to_col, (int )to_rank);
#line 1096
      free_move_pair_list(move_list);
#line 1097
      Ok = (Boolean )0;
      }
    }
  }
#line 1100
  return (Ok);
}
}
#line 1106 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean queen_move(Move *move_details , Colour colour , Board *board ) 
{ 
  Col from_col ;
  Rank from_rank ;
  Col to_col ;
  Rank to_rank ;
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  MovePair *move_list ;
  MovePair *tmp___1 ;
  Boolean Ok ;
  Piece occupant ;
  Boolean tmp___2 ;

  {
#line 1108
  from_col = move_details->from_col;
#line 1109
  from_rank = move_details->from_rank;
#line 1110
  to_col = move_details->to_col;
#line 1111
  to_rank = move_details->to_rank;
#line 1112
  if (49 <= (int )to_rank) {
#line 1112
    if ((int )to_rank <= 56) {
#line 1112
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 1112
      tmp = 0;
    }
  } else {
#line 1112
    tmp = 0;
  }
#line 1112
  to_r = (short )tmp;
#line 1113
  if (97 <= (int )to_col) {
#line 1113
    if ((int )to_col <= 104) {
#line 1113
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 1113
      tmp___0 = 0;
    }
  } else {
#line 1113
    tmp___0 = 0;
  }
  {
#line 1113
  to_c = (short )tmp___0;
#line 1114
  tmp___1 = find_queen_moves(to_col, to_rank, colour, (Board const   *)board);
#line 1114
  move_list = tmp___1;
#line 1116
  Ok = (Boolean )1;
#line 1118
  move_list = exclude_moves((Piece )6, colour, from_col, from_rank, move_list, (Board const   *)board);
  }
#line 1120
  if ((unsigned long )move_list == (unsigned long )((void *)0)) {
    {
#line 1121
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"No queen move possible to %c%c.\n",
            (int )to_col, (int )to_rank);
#line 1122
    Ok = (Boolean )0;
    }
  } else
#line 1124
  if ((unsigned long )move_list->next == (unsigned long )((void *)0)) {
#line 1126
    occupant = board->board[to_r][to_c];
#line 1128
    if ((unsigned int )occupant == 1U) {
#line 1129
      move_details->from_col = move_list->from_col;
#line 1130
      move_details->from_rank = move_list->from_rank;
    } else {
      {
#line 1128
      tmp___2 = piece_is_colour(occupant, (Colour )(! colour));
      }
#line 1128
      if (tmp___2) {
#line 1129
        move_details->from_col = move_list->from_col;
#line 1130
        move_details->from_rank = move_list->from_rank;
      } else {
        {
#line 1133
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Queen\'s destination square %c%c is illegal.\n",
                (int )to_col, (int )to_rank);
#line 1135
        Ok = (Boolean )0;
        }
      }
    }
    {
#line 1137
    free_move_pair(move_list);
    }
  } else {
    {
#line 1140
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Ambiguous queen move to %c%c.\n",
            (int )to_col, (int )to_rank);
#line 1141
    free_move_pair_list(move_list);
#line 1142
    Ok = (Boolean )0;
    }
  }
#line 1144
  return (Ok);
}
}
#line 1148 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean can_castle_kingside(Colour colour , Board const   *board ) 
{ 
  Boolean Ok ;
  Rank king_rank ;
  short king_c ;
  short king_r ;
  int tmp ;
  Piece coloured_king ;
  Piece coloured_rook ;
  Boolean tmp___0 ;

  {
#line 1151
  Ok = (Boolean )0;
#line 1154
  if ((unsigned int )colour == 1U) {
#line 1155
    king_rank = (Rank )'1';
#line 1156
    Ok = (Boolean )board->WKingCastle;
  } else {
#line 1159
    king_rank = (Rank )56;
#line 1160
    Ok = (Boolean )board->BKingCastle;
  }
#line 1163
  if (Ok) {
#line 1165
    king_c = (short)6;
#line 1166
    if (49 <= (int )king_rank) {
#line 1166
      if ((int )king_rank <= 56) {
#line 1166
        tmp = ((int )king_rank - 49) + 2;
      } else {
#line 1166
        tmp = 0;
      }
    } else {
#line 1166
      tmp = 0;
    }
#line 1166
    king_r = (short )tmp;
#line 1167
    coloured_king = (Piece )((unsigned int )(7 << 3) | (unsigned int )colour);
#line 1168
    coloured_rook = (Piece )((unsigned int )(5 << 3) | (unsigned int )colour);
#line 1170
    if ((unsigned int )board->board[king_r][king_c] == (unsigned int )coloured_king) {
#line 1170
      if ((unsigned int )board->board[king_r][(int )king_c + 1] == 1U) {
#line 1170
        if ((unsigned int )board->board[king_r][(int )king_c + 2] == 1U) {
#line 1170
          if ((unsigned int )board->board[king_r][(int )king_c + 3] == (unsigned int )coloured_rook) {
            {
#line 1174
            tmp___0 = exclude_castling_across_checks((MoveClass )4, colour, board);
            }
#line 1174
            if (tmp___0) {
#line 1175
              Ok = (Boolean )1;
            } else {
#line 1179
              Ok = (Boolean )0;
            }
          } else {
#line 1185
            Ok = (Boolean )0;
          }
        } else {
#line 1185
          Ok = (Boolean )0;
        }
      } else {
#line 1185
        Ok = (Boolean )0;
      }
    } else {
#line 1185
      Ok = (Boolean )0;
    }
  }
#line 1191
  return (Ok);
}
}
#line 1195 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean can_castle_queenside(Colour colour , Board const   *board ) 
{ 
  Boolean Ok ;
  Rank king_rank ;
  short king_c ;
  short king_r ;
  int tmp ;
  Piece coloured_king ;
  Piece coloured_rook ;
  Boolean tmp___0 ;

  {
#line 1198
  Ok = (Boolean )0;
#line 1201
  if ((unsigned int )colour == 1U) {
#line 1202
    king_rank = (Rank )'1';
#line 1203
    Ok = (Boolean )board->WQueenCastle;
  } else {
#line 1206
    king_rank = (Rank )56;
#line 1207
    Ok = (Boolean )board->BQueenCastle;
  }
#line 1210
  if (Ok) {
#line 1212
    king_c = (short)6;
#line 1213
    if (49 <= (int )king_rank) {
#line 1213
      if ((int )king_rank <= 56) {
#line 1213
        tmp = ((int )king_rank - 49) + 2;
      } else {
#line 1213
        tmp = 0;
      }
    } else {
#line 1213
      tmp = 0;
    }
#line 1213
    king_r = (short )tmp;
#line 1214
    coloured_king = (Piece )((unsigned int )(7 << 3) | (unsigned int )colour);
#line 1215
    coloured_rook = (Piece )((unsigned int )(5 << 3) | (unsigned int )colour);
#line 1217
    if ((unsigned int )board->board[king_r][king_c] == (unsigned int )coloured_king) {
#line 1217
      if ((unsigned int )board->board[king_r][(int )king_c - 1] == 1U) {
#line 1217
        if ((unsigned int )board->board[king_r][(int )king_c - 2] == 1U) {
#line 1217
          if ((unsigned int )board->board[king_r][(int )king_c - 3] == 1U) {
#line 1217
            if ((unsigned int )board->board[king_r][(int )king_c - 4] == (unsigned int )coloured_rook) {
              {
#line 1222
              tmp___0 = exclude_castling_across_checks((MoveClass )5, colour, board);
              }
#line 1222
              if (tmp___0) {
#line 1223
                Ok = (Boolean )1;
              } else {
#line 1227
                Ok = (Boolean )0;
              }
            } else {
#line 1233
              Ok = (Boolean )0;
            }
          } else {
#line 1233
            Ok = (Boolean )0;
          }
        } else {
#line 1233
          Ok = (Boolean )0;
        }
      } else {
#line 1233
        Ok = (Boolean )0;
      }
    } else {
#line 1233
      Ok = (Boolean )0;
    }
  }
#line 1239
  return (Ok);
}
}
#line 1243 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean kingside_castle(Move *move_details , Colour colour , Board *board ) 
{ 
  Boolean Ok ;
  Rank rank ;
  int tmp ;
  char const   *tmp___0 ;
  Boolean tmp___1 ;

  {
  {
#line 1247
  tmp___1 = can_castle_kingside(colour, (Board const   *)board);
  }
#line 1247
  if (tmp___1) {
#line 1248
    if ((unsigned int )colour == 1U) {
#line 1248
      tmp = '1';
    } else {
#line 1248
      tmp = 56;
    }
#line 1248
    rank = (Rank )tmp;
#line 1250
    move_details->from_col = (Col )'e';
#line 1251
    move_details->from_rank = rank;
#line 1252
    move_details->to_col = (Col )'g';
#line 1253
    move_details->to_rank = rank;
#line 1254
    Ok = (Boolean )1;
  } else {
#line 1257
    if ((unsigned int )colour == 1U) {
#line 1257
      tmp___0 = "White";
    } else {
#line 1257
      tmp___0 = "Black";
    }
    {
#line 1257
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Kingside castling is forbidden to %s.\n",
            tmp___0);
#line 1259
    Ok = (Boolean )0;
    }
  }
#line 1261
  return (Ok);
}
}
#line 1264 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean queenside_castle(Move *move_details , Colour colour , Board *board ) 
{ 
  Boolean Ok ;
  Rank rank ;
  int tmp ;
  char const   *tmp___0 ;
  Boolean tmp___1 ;

  {
  {
#line 1268
  tmp___1 = can_castle_queenside(colour, (Board const   *)board);
  }
#line 1268
  if (tmp___1) {
#line 1269
    if ((unsigned int )colour == 1U) {
#line 1269
      tmp = '1';
    } else {
#line 1269
      tmp = 56;
    }
#line 1269
    rank = (Rank )tmp;
#line 1271
    move_details->from_col = (Col )'e';
#line 1272
    move_details->from_rank = rank;
#line 1273
    move_details->to_col = (Col )'c';
#line 1274
    move_details->to_rank = rank;
#line 1275
    Ok = (Boolean )1;
  } else {
#line 1278
    if ((unsigned int )colour == 1U) {
#line 1278
      tmp___0 = "White";
    } else {
#line 1278
      tmp___0 = "Black";
    }
    {
#line 1278
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Queenside castling is forbidden to %s.\n",
            tmp___0);
#line 1280
    Ok = (Boolean )0;
    }
  }
#line 1282
  return (Ok);
}
}
#line 1288 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static Boolean king_move(Move *move_details , Colour colour , Board *board ) 
{ 
  Col from_col ;
  Rank from_rank ;
  Col to_col ;
  Rank to_rank ;
  short to_r ;
  int tmp ;
  short to_c ;
  int tmp___0 ;
  MovePair *move_list ;
  MovePair *tmp___1 ;
  Boolean Ok ;
  Piece occupant ;
  Boolean tmp___2 ;

  {
#line 1290
  from_col = move_details->from_col;
#line 1291
  from_rank = move_details->from_rank;
#line 1292
  to_col = move_details->to_col;
#line 1293
  to_rank = move_details->to_rank;
#line 1294
  if (49 <= (int )to_rank) {
#line 1294
    if ((int )to_rank <= 56) {
#line 1294
      tmp = ((int )to_rank - 49) + 2;
    } else {
#line 1294
      tmp = 0;
    }
  } else {
#line 1294
    tmp = 0;
  }
#line 1294
  to_r = (short )tmp;
#line 1295
  if (97 <= (int )to_col) {
#line 1295
    if ((int )to_col <= 104) {
#line 1295
      tmp___0 = ((int )to_col - 97) + 2;
    } else {
#line 1295
      tmp___0 = 0;
    }
  } else {
#line 1295
    tmp___0 = 0;
  }
  {
#line 1295
  to_c = (short )tmp___0;
#line 1297
  tmp___1 = find_king_moves(to_col, to_rank, colour, (Board const   *)board);
#line 1297
  move_list = tmp___1;
#line 1299
  Ok = (Boolean )1;
#line 1302
  move_list = exclude_moves((Piece )7, colour, from_col, from_rank, move_list, (Board const   *)board);
  }
#line 1304
  if ((unsigned long )move_list == (unsigned long )((void *)0)) {
    {
#line 1305
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"No king move possible to %c%c.\n",
            (int )to_col, (int )to_rank);
#line 1306
    Ok = (Boolean )0;
    }
  } else
#line 1308
  if ((unsigned long )move_list->next == (unsigned long )((void *)0)) {
#line 1310
    occupant = board->board[to_r][to_c];
#line 1312
    if ((unsigned int )occupant == 1U) {
#line 1313
      move_details->from_col = move_list->from_col;
#line 1314
      move_details->from_rank = move_list->from_rank;
    } else {
      {
#line 1312
      tmp___2 = piece_is_colour(occupant, (Colour )(! colour));
      }
#line 1312
      if (tmp___2) {
#line 1313
        move_details->from_col = move_list->from_col;
#line 1314
        move_details->from_rank = move_list->from_rank;
      } else {
        {
#line 1317
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"King\'s destination square %c%c is illegal.\n",
                (int )to_col, (int )to_rank);
#line 1319
        Ok = (Boolean )0;
        }
      }
    }
    {
#line 1321
    free_move_pair(move_list);
    }
  } else {
    {
#line 1324
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Ambiguous king move possible to %c%c.\n",
            (int )to_col, (int )to_rank);
#line 1326
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Multiple kings?!\n");
#line 1327
    free_move_pair_list(move_list);
#line 1328
    Ok = (Boolean )0;
    }
  }
#line 1330
  return (Ok);
}
}
#line 1346 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
Boolean determine_move_details(Colour colour , Move *move_details , Board *board ) 
{ 
  Boolean Ok ;
  unsigned char const   *move ;
  MoveClass class ;
  Boolean move_handled ;
  size_t last_char ;
  size_t tmp ;
  Boolean tmp___0 ;
  unsigned char alternative_move[16] ;
  Move *alternative ;
  short to_r ;
  int tmp___1 ;
  short to_c ;
  int tmp___2 ;

  {
#line 1348
  Ok = (Boolean )0;
#line 1350
  if ((unsigned long )move_details == (unsigned long )((void *)0)) {
    {
#line 1352
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Empty move details in apply_move.\n");
    }
  } else
#line 1355
  if ((int )move_details->move[0] == 0) {
    {
#line 1357
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: Null move string in apply_move.\n");
    }
  } else
#line 1360
  if ((unsigned int )move_details->class == 6U) {
#line 1364
    Ok = (Boolean )1;
  } else {
#line 1368
    move = (unsigned char const   *)(move_details->move);
#line 1369
    class = move_details->class;
#line 1370
    move_handled = (Boolean )0;
#line 1373
    move_details->promoted_piece = (Piece )1;
#line 1381
    if ((unsigned int )class == 0U) {
#line 1381
      if ((int )move_details->from_col != 0) {
#line 1381
        if ((int )move_details->from_rank != 0) {
#line 1381
          if ((int )move_details->to_col != 0) {
#line 1381
            if ((int )move_details->to_rank != 0) {
              {
#line 1387
              move_details = decode_algebraic(move_details, board);
#line 1389
              class = move_details->class;
              }
            }
          }
        }
      }
    }
#line 1393
    if ((unsigned int )class == 0U) {
#line 1393
      goto _L___1;
    } else
#line 1393
    if ((unsigned int )class == 2U) {
#line 1393
      goto _L___1;
    } else
#line 1393
    if ((unsigned int )class == 1U) {
      _L___1: /* CIL Label */ 
#line 1395
      move_details->piece_to_move = (Piece )2;
#line 1397
      if ((unsigned int )class == 0U) {
#line 1399
        if ((int )move_details->to_rank == 56) {
#line 1399
          if ((unsigned int )colour == 1U) {
#line 1404
            class = (MoveClass )1;
#line 1408
            move_details->promoted_piece = (Piece )6;
          } else {
#line 1399
            goto _L;
          }
        } else
        _L: /* CIL Label */ 
#line 1399
        if ((int )move_details->to_rank == 49) {
#line 1399
          if ((unsigned int )colour == 0U) {
#line 1404
            class = (MoveClass )1;
#line 1408
            move_details->promoted_piece = (Piece )6;
          }
        }
      } else
#line 1411
      if (! ((unsigned int )class == 2U)) {
        {
#line 1416
        tmp = strlen((char const   *)move);
#line 1416
        last_char = tmp - 1UL;
        }
        {
#line 1419
        while (1) {
          while_continue: /* CIL Label */ ;
          {
#line 1419
          tmp___0 = is_check((char )*(move + last_char));
          }
#line 1419
          if (! tmp___0) {
#line 1419
            goto while_break;
          }
#line 1420
          last_char --;
        }
        while_break: /* CIL Label */ ;
        }
        {
#line 1423
        move_details->promoted_piece = is_piece(move + last_char);
        }
        {
#line 1425
        if ((unsigned int )move_details->promoted_piece == 3U) {
#line 1425
          goto case_3;
        }
#line 1425
        if ((unsigned int )move_details->promoted_piece == 4U) {
#line 1425
          goto case_3;
        }
#line 1425
        if ((unsigned int )move_details->promoted_piece == 5U) {
#line 1425
          goto case_3;
        }
#line 1425
        if ((unsigned int )move_details->promoted_piece == 6U) {
#line 1425
          goto case_3;
        }
#line 1428
        goto switch_default;
        case_3: /* CIL Label */ 
        case_4: /* CIL Label */ 
        case_5: /* CIL Label */ 
        case_6: /* CIL Label */ 
#line 1427
        goto switch_break;
        switch_default: /* CIL Label */ 
        {
#line 1429
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown piece in promotion %s\n",
                move);
#line 1431
        move_details->promoted_piece = (Piece )1;
        }
#line 1432
        goto switch_break;
        switch_break: /* CIL Label */ ;
        }
      }
#line 1435
      if ((unsigned int )class == 0U) {
#line 1435
        goto _L___0;
      } else
#line 1435
      if ((unsigned int )class == 2U) {
        _L___0: /* CIL Label */ 
        {
#line 1437
        Ok = pawn_move(move_details, colour, board);
        }
#line 1439
        if (Ok) {
#line 1440
          if (board->EnPassant) {
#line 1440
            if ((int )board->ep_rank == (int )move_details->to_rank) {
#line 1440
              if ((int )board->ep_col == (int )move_details->to_col) {
#line 1443
                class = (MoveClass )2;
#line 1443
                move_details->class = class;
              } else {
#line 1447
                class = (MoveClass )0;
#line 1447
                move_details->class = class;
              }
            } else {
#line 1447
              class = (MoveClass )0;
#line 1447
              move_details->class = class;
            }
          } else {
#line 1447
            class = (MoveClass )0;
#line 1447
            move_details->class = class;
          }
#line 1449
          move_handled = (Boolean )1;
        }
      } else
#line 1452
      if ((unsigned int )class == 1U) {
        {
#line 1454
        Ok = promote(move_details, colour, board);
#line 1455
        move_handled = (Boolean )1;
        }
      }
#line 1460
      if (! move_handled) {
#line 1463
        if ((int )move_details->move[0] == 98) {
          {
#line 1468
          strcpy((char */* __restrict  */)((char *)(alternative_move)), (char const   */* __restrict  */)((char const   *)(move_details->move)));
#line 1470
          alternative_move[0] = (unsigned char )'B';
#line 1471
          alternative = decode_move((unsigned char const   *)(alternative_move));
          }
#line 1472
          if ((unsigned long )alternative != (unsigned long )((void *)0)) {
            {
#line 1473
            Ok = bishop_move(alternative, colour, board);
            }
#line 1474
            if (Ok) {
              {
#line 1476
              move_details->class = alternative->class;
#line 1477
              move_details->from_col = alternative->from_col;
#line 1478
              move_details->from_rank = alternative->from_rank;
#line 1479
              move_details->to_col = alternative->to_col;
#line 1480
              move_details->to_rank = alternative->to_rank;
#line 1481
              move_details->piece_to_move = alternative->piece_to_move;
#line 1483
              free_move_list(alternative);
#line 1484
              move_handled = (Boolean )1;
              }
            }
          }
        }
      }
    }
#line 1490
    if (! move_handled) {
      {
#line 1498
      if ((unsigned int )class == 1U) {
#line 1498
        goto case_1;
      }
#line 1498
      if ((unsigned int )class == 2U) {
#line 1498
        goto case_1;
      }
#line 1498
      if ((unsigned int )class == 0U) {
#line 1498
        goto case_1;
      }
#line 1501
      if ((unsigned int )class == 3U) {
#line 1501
        goto case_3___0;
      }
#line 1524
      if ((unsigned int )class == 4U) {
#line 1524
        goto case_4___1;
      }
#line 1528
      if ((unsigned int )class == 5U) {
#line 1528
        goto case_5___1;
      }
#line 1532
      if ((unsigned int )class == 7U) {
#line 1532
        goto case_7___0;
      }
#line 1535
      goto switch_default___1;
      case_1: /* CIL Label */ 
      case_2: /* CIL Label */ 
      case_0: /* CIL Label */ 
#line 1500
      goto switch_break___0;
      case_3___0: /* CIL Label */ 
      {
#line 1503
      if ((unsigned int )move_details->piece_to_move == 7U) {
#line 1503
        goto case_7;
      }
#line 1506
      if ((unsigned int )move_details->piece_to_move == 6U) {
#line 1506
        goto case_6___0;
      }
#line 1509
      if ((unsigned int )move_details->piece_to_move == 5U) {
#line 1509
        goto case_5___0;
      }
#line 1512
      if ((unsigned int )move_details->piece_to_move == 3U) {
#line 1512
        goto case_3___1;
      }
#line 1515
      if ((unsigned int )move_details->piece_to_move == 4U) {
#line 1515
        goto case_4___0;
      }
#line 1518
      goto switch_default___0;
      case_7: /* CIL Label */ 
      {
#line 1504
      Ok = king_move(move_details, colour, board);
      }
#line 1505
      goto switch_break___1;
      case_6___0: /* CIL Label */ 
      {
#line 1507
      Ok = queen_move(move_details, colour, board);
      }
#line 1508
      goto switch_break___1;
      case_5___0: /* CIL Label */ 
      {
#line 1510
      Ok = rook_move(move_details, colour, board);
      }
#line 1511
      goto switch_break___1;
      case_3___1: /* CIL Label */ 
      {
#line 1513
      Ok = knight_move(move_details, colour, board);
      }
#line 1514
      goto switch_break___1;
      case_4___0: /* CIL Label */ 
      {
#line 1516
      Ok = bishop_move(move_details, colour, board);
      }
#line 1517
      goto switch_break___1;
      switch_default___0: /* CIL Label */ 
      {
#line 1519
      Ok = (Boolean )0;
#line 1520
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown piece move %s\n",
              move);
      }
#line 1521
      goto switch_break___1;
      switch_break___1: /* CIL Label */ ;
      }
#line 1523
      goto switch_break___0;
      case_4___1: /* CIL Label */ 
      {
#line 1525
      move_details->piece_to_move = (Piece )7;
#line 1526
      Ok = kingside_castle(move_details, colour, board);
      }
#line 1527
      goto switch_break___0;
      case_5___1: /* CIL Label */ 
      {
#line 1529
      move_details->piece_to_move = (Piece )7;
#line 1530
      Ok = queenside_castle(move_details, colour, board);
      }
#line 1531
      goto switch_break___0;
      case_7___0: /* CIL Label */ 
#line 1533
      Ok = (Boolean )0;
#line 1534
      goto switch_break___0;
      switch_default___1: /* CIL Label */ 
      {
#line 1536
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unknown move class in determine_move_details(%d).\n",
              (unsigned int )move_details->class);
      }
#line 1539
      goto switch_break___0;
      switch_break___0: /* CIL Label */ ;
      }
    }
#line 1542
    if (Ok) {
#line 1544
      if (49 <= (int )move_details->to_rank) {
#line 1544
        if ((int )move_details->to_rank <= 56) {
#line 1544
          tmp___1 = ((int )move_details->to_rank - 49) + 2;
        } else {
#line 1544
          tmp___1 = 0;
        }
      } else {
#line 1544
        tmp___1 = 0;
      }
#line 1544
      to_r = (short )tmp___1;
#line 1545
      if (97 <= (int )move_details->to_col) {
#line 1545
        if ((int )move_details->to_col <= 104) {
#line 1545
          tmp___2 = ((int )move_details->to_col - 97) + 2;
        } else {
#line 1545
          tmp___2 = 0;
        }
      } else {
#line 1545
        tmp___2 = 0;
      }
#line 1545
      to_c = (short )tmp___2;
#line 1548
      if ((unsigned int )board->board[to_r][to_c] != 1U) {
#line 1549
        move_details->captured_piece = (Piece )((unsigned int )board->board[to_r][to_c] >> 3);
      } else
#line 1552
      if ((unsigned int )move_details->class == 2U) {
#line 1553
        move_details->captured_piece = (Piece )2;
      } else {
#line 1556
        move_details->captured_piece = (Piece )1;
      }
    }
  }
#line 1560
  return (Ok);
}
}
#line 1568 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static MovePair *GenerateSingleMoves(Colour colour , Piece piece , Board const   *board ,
                                     Col from_col , Rank from_rank ) 
{ 
  short from_r ;
  int tmp ;
  short from_c ;
  int tmp___0 ;
  unsigned int ix ;
  MovePair *moves ;
  Colour target_colour ;
  unsigned int num_directions ;
  int tmp___1 ;
  short const   *Piece_moves ;
  short *tmp___2 ;
  short r ;
  short c ;
  Piece occupant ;
  Boolean Ok ;

  {
#line 1571
  if (49 <= (int )from_rank) {
#line 1571
    if ((int )from_rank <= 56) {
#line 1571
      tmp = ((int )from_rank - 49) + 2;
    } else {
#line 1571
      tmp = 0;
    }
  } else {
#line 1571
    tmp = 0;
  }
#line 1571
  from_r = (short )tmp;
#line 1572
  if (97 <= (int )from_col) {
#line 1572
    if ((int )from_col <= 104) {
#line 1572
      tmp___0 = ((int )from_col - 97) + 2;
    } else {
#line 1572
      tmp___0 = 0;
    }
  } else {
#line 1572
    tmp___0 = 0;
  }
#line 1572
  from_c = (short )tmp___0;
#line 1574
  moves = (MovePair *)((void *)0);
#line 1575
  target_colour = (Colour )(! colour);
#line 1576
  if ((unsigned int )piece == 7U) {
#line 1576
    tmp___1 = 8;
  } else {
#line 1576
    tmp___1 = 8;
  }
#line 1576
  num_directions = (unsigned int )tmp___1;
#line 1577
  if ((unsigned int )piece == 7U) {
#line 1577
    tmp___2 = King_moves;
  } else {
#line 1577
    tmp___2 = Knight_moves;
  }
#line 1577
  Piece_moves = (short const   *)tmp___2;
#line 1582
  ix = 0U;
  {
#line 1582
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1582
    if (! (ix < 2U * num_directions)) {
#line 1582
      goto while_break;
    }
#line 1583
    r = (short )((int const   )*(Piece_moves + ix) + (int const   )from_r);
#line 1584
    c = (short )((int const   )*(Piece_moves + (ix + 1U)) + (int const   )from_c);
#line 1585
    occupant = board->board[r][c];
#line 1586
    Ok = (Boolean )0;
#line 1588
    if (! ((unsigned int )occupant == 0U)) {
#line 1591
      if ((unsigned int )board->board[r][c] == 1U) {
#line 1592
        Ok = (Boolean )1;
      } else
#line 1594
      if (((unsigned int )occupant & 1U) == (unsigned int )target_colour) {
#line 1595
        Ok = (Boolean )1;
      }
    }
#line 1599
    if (Ok) {
      {
#line 1601
      moves = append_move_pair(from_col, from_rank, (Col )(((int )c + 97) - 2), (Rank )(((int )r + 49) - 2),
                               moves);
      }
    }
#line 1582
    ix += 2U;
  }
  while_break: /* CIL Label */ ;
  }
#line 1604
  if ((unsigned long )moves != (unsigned long )((void *)0)) {
    {
#line 1605
    moves = exclude_checks(piece, colour, moves, board);
    }
  }
#line 1607
  return (moves);
}
}
#line 1613 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static MovePair *GenerateMultipleMoves(Colour colour , Piece piece , Board const   *board ,
                                       Col from_col , Rank from_rank ) 
{ 
  short from_r ;
  int tmp ;
  short from_c ;
  int tmp___0 ;
  unsigned int ix ;
  MovePair *moves ;
  Colour target_colour ;
  unsigned int num_directions ;
  int tmp___1 ;
  int tmp___2 ;
  short const   *Piece_moves ;
  short *tmp___3 ;
  short *tmp___4 ;
  short r ;
  short c ;
  Piece occupant ;

  {
#line 1616
  if (49 <= (int )from_rank) {
#line 1616
    if ((int )from_rank <= 56) {
#line 1616
      tmp = ((int )from_rank - 49) + 2;
    } else {
#line 1616
      tmp = 0;
    }
  } else {
#line 1616
    tmp = 0;
  }
#line 1616
  from_r = (short )tmp;
#line 1617
  if (97 <= (int )from_col) {
#line 1617
    if ((int )from_col <= 104) {
#line 1617
      tmp___0 = ((int )from_col - 97) + 2;
    } else {
#line 1617
      tmp___0 = 0;
    }
  } else {
#line 1617
    tmp___0 = 0;
  }
#line 1617
  from_c = (short )tmp___0;
#line 1619
  moves = (MovePair *)((void *)0);
#line 1620
  target_colour = (Colour )(! colour);
#line 1621
  if ((unsigned int )piece == 6U) {
#line 1621
    tmp___2 = 8;
  } else {
#line 1621
    if ((unsigned int )piece == 5U) {
#line 1621
      tmp___1 = 4;
    } else {
#line 1621
      tmp___1 = 4;
    }
#line 1621
    tmp___2 = tmp___1;
  }
#line 1621
  num_directions = (unsigned int )tmp___2;
#line 1623
  if ((unsigned int )piece == 6U) {
#line 1623
    tmp___4 = Queen_moves;
  } else {
#line 1623
    if ((unsigned int )piece == 5U) {
#line 1623
      tmp___3 = Rook_moves;
    } else {
#line 1623
      tmp___3 = Bishop_moves;
    }
#line 1623
    tmp___4 = tmp___3;
  }
#line 1623
  Piece_moves = (short const   *)tmp___4;
#line 1629
  ix = 0U;
  {
#line 1629
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1629
    if (! (ix < 2U * num_directions)) {
#line 1629
      goto while_break;
    }
#line 1630
    r = (short )((int const   )*(Piece_moves + ix) + (int const   )from_r);
#line 1631
    c = (short )((int const   )*(Piece_moves + (ix + 1U)) + (int const   )from_c);
#line 1632
    occupant = board->board[r][c];
    {
#line 1635
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 1635
      if (! ((unsigned int )occupant == 1U)) {
#line 1635
        goto while_break___0;
      }
      {
#line 1637
      moves = append_move_pair(from_col, from_rank, (Col )(((int )c + 97) - 2), (Rank )(((int )r + 49) - 2),
                               moves);
#line 1639
      r = (short )((int )r + (int )*(Piece_moves + ix));
#line 1640
      c = (short )((int )c + (int )*(Piece_moves + (ix + 1U)));
#line 1641
      occupant = board->board[r][c];
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 1644
    if (! ((unsigned int )occupant == 0U)) {
#line 1647
      if (((unsigned int )occupant & 1U) == (unsigned int )target_colour) {
        {
#line 1648
        moves = append_move_pair(from_col, from_rank, (Col )(((int )c + 97) - 2),
                                 (Rank )(((int )r + 49) - 2), moves);
        }
      }
    }
#line 1629
    ix += 2U;
  }
  while_break: /* CIL Label */ ;
  }
#line 1654
  if ((unsigned long )moves != (unsigned long )((void *)0)) {
    {
#line 1655
    moves = exclude_checks(piece, colour, moves, board);
    }
  }
#line 1657
  return (moves);
}
}
#line 1661 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
static MovePair *GeneratePawnMoves(Colour colour , Board const   *board , Col from_col ,
                                   Rank from_rank ) 
{ 
  MovePair *moves ;
  Piece piece ;
  Colour target_colour ;
  short offset ;
  int tmp ;
  short to_r ;
  short to_c ;
  int tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  int tmp___3 ;
  int tmp___4 ;
  int tmp___5 ;
  int tmp___6 ;

  {
#line 1663
  moves = (MovePair *)((void *)0);
#line 1664
  piece = (Piece )2;
#line 1665
  target_colour = (Colour )(! colour);
#line 1667
  if ((unsigned int )colour == 1U) {
#line 1667
    tmp = 1;
  } else {
#line 1667
    tmp = -1;
  }
#line 1667
  offset = (short )tmp;
#line 1668
  if (97 <= (int )from_col) {
#line 1668
    if ((int )from_col <= 104) {
#line 1668
      tmp___0 = ((int )from_col - 97) + 2;
    } else {
#line 1668
      tmp___0 = 0;
    }
  } else {
#line 1668
    tmp___0 = 0;
  }
#line 1668
  to_c = (short )tmp___0;
#line 1671
  if (49 <= (int )from_rank) {
#line 1671
    if ((int )from_rank <= 56) {
#line 1671
      tmp___1 = ((int )from_rank - 49) + 2;
    } else {
#line 1671
      tmp___1 = 0;
    }
  } else {
#line 1671
    tmp___1 = 0;
  }
#line 1671
  to_r = (short )(tmp___1 + (int )offset);
#line 1672
  if ((unsigned int )board->board[to_r][to_c] == 1U) {
    {
#line 1674
    moves = append_move_pair(from_col, from_rank, (Col )(((int )to_c + 97) - 2), (Rank )(((int )to_r + 49) - 2),
                             moves);
    }
#line 1675
    if ((unsigned int )colour == 1U) {
#line 1675
      if ((int )from_rank == 50) {
#line 1675
        goto _L;
      } else {
#line 1675
        goto _L___0;
      }
    } else
    _L___0: /* CIL Label */ 
#line 1675
    if ((unsigned int )colour == 0U) {
#line 1675
      if ((int )from_rank == 55) {
        _L: /* CIL Label */ 
#line 1678
        if (49 <= (int )from_rank) {
#line 1678
          if ((int )from_rank <= 56) {
#line 1678
            tmp___2 = ((int )from_rank - 49) + 2;
          } else {
#line 1678
            tmp___2 = 0;
          }
        } else {
#line 1678
          tmp___2 = 0;
        }
#line 1678
        to_r = (short )(tmp___2 + 2 * (int )offset);
#line 1679
        if ((unsigned int )board->board[to_r][to_c] == 1U) {
          {
#line 1680
          moves = append_move_pair(from_col, from_rank, (Col )(((int )to_c + 97) - 2),
                                   (Rank )(((int )to_r + 49) - 2), moves);
          }
        }
      }
    }
  }
#line 1685
  if (49 <= (int )from_rank) {
#line 1685
    if ((int )from_rank <= 56) {
#line 1685
      tmp___3 = ((int )from_rank - 49) + 2;
    } else {
#line 1685
      tmp___3 = 0;
    }
  } else {
#line 1685
    tmp___3 = 0;
  }
#line 1685
  to_r = (short )(tmp___3 + (int )offset);
#line 1686
  if (97 <= (int )from_col) {
#line 1686
    if ((int )from_col <= 104) {
#line 1686
      tmp___4 = ((int )from_col - 97) + 2;
    } else {
#line 1686
      tmp___4 = 0;
    }
  } else {
#line 1686
    tmp___4 = 0;
  }
#line 1686
  to_c = (short )(tmp___4 - 1);
#line 1687
  if (! ((unsigned int )board->board[to_r][to_c] == 0U)) {
#line 1689
    if ((unsigned int )board->board[to_r][to_c] == 1U) {
#line 1690
      if (board->EnPassant) {
#line 1690
        if (((int )to_r + 49) - 2 == (int )board->ep_rank) {
#line 1690
          if (((int )to_c + 97) - 2 == (int )board->ep_col) {
            {
#line 1692
            moves = append_move_pair(from_col, from_rank, (Col )(((int )to_c + 97) - 2),
                                     (Rank )(((int )to_r + 49) - 2), moves);
            }
          }
        }
      }
    } else
#line 1695
    if (((unsigned int )board->board[to_r][to_c] & 1U) == (unsigned int )target_colour) {
      {
#line 1696
      moves = append_move_pair(from_col, from_rank, (Col )(((int )to_c + 97) - 2),
                               (Rank )(((int )to_r + 49) - 2), moves);
      }
    }
  }
#line 1702
  if (49 <= (int )from_rank) {
#line 1702
    if ((int )from_rank <= 56) {
#line 1702
      tmp___5 = ((int )from_rank - 49) + 2;
    } else {
#line 1702
      tmp___5 = 0;
    }
  } else {
#line 1702
    tmp___5 = 0;
  }
#line 1702
  to_r = (short )(tmp___5 + (int )offset);
#line 1703
  if (97 <= (int )from_col) {
#line 1703
    if ((int )from_col <= 104) {
#line 1703
      tmp___6 = ((int )from_col - 97) + 2;
    } else {
#line 1703
      tmp___6 = 0;
    }
  } else {
#line 1703
    tmp___6 = 0;
  }
#line 1703
  to_c = (short )(tmp___6 + 1);
#line 1704
  if (! ((unsigned int )board->board[to_r][to_c] == 0U)) {
#line 1706
    if ((unsigned int )board->board[to_r][to_c] == 1U) {
#line 1707
      if (board->EnPassant) {
#line 1707
        if (((int )to_r + 49) - 2 == (int )board->ep_rank) {
#line 1707
          if (((int )to_c + 97) - 2 == (int )board->ep_col) {
            {
#line 1709
            moves = append_move_pair(from_col, from_rank, (Col )(((int )to_c + 97) - 2),
                                     (Rank )(((int )to_r + 49) - 2), moves);
            }
          }
        }
      }
    } else
#line 1712
    if (((unsigned int )board->board[to_r][to_c] & 1U) == (unsigned int )target_colour) {
      {
#line 1713
      moves = append_move_pair(from_col, from_rank, (Col )(((int )to_c + 97) - 2),
                               (Rank )(((int )to_r + 49) - 2), moves);
      }
    }
  }
#line 1718
  if ((unsigned long )moves != (unsigned long )((void *)0)) {
    {
#line 1719
    moves = exclude_checks(piece, colour, moves, board);
    }
  }
#line 1721
  return (moves);
}
}
#line 1730 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
Boolean king_is_in_checkmate(Colour colour , Board *board ) 
{ 
  Rank rank ;
  Col col ;
  MovePair *moves ;
  Boolean in_checkmate ;
  short r ;
  int tmp ;
  short c ;
  int tmp___0 ;
  Piece occupant ;
  Piece piece ;

  {
#line 1734
  moves = (MovePair *)((void *)0);
#line 1735
  in_checkmate = (Boolean )0;
#line 1741
  rank = (Rank )56;
  {
#line 1741
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1741
    if ((int )rank >= 49) {
#line 1741
      if (! ((unsigned long )moves == (unsigned long )((void *)0))) {
#line 1741
        goto while_break;
      }
    } else {
#line 1741
      goto while_break;
    }
#line 1742
    col = (Col )'a';
    {
#line 1742
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 1742
      if ((int )col <= 104) {
#line 1742
        if (! ((unsigned long )moves == (unsigned long )((void *)0))) {
#line 1742
          goto while_break___0;
        }
      } else {
#line 1742
        goto while_break___0;
      }
#line 1743
      if (49 <= (int )rank) {
#line 1743
        if ((int )rank <= 56) {
#line 1743
          tmp = ((int )rank - 49) + 2;
        } else {
#line 1743
          tmp = 0;
        }
      } else {
#line 1743
        tmp = 0;
      }
#line 1743
      r = (short )tmp;
#line 1744
      if (97 <= (int )col) {
#line 1744
        if ((int )col <= 104) {
#line 1744
          tmp___0 = ((int )col - 97) + 2;
        } else {
#line 1744
          tmp___0 = 0;
        }
      } else {
#line 1744
        tmp___0 = 0;
      }
#line 1744
      c = (short )tmp___0;
#line 1745
      occupant = board->board[r][c];
#line 1747
      if ((unsigned int )occupant != 1U) {
#line 1747
        if ((unsigned int )colour == ((unsigned int )occupant & 1U)) {
#line 1749
          piece = (Piece )((unsigned int )occupant >> 3);
          {
#line 1753
          if ((unsigned int )piece == 3U) {
#line 1753
            goto case_3;
          }
#line 1753
          if ((unsigned int )piece == 7U) {
#line 1753
            goto case_3;
          }
#line 1758
          if ((unsigned int )piece == 4U) {
#line 1758
            goto case_4;
          }
#line 1758
          if ((unsigned int )piece == 5U) {
#line 1758
            goto case_4;
          }
#line 1758
          if ((unsigned int )piece == 6U) {
#line 1758
            goto case_4;
          }
#line 1761
          if ((unsigned int )piece == 2U) {
#line 1761
            goto case_2;
          }
#line 1764
          goto switch_default;
          case_3: /* CIL Label */ 
          case_7: /* CIL Label */ 
          {
#line 1754
          moves = GenerateSingleMoves(colour, piece, (Board const   *)board, col,
                                      rank);
          }
#line 1755
          goto switch_break;
          case_4: /* CIL Label */ 
          case_5: /* CIL Label */ 
          case_6: /* CIL Label */ 
          {
#line 1759
          moves = GenerateMultipleMoves(colour, piece, (Board const   *)board, col,
                                        rank);
          }
#line 1760
          goto switch_break;
          case_2: /* CIL Label */ 
          {
#line 1762
          moves = GeneratePawnMoves(colour, (Board const   *)board, col, rank);
          }
#line 1763
          goto switch_break;
          switch_default: /* CIL Label */ 
          {
#line 1765
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: unknown piece %d in king_is_in_checmate().\n",
                  (unsigned int )piece);
          }
          switch_break: /* CIL Label */ ;
          }
        }
      }
#line 1742
      col = (Col )((int )col + 1);
    }
    while_break___0: /* CIL Label */ ;
    }
#line 1741
    rank = (Rank )((int )rank - 1);
  }
  while_break: /* CIL Label */ ;
  }
#line 1772
  if ((unsigned long )moves != (unsigned long )((void *)0)) {
    {
#line 1774
    free_move_pair_list(moves);
    }
  } else {
#line 1777
    in_checkmate = (Boolean )1;
  }
#line 1779
  return (in_checkmate);
}
}
#line 1847 "/home/wheatley/newnew/temp/pgn-extract-17.14/map.c"
MovePair *find_all_moves(Board const   *board , Colour colour ) 
{ 
  Rank rank ;
  Col col ;
  MovePair *all_moves ;
  short r ;
  int tmp ;
  short c ;
  int tmp___0 ;
  Piece occupant ;
  Piece piece ;
  MovePair *moves ;
  MovePair *m ;
  void *tmp___1 ;
  Boolean tmp___2 ;
  MovePair *m___0 ;
  void *tmp___3 ;
  Boolean tmp___4 ;
  MovePair *m___1 ;

  {
#line 1852
  all_moves = (MovePair *)((void *)0);
#line 1855
  rank = (Rank )56;
  {
#line 1855
  while (1) {
    while_continue: /* CIL Label */ ;
#line 1855
    if (! ((int )rank >= 49)) {
#line 1855
      goto while_break;
    }
#line 1856
    if (49 <= (int )rank) {
#line 1856
      if ((int )rank <= 56) {
#line 1856
        tmp = ((int )rank - 49) + 2;
      } else {
#line 1856
        tmp = 0;
      }
    } else {
#line 1856
      tmp = 0;
    }
#line 1856
    r = (short )tmp;
#line 1857
    col = (Col )'a';
    {
#line 1857
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 1857
      if (! ((int )col <= 104)) {
#line 1857
        goto while_break___0;
      }
#line 1858
      if (97 <= (int )col) {
#line 1858
        if ((int )col <= 104) {
#line 1858
          tmp___0 = ((int )col - 97) + 2;
        } else {
#line 1858
          tmp___0 = 0;
        }
      } else {
#line 1858
        tmp___0 = 0;
      }
#line 1858
      c = (short )tmp___0;
#line 1859
      occupant = board->board[r][c];
#line 1861
      if ((unsigned int )occupant != 1U) {
#line 1861
        if ((unsigned int )colour == ((unsigned int )occupant & 1U)) {
#line 1863
          piece = (Piece )((unsigned int )occupant >> 3);
#line 1865
          moves = (MovePair *)((void *)0);
          {
#line 1868
          if ((unsigned int )piece == 7U) {
#line 1868
            goto case_7;
          }
#line 1896
          if ((unsigned int )piece == 3U) {
#line 1896
            goto case_3;
          }
#line 1901
          if ((unsigned int )piece == 4U) {
#line 1901
            goto case_4;
          }
#line 1901
          if ((unsigned int )piece == 5U) {
#line 1901
            goto case_4;
          }
#line 1901
          if ((unsigned int )piece == 6U) {
#line 1901
            goto case_4;
          }
#line 1904
          if ((unsigned int )piece == 2U) {
#line 1904
            goto case_2;
          }
#line 1907
          goto switch_default;
          case_7: /* CIL Label */ 
          {
#line 1869
          moves = GenerateSingleMoves(colour, piece, board, col, rank);
#line 1873
          tmp___2 = can_castle_kingside(colour, board);
          }
#line 1873
          if (tmp___2) {
            {
#line 1874
            tmp___1 = MallocOrDie(sizeof(MovePair ));
#line 1874
            m = (MovePair *)tmp___1;
#line 1876
            m->from_col = (Col )'e';
#line 1877
            m->from_rank = rank;
#line 1878
            m->to_col = (Col )'g';
#line 1879
            m->to_rank = rank;
#line 1881
            m->next = moves;
#line 1882
            moves = m;
            }
          }
          {
#line 1884
          tmp___4 = can_castle_queenside(colour, board);
          }
#line 1884
          if (tmp___4) {
            {
#line 1885
            tmp___3 = MallocOrDie(sizeof(MovePair ));
#line 1885
            m___0 = (MovePair *)tmp___3;
#line 1887
            m___0->from_col = (Col )'e';
#line 1888
            m___0->from_rank = rank;
#line 1889
            m___0->to_col = (Col )'c';
#line 1890
            m___0->to_rank = rank;
#line 1892
            m___0->next = moves;
#line 1893
            moves = m___0;
            }
          }
#line 1895
          goto switch_break;
          case_3: /* CIL Label */ 
          {
#line 1897
          moves = GenerateSingleMoves(colour, piece, board, col, rank);
          }
#line 1898
          goto switch_break;
          case_4: /* CIL Label */ 
          case_5: /* CIL Label */ 
          case_6: /* CIL Label */ 
          {
#line 1902
          moves = GenerateMultipleMoves(colour, piece, board, col, rank);
          }
#line 1903
          goto switch_break;
          case_2: /* CIL Label */ 
          {
#line 1905
          moves = GeneratePawnMoves(colour, board, col, rank);
          }
#line 1906
          goto switch_break;
          switch_default: /* CIL Label */ 
          {
#line 1908
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: unknown piece %d in king_is_in_checmate().\n",
                  (unsigned int )piece);
          }
          switch_break: /* CIL Label */ ;
          }
#line 1912
          if ((unsigned long )moves != (unsigned long )((void *)0)) {
#line 1918
            m___1 = moves;
            {
#line 1918
            while (1) {
              while_continue___1: /* CIL Label */ ;
#line 1918
              if (! ((unsigned long )m___1->next != (unsigned long )((void *)0))) {
#line 1918
                goto while_break___1;
              }
#line 1918
              m___1 = m___1->next;
            }
            while_break___1: /* CIL Label */ ;
            }
#line 1920
            m___1->next = all_moves;
#line 1921
            all_moves = moves;
          }
        }
      }
#line 1857
      col = (Col )((int )col + 1);
    }
    while_break___0: /* CIL Label */ ;
    }
#line 1855
    rank = (Rank )((int )rank - 1);
  }
  while_break: /* CIL Label */ ;
  }
#line 1926
  return (all_moves);
}
}
#line 53 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.c"
static Boolean matchhere(char const   *regexp , char const   *text ) ;
#line 54
static Boolean matchstar(char const   *regexp , char const   *text ) ;
#line 55
static Boolean matchccl(char const   *regexp , char const   *text ) ;
#line 56
static Boolean matchnccl(char const   *regexp , char const   *text ) ;
#line 57
static Boolean matchone(char regchar , char textchar ) ;
#line 58
static char *convert_board_to_text(Board const   *board ) ;
#line 61 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.c"
static StringList *fen_patterns  =    (StringList *)((void *)0);
#line 63 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.c"
void add_fen_pattern(char const   *fen_pattern ) 
{ 
  int dividors ;
  int rankSymbols ;
  Boolean ok ;
  char const   *p ;
  Boolean in_closure ;
  char const   *pattern ;
  char *tmp ;

  {
#line 68
  dividors = 0;
#line 72
  rankSymbols = 0;
#line 73
  ok = (Boolean )1;
#line 74
  p = fen_pattern;
#line 75
  in_closure = (Boolean )0;
  {
#line 76
  while (1) {
    while_continue: /* CIL Label */ ;
#line 76
    if ((int const   )*p != 0) {
#line 76
      if (! ok) {
#line 76
        goto while_break;
      }
    } else {
#line 76
      goto while_break;
    }
#line 77
    if ((int const   )*p == 47) {
#line 78
      dividors ++;
#line 79
      if (rankSymbols == 0) {
#line 81
        ok = (Boolean )0;
      }
#line 83
      rankSymbols = 0;
    } else
#line 85
    if ((int const   )*p == 91) {
#line 86
      if (! in_closure) {
#line 87
        in_closure = (Boolean )1;
      } else {
        {
#line 90
        ok = (Boolean )0;
#line 91
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Nested closures not allowed: %s\n",
                fen_pattern);
        }
      }
    } else
#line 96
    if ((int const   )*p == 93) {
#line 97
      if (in_closure) {
#line 98
        in_closure = (Boolean )0;
      } else {
        {
#line 101
        ok = (Boolean )0;
#line 102
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Missing %c to match %c: %s\n",
                '[', ']', fen_pattern);
        }
      }
    } else
#line 108
    if ((int const   )*p == 94) {
#line 109
      if (! in_closure) {
        {
#line 110
        ok = (Boolean )0;
#line 111
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"%c not allowed outside %c...%c: %s\n",
                '^', '[', ']', fen_pattern);
        }
      }
    } else {
#line 119
      rankSymbols ++;
    }
#line 121
    p ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 123
  if (dividors != 7) {
#line 124
    ok = (Boolean )0;
  } else
#line 126
  if (rankSymbols == 0) {
#line 127
    ok = (Boolean )0;
  }
#line 129
  if (ok) {
    {
#line 130
    tmp = StringCopy(fen_pattern);
#line 130
    pattern = (char const   *)tmp;
#line 131
    fen_patterns = SaveStringListItem(fen_patterns, pattern);
    }
  } else {
    {
#line 134
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"FEN Pattern: %s badly formed.\n",
            fen_pattern);
    }
  }
#line 137
  return;
}
}
#line 143 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.c"
char const   *matchBoard(Board const   *board ) 
{ 
  Boolean match ;
  char const   *pattern ;
  char const   *text ;
  char *tmp ;
  StringList *item ;
  Boolean tmp___0 ;

  {
#line 146
  match = (Boolean )0;
#line 147
  pattern = (char const   *)((void *)0);
#line 148
  if ((unsigned long )fen_patterns != (unsigned long )((void *)0)) {
    {
#line 149
    tmp = convert_board_to_text(board);
#line 149
    text = (char const   *)tmp;
#line 151
    item = fen_patterns;
    }
    {
#line 153
    while (1) {
      while_continue: /* CIL Label */ ;
#line 153
      if ((unsigned long )item != (unsigned long )((void *)0)) {
#line 153
        if (! (! match)) {
#line 153
          goto while_break;
        }
      } else {
#line 153
        goto while_break;
      }
      {
#line 155
      pattern = item->str;
#line 156
      tmp___0 = matchhere(pattern, text);
      }
#line 156
      if (tmp___0) {
#line 158
        match = (Boolean )1;
      } else {
#line 161
        item = item->next;
      }
    }
    while_break: /* CIL Label */ ;
    }
    {
#line 164
    free((void *)text);
    }
#line 165
    if (match) {
#line 166
      return (pattern);
    } else {
#line 169
      return ((char const   *)((void *)0));
    }
  } else {
#line 173
    return ((char const   *)((void *)0));
  }
}
}
#line 180 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.c"
static Boolean matchhere(char const   *regexp , char const   *text ) 
{ 
  Boolean tmp ;
  Boolean tmp___0 ;
  Boolean tmp___1 ;
  Boolean tmp___2 ;
  Boolean tmp___3 ;
  Boolean tmp___4 ;
  int empty ;
  Boolean matches ;
  int match_count ;
  Boolean tmp___5 ;
  Boolean tmp___6 ;

  {
#line 183
  if ((int const   )*(regexp + 0) == 0) {
#line 183
    if ((int const   )*(text + 0) == 0) {
#line 184
      return ((Boolean )1);
    }
  }
#line 186
  if ((int const   )*(regexp + 0) == 42) {
    {
#line 187
    tmp = matchstar(regexp + 1, text);
    }
#line 187
    return (tmp);
  }
#line 189
  if ((int const   )*text != 0) {
    {
#line 191
    if ((int const   )*regexp == 63) {
#line 191
      goto case_63;
    }
#line 196
    if ((int const   )*regexp == 97) {
#line 196
      goto case_97;
    }
#line 196
    if ((int const   )*regexp == 65) {
#line 196
      goto case_97;
    }
#line 196
    if ((int const   )*regexp == 33) {
#line 196
      goto case_97;
    }
#line 201
    if ((int const   )*regexp == 91) {
#line 201
      goto case_91;
    }
#line 211
    if ((int const   )*regexp == 56) {
#line 211
      goto case_56;
    }
#line 211
    if ((int const   )*regexp == 55) {
#line 211
      goto case_56;
    }
#line 211
    if ((int const   )*regexp == 54) {
#line 211
      goto case_56;
    }
#line 211
    if ((int const   )*regexp == 53) {
#line 211
      goto case_56;
    }
#line 211
    if ((int const   )*regexp == 52) {
#line 211
      goto case_56;
    }
#line 211
    if ((int const   )*regexp == 51) {
#line 211
      goto case_56;
    }
#line 211
    if ((int const   )*regexp == 50) {
#line 211
      goto case_56;
    }
#line 211
    if ((int const   )*regexp == 49) {
#line 211
      goto case_56;
    }
#line 231
    goto switch_default;
    case_63: /* CIL Label */ 
    {
#line 192
    tmp___0 = matchhere(regexp + 1, text + 1);
    }
#line 192
    return (tmp___0);
#line 193
    goto switch_break;
    case_97: /* CIL Label */ 
    case_65: /* CIL Label */ 
    case_33: /* CIL Label */ 
    {
#line 197
    tmp___2 = matchone((char )*regexp, (char )*text);
    }
#line 197
    if (tmp___2) {
      {
#line 198
      tmp___1 = matchhere(regexp + 1, text + 1);
      }
#line 198
      return (tmp___1);
    }
#line 200
    goto switch_break;
    case_91: /* CIL Label */ 
#line 203
    if ((int const   )*(regexp + 1) == 94) {
      {
#line 204
      tmp___3 = matchnccl(regexp + 2, text);
      }
#line 204
      return (tmp___3);
    } else {
      {
#line 207
      tmp___4 = matchccl(regexp + 1, text);
      }
#line 207
      return (tmp___4);
    }
#line 209
    goto switch_break;
    case_56: /* CIL Label */ 
    case_55: /* CIL Label */ 
    case_54: /* CIL Label */ 
    case_53: /* CIL Label */ 
    case_52: /* CIL Label */ 
    case_51: /* CIL Label */ 
    case_50: /* CIL Label */ 
    case_49: /* CIL Label */ 
#line 214
    empty = (int )((int const   )*(regexp + 0) - 48);
#line 215
    matches = (Boolean )1;
#line 217
    match_count = 0;
    {
#line 218
    while (1) {
      while_continue: /* CIL Label */ ;
#line 218
      if (matches) {
#line 218
        if (! (match_count < empty)) {
#line 218
          goto while_break;
        }
      } else {
#line 218
        goto while_break;
      }
#line 219
      if ((int const   )*(text + match_count) == 95) {
#line 220
        match_count ++;
      } else {
#line 223
        matches = (Boolean )0;
      }
    }
    while_break: /* CIL Label */ ;
    }
#line 226
    if (matches) {
      {
#line 227
      tmp___5 = matchhere(regexp + 1, text + match_count);
      }
#line 227
      return (tmp___5);
    }
#line 230
    goto switch_break;
    switch_default: /* CIL Label */ 
#line 232
    if ((int const   )*regexp == (int const   )*text) {
      {
#line 233
      tmp___6 = matchhere(regexp + 1, text + 1);
      }
#line 233
      return (tmp___6);
    }
#line 235
    goto switch_break;
    switch_break: /* CIL Label */ ;
    }
  }
#line 239
  return ((Boolean )0);
}
}
#line 245 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.c"
static Boolean matchstar(char const   *regexp , char const   *text ) 
{ 
  char const   *t ;
  Boolean tmp ;
  char const   *tmp___0 ;

  {
#line 251
  t = text;
  {
#line 251
  while (1) {
    while_continue: /* CIL Label */ ;
#line 251
    if ((int const   )*t != 0) {
#line 251
      if (! ((int const   )*t != 47)) {
#line 251
        goto while_break;
      }
    } else {
#line 251
      goto while_break;
    }
#line 251
    t ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 255
  while (1) {
    while_continue___0: /* CIL Label */ ;
    {
#line 257
    tmp = matchhere(regexp, t);
    }
#line 257
    if (tmp) {
#line 258
      return ((Boolean )1);
    }
#line 255
    tmp___0 = t;
#line 255
    t --;
#line 255
    if (! ((unsigned long )tmp___0 > (unsigned long )text)) {
#line 255
      goto while_break___0;
    }
  }
  while_break___0: /* CIL Label */ ;
  }
#line 261
  return ((Boolean )0);
}
}
#line 267 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.c"
static Boolean matchone(char regchar , char textchar ) 
{ 


  {
#line 270
  if ((int )regchar == (int )textchar) {
#line 271
    return ((Boolean )1);
  } else {
    {
#line 275
    if ((int )regchar == 33) {
#line 275
      goto case_33;
    }
#line 277
    if ((int )regchar == 65) {
#line 277
      goto case_65;
    }
#line 290
    if ((int )regchar == 97) {
#line 290
      goto case_97;
    }
#line 303
    if ((int )regchar == 63) {
#line 303
      goto case_63;
    }
#line 305
    goto switch_default___1;
    case_33: /* CIL Label */ 
#line 276
    return ((Boolean )((int )textchar != 95));
    case_65: /* CIL Label */ 
    {
#line 285
    if ((int )textchar == 80) {
#line 285
      goto case_80;
    }
#line 285
    if ((int )textchar == 66) {
#line 285
      goto case_80;
    }
#line 285
    if ((int )textchar == 78) {
#line 285
      goto case_80;
    }
#line 285
    if ((int )textchar == 82) {
#line 285
      goto case_80;
    }
#line 285
    if ((int )textchar == 81) {
#line 285
      goto case_80;
    }
#line 285
    if ((int )textchar == 75) {
#line 285
      goto case_80;
    }
#line 287
    goto switch_default;
    case_80: /* CIL Label */ 
    case_66: /* CIL Label */ 
    case_78: /* CIL Label */ 
    case_82: /* CIL Label */ 
    case_81: /* CIL Label */ 
    case_75: /* CIL Label */ 
#line 286
    return ((Boolean )1);
    switch_default: /* CIL Label */ 
#line 288
    return ((Boolean )0);
    switch_break___0: /* CIL Label */ ;
    }
    case_97: /* CIL Label */ 
    {
#line 298
    if ((int )textchar == 112) {
#line 298
      goto case_112;
    }
#line 298
    if ((int )textchar == 98) {
#line 298
      goto case_112;
    }
#line 298
    if ((int )textchar == 110) {
#line 298
      goto case_112;
    }
#line 298
    if ((int )textchar == 114) {
#line 298
      goto case_112;
    }
#line 298
    if ((int )textchar == 113) {
#line 298
      goto case_112;
    }
#line 298
    if ((int )textchar == 107) {
#line 298
      goto case_112;
    }
#line 300
    goto switch_default___0;
    case_112: /* CIL Label */ 
    case_98: /* CIL Label */ 
    case_110: /* CIL Label */ 
    case_114: /* CIL Label */ 
    case_113: /* CIL Label */ 
    case_107: /* CIL Label */ 
#line 299
    return ((Boolean )1);
    switch_default___0: /* CIL Label */ 
#line 301
    return ((Boolean )0);
    switch_break___1: /* CIL Label */ ;
    }
    case_63: /* CIL Label */ 
#line 304
    return ((Boolean )1);
    switch_default___1: /* CIL Label */ 
#line 306
    return ((Boolean )0);
    switch_break: /* CIL Label */ ;
    }
  }
}
}
#line 314 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.c"
static Boolean matchccl(char const   *regexp , char const   *text ) 
{ 
  Boolean tmp ;
  Boolean tmp___0 ;
  Boolean tmp___1 ;

  {
  {
#line 317
  while (1) {
    while_continue: /* CIL Label */ ;
#line 317
    if ((int const   )*regexp != 93) {
      {
#line 317
      tmp = matchone((char )*regexp, (char )*text);
      }
#line 317
      if (tmp) {
#line 317
        goto while_break;
      } else
#line 317
      if (! ((int const   )*regexp != 0)) {
#line 317
        goto while_break;
      }
    } else {
#line 317
      goto while_break;
    }
#line 319
    regexp ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 321
  tmp___1 = matchone((char )*regexp, (char )*text);
  }
#line 321
  if (tmp___1) {
    {
#line 322
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 323
      regexp ++;
#line 322
      if ((int const   )*regexp != 93) {
#line 322
        if (! ((int const   )*regexp != 0)) {
#line 322
          goto while_break___0;
        }
      } else {
#line 322
        goto while_break___0;
      }
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 326
    tmp___0 = matchhere(regexp + 1, text + 1);
    }
#line 326
    return (tmp___0);
  } else {
#line 329
    return ((Boolean )0);
  }
}
}
#line 336 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.c"
static Boolean matchnccl(char const   *regexp , char const   *text ) 
{ 
  Boolean tmp ;
  Boolean tmp___0 ;

  {
  {
#line 339
  while (1) {
    while_continue: /* CIL Label */ ;
#line 339
    if ((int const   )*regexp != 93) {
      {
#line 339
      tmp = matchone((char )*regexp, (char )*text);
      }
#line 339
      if (tmp) {
#line 339
        goto while_break;
      } else
#line 339
      if (! ((int const   )*regexp != 0)) {
#line 339
        goto while_break;
      }
    } else {
#line 339
      goto while_break;
    }
#line 341
    regexp ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 343
  if ((int const   )*regexp == 93) {
    {
#line 344
    tmp___0 = matchhere(regexp + 1, text + 1);
    }
#line 344
    return (tmp___0);
  } else {
#line 347
    return ((Boolean )0);
  }
}
}
#line 353 "/home/wheatley/newnew/temp/pgn-extract-17.14/fenmatcher.c"
static char *convert_board_to_text(Board const   *board ) 
{ 
  Rank rank ;
  int ix ;
  char *text ;
  void *tmp ;
  Col col ;
  int coloured_piece ;
  int tmp___0 ;
  int tmp___1 ;

  {
  {
#line 356
  ix = 0;
#line 358
  tmp = MallocOrDie((size_t )72);
#line 358
  text = (char *)tmp;
#line 359
  rank = (Rank )56;
  }
  {
#line 359
  while (1) {
    while_continue: /* CIL Label */ ;
#line 359
    if (! ((int )rank >= 49)) {
#line 359
      goto while_break;
    }
#line 361
    col = (Col )'a';
    {
#line 361
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 361
      if (! ((int )col <= 104)) {
#line 361
        goto while_break___0;
      }
#line 362
      if (49 <= (int )rank) {
#line 362
        if ((int )rank <= 56) {
#line 362
          tmp___0 = ((int )rank - 49) + 2;
        } else {
#line 362
          tmp___0 = 0;
        }
      } else {
#line 362
        tmp___0 = 0;
      }
#line 362
      if (97 <= (int )col) {
#line 362
        if ((int )col <= 104) {
#line 362
          tmp___1 = ((int )col - 97) + 2;
        } else {
#line 362
          tmp___1 = 0;
        }
      } else {
#line 362
        tmp___1 = 0;
      }
#line 362
      coloured_piece = (int )board->board[tmp___0][tmp___1];
#line 364
      if (coloured_piece != 1) {
        {
#line 365
        *(text + ix) = coloured_piece_to_SAN_letter((Piece )coloured_piece);
        }
      } else {
#line 368
        *(text + ix) = (char )'_';
      }
#line 370
      ix ++;
#line 361
      col = (Col )((int )col + 1);
    }
    while_break___0: /* CIL Label */ ;
    }
#line 372
    if ((int )rank != 49) {
#line 373
      *(text + ix) = (char )'/';
#line 374
      ix ++;
    }
#line 359
    rank = (Rank )((int )rank - 1);
  }
  while_break: /* CIL Label */ ;
  }
#line 377
  *(text + ix) = (char )'\000';
#line 378
  return (text);
}
}
#line 564 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1), __leaf__)) getenv)(char const   *__name ) ;
#line 534 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,2), __leaf__)) strcasecmp)(char const   *__s1 ,
                                                                                                   char const   *__s2 )  __attribute__((__pure__)) ;
#line 65 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.h"
void read_args_file(char const   *infile ) ;
#line 60 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.c"
static char const   argument_prefix[3]  = {      (char const   )':',      (char const   )'-',      (char const   )'\000'};
#line 61 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.c"
static int const   argument_prefix_len  =    (int const   )(sizeof(argument_prefix) - 1UL);
#line 62
static ArgType classify_arg(char const   *line___1 ) ;
#line 65 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.c"
static int stringcompare(char const   *s1 , char const   *s2 ) 
{ 
  int tmp ;

  {
  {
#line 69
  tmp = strcasecmp(s1, s2);
  }
#line 69
  return (tmp);
}
}
#line 95 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.c"
static char const   *skip_leading_spaces(char const   *str ) 
{ 


  {
  {
#line 97
  while (1) {
    while_continue: /* CIL Label */ ;
#line 97
    if (! ((int const   )*str == 32)) {
#line 97
      goto while_break;
    }
#line 98
    str ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 100
  return (str);
}
}
#line 104 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.c"
static void usage_and_exit(void) 
{ 
  char const   *help_data[87] ;
  char const   **data ;

  {
  {
#line 107
  help_data[0] = "-7 -- output only the seven tag roster for each game. Other tags (apart";
#line 107
  help_data[1] = "      from FEN and possibly ECO) are discarded (See -e).";
#line 107
  help_data[2] = "-#num -- output num games per file, to files named 1.pgn, 2.pgn, etc.";
#line 107
  help_data[3] = "";
#line 107
  help_data[4] = "-aoutputfile -- append extracted games to outputfile. (See -o).";
#line 107
  help_data[5] = "-Aargsfile -- read the program\'s arguments from argsfile.";
#line 107
  help_data[6] = "-b[elu]num -- restricted bounds on the number of moves in a game.";
#line 107
  help_data[7] = "       lnum set a lower bound of `num\' moves,";
#line 107
  help_data[8] = "       unum set an upper bound of `num\' moves,";
#line 107
  help_data[9] = "       otherwise num (or enum) means equal-to `num\' moves.";
#line 107
  help_data[10] = "-cfile[.pgn] -- Use file.pgn as a check-file for duplicates or";
#line 107
  help_data[11] = "      contents of file (no pgn suffix) as a list of check-file names.";
#line 107
  help_data[12] = "-C -- don\'t include comments in the output. Ordinarily these are retained.";
#line 107
  help_data[13] = "-dduplicates -- write duplicate games to the file duplicates.";
#line 107
  help_data[14] = "-D -- don\'t output duplicate games.";
#line 107
  help_data[15] = "-eECO_file -- perform ECO classification of games. The optional";
#line 107
  help_data[16] = "      ECO_file should contain a PGN format list of ECO lines";
#line 107
  help_data[17] = "      Default is to use eco.pgn from the current directory.";
#line 107
  help_data[18] = "-E[123 etc.] -- split output into separate files according to ECO.";
#line 107
  help_data[19] = "      E1 : Produce files from ECO letter, A.pgn, B.pgn, ...";
#line 107
  help_data[20] = "      E2 : Produce files from ECO letter and first digit, A0.pgn, ...";
#line 107
  help_data[21] = "      E3 : Produce files from full ECO code, A00.pgn, A01.pgn, ...";
#line 107
  help_data[22] = "      Further digits may be used to produce non-standard further";
#line 107
  help_data[23] = "      refined division of games.";
#line 107
  help_data[24] = "      All files are opened in append mode.";
#line 107
  help_data[25] = "-F -- output a FEN string comment of the final game position.";
#line 107
  help_data[26] = "-ffile_list  -- file_list contains the list of PGN source files, one per line.";
#line 107
  help_data[27] = "-h -- print details of the arguments.";
#line 107
  help_data[28] = "-llogfile  -- Save the diagnostics in logfile rather than using stderr.";
#line 107
  help_data[29] = "-Llogfile  -- Append all diagnostics to logfile, rather than overwriting.";
#line 107
  help_data[30] = "-M -- Match only games which end in checkmate.";
#line 107
  help_data[31] = "-noutputfile -- Write all valid games not otherwise output to outputfile.";
#line 107
  help_data[32] = "-N -- don\'t include NAGs in the output. Ordinarily these are retained.";
#line 107
  help_data[33] = "-ooutputfile -- write extracted games to outputfile (existing contents lost).";
#line 107
  help_data[34] = "-P -- don\'t match permutations of the textual variations (-v).";
#line 107
  help_data[35] = "-Rtagorder -- Use the tag ordering specified in the file tagorder.";
#line 107
  help_data[36] = "-r -- report any errors but don\'t extract.";
#line 107
  help_data[37] = "-S -- Use a simple soundex algorithm for some tag matches. If used";
#line 107
  help_data[38] = "      this option must precede the -t or -T options.";
#line 107
  help_data[39] = "-s -- silent mode: don\'t report each game as it is extracted.";
#line 107
  help_data[40] = "-ttagfile -- file of player, date, result or FEN extraction criteria.";
#line 107
  help_data[41] = "-Tcriterion -- player, date, or result extraction criterion.";
#line 107
  help_data[42] = "-U -- don\'t output games that only occur once. (See -d).";
#line 107
  help_data[43] = "-vvariations -- the file variations contains the textual lines of interest.";
#line 107
  help_data[44] = "-V -- don\'t include variations in the output. Ordinarily these are retained.";
#line 107
  help_data[45] = "-wwidth -- set width as an approximate line width for output.";
#line 107
  help_data[46] = "-W[cm|epd|halg|lalg|elalg|san] -- specify the output format to use.";
#line 107
  help_data[47] = "      Default is SAN.";
#line 107
  help_data[48] = "      -W means use the input format.";
#line 107
  help_data[49] = "      -Wcm is (a possibly obsolete) ChessMaster format.";
#line 107
  help_data[50] = "      -Wepd is EPD format.";
#line 107
  help_data[51] = "      -Wsan[PNBRQK] for language specific output.";
#line 107
  help_data[52] = "      -Whalg is hyphenated long algebraic.";
#line 107
  help_data[53] = "      -Wlalg is long algebraic.";
#line 107
  help_data[54] = "      -Welalg is enhanced long algebraic.";
#line 107
  help_data[55] = "      -Wuci is output compatible with the UCI protocol.";
#line 107
  help_data[56] = "-xvariations -- the file variations contains the lines resulting in";
#line 107
  help_data[57] = "                positions of interest.";
#line 107
  help_data[58] = "-zendings -- the file endings contains the end positions of interest.";
#line 107
  help_data[59] = "-Z -- use the file virtual.tmp as an external hash table for duplicates.";
#line 107
  help_data[60] = "      Use when MallocOrDie messages occur with big datasets.";
#line 107
  help_data[61] = "";
#line 107
  help_data[62] = "--append - see -a";
#line 107
  help_data[63] = "--checkfile - see -c";
#line 107
  help_data[64] = "--checkmate - see -M";
#line 107
  help_data[65] = "--duplicates - see -d";
#line 107
  help_data[66] = "--evaluation - include a position evaluation after each move";
#line 107
  help_data[67] = "--fencomments - include a FEN string after each move";
#line 107
  help_data[68] = "--fuzzydepth plies - positional duplicates match";
#line 107
  help_data[69] = "--help - see -h";
#line 107
  help_data[70] = "--linelength - see -w";
#line 107
  help_data[71] = "--markmatches - mark positional and material matches with a comment; see -t, -v, and -z";
#line 107
  help_data[72] = "--nochecks - don\'t output + and # after moves.";
#line 107
  help_data[73] = "--nocomments - see -C";
#line 107
  help_data[74] = "--noduplicates - see -D";
#line 107
  help_data[75] = "--nomovenumbers - don\'t output move numbers.";
#line 107
  help_data[76] = "--nonags - see -N";
#line 107
  help_data[77] = "--noresults - don\'t output results.";
#line 107
  help_data[78] = "--notags - don\'t output any tags.";
#line 107
  help_data[79] = "--nounique - see -U";
#line 107
  help_data[80] = "--novars - see -V";
#line 107
  help_data[81] = "--output - see -o";
#line 107
  help_data[82] = "--plylimit - limit the number of plies output.";
#line 107
  help_data[83] = "--seven - see -7";
#line 107
  help_data[84] = "--stalemate - only output games that end in stalemate.";
#line 107
  help_data[85] = "--version - print the current version number and exit.";
#line 107
  help_data[86] = (char const   *)((char *)((void *)0));
#line 203
  data = help_data;
#line 205
  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"pgn-extract %s (%s): a Portable Game Notation (PGN) manipulator.\n",
          "v17-14", "Mar  4 2016");
#line 208
  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Copyright (C) 1994-2013 David J. Barnes (d.j.barnes@kent.ac.uk)\n");
#line 210
  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"%s\n\n",
          "http://www.cs.kent.ac.uk/people/staff/djb/pgn-extract/");
#line 211
  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: pgn-extract [arguments] [file.pgn ...]\n");
  }
  {
#line 213
  while (1) {
    while_continue: /* CIL Label */ ;
#line 213
    if (! ((unsigned long )*data != (unsigned long )((void *)0))) {
#line 213
      goto while_break;
    }
    {
#line 214
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"%s\n",
            *data);
#line 213
    data ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 216
  exit(1);
  }
}
}
#line 219 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.c"
void read_args_file(char const   *infile ) 
{ 
  char *line___1 ;
  FILE *fp ;
  FILE *tmp ;
  ArgType linetype ;
  ArgType nexttype ;
  Boolean tmp___0 ;
  char *arg ;
  char *space ;
  char *tmp___1 ;
  int arglen ;
  char *just_arg ;
  void *tmp___2 ;
  char const   *tmp___3 ;

  {
  {
#line 222
  tmp = fopen((char const   */* __restrict  */)infile, (char const   */* __restrict  */)"r");
#line 222
  fp = tmp;
  }
#line 224
  if ((unsigned long )fp == (unsigned long )((void *)0)) {
    {
#line 225
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Cannot open %s for reading.\n",
            infile);
#line 226
    exit(1);
    }
  } else {
#line 229
    linetype = (ArgType )0;
    {
#line 231
    while (1) {
      while_continue: /* CIL Label */ ;
      {
#line 231
      line___1 = read_line(fp);
      }
#line 231
      if (! ((unsigned long )line___1 != (unsigned long )((void *)0))) {
#line 231
        goto while_break;
      }
      {
#line 232
      tmp___0 = blank_line((char const   *)line___1);
      }
#line 232
      if (tmp___0) {
        {
#line 233
        free((void *)line___1);
        }
#line 234
        goto while_continue;
      }
      {
#line 236
      nexttype = classify_arg((char const   *)line___1);
      }
#line 237
      if ((unsigned int )nexttype == 0U) {
#line 238
        if ((int )*line___1 == (int )argument_prefix[0]) {
          {
#line 240
          add_filename_to_source_list((char const   *)(line___1 + 1), (SourceFileType )0);
          }
        } else
#line 242
        if ((unsigned int )linetype != 0U) {
          {
#line 245
          if ((unsigned int )linetype == 118U) {
#line 245
            goto case_118;
          }
#line 248
          if ((unsigned int )linetype == 120U) {
#line 248
            goto case_120;
          }
#line 251
          if ((unsigned int )linetype == 116U) {
#line 251
            goto case_116;
          }
#line 254
          if ((unsigned int )linetype == 82U) {
#line 254
            goto case_82;
          }
#line 257
          if ((unsigned int )linetype == 122U) {
#line 257
            goto case_122;
          }
#line 261
          goto switch_default;
          case_118: /* CIL Label */ 
          {
#line 246
          add_textual_variation_from_line(line___1);
          }
#line 247
          goto switch_break;
          case_120: /* CIL Label */ 
          {
#line 249
          add_positional_variation_from_line(line___1);
          }
#line 250
          goto switch_break;
          case_116: /* CIL Label */ 
          {
#line 252
          process_tag_line(infile, line___1);
          }
#line 253
          goto switch_break;
          case_82: /* CIL Label */ 
          {
#line 255
          process_roster_line(line___1);
          }
#line 256
          goto switch_break;
          case_122: /* CIL Label */ 
          {
#line 258
          process_ending_line((char const   *)line___1);
#line 259
          free((void *)line___1);
          }
#line 260
          goto switch_break;
          switch_default: /* CIL Label */ 
          {
#line 262
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Internal error: unknown linetype %d in read_args_file\n",
                  (unsigned int )linetype);
#line 265
          free((void *)line___1);
#line 266
          exit(-1);
          }
          switch_break: /* CIL Label */ ;
          }
        } else {
          {
#line 273
          fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Missing argument type for line %s in the argument file.\n",
                  line___1);
#line 276
          exit(1);
          }
        }
      } else {
        {
#line 301
        if ((unsigned int )nexttype == 87U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 119U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 84U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 110U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 65U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 69U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 35U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 98U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 102U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 99U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 101U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 100U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 76U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 108U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 97U) {
#line 301
          goto case_87;
        }
#line 301
        if ((unsigned int )nexttype == 111U) {
#line 301
          goto case_87;
        }
#line 306
        if ((unsigned int )nexttype == 45U) {
#line 306
          goto case_45;
        }
#line 345
        if ((unsigned int )nexttype == 90U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 86U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 85U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 77U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 83U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 115U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 114U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 70U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 78U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 80U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 68U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 67U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 63U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 104U) {
#line 345
          goto case_90;
        }
#line 345
        if ((unsigned int )nexttype == 55U) {
#line 345
          goto case_90;
        }
#line 357
        if ((unsigned int )nexttype == 82U) {
#line 357
          goto case_82___0;
        }
#line 357
        if ((unsigned int )nexttype == 116U) {
#line 357
          goto case_82___0;
        }
#line 357
        if ((unsigned int )nexttype == 122U) {
#line 357
          goto case_82___0;
        }
#line 357
        if ((unsigned int )nexttype == 120U) {
#line 357
          goto case_82___0;
        }
#line 357
        if ((unsigned int )nexttype == 118U) {
#line 357
          goto case_82___0;
        }
#line 363
        goto switch_default___0;
        case_87: /* CIL Label */ 
        case_119: /* CIL Label */ 
        case_84: /* CIL Label */ 
        case_110: /* CIL Label */ 
        case_65: /* CIL Label */ 
        case_69: /* CIL Label */ 
        case_35: /* CIL Label */ 
        case_98: /* CIL Label */ 
        case_102: /* CIL Label */ 
        case_99: /* CIL Label */ 
        case_101: /* CIL Label */ 
        case_100: /* CIL Label */ 
        case_76: /* CIL Label */ 
        case_108: /* CIL Label */ 
        case_97: /* CIL Label */ 
        case_111: /* CIL Label */ 
        {
#line 302
        process_argument(*(line___1 + argument_prefix_len), (char const   *)(line___1 + (argument_prefix_len + 1)));
#line 304
        linetype = (ArgType )0;
        }
#line 305
        goto switch_break___0;
        case_45: /* CIL Label */ 
        {
#line 308
        arg = line___1 + (argument_prefix_len + 1);
#line 309
        tmp___1 = strchr((char const   *)arg, ' ');
#line 309
        space = tmp___1;
        }
#line 310
        if ((unsigned long )space != (unsigned long )((void *)0)) {
          {
#line 312
          arglen = (int )(space - arg);
#line 313
          tmp___2 = MallocOrDie((size_t )(arglen + 1));
#line 313
          just_arg = (char *)tmp___2;
#line 314
          strncpy((char */* __restrict  */)just_arg, (char const   */* __restrict  */)arg,
                  (size_t )arglen);
#line 315
          *(just_arg + arglen) = (char )'\000';
#line 316
          tmp___3 = skip_leading_spaces((char const   *)space);
#line 316
          process_long_form_argument((char const   *)just_arg, tmp___3);
          }
        } else {
          {
#line 320
          process_long_form_argument((char const   *)arg, "");
#line 321
          linetype = (ArgType )0;
          }
        }
#line 324
        goto switch_break___0;
        case_90: /* CIL Label */ 
        case_86: /* CIL Label */ 
        case_85: /* CIL Label */ 
        case_77: /* CIL Label */ 
        case_83: /* CIL Label */ 
        case_115: /* CIL Label */ 
        case_114: /* CIL Label */ 
        case_70: /* CIL Label */ 
        case_78: /* CIL Label */ 
        case_80: /* CIL Label */ 
        case_68: /* CIL Label */ 
        case_67: /* CIL Label */ 
        case_63: /* CIL Label */ 
        case_104: /* CIL Label */ 
        case_55: /* CIL Label */ 
        {
#line 346
        process_argument(*(line___1 + argument_prefix_len), "");
#line 347
        linetype = (ArgType )0;
        }
#line 348
        goto switch_break___0;
        case_82___0: /* CIL Label */ 
        case_116___0: /* CIL Label */ 
        case_122___0: /* CIL Label */ 
        case_120___0: /* CIL Label */ 
        case_118___0: /* CIL Label */ 
        {
#line 358
        process_argument(*(line___1 + argument_prefix_len), (char const   *)(line___1 + (argument_prefix_len + 1)));
#line 361
        linetype = nexttype;
        }
#line 362
        goto switch_break___0;
        switch_default___0: /* CIL Label */ 
#line 364
        linetype = nexttype;
#line 365
        goto switch_break___0;
        switch_break___0: /* CIL Label */ ;
        }
        {
#line 367
        free((void *)line___1);
        }
      }
    }
    while_break: /* CIL Label */ ;
    }
    {
#line 370
    fclose(fp);
    }
  }
#line 372
  return;
}
}
#line 385 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.c"
static unsigned long const   min_argument_length  =    (size_t const   )((1UL + sizeof(argument_prefix)) - 1UL);
#line 379 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.c"
static ArgType classify_arg(char const   *line___1 ) 
{ 
  size_t line_length___0 ;
  size_t tmp ;
  char argument_letter ;
  int tmp___0 ;

  {
  {
#line 386
  tmp = strlen(line___1);
#line 386
  line_length___0 = tmp;
#line 391
  tmp___0 = strncmp(line___1, argument_prefix, (size_t )argument_prefix_len);
  }
#line 391
  if (tmp___0 == 0) {
#line 391
    if (line_length___0 >= (size_t )min_argument_length) {
#line 393
      argument_letter = (char )*(line___1 + argument_prefix_len);
      {
#line 430
      if ((int )argument_letter == 45) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 82) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 63) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 104) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 69) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 35) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 98) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 102) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 99) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 101) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 100) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 97) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 76) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 108) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 111) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 86) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 85) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 77) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 83) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 115) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 114) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 70) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 80) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 78) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 68) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 67) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 110) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 65) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 55) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 87) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 119) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 84) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 122) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 120) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 118) {
#line 430
        goto case_45;
      }
#line 430
      if ((int )argument_letter == 116) {
#line 430
        goto case_45;
      }
#line 432
      goto switch_default;
      case_45: /* CIL Label */ 
      case_82: /* CIL Label */ 
      case_63: /* CIL Label */ 
      case_104: /* CIL Label */ 
      case_69: /* CIL Label */ 
      case_35: /* CIL Label */ 
      case_98: /* CIL Label */ 
      case_102: /* CIL Label */ 
      case_99: /* CIL Label */ 
      case_101: /* CIL Label */ 
      case_100: /* CIL Label */ 
      case_97: /* CIL Label */ 
      case_76: /* CIL Label */ 
      case_108: /* CIL Label */ 
      case_111: /* CIL Label */ 
      case_86: /* CIL Label */ 
      case_85: /* CIL Label */ 
      case_77: /* CIL Label */ 
      case_83: /* CIL Label */ 
      case_115: /* CIL Label */ 
      case_114: /* CIL Label */ 
      case_70: /* CIL Label */ 
      case_80: /* CIL Label */ 
      case_78: /* CIL Label */ 
      case_68: /* CIL Label */ 
      case_67: /* CIL Label */ 
      case_110: /* CIL Label */ 
      case_65: /* CIL Label */ 
      case_55: /* CIL Label */ 
      case_87: /* CIL Label */ 
      case_119: /* CIL Label */ 
      case_84: /* CIL Label */ 
      case_122: /* CIL Label */ 
      case_120: /* CIL Label */ 
      case_118: /* CIL Label */ 
      case_116: /* CIL Label */ 
#line 431
      return ((ArgType )argument_letter);
      switch_default: /* CIL Label */ 
      {
#line 433
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unrecognized argument: %s in the argument file.\n",
              line___1);
#line 436
      exit(1);
      }
#line 437
      return ((ArgType )0);
      switch_break: /* CIL Label */ ;
      }
    } else {
#line 441
      return ((ArgType )0);
    }
  } else {
#line 441
    return ((ArgType )0);
  }
}
}
#line 456 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.c"
void process_argument(char arg_letter , char const   *associated_value ) 
{ 
  char const   *filename___0 ;
  char const   *tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  unsigned int level ;
  int tmp___2 ;
  size_t len ;
  size_t tmp___3 ;
  char const   *suffix___0 ;
  char const   *tmp___4 ;
  FILE *fp ;
  FILE *tmp___5 ;
  size_t tmp___6 ;
  size_t tmp___7 ;
  int tmp___8 ;
  FILE *fp___0 ;
  FILE *tmp___9 ;
  char which ;
  unsigned int value ;
  Boolean Ok ;
  char const   *bound ;
  unsigned short const   **tmp___10 ;
  int tmp___11 ;
  int tmp___12 ;
  unsigned int length ;
  int tmp___13 ;
  OutputFormat format ;
  OutputFormat tmp___14 ;
  FILE *variation_file ;
  FILE *tmp___15 ;
  FILE *variation_file___0 ;
  FILE *tmp___16 ;
  Boolean tmp___17 ;

  {
  {
#line 461
  tmp = skip_leading_spaces(associated_value);
#line 461
  filename___0 = tmp;
  }
  {
#line 465
  if ((int )arg_letter == 97) {
#line 465
    goto case_97;
  }
#line 465
  if ((int )arg_letter == 111) {
#line 465
    goto case_97;
  }
#line 498
  if ((int )arg_letter == 76) {
#line 498
    goto case_76;
  }
#line 498
  if ((int )arg_letter == 108) {
#line 498
    goto case_76;
  }
#line 514
  if ((int )arg_letter == 100) {
#line 514
    goto case_100;
  }
#line 529
  if ((int )arg_letter == 101) {
#line 529
    goto case_101;
  }
#line 542
  if ((int )arg_letter == 69) {
#line 542
    goto case_69;
  }
#line 575
  if ((int )arg_letter == 99) {
#line 575
    goto case_99;
  }
#line 596
  if ((int )arg_letter == 102) {
#line 596
    goto case_102;
  }
#line 607
  if ((int )arg_letter == 98) {
#line 607
    goto case_98;
  }
#line 678
  if ((int )arg_letter == 35) {
#line 678
    goto case_35;
  }
#line 702
  if ((int )arg_letter == 65) {
#line 702
    goto case_65;
  }
#line 712
  if ((int )arg_letter == 110) {
#line 712
    goto case_110;
  }
#line 724
  if ((int )arg_letter == 84) {
#line 724
    goto case_84;
  }
#line 728
  if ((int )arg_letter == 119) {
#line 728
    goto case_119;
  }
#line 743
  if ((int )arg_letter == 104) {
#line 743
    goto case_104;
  }
#line 746
  if ((int )arg_letter == 87) {
#line 746
    goto case_87;
  }
#line 769
  if ((int )arg_letter == 55) {
#line 769
    goto case_55;
  }
#line 781
  if ((int )arg_letter == 67) {
#line 781
    goto case_67;
  }
#line 784
  if ((int )arg_letter == 68) {
#line 784
    goto case_68;
  }
#line 797
  if ((int )arg_letter == 80) {
#line 797
    goto case_80;
  }
#line 800
  if ((int )arg_letter == 78) {
#line 800
    goto case_78;
  }
#line 803
  if ((int )arg_letter == 70) {
#line 803
    goto case_70;
  }
#line 815
  if ((int )arg_letter == 114) {
#line 815
    goto case_114;
  }
#line 819
  if ((int )arg_letter == 115) {
#line 819
    goto case_115;
  }
#line 823
  if ((int )arg_letter == 83) {
#line 823
    goto case_83;
  }
#line 827
  if ((int )arg_letter == 77) {
#line 827
    goto case_77;
  }
#line 831
  if ((int )arg_letter == 85) {
#line 831
    goto case_85;
  }
#line 834
  if ((int )arg_letter == 86) {
#line 834
    goto case_86;
  }
#line 837
  if ((int )arg_letter == 90) {
#line 837
    goto case_90;
  }
#line 841
  if ((int )arg_letter == 116) {
#line 841
    goto case_116;
  }
#line 846
  if ((int )arg_letter == 82) {
#line 846
    goto case_82;
  }
#line 851
  if ((int )arg_letter == 118) {
#line 851
    goto case_118;
  }
#line 860
  if ((int )arg_letter == 120) {
#line 860
    goto case_120;
  }
#line 868
  if ((int )arg_letter == 122) {
#line 868
    goto case_122;
  }
#line 875
  goto switch_default___0;
  case_97: /* CIL Label */ 
  case_111: /* CIL Label */ 
#line 466
  if ((unsigned int )GlobalState.ECO_level > 0U) {
    {
#line 467
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c conflicts with -E\n",
            (int )arg_letter);
    }
  } else
#line 470
  if (GlobalState.games_per_file > 0U) {
    {
#line 471
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c conflicts with -#\n",
            (int )arg_letter);
    }
  } else
#line 474
  if ((unsigned long )GlobalState.output_filename != (unsigned long )((void *)0)) {
    {
#line 475
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c: File %s has already been selected for output.\n",
            (int )arg_letter, GlobalState.output_filename);
#line 478
    exit(1);
    }
  } else
#line 480
  if ((int const   )*filename___0 == 0) {
    {
#line 481
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: -%cfilename.\n",
            (int )arg_letter);
#line 482
    exit(1);
    }
  } else {
#line 485
    if ((unsigned long )GlobalState.outputfile != (unsigned long )((void *)0)) {
      {
#line 486
      fclose(GlobalState.outputfile);
      }
    }
#line 488
    if ((int )arg_letter == 111) {
      {
#line 489
      GlobalState.outputfile = MustOpen(filename___0, "w");
      }
    } else {
      {
#line 492
      GlobalState.outputfile = MustOpen(filename___0, "a");
      }
    }
#line 494
    GlobalState.output_filename = filename___0;
  }
#line 496
  goto switch_break;
  case_76: /* CIL Label */ 
  case_108: /* CIL Label */ 
#line 500
  if ((unsigned long )GlobalState.logfile != (unsigned long )stderr) {
#line 500
    if ((unsigned long )GlobalState.logfile != (unsigned long )((void *)0)) {
      {
#line 501
      fclose(GlobalState.logfile);
      }
    }
  }
#line 503
  if ((int )arg_letter == 108) {
    {
#line 504
    GlobalState.logfile = fopen((char const   */* __restrict  */)filename___0, (char const   */* __restrict  */)"w");
    }
  } else {
    {
#line 507
    GlobalState.logfile = fopen((char const   */* __restrict  */)filename___0, (char const   */* __restrict  */)"a");
    }
  }
#line 509
  if ((unsigned long )GlobalState.logfile == (unsigned long )((void *)0)) {
    {
#line 510
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"Unable to open %s for writing.\n",
            filename___0);
#line 511
    GlobalState.logfile = stderr;
    }
  }
#line 513
  goto switch_break;
  case_100: /* CIL Label */ 
#line 515
  if ((int const   )*filename___0 == 0) {
    {
#line 516
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: -%cfilename.\n",
            (int )arg_letter);
#line 517
    exit(1);
    }
  } else
#line 519
  if (GlobalState.suppress_duplicates) {
    {
#line 520
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c clashes with the -%c flag.\n",
            (int )arg_letter, 68);
#line 523
    exit(1);
    }
  } else {
    {
#line 526
    GlobalState.duplicate_file = MustOpen(filename___0, "w");
    }
  }
#line 528
  goto switch_break;
  case_101: /* CIL Label */ 
#line 530
  GlobalState.add_ECO = (Boolean )1;
#line 531
  if ((int const   )*filename___0 != 0) {
    {
#line 532
    tmp___0 = StringCopy(filename___0);
#line 532
    GlobalState.eco_file = (char const   *)tmp___0;
    }
  } else {
    {
#line 534
    tmp___1 = getenv("ECO_FILE");
#line 534
    filename___0 = (char const   *)tmp___1;
    }
#line 534
    if ((unsigned long )filename___0 != (unsigned long )((void *)0)) {
#line 535
      GlobalState.eco_file = filename___0;
    }
  }
  {
#line 540
  initEcoTable();
  }
#line 541
  goto switch_break;
  case_69: /* CIL Label */ 
#line 545
  if ((unsigned long )GlobalState.output_filename != (unsigned long )((void *)0)) {
    {
#line 546
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c: File %s has already been selected for output.\n",
            (int )arg_letter, GlobalState.output_filename);
#line 550
    exit(1);
    }
  } else
#line 552
  if (GlobalState.games_per_file > 0U) {
    {
#line 553
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c conflicts with -#.\n",
            (int )arg_letter);
#line 556
    exit(1);
    }
  } else {
    {
#line 558
    tmp___2 = sscanf((char const   */* __restrict  */)associated_value, (char const   */* __restrict  */)"%u",
                     & level);
    }
#line 558
    if (tmp___2 != 1) {
      {
#line 559
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c requires a number attached, e.g., -%c1.\n",
              (int )arg_letter, (int )arg_letter);
#line 562
      exit(1);
      }
    } else
#line 564
    if (level < 1U) {
      {
#line 565
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c level should be between %u and %u.\n",
              1, 10, (int )arg_letter);
#line 568
      exit(1);
      }
    } else
#line 564
    if (level > 10U) {
      {
#line 565
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c level should be between %u and %u.\n",
              1, 10, (int )arg_letter);
#line 568
      exit(1);
      }
    } else {
#line 571
      GlobalState.ECO_level = (EcoDivision )level;
    }
  }
#line 574
  goto switch_break;
  case_99: /* CIL Label */ 
#line 576
  if ((int const   )*filename___0 != 0) {
    {
#line 580
    tmp___3 = strlen(filename___0);
#line 580
    len = tmp___3;
#line 582
    tmp___4 = output_file_suffix((OutputFormat )1);
#line 582
    suffix___0 = tmp___4;
#line 584
    tmp___6 = strlen(suffix___0);
    }
#line 584
    if (len > tmp___6) {
      {
#line 584
      tmp___7 = strlen(suffix___0);
#line 584
      tmp___8 = stringcompare(filename___0 + (len - tmp___7), suffix___0);
      }
#line 584
      if (tmp___8 == 0) {
        {
#line 587
        add_filename_to_source_list(filename___0, (SourceFileType )1);
        }
      } else {
        {
#line 590
        tmp___5 = MustOpen(filename___0, "r");
#line 590
        fp = tmp___5;
#line 591
        add_filename_list_from_file(fp, (SourceFileType )1);
#line 592
        fclose(fp);
        }
      }
    } else {
      {
#line 590
      tmp___5 = MustOpen(filename___0, "r");
#line 590
      fp = tmp___5;
#line 591
      add_filename_list_from_file(fp, (SourceFileType )1);
#line 592
      fclose(fp);
      }
    }
  }
#line 595
  goto switch_break;
  case_102: /* CIL Label */ 
#line 597
  if ((int const   )*filename___0 != 0) {
    {
#line 598
    tmp___9 = MustOpen(filename___0, "r");
#line 598
    fp___0 = tmp___9;
#line 599
    add_filename_list_from_file(fp___0, (SourceFileType )0);
#line 600
    fclose(fp___0);
    }
  } else {
    {
#line 603
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Filename expected with -%c\n",
            (int )arg_letter);
    }
  }
#line 606
  goto switch_break;
  case_98: /* CIL Label */ 
#line 615
  which = (char )'e';
#line 617
  Ok = (Boolean )1;
#line 618
  bound = associated_value;
  {
#line 623
  if ((int const   )*bound == 101) {
#line 623
    goto case_101___0;
  }
#line 623
  if ((int const   )*bound == 117) {
#line 623
    goto case_101___0;
  }
#line 623
  if ((int const   )*bound == 108) {
#line 623
    goto case_101___0;
  }
#line 627
  goto switch_default;
  case_101___0: /* CIL Label */ 
  case_117: /* CIL Label */ 
  case_108___0: /* CIL Label */ 
#line 624
  which = (char )*bound;
#line 625
  bound ++;
#line 626
  goto switch_break___0;
  switch_default: /* CIL Label */ 
  {
#line 628
  tmp___10 = __ctype_b_loc();
  }
#line 628
  if (! ((int const   )*(*tmp___10 + (int )*bound) & 2048)) {
    {
#line 629
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c must be followed by e, l, or u.\n",
            (int )arg_letter);
#line 632
    Ok = (Boolean )0;
    }
  }
#line 634
  goto switch_break___0;
  switch_break___0: /* CIL Label */ ;
  }
#line 636
  if (Ok) {
    {
#line 636
    tmp___11 = sscanf((char const   */* __restrict  */)bound, (char const   */* __restrict  */)"%u",
                      & value);
    }
#line 636
    if (tmp___11 == 1) {
#line 637
      GlobalState.check_move_bounds = (Boolean )1;
      {
#line 639
      if ((int )which == 101) {
#line 639
        goto case_101___1;
      }
#line 643
      if ((int )which == 108) {
#line 643
        goto case_108___1;
      }
#line 654
      if ((int )which == 117) {
#line 654
        goto case_117___0;
      }
#line 638
      goto switch_break___1;
      case_101___1: /* CIL Label */ 
#line 640
      GlobalState.lower_move_bound = value;
#line 641
      GlobalState.upper_move_bound = value;
#line 642
      goto switch_break___1;
      case_108___1: /* CIL Label */ 
#line 644
      if (value <= GlobalState.upper_move_bound) {
#line 645
        GlobalState.lower_move_bound = value;
      } else {
        {
#line 648
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Lower bound is greater than the upper bound; -%c ignored.\n",
                (int )arg_letter);
#line 651
        Ok = (Boolean )0;
        }
      }
#line 653
      goto switch_break___1;
      case_117___0: /* CIL Label */ 
#line 655
      if (value >= GlobalState.lower_move_bound) {
#line 656
        GlobalState.upper_move_bound = value;
      } else {
        {
#line 659
        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Upper bound is smaller than the lower bound; -%c ignored.\n",
                (int )arg_letter);
#line 662
        Ok = (Boolean )0;
        }
      }
#line 664
      goto switch_break___1;
      switch_break___1: /* CIL Label */ ;
      }
    } else {
      {
#line 668
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c should be in the form -%c[elu]number.\n",
              (int )arg_letter, (int )arg_letter);
#line 671
      Ok = (Boolean )0;
      }
    }
  } else {
    {
#line 668
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c should be in the form -%c[elu]number.\n",
            (int )arg_letter, (int )arg_letter);
#line 671
    Ok = (Boolean )0;
    }
  }
#line 673
  if (! Ok) {
    {
#line 674
    exit(1);
    }
  }
#line 677
  goto switch_break;
  case_35: /* CIL Label */ 
#line 679
  if ((unsigned int )GlobalState.ECO_level > 0U) {
    {
#line 680
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c conflicts with -E.\n",
            (int )arg_letter);
#line 682
    exit(1);
    }
  } else
#line 684
  if ((unsigned long )GlobalState.output_filename != (unsigned long )((void *)0)) {
    {
#line 685
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c: File %s has already been selected for output.\n",
            (int )arg_letter, GlobalState.output_filename);
#line 689
    exit(1);
    }
  } else {
    {
#line 691
    tmp___12 = sscanf((char const   */* __restrict  */)associated_value, (char const   */* __restrict  */)"%u",
                      & GlobalState.games_per_file);
    }
#line 691
    if (tmp___12 != 1) {
      {
#line 693
      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c should be followed by an unsigned integer.\n",
              (int )arg_letter);
#line 696
      exit(1);
      }
    }
  }
#line 701
  goto switch_break;
  case_65: /* CIL Label */ 
#line 703
  if ((int const   )*filename___0 != 0) {
    {
#line 705
    read_args_file(filename___0);
    }
  } else {
    {
#line 708
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: -%cfilename.\n",
            (int )arg_letter);
    }
  }
#line 711
  goto switch_break;
  case_110: /* CIL Label */ 
#line 713
  if ((int const   )*filename___0 != 0) {
#line 714
    if ((unsigned long )GlobalState.non_matching_file != (unsigned long )((void *)0)) {
      {
#line 715
      fclose(GlobalState.non_matching_file);
      }
    }
    {
#line 717
    GlobalState.non_matching_file = MustOpen(filename___0, "w");
    }
  } else {
    {
#line 720
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Usage: -%cfilename.\n",
            (int )arg_letter);
#line 721
    exit(1);
    }
  }
#line 723
  goto switch_break;
  case_84: /* CIL Label */ 
  {
#line 726
  extract_tag_argument(associated_value);
  }
#line 727
  goto switch_break;
  case_119: /* CIL Label */ 
  {
#line 732
  tmp___13 = sscanf((char const   */* __restrict  */)associated_value, (char const   */* __restrict  */)"%u",
                    & length);
  }
#line 732
  if (tmp___13 > 0) {
    {
#line 733
    set_output_line_length(length);
    }
  } else {
    {
#line 736
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c should be followed by an unsigned integer.\n",
            (int )arg_letter);
#line 739
    exit(1);
    }
  }
#line 742
  goto switch_break;
  case_104: /* CIL Label */ 
  {
#line 744
  usage_and_exit();
  }
#line 745
  goto switch_break;
  case_87: /* CIL Label */ 
  {
#line 751
  tmp___14 = which_output_format(associated_value);
#line 751
  format = tmp___14;
  }
#line 752
  if ((unsigned int )format == 7U) {
    {
#line 758
    GlobalState.keep_NAGs = (Boolean )0;
#line 759
    GlobalState.keep_comments = (Boolean )0;
#line 760
    GlobalState.keep_move_numbers = (Boolean )0;
#line 761
    GlobalState.keep_checks = (Boolean )0;
#line 762
    GlobalState.keep_variations = (Boolean )0;
#line 763
    set_output_line_length(5000U);
#line 764
    format = (OutputFormat )4;
    }
  }
#line 766
  GlobalState.output_format = format;
#line 768
  goto switch_break;
  case_55: /* CIL Label */ 
#line 770
  if ((unsigned int )GlobalState.tag_output_format == 0U) {
#line 772
    GlobalState.tag_output_format = (TagOutputForm )1;
  } else
#line 770
  if ((unsigned int )GlobalState.tag_output_format == 1U) {
#line 772
    GlobalState.tag_output_format = (TagOutputForm )1;
  } else {
    {
#line 775
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c clashes with another argument.\n",
            55);
#line 778
    exit(1);
    }
  }
#line 780
  goto switch_break;
  case_67: /* CIL Label */ 
#line 782
  GlobalState.keep_comments = (Boolean )0;
#line 783
  goto switch_break;
  case_68: /* CIL Label */ 
#line 786
  if ((unsigned long )GlobalState.duplicate_file == (unsigned long )((void *)0)) {
#line 787
    GlobalState.suppress_duplicates = (Boolean )1;
  } else {
    {
#line 790
    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"-%c clashes with -%c flag.\n",
            68, 100);
#line 794
    exit(1);
    }
  }
#line 796
  goto switch_break;
  case_80: /* CIL Label */ 
#line 798
  GlobalState.match_permutations = (Boolean )0;
#line 799
  goto switch_break;
  case_78: /* CIL Label */ 
#line 801
  GlobalState.keep_NAGs = (Boolean )0;
#line 802
  goto switch_break;
  case_70: /* CIL Label */ 
#line 807
  if (GlobalState.add_FEN_comments) {
#line 809
    GlobalState.output_FEN_string = (Boolean )0;
  } else {
#line 812
    GlobalState.output_FEN_string = (Boolean )1;
  }
#line 814
  goto switch_break;
  case_114: /* CIL Label */ 
#line 817
  GlobalState.check_only = (Boolean )1;
#line 818
  goto switch_break;
  case_115: /* CIL Label */ 
#line 821
  GlobalState.verbose = (Boolean )0;
#line 822
  goto switch_break;
  case_83: /* CIL Label */ 
#line 825
  GlobalState.use_soundex = (Boolean )1;
#line 826
  goto switch_break;
  case_77: /* CIL Label */ 
#line 829
  GlobalState.match_only_checkmate = (Boolean )1;
#line 830
  goto switch_break;
  case_85: /* CIL Label */ 
#line 832
  GlobalState.suppress_originals = (Boolean )1;
#line 833
  goto switch_break;
  case_86: /* CIL Label */ 
#line 835
  GlobalState.keep_variations = (Boolean )0;
#line 836
  goto switch_break;
  case_90: /* CIL Label */ 
#line 838
  GlobalState.use_virtual_hash_table = (Boolean )1;
#line 839
  goto switch_break;
  case_116: /* CIL Label */ 
#line 842
  if ((int const   )*filename___0 != 0) {
    {
#line 843
    read_tag_file(filename___0);
    }
  }
#line 845
  goto switch_break;
  case_82: /* CIL Label */ 
#line 847
  if ((int const   )*filename___0 != 0) {
    {
#line 848
    read_tag_roster_file(filename___0);
    }
  }
#line 850
  goto switch_break;
  case_118: /* CIL Label */ 
#line 852
  if ((int const   )*filename___0 != 0) {
    {
#line 854
    tmp___15 = MustOpen(filename___0, "r");
#line 854
    variation_file = tmp___15;
#line 856
    add_textual_variations_from_file(variation_file);
#line 857
    fclose(variation_file);
    }
  }
#line 859
  goto switch_break;
  case_120: /* CIL Label */ 
#line 861
  if ((int const   )*filename___0 != 0) {
    {
#line 862
    tmp___16 = MustOpen(filename___0, "r");
#line 862
    variation_file___0 = tmp___16;
#line 864
    add_positional_variations_from_file(variation_file___0);
#line 865
    fclose(variation_file___0);
    }
  }
#line 867
  goto switch_break;
  case_122: /* CIL Label */ 
#line 869
  if ((int const   )*filename___0 != 0) {
    {
#line 870
    tmp___17 = build_endings(filename___0);
    }
#line 870
    if (! tmp___17) {
      {
#line 871
      exit(1);
      }
    }
  }
#line 874
  goto switch_break;
  switch_default___0: /* CIL Label */ 
  {
#line 876
  fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"Unrecognized argument -%c\n",
          (int )arg_letter);
  }
  switch_break: /* CIL Label */ ;
  }
#line 879
  return;
}
}
#line 887 "/home/wheatley/newnew/temp/pgn-extract-17.14/argsfile.c"
int process_long_form_argument(char const   *argument , char const   *associated_value ) 
{ 
  int depth ;
  int tmp ;
  char *tmp___0 ;
  int limit ;
  int tmp___1 ;
  int tmp___2 ;
  int tmp___3 ;
  int tmp___4 ;
  int tmp___5 ;
  int tmp___6 ;
  int tmp___7 ;
  int tmp___8 ;
  int tmp___9 ;
  int tmp___10 ;
  int tmp___11 ;
  int tmp___12 ;
  int tmp___13 ;
  int tmp___14 ;
  int tmp___15 ;
  int tmp___16 ;
  int tmp___17 ;
  int tmp___18 ;
  int tmp___19 ;
  int tmp___20 ;
  int tmp___21 ;
  int tmp___22 ;
  int tmp___23 ;
  int tmp___24 ;
  int tmp___25 ;

  {
  {
#line 890
  tmp___25 = stringcompare(argument, "append");
  }
#line 890
  if (tmp___25 == 0) {
    {
#line 891
    process_argument((char)97, associated_value);
    }
#line 892
    return (2);
  } else {
    {
#line 894
    tmp___24 = stringcompare(argument, "checkfile");
    }
#line 894
    if (tmp___24 == 0) {
      {
#line 895
      process_argument((char)99, associated_value);
      }
#line 896
      return (2);
    } else {
      {
#line 898
      tmp___23 = stringcompare(argument, "checkmate");
      }
#line 898
      if (tmp___23 == 0) {
        {
#line 899
        process_argument((char)77, "");
        }
#line 900
        return (1);
      } else {
        {
#line 902
        tmp___22 = stringcompare(argument, "duplicates");
        }
#line 902
        if (tmp___22 == 0) {
          {
#line 903
          process_argument((char)100, associated_value);
          }
#line 904
          return (2);
        } else {
          {
#line 906
          tmp___21 = stringcompare(argument, "evaluation");
          }
#line 906
          if (tmp___21 == 0) {
#line 908
            GlobalState.output_evaluation = (Boolean )1;
#line 909
            return (1);
          } else {
            {
#line 911
            tmp___20 = stringcompare(argument, "fencomments");
            }
#line 911
            if (tmp___20 == 0) {
#line 913
              GlobalState.add_FEN_comments = (Boolean )1;
#line 915
              GlobalState.output_FEN_string = (Boolean )0;
#line 916
              return (1);
            } else {
              {
#line 918
              tmp___19 = stringcompare(argument, "help");
              }
#line 918
              if (tmp___19 == 0) {
                {
#line 919
                process_argument((char)104, "");
                }
#line 920
                return (1);
              } else {
                {
#line 922
                tmp___18 = stringcompare(argument, "fuzzydepth");
                }
#line 922
                if (tmp___18 == 0) {
                  {
#line 924
                  depth = 0;
#line 926
                  tmp = sscanf((char const   */* __restrict  */)associated_value,
                               (char const   */* __restrict  */)"%d", & depth);
                  }
#line 926
                  if (tmp == 1) {
#line 927
                    if (depth >= 0) {
#line 928
                      GlobalState.fuzzy_match_duplicates = (Boolean )1;
#line 929
                      GlobalState.fuzzy_match_depth = depth;
                    } else {
                      {
#line 932
                      fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"--%s requires a number greater than or equal to zero.\n",
                              argument);
#line 934
                      exit(1);
                      }
                    }
                  } else {
                    {
#line 938
                    fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"--%s requires a number following it.\n",
                            argument);
#line 940
                    exit(1);
                    }
                  }
#line 942
                  return (2);
                } else {
                  {
#line 944
                  tmp___17 = stringcompare(argument, "linelength");
                  }
#line 944
                  if (tmp___17 == 0) {
                    {
#line 945
                    process_argument((char)119, associated_value);
                    }
#line 947
                    return (2);
                  } else {
                    {
#line 949
                    tmp___16 = stringcompare(argument, "markmatches");
                    }
#line 949
                    if (tmp___16 == 0) {
#line 950
                      if ((int const   )*associated_value != 0) {
                        {
#line 951
                        GlobalState.add_position_match_comments = (Boolean )1;
#line 952
                        tmp___0 = StringCopy(associated_value);
#line 952
                        GlobalState.position_match_comment = (char const   *)tmp___0;
                        }
                      } else {
                        {
#line 955
                        fprintf((FILE */* __restrict  */)GlobalState.logfile, (char const   */* __restrict  */)"--markmatches requires a comment string following it.\n");
#line 957
                        exit(1);
                        }
                      }
#line 959
                      return (2);
                    } else {
                      {
#line 961
                      tmp___15 = stringcompare(argument, "nochecks");
                      }
#line 961
                      if (tmp___15 == 0) {
#line 962
                        GlobalState.keep_checks = (Boolean )0;
#line 963
                        return (1);
                      } else {
                        {
#line 965
                        tmp___14 = stringcompare(argument, "nocomments");
                        }
#line 965
                        if (tmp___14 == 0) {
                          {
#line 966
                          process_argument((char)67, "");
                          }
#line 967
                          return (1);
                        } else {
                          {
#line 969
                          tmp___13 = stringcompare(argument, "noduplicates");
                          }
#line 969
                          if (tmp___13 == 0) {
                            {
#line 970
                            process_argument((char)68, "");
                            }
#line 971
                            return (1);
                          } else {
                            {
#line 973
                            tmp___12 = stringcompare(argument, "nomovenumbers");
                            }
#line 973
                            if (tmp___12 == 0) {
#line 974
                              GlobalState.keep_move_numbers = (Boolean )0;
#line 975
                              return (1);
                            } else {
                              {
#line 977
                              tmp___11 = stringcompare(argument, "nonags");
                              }
#line 977
                              if (tmp___11 == 0) {
                                {
#line 978
                                process_argument((char)78, "");
                                }
#line 979
                                return (1);
                              } else {
                                {
#line 981
                                tmp___10 = stringcompare(argument, "noresults");
                                }
#line 981
                                if (tmp___10 == 0) {
#line 982
                                  GlobalState.keep_results = (Boolean )0;
#line 983
                                  return (1);
                                } else {
                                  {
#line 985
                                  tmp___9 = stringcompare(argument, "notags");
                                  }
#line 985
                                  if (tmp___9 == 0) {
#line 986
                                    if ((unsigned int )GlobalState.tag_output_format == 0U) {
#line 988
                                      GlobalState.tag_output_format = (TagOutputForm )2;
                                    } else
#line 986
                                    if ((unsigned int )GlobalState.tag_output_format == 2U) {
#line 988
                                      GlobalState.tag_output_format = (TagOutputForm )2;
                                    } else {
                                      {
#line 991
                                      fprintf((FILE */* __restrict  */)GlobalState.logfile,
                                              (char const   */* __restrict  */)"--notags clashes with another argument.\n");
#line 993
                                      exit(1);
                                      }
                                    }
#line 995
                                    return (1);
                                  } else {
                                    {
#line 997
                                    tmp___8 = stringcompare(argument, "nounique");
                                    }
#line 997
                                    if (tmp___8 == 0) {
                                      {
#line 998
                                      process_argument((char)85, "");
                                      }
#line 999
                                      return (1);
                                    } else {
                                      {
#line 1001
                                      tmp___7 = stringcompare(argument, "novars");
                                      }
#line 1001
                                      if (tmp___7 == 0) {
                                        {
#line 1002
                                        process_argument((char)86, "");
                                        }
#line 1003
                                        return (1);
                                      } else {
                                        {
#line 1005
                                        tmp___6 = stringcompare(argument, "output");
                                        }
#line 1005
                                        if (tmp___6 == 0) {
                                          {
#line 1006
                                          process_argument((char)111, associated_value);
                                          }
#line 1007
                                          return (2);
                                        } else {
                                          {
#line 1009
                                          tmp___5 = stringcompare(argument, "plylimit");
                                          }
#line 1009
                                          if (tmp___5 == 0) {
                                            {
#line 1010
                                            limit = 0;
#line 1013
                                            tmp___1 = sscanf((char const   */* __restrict  */)associated_value,
                                                             (char const   */* __restrict  */)"%d",
                                                             & limit);
                                            }
#line 1013
                                            if (tmp___1 == 1) {
#line 1014
                                              if (limit >= 0) {
#line 1015
                                                GlobalState.output_ply_limit = (unsigned int )limit;
                                              } else {
                                                {
#line 1018
                                                fprintf((FILE */* __restrict  */)GlobalState.logfile,
                                                        (char const   */* __restrict  */)"--plylimit requires a number greater than or equal to zero.\n");
#line 1020
                                                exit(1);
                                                }
                                              }
                                            } else {
                                              {
#line 1024
                                              fprintf((FILE */* __restrict  */)GlobalState.logfile,
                                                      (char const   */* __restrict  */)"--plylimit requires a number following it.\n");
#line 1026
                                              exit(1);
                                              }
                                            }
#line 1028
                                            return (2);
                                          } else {
                                            {
#line 1030
                                            tmp___4 = stringcompare(argument, "seven");
                                            }
#line 1030
                                            if (tmp___4 == 0) {
                                              {
#line 1031
                                              process_argument((char)55, "");
                                              }
#line 1032
                                              return (1);
                                            } else {
                                              {
#line 1034
                                              tmp___3 = stringcompare(argument, "stalemate");
                                              }
#line 1034
                                              if (tmp___3 == 0) {
#line 1035
                                                GlobalState.match_only_stalemate = (Boolean )1;
#line 1036
                                                return (1);
                                              } else {
                                                {
#line 1038
                                                tmp___2 = stringcompare(argument,
                                                                        "version");
                                                }
#line 1038
                                                if (tmp___2 == 0) {
                                                  {
#line 1039
                                                  fprintf((FILE */* __restrict  */)GlobalState.logfile,
                                                          (char const   */* __restrict  */)"pgn-extract %s\n",
                                                          "v17-14");
#line 1040
                                                  exit(0);
                                                  }
#line 1041
                                                  return (1);
                                                } else {
                                                  {
#line 1044
                                                  fprintf((FILE */* __restrict  */)GlobalState.logfile,
                                                          (char const   */* __restrict  */)"Unrecognised long-form argument: --%s\n",
                                                          argument);
#line 1047
                                                  exit(1);
                                                  }
#line 1048
                                                  return (1);
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
}
