/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is false */

#line 212 "/usr/lib/gcc/x86_64-linux-gnu/4.8/include/stddef.h"
typedef unsigned long size_t;
#line 127 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned long __ino_t;
#line 131 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off_t;
#line 132 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off64_t;
#line 139 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __time_t;
#line 141 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __suseconds_t;
#line 44 "/usr/include/stdio.h"
struct _IO_FILE;
#line 48 "/usr/include/stdio.h"
typedef struct _IO_FILE FILE;
#line 154 "/usr/include/libio.h"
typedef void _IO_lock_t;
#line 160 "/usr/include/libio.h"
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
#line 245 "/usr/include/libio.h"
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15UL * sizeof(int ) - 4UL * sizeof(void *)) - sizeof(size_t )] ;
};
#line 30 "/usr/include/x86_64-linux-gnu/bits/time.h"
struct timeval {
   __time_t tv_sec ;
   __suseconds_t tv_usec ;
};
#line 22 "/usr/include/x86_64-linux-gnu/bits/dirent.h"
struct dirent {
   __ino_t d_ino ;
   __off_t d_off ;
   unsigned short d_reclen ;
   unsigned char d_type ;
   char d_name[256] ;
};
#line 127 "/usr/include/dirent.h"
struct __dirstream;
#line 127 "/usr/include/dirent.h"
typedef struct __dirstream DIR;
#line 20 "/usr/include/asm-generic/int-ll64.h"
typedef unsigned char __u8;
#line 23 "/usr/include/asm-generic/int-ll64.h"
typedef unsigned short __u16;
#line 26 "/usr/include/asm-generic/int-ll64.h"
typedef unsigned int __u32;
#line 39 "/usr/include/linux/usbdevice_fs.h"
struct usbdevfs_ctrltransfer {
   __u8 bRequestType ;
   __u8 bRequest ;
   __u16 wValue ;
   __u16 wIndex ;
   __u16 wLength ;
   __u32 timeout ;
   void *data ;
};
#line 49 "/usr/include/linux/usbdevice_fs.h"
struct usbdevfs_bulktransfer {
   unsigned int ep ;
   unsigned int len ;
   unsigned int timeout ;
   void *data ;
};
#line 56 "/usr/include/linux/usbdevice_fs.h"
struct usbdevfs_setinterface {
   unsigned int interface ;
   unsigned int altsetting ;
};
#line 90 "/usr/include/linux/usbdevice_fs.h"
struct usbdevfs_iso_packet_desc {
   unsigned int length ;
   unsigned int actual_length ;
   unsigned int status ;
};
#line 96 "/usr/include/linux/usbdevice_fs.h"
struct usbdevfs_urb {
   unsigned char type ;
   unsigned char endpoint ;
   int status ;
   unsigned int flags ;
   void *buffer ;
   int buffer_length ;
   int actual_length ;
   int start_frame ;
   int number_of_packets ;
   int error_count ;
   unsigned int signr ;
   void *usercontext ;
   struct usbdevfs_iso_packet_desc iso_frame_desc[0] ;
};
#line 36 "/usr/include/x86_64-linux-gnu/sys/poll.h"
typedef unsigned long nfds_t;
#line 39 "/usr/include/x86_64-linux-gnu/sys/poll.h"
struct pollfd {
   int fd ;
   short events ;
   short revents ;
};
#line 55 "/usr/include/x86_64-linux-gnu/sys/time.h"
struct timezone {
   int tz_minuteswest ;
   int tz_dsttime ;
};
#line 61 "/usr/include/x86_64-linux-gnu/sys/time.h"
typedef struct timezone * __restrict  __timezone_ptr_t;
#line 48 "/usr/include/stdint.h"
typedef unsigned char uint8_t;
#line 49 "/usr/include/stdint.h"
typedef unsigned short uint16_t;
#line 51 "/usr/include/stdint.h"
typedef unsigned int uint32_t;
#line 42 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
struct USB_descriptor {
   uint8_t bLength ;
   uint8_t bDescriptorType ;
} __attribute__((__packed__)) ;
#line 42 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
typedef struct USB_descriptor USBDescriptor;
#line 47 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
struct USB_device_descriptor {
   uint8_t bLength ;
   uint8_t bDescriptorType ;
   uint16_t bcdUSB ;
   uint8_t bDeviceClass ;
   uint8_t bDeviceSubClass ;
   uint8_t bDeviceProtocol ;
   uint8_t bMaxPacketSize0 ;
   uint16_t idVendor ;
   uint16_t idProduct ;
   uint16_t bcdDevice ;
   uint8_t iManufacturer ;
   uint8_t iProduct ;
   uint8_t iSerialNumber ;
   uint8_t bNumConfigurations ;
} __attribute__((__packed__)) ;
#line 47 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
typedef struct USB_device_descriptor USBDeviceDescriptor;
#line 64 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
struct USB_configuration_descriptor {
   uint8_t bLength ;
   uint8_t bDescriptorType ;
   uint16_t wTotalLength ;
   uint8_t bNumInterfaces ;
   uint8_t bConfigurationValue ;
   uint8_t iConfiguration ;
   uint8_t bmAttributes ;
   uint8_t bMaxPower ;
} __attribute__((__packed__)) ;
#line 64 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
typedef struct USB_configuration_descriptor USBConfigurationDescriptor;
#line 96
struct USB_device;
#line 97
struct USB_urb;
#line 98 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
typedef struct USB_device USBDevice;
#line 99 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
typedef uint32_t USBDeviceLocation;
#line 100 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
typedef uint8_t USBEndpoint;
#line 105
enum __anonenum_USBTransferType_31 {
    USBControl = 0,
    USBIsochronous = 1,
    USBBulk = 2,
    USBInterrupt = 3
} ;
#line 105 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
typedef enum __anonenum_USBTransferType_31 USBTransferType;
#line 112 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
struct USB_urb {
   void *priv ;
   USBTransferType type ;
   USBEndpoint ep ;
   int status ;
   void *buffer ;
   unsigned int bufferSize ;
   unsigned int actualLength ;
   void (*callback)(struct USB_urb * ) ;
   void *userContext ;
};
#line 112 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
typedef struct USB_urb USBURB;
#line 71 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
struct USB_device {
   USBDevice *next ;
   USBDeviceLocation location ;
   int fd ;
   int rdwr ;
   USBDeviceDescriptor deviced ;
   uint8_t **rawconfd ;
   unsigned int nconfd ;
};
#line 80 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
struct URBNode {
   struct URBNode *next ;
   USBURB urb ;
};
#line 80 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
typedef struct URBNode URBNode;
#line 804 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
struct __anonstruct_temp_32 {
   USBDescriptor h ;
   uint16_t lang ;
} __attribute__((__packed__)) ;
#line 140 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef unsigned int __useconds_t;
#line 75 "/usr/include/time.h"
typedef __time_t time_t;
#line 40 "/usr/lib/gcc/x86_64-linux-gnu/4.8/include/stdarg.h"
typedef __builtin_va_list __gnuc_va_list;
#line 79 "/usr/include/stdio.h"
typedef __gnuc_va_list va_list;
#line 170 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
struct AES;
#line 170 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
typedef struct AES AES;
#line 171 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
struct AES {
   USBDevice *usb ;
   USBEndpoint epOut ;
   USBEndpoint epIn ;
   unsigned int fingerTh1 ;
   unsigned int fingerTh2 ;
};
#line 177 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
struct __anonstruct_AESReplyBuffer_29 {
   int length ;
   uint8_t *buf ;
};
#line 177 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
typedef struct __anonstruct_AESReplyBuffer_29 AESReplyBuffer;
#line 170 "/usr/include/stdio.h"
extern struct _IO_FILE *stderr ;
#line 356
extern int fprintf(FILE * __restrict  __stream , char const   * __restrict  __format 
                   , ...) ;
#line 364
extern  __attribute__((__nothrow__)) int sprintf(char * __restrict  __s , char const   * __restrict  __format 
                                                 , ...) ;
#line 386
extern  __attribute__((__nothrow__)) int ( /* format attribute */  snprintf)(char * __restrict  __s ,
                                                                             size_t __maxlen ,
                                                                             char const   * __restrict  __format 
                                                                             , ...) ;
#line 183 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) long ( __attribute__((__nonnull__(1), __leaf__)) strtol)(char const   * __restrict  __nptr ,
                                                                                              char ** __restrict  __endptr ,
                                                                                              int __base ) ;
#line 466
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) malloc)(size_t __size )  __attribute__((__malloc__)) ;
#line 468
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) calloc)(size_t __nmemb ,
                                                                               size_t __size )  __attribute__((__malloc__)) ;
#line 483
extern  __attribute__((__nothrow__)) void ( __attribute__((__leaf__)) free)(void *__ptr ) ;
#line 353 "/usr/include/unistd.h"
extern int close(int __fd ) ;
#line 134 "/usr/include/dirent.h"
extern DIR *( __attribute__((__nonnull__(1))) opendir)(char const   *__name ) ;
#line 149
extern int ( __attribute__((__nonnull__(1))) closedir)(DIR *__dirp ) ;
#line 162
extern struct dirent *( __attribute__((__nonnull__(1))) readdir)(DIR *__dirp ) ;
#line 146 "/usr/include/fcntl.h"
extern int ( __attribute__((__nonnull__(1))) open)(char const   *__file , int __oflag 
                                                   , ...) ;
#line 50 "/usr/include/x86_64-linux-gnu/bits/errno.h"
extern  __attribute__((__nothrow__)) int *( __attribute__((__leaf__)) __errno_location)(void)  __attribute__((__const__)) ;
#line 41 "/usr/include/x86_64-linux-gnu/sys/ioctl.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) ioctl)(int __fd ,
                                                                            unsigned long __request 
                                                                            , ...) ;
#line 57 "/usr/include/x86_64-linux-gnu/sys/poll.h"
extern int poll(struct pollfd *__fds , nfds_t __nfds , int __timeout ) ;
#line 66 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__nonnull__(1), __leaf__)) memset)(void *__s ,
                                                                                               int __c ,
                                                                                               size_t __n ) ;
#line 132
extern  __attribute__((__nothrow__)) char *( __attribute__((__nonnull__(1,2), __leaf__)) strncpy)(char * __restrict  __dest ,
                                                                                                  char const   * __restrict  __src ,
                                                                                                  size_t __n ) ;
#line 144
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,2), __leaf__)) strcmp)(char const   *__s1 ,
                                                                                               char const   *__s2 )  __attribute__((__pure__)) ;
#line 399
extern  __attribute__((__nothrow__)) size_t ( __attribute__((__nonnull__(1), __leaf__)) strlen)(char const   *__s )  __attribute__((__pure__)) ;
#line 413
extern  __attribute__((__nothrow__)) char *( __attribute__((__leaf__)) strerror)(int __errnum ) ;
#line 71 "/usr/include/x86_64-linux-gnu/sys/time.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1), __leaf__)) gettimeofday)(struct timeval * __restrict  __tv ,
                                                                                                   __timezone_ptr_t __tz ) ;
#line 132 "/home/june/collector/temp/aes2501-wy-0.1/usb.h"
void usbInit(char const   *root ) ;
#line 133
void usbCleanup(void) ;
#line 134
char const   *usbGetRootDir(void) ;
#line 136
void usbFindDevices(uint16_t vid , uint16_t pid , int (*callback)(USBDeviceLocation  ,
                                                                  void * ) , void *data ) ;
#line 138
void usbScanDevices(int (*callback)(USBDeviceLocation  , void * ) , void *data ) ;
#line 139
USBDevice *usbGetDevice(USBDeviceLocation l ) ;
#line 140
void usbFreeDevice(USBDevice *dev ) ;
#line 142
USBDeviceDescriptor const   *usbGetDeviceDescriptor(USBDevice *dev ) ;
#line 143
USBConfigurationDescriptor const   *usbGetConfigurationDescriptor(USBDevice *dev ,
                                                                  unsigned int idx ) ;
#line 145
USBDeviceLocation usbGetDeviceLocation(USBDevice *dev ) ;
#line 147
int usbClaimInterface(USBDevice *dev , unsigned int intf ) ;
#line 148
int usbReleaseInterface(USBDevice *dev , unsigned int intf ) ;
#line 150
USBURB *usbNewUrb(void) ;
#line 151
void usbDestroyUrb(USBURB *urb ) ;
#line 152
int usbSubmitUrb(USBDevice *dev , USBURB *urb ) ;
#line 153
int usbGetCompleteUrb(USBDevice *dev , USBURB **completed , int timeout ) ;
#line 154
int usbGetCompleteUrbNoIntr(USBDevice *dev , USBURB **completed , int timeout ) ;
#line 155
int usbCancelUrb(USBDevice *dev , USBURB *urb ) ;
#line 157
int usbSendBulkMsg(USBDevice *dev , USBEndpoint ep , void *data_ , unsigned int len ,
                   int timeout ) ;
#line 159
int usbSendControlMsg(USBDevice *dev , USBEndpoint ep , uint8_t bRequest , uint8_t bmRequestType ,
                      uint16_t wValue , uint16_t wIndex , uint16_t wLength , void *data ,
                      int timeout ) ;
#line 164
int usbGetDescriptor(USBDevice *dev , uint8_t type , uint8_t descidx , uint16_t wIndex ,
                     uint16_t wLength , void *data ) ;
#line 166
int usbGetFirstLanguageString(USBDevice *dev , unsigned int idx , void *buf , unsigned int bufsize ) ;
#line 168
int usbResetDevice(USBDevice *dev ) ;
#line 169
int usbSetInterface(USBDevice *dev , uint8_t iface , uint8_t altsetting ) ;
#line 86 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static char usbRoot[256]  ;
#line 87 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static char const   *usbRootPattern  ;
#line 88 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static char const   *usbfsPattern  ;
#line 89 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static char const   *udevPattern  ;
#line 90 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static char const   *resmgrPattern  ;
#line 91 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static USBDevice *firstDevice  =    (USBDevice *)((void *)0);
#line 92 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static URBNode *firstURB  =    (URBNode *)((void *)0);
#line 94
static int usbOpen(USBDevice *dev , int rdwr ) ;
#line 95
static int usbClose(USBDevice *dev ) ;
#line 98 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
__inline static USBDeviceLocation usbLocation(uint8_t bus , uint8_t device ) 
{ 


  {
#line 101
  return ((USBDeviceLocation )(((int )bus << 8) | (int )device));
}
}
#line 105 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
__inline static uint8_t usbBusNumber(USBDeviceLocation l ) 
{ 


  {
#line 108
  return ((uint8_t )(l >> 8));
}
}
#line 112 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
__inline static uint8_t usbDeviceNumber(USBDeviceLocation l ) 
{ 


  {
#line 115
  return ((uint8_t )l);
}
}
#line 119 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
__inline static uint16_t getLe16(uint16_t const   *le ) 
{ 
  uint8_t const   *b ;

  {
#line 122
  b = (uint8_t const   *)le;
#line 123
  return ((uint16_t )(((int const   )*(b + 1) << 8) | (int const   )*(b + 0)));
}
}
#line 127 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
__inline static void setLe16(uint16_t *le , uint16_t native ) 
{ 
  uint8_t *b ;

  {
#line 130
  b = (uint8_t *)le;
#line 131
  *(b + 0) = (uint8_t )native;
#line 132
  *(b + 1) = (uint8_t )((int )native >> 8);
#line 133
  return;
}
}
#line 136 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static char const   *guessDirPattern(char const   *root ) 
{ 
  DIR *dir ;
  char const   *pat ;
  struct dirent *de ;
  char *endptr ;
  int temp ;
  char s[10] ;
  long tmp ;
  int tmp___0 ;

  {
  {
#line 140
  pat = (char const   *)((void *)0);
#line 146
  dir = opendir(root);
  }
#line 147
  if (! dir) {
#line 148
    return ((char const   *)((void *)0));
  }
  {
#line 149
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 149
    de = readdir(dir);
    }
#line 149
    if (! de) {
#line 149
      goto while_break;
    }
#line 150
    if ((int )de->d_name[0] == 46) {
#line 151
      goto while_continue;
    }
    {
#line 152
    tmp = strtol((char const   */* __restrict  */)(de->d_name), (char **/* __restrict  */)(& endptr),
                 10);
#line 152
    temp = (int )tmp;
    }
#line 153
    if ((int )*(endptr + 0) == 0) {
#line 153
      if (temp >= 0) {
        {
#line 154
        sprintf((char */* __restrict  */)(s), (char const   */* __restrict  */)"%d",
                temp);
#line 155
        tmp___0 = strcmp((char const   *)(de->d_name), (char const   *)(s));
        }
#line 155
        if (tmp___0 == 0) {
#line 156
          pat = "%u/%u";
        } else {
#line 158
          pat = "%03u/%03u";
        }
#line 160
        goto while_break;
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 163
  closedir(dir);
  }
#line 164
  return (pat);
}
}
#line 168 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static void makeDeviceName(char *path , unsigned int size , char const   *pattern ,
                           char const   *root , USBDeviceLocation l ) 
{ 
  unsigned int len ;
  size_t tmp ;
  uint8_t tmp___0 ;
  uint8_t tmp___1 ;

  {
  {
#line 174
  snprintf((char */* __restrict  */)path, (size_t )size, (char const   */* __restrict  */)"%s/",
           root);
#line 175
  tmp = strlen((char const   *)path);
#line 175
  len = (unsigned int )tmp;
#line 176
  tmp___0 = usbDeviceNumber(l);
#line 176
  tmp___1 = usbBusNumber(l);
#line 176
  snprintf((char */* __restrict  */)(path + len), (size_t )(size - len), (char const   */* __restrict  */)pattern,
           (int )tmp___1, (int )tmp___0);
  }
#line 178
  return;
}
}
#line 181 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static int openInUsbfs(USBDeviceLocation l , int rdwr ) 
{ 
  char path[255] ;
  int *tmp ;
  int tmp___0 ;
  int tmp___1 ;

  {
#line 186
  if (! usbfsPattern) {
    {
#line 187
    tmp = __errno_location();
#line 187
    *tmp = 2;
    }
#line 188
    return (-1);
  }
  {
#line 190
  makeDeviceName(path, (unsigned int )sizeof(path), usbfsPattern, "/proc/bus/usb",
                 l);
  }
#line 191
  if (rdwr) {
#line 191
    tmp___0 = 2;
  } else {
#line 191
    tmp___0 = 0;
  }
  {
#line 191
  tmp___1 = open((char const   *)(path), tmp___0);
  }
#line 191
  return (tmp___1);
}
}
#line 195 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static int openInUdev(USBDeviceLocation l , int rdwr ) 
{ 
  char path[255] ;
  int *tmp ;
  int tmp___0 ;
  int tmp___1 ;

  {
#line 200
  if (! udevPattern) {
    {
#line 201
    tmp = __errno_location();
#line 201
    *tmp = 2;
    }
#line 202
    return (-1);
  }
  {
#line 204
  makeDeviceName(path, (unsigned int )sizeof(path), udevPattern, "/dev/bus/usb", l);
  }
#line 205
  if (rdwr) {
#line 205
    tmp___0 = 2;
  } else {
#line 205
    tmp___0 = 0;
  }
  {
#line 205
  tmp___1 = open((char const   *)(path), tmp___0);
  }
#line 205
  return (tmp___1);
}
}
#line 209 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static int openInResmgr(USBDeviceLocation l , int rdwr ) 
{ 
  int *tmp ;

  {
  {
#line 221
  tmp = __errno_location();
#line 221
  *tmp = 2;
  }
#line 222
  return (-1);
}
}
#line 227 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static void freeConfigBuf(USBDevice *dev ) 
{ 
  unsigned int i ;

  {
#line 232
  if (! dev->rawconfd) {
#line 233
    return;
  }
#line 234
  i = 0U;
  {
#line 234
  while (1) {
    while_continue: /* CIL Label */ ;
#line 234
    if (! (i != dev->nconfd)) {
#line 234
      goto while_break;
    }
    {
#line 235
    free((void *)*(dev->rawconfd + i));
#line 234
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 236
  free((void *)dev->rawconfd);
#line 237
  dev->rawconfd = (uint8_t **)((void *)0);
#line 238
  dev->nconfd = 0U;
  }
#line 239
  return;
}
}
#line 242 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static void readConfigurationDescriptor(USBDevice *dev , int idx ) 
{ 
  int result ;
  USBConfigurationDescriptor confd ;
  USBConfigurationDescriptor *c ;
  uint8_t *buf ;
  void *tmp ;

  {
  {
#line 249
  result = usbGetDescriptor(dev, (uint8_t )2, (uint8_t )idx, (uint16_t )0, (uint16_t )sizeof(confd),
                            (void *)(& confd));
  }
#line 251
  if ((unsigned long )result != sizeof(confd)) {
#line 252
    return;
  }
  {
#line 253
  confd.wTotalLength = getLe16((uint16_t const   *)(& confd.wTotalLength));
#line 254
  free((void *)*(dev->rawconfd + idx));
#line 255
  tmp = malloc((size_t )confd.wTotalLength);
#line 255
  buf = (uint8_t *)tmp;
#line 256
  *(dev->rawconfd + idx) = buf;
  }
#line 257
  if (! buf) {
#line 258
    return;
  }
  {
#line 259
  result = usbGetDescriptor(dev, (uint8_t )2, (uint8_t )idx, (uint16_t )0, confd.wTotalLength,
                            (void *)buf);
  }
#line 261
  if (result < (int )sizeof(USBConfigurationDescriptor )) {
    {
#line 262
    free((void *)*(dev->rawconfd + idx));
#line 263
    *(dev->rawconfd + idx) = (uint8_t *)((void *)0);
    }
#line 264
    return;
  }
  {
#line 266
  c = (USBConfigurationDescriptor *)buf;
#line 267
  setLe16(& c->wTotalLength, (uint16_t )result);
  }
#line 268
  return;
}
}
#line 271 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static void readDescriptors(USBDevice *dev ) 
{ 
  int result ;
  int i ;
  void *tmp ;

  {
  {
#line 276
  result = usbGetDescriptor(dev, (uint8_t )1, (uint8_t )0, (uint16_t )0, (uint16_t )sizeof(dev->deviced),
                            (void *)(& dev->deviced));
  }
#line 278
  if ((unsigned long )result != sizeof(dev->deviced)) {
#line 279
    dev->deviced.bLength = (uint8_t )0;
#line 280
    return;
  }
  {
#line 282
  dev->deviced.bcdUSB = getLe16((uint16_t const   *)(& dev->deviced.bcdUSB));
#line 283
  dev->deviced.idVendor = getLe16((uint16_t const   *)(& dev->deviced.idVendor));
#line 284
  dev->deviced.idProduct = getLe16((uint16_t const   *)(& dev->deviced.idProduct));
#line 285
  dev->deviced.bcdDevice = getLe16((uint16_t const   *)(& dev->deviced.bcdDevice));
#line 287
  freeConfigBuf(dev);
#line 288
  tmp = calloc((size_t )dev->deviced.bNumConfigurations, sizeof(*(dev->rawconfd)));
#line 288
  dev->rawconfd = (uint8_t **)tmp;
  }
#line 290
  if (! dev->rawconfd) {
#line 291
    return;
  }
#line 292
  dev->nconfd = (unsigned int )dev->deviced.bNumConfigurations;
#line 293
  i = 0;
  {
#line 293
  while (1) {
    while_continue: /* CIL Label */ ;
#line 293
    if (! (i != (int )dev->deviced.bNumConfigurations)) {
#line 293
      goto while_break;
    }
    {
#line 294
    readConfigurationDescriptor(dev, i);
#line 293
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 296
  return;
}
}
#line 299 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static int usbOpen(USBDevice *dev , int rdwr ) 
{ 
  int result ;
  char path[255] ;
  int tmp ;
  int *tmp___0 ;

  {
#line 302
  result = 0;
#line 305
  if (dev->fd >= 0) {
#line 305
    if (dev->rdwr < rdwr) {
      {
#line 306
      usbClose(dev);
      }
    }
  }
#line 308
  if (dev->fd == -1) {
    {
#line 309
    makeDeviceName(path, (unsigned int )sizeof(path), usbRootPattern, (char const   *)(usbRoot),
                   dev->location);
    }
#line 311
    if (rdwr) {
#line 311
      tmp = 2;
    } else {
#line 311
      tmp = 0;
    }
    {
#line 311
    dev->fd = open((char const   *)(path), tmp);
    }
#line 312
    if (dev->fd == -1) {
      {
#line 313
      dev->fd = openInUdev(dev->location, rdwr);
      }
    }
#line 314
    if (dev->fd == -1) {
      {
#line 315
      dev->fd = openInUsbfs(dev->location, rdwr);
      }
    }
#line 316
    if (dev->fd == -1) {
      {
#line 317
      dev->fd = openInResmgr(dev->location, rdwr);
      }
    }
#line 318
    if (dev->fd == -1) {
      {
#line 319
      tmp___0 = __errno_location();
#line 319
      result = - *tmp___0;
      }
    } else {
      {
#line 321
      dev->rdwr = rdwr;
#line 322
      readDescriptors(dev);
      }
    }
  }
#line 325
  return (result);
}
}
#line 329 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static int usbClose(USBDevice *dev ) 
{ 
  int *tmp ;
  int tmp___0 ;

  {
#line 332
  if (dev->fd != -1) {
    {
#line 333
    tmp___0 = close(dev->fd);
    }
#line 333
    if (tmp___0 == -1) {
      {
#line 334
      tmp = __errno_location();
      }
#line 334
      return (- *tmp);
    }
#line 335
    dev->fd = -1;
  }
#line 337
  return (0);
}
}
#line 341 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static int usbScanDevicesInBus(unsigned int bus , char const   *bus_name , uint16_t vid ,
                               uint16_t pid , int (*callback)(USBDeviceLocation  ,
                                                              void * ) , void *data ) 
{ 
  DIR *dir ;
  char path[256] ;
  struct dirent *de ;
  USBDevice *dev ;
  char *endptr ;
  USBDeviceDescriptor const   *ddesc ;
  int stop ;
  unsigned int idVendor ;
  unsigned int idProduct ;
  int devnum ;
  long tmp ;
  USBDeviceLocation tmp___0 ;
  USBDeviceLocation tmp___1 ;

  {
  {
#line 352
  stop = 0;
#line 355
  snprintf((char */* __restrict  */)(path), sizeof(path), (char const   */* __restrict  */)"%s/%s",
           usbRoot, bus_name);
#line 356
  dir = opendir((char const   *)(path));
  }
#line 357
  if (! dir) {
#line 358
    return (stop);
  }
  {
#line 359
  while (1) {
    while_continue: /* CIL Label */ ;
#line 359
    if (! stop) {
      {
#line 359
      de = readdir(dir);
      }
#line 359
      if (! de) {
#line 359
        goto while_break;
      }
    } else {
#line 359
      goto while_break;
    }
    {
#line 360
    tmp = strtol((char const   */* __restrict  */)(de->d_name), (char **/* __restrict  */)(& endptr),
                 10);
#line 360
    devnum = (int )tmp;
    }
#line 361
    if ((int )*endptr != 0) {
#line 362
      goto while_continue;
    } else
#line 361
    if (devnum < 0) {
#line 362
      goto while_continue;
    }
    {
#line 364
    tmp___0 = usbLocation((uint8_t )bus, (uint8_t )devnum);
#line 364
    dev = usbGetDevice(tmp___0);
#line 365
    ddesc = usbGetDeviceDescriptor(dev);
    }
#line 366
    if (! ddesc) {
      {
#line 367
      usbFreeDevice(dev);
      }
#line 368
      goto while_continue;
    }
    {
#line 370
    idVendor = (unsigned int )ddesc->idVendor;
#line 371
    idProduct = (unsigned int )ddesc->idProduct;
#line 372
    usbFreeDevice(dev);
    }
#line 374
    if ((int )vid == 0) {
#line 374
      goto _L;
    } else
#line 374
    if (idVendor == (unsigned int )vid) {
      _L: /* CIL Label */ 
#line 374
      if ((int )pid == 0) {
        {
#line 376
        tmp___1 = usbLocation((uint8_t )bus, (uint8_t )devnum);
#line 376
        stop = (*callback)(tmp___1, data);
        }
      } else
#line 374
      if (idProduct == (unsigned int )pid) {
        {
#line 376
        tmp___1 = usbLocation((uint8_t )bus, (uint8_t )devnum);
#line 376
        stop = (*callback)(tmp___1, data);
        }
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 378
  closedir(dir);
  }
#line 379
  return (stop);
}
}
#line 383 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
void usbInit(char const   *root ) 
{ 


  {
  {
#line 385
  usbRoot[0] = (char )'\000';
#line 386
  udevPattern = guessDirPattern("/dev/bus/usb");
#line 387
  usbfsPattern = guessDirPattern("/proc/bus/usb");
#line 388
  resmgrPattern = "usb:%u,%u";
  }
#line 390
  if (root) {
    {
#line 391
    strncpy((char */* __restrict  */)(usbRoot), (char const   */* __restrict  */)root,
            sizeof(usbRoot));
#line 392
    usbRootPattern = guessDirPattern((char const   *)(usbRoot));
    }
#line 393
    if (usbRootPattern) {
#line 394
      return;
    }
  }
#line 397
  if (udevPattern) {
    {
#line 398
    strncpy((char */* __restrict  */)(usbRoot), (char const   */* __restrict  */)"/dev/bus/usb",
            sizeof(usbRoot));
#line 399
    usbRootPattern = udevPattern;
    }
#line 400
    return;
  }
#line 403
  if (usbfsPattern) {
    {
#line 404
    strncpy((char */* __restrict  */)(usbRoot), (char const   */* __restrict  */)"/proc/bus/usb",
            sizeof(usbRoot));
#line 405
    usbRootPattern = usbfsPattern;
    }
#line 406
    return;
  }
  {
#line 410
  strncpy((char */* __restrict  */)(usbRoot), (char const   */* __restrict  */)"/proc/bus/usb",
          sizeof(usbRoot));
#line 411
  usbRootPattern = "%03u/%03u";
  }
#line 412
  return;
}
}
#line 415 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
void usbCleanup(void) 
{ 


  {
  {
#line 417
  while (1) {
    while_continue: /* CIL Label */ ;
#line 417
    if (! firstDevice) {
#line 417
      goto while_break;
    }
    {
#line 418
    usbFreeDevice(firstDevice);
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 419
  while (1) {
    while_continue___0: /* CIL Label */ ;
#line 419
    if (! firstURB) {
#line 419
      goto while_break___0;
    }
    {
#line 420
    firstURB->urb.status = 0;
#line 421
    usbDestroyUrb(& firstURB->urb);
    }
  }
  while_break___0: /* CIL Label */ ;
  }
#line 423
  return;
}
}
#line 426 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
char const   *usbGetRootDir(void) 
{ 


  {
#line 428
  return ((char const   *)(usbRoot));
}
}
#line 432 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
void usbFindDevices(uint16_t vid , uint16_t pid , int (*callback)(USBDeviceLocation  ,
                                                                  void * ) , void *data ) 
{ 
  DIR *dir ;
  struct dirent *de ;
  char *endptr ;
  int stop ;
  int bus ;
  long tmp ;

  {
  {
#line 438
  stop = 0;
#line 440
  dir = opendir((char const   *)(usbRoot));
  }
#line 441
  if (! dir) {
#line 442
    return;
  }
  {
#line 443
  while (1) {
    while_continue: /* CIL Label */ ;
#line 443
    if (! stop) {
      {
#line 443
      de = readdir(dir);
      }
#line 443
      if (! de) {
#line 443
        goto while_break;
      }
    } else {
#line 443
      goto while_break;
    }
    {
#line 444
    tmp = strtol((char const   */* __restrict  */)(de->d_name), (char **/* __restrict  */)(& endptr),
                 10);
#line 444
    bus = (int )tmp;
    }
#line 445
    if ((int )*endptr == 0) {
#line 445
      if (bus >= 0) {
        {
#line 446
        stop = usbScanDevicesInBus((unsigned int )bus, (char const   *)(de->d_name),
                                   vid, pid, callback, data);
        }
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 449
  closedir(dir);
  }
#line 450
  return;
}
}
#line 453 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
void usbScanDevices(int (*callback)(USBDeviceLocation  , void * ) , void *data ) 
{ 


  {
  {
#line 455
  usbFindDevices((uint16_t )0, (uint16_t )0, callback, data);
  }
#line 456
  return;
}
}
#line 459 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
USBDevice *usbGetDevice(USBDeviceLocation l ) 
{ 
  USBDevice *dev ;
  void *tmp ;

  {
  {
#line 463
  tmp = calloc((size_t )1, sizeof(*(dev + 0)));
#line 463
  dev = (USBDevice *)tmp;
  }
#line 464
  if (dev) {
    {
#line 465
    dev->next = firstDevice;
#line 466
    firstDevice = dev;
#line 467
    dev->location = l;
#line 468
    dev->fd = -1;
#line 469
    usbOpen(dev, 0);
    }
  }
#line 471
  return (dev);
}
}
#line 475 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
void usbFreeDevice(USBDevice *dev ) 
{ 
  USBDevice **p ;

  {
#line 479
  if (! dev) {
#line 480
    return;
  }
#line 481
  p = & firstDevice;
  {
#line 481
  while (1) {
    while_continue: /* CIL Label */ ;
#line 481
    if (*p) {
#line 481
      if (! ((unsigned long )*p != (unsigned long )dev)) {
#line 481
        goto while_break;
      }
    } else {
#line 481
      goto while_break;
    }
#line 481
    p = & (*p)->next;
  }
  while_break: /* CIL Label */ ;
  }
#line 482
  if (! *p) {
    {
#line 483
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"BUG:usbFreeDevice():invalid device\n");
    }
#line 484
    return;
  }
  {
#line 486
  *p = dev->next;
#line 487
  freeConfigBuf(dev);
#line 488
  usbClose(dev);
#line 489
  free((void *)dev);
  }
#line 490
  return;
}
}
#line 493 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
USBDeviceDescriptor const   *usbGetDeviceDescriptor(USBDevice *dev ) 
{ 
  USBDeviceDescriptor *tmp ;

  {
#line 495
  if ((int )dev->deviced.bLength != 0) {
#line 495
    tmp = & dev->deviced;
  } else {
#line 495
    tmp = (USBDeviceDescriptor *)((void *)0);
  }
#line 495
  return ((USBDeviceDescriptor const   *)tmp);
}
}
#line 499 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
USBConfigurationDescriptor const   *usbGetConfigurationDescriptor(USBDevice *dev ,
                                                                  unsigned int idx ) 
{ 
  USBConfigurationDescriptor *tmp ;

  {
#line 502
  if (idx < dev->nconfd) {
#line 502
    tmp = (USBConfigurationDescriptor *)*(dev->rawconfd + idx);
  } else {
#line 502
    tmp = (USBConfigurationDescriptor *)((void *)0);
  }
#line 502
  return ((USBConfigurationDescriptor const   *)tmp);
}
}
#line 507 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
USBDeviceLocation usbGetDeviceLocation(USBDevice *dev ) 
{ 


  {
#line 509
  return (dev->location);
}
}
#line 513 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbClaimInterface(USBDevice *dev , unsigned int intf ) 
{ 
  int result ;
  int *tmp ;
  int tmp___0 ;

  {
  {
#line 517
  result = usbOpen(dev, 1);
  }
#line 518
  if (result == 0) {
    {
#line 518
    tmp___0 = ioctl(dev->fd, (unsigned long )(((2U << 30) | (unsigned int )(85 << 8)) | 15U) | (sizeof(unsigned int ) << 16),
                    & intf);
    }
#line 518
    if (tmp___0 == -1) {
      {
#line 519
      tmp = __errno_location();
#line 519
      result = - *tmp;
      }
    }
  }
#line 520
  return (result);
}
}
#line 524 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbReleaseInterface(USBDevice *dev , unsigned int intf ) 
{ 
  int result ;
  int *tmp ;
  int tmp___0 ;

  {
#line 526
  result = 0;
#line 528
  if (dev->fd != -1) {
    {
#line 528
    tmp___0 = ioctl(dev->fd, (unsigned long )(((2U << 30) | (unsigned int )(85 << 8)) | 16U) | (sizeof(unsigned int ) << 16),
                    & intf);
    }
#line 528
    if (tmp___0 == -1) {
      {
#line 530
      tmp = __errno_location();
#line 530
      result = - *tmp;
      }
    }
  }
#line 531
  return (result);
}
}
#line 535 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbSubmitUrb(USBDevice *dev , USBURB *urb ) 
{ 
  struct usbdevfs_urb *lurb ;
  int error ;
  char *tmp ;
  int *tmp___0 ;
  int tmp___1 ;

  {
  {
#line 537
  lurb = (struct usbdevfs_urb *)((void *)0);
#line 538
  error = 0;
#line 540
  error = usbOpen(dev, 1);
  }
#line 541
  if (error < 0) {
#line 542
    return (error);
  }
#line 543
  if (! urb->priv) {
    {
#line 544
    tmp = strerror(- urb->status);
#line 544
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"BUG:usbSubmitUrb():invalid urb %p %p %s\n",
            (void *)urb, urb->priv, tmp);
    }
#line 546
    return (-22);
  } else
#line 543
  if (urb->status == -115) {
    {
#line 544
    tmp = strerror(- urb->status);
#line 544
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"BUG:usbSubmitUrb():invalid urb %p %p %s\n",
            (void *)urb, urb->priv, tmp);
    }
#line 546
    return (-22);
  }
  {
#line 548
  lurb = (struct usbdevfs_urb *)urb->priv;
#line 549
  memset((void *)lurb, 0, sizeof(*(lurb + 0)));
  }
  {
#line 551
  if ((unsigned int )urb->type == 0U) {
#line 551
    goto case_0;
  }
#line 554
  if ((unsigned int )urb->type == 2U) {
#line 554
    goto case_2;
  }
#line 557
  if ((unsigned int )urb->type == 3U) {
#line 557
    goto case_3;
  }
#line 561
  goto switch_default;
  case_0: /* CIL Label */ 
#line 552
  lurb->type = (unsigned char)2;
#line 553
  goto switch_break;
  case_2: /* CIL Label */ 
#line 555
  lurb->type = (unsigned char)3;
#line 556
  goto switch_break;
  case_3: /* CIL Label */ 
#line 558
  lurb->type = (unsigned char)1;
#line 559
  goto switch_break;
  switch_default: /* CIL Label */ 
#line 562
  return (-22);
  switch_break: /* CIL Label */ ;
  }
  {
#line 564
  lurb->endpoint = urb->ep;
#line 565
  lurb->buffer = urb->buffer;
#line 566
  lurb->buffer_length = (int )urb->bufferSize;
#line 567
  lurb->usercontext = (void *)urb;
#line 568
  urb->status = 0;
#line 569
  tmp___1 = ioctl(dev->fd, (unsigned long )(((2U << 30) | (unsigned int )(85 << 8)) | 10U) | (sizeof(struct usbdevfs_urb ) << 16),
                  lurb);
  }
#line 569
  if (tmp___1 < 0) {
    {
#line 570
    tmp___0 = __errno_location();
    }
#line 570
    return (- *tmp___0);
  }
#line 571
  urb->status = -115;
#line 572
  return (0);
}
}
#line 576 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbGetCompleteUrb(USBDevice *dev , USBURB **completed , int timeout ) 
{ 
  int error ;
  struct pollfd pf ;
  struct usbdevfs_urb *lurb ;
  USBURB *urb ;
  int *tmp ;
  int *tmp___0 ;
  int tmp___1 ;

  {
  {
#line 583
  *completed = (USBURB *)((void *)0);
#line 584
  error = usbOpen(dev, 1);
  }
#line 585
  if (error < 0) {
#line 586
    return (error);
  }
  {
#line 588
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 589
    pf.fd = dev->fd;
#line 590
    pf.events = (short)4;
#line 591
    pf.revents = (short)0;
#line 592
    error = poll(& pf, (nfds_t )1, timeout);
    }
#line 593
    if (error == -1) {
      {
#line 594
      tmp = __errno_location();
      }
#line 594
      return (- *tmp);
    }
#line 595
    if (error == 0) {
#line 596
      return (0);
    }
#line 597
    if (((int )pf.revents & 8) != 0) {
#line 598
      return (-19);
    }
    {
#line 599
    tmp___1 = ioctl(dev->fd, (unsigned long )(((1U << 30) | (unsigned int )(85 << 8)) | 12U) | (sizeof(void *) << 16),
                    & lurb);
    }
#line 599
    if (tmp___1 == -1) {
      {
#line 600
      tmp___0 = __errno_location();
      }
#line 600
      return (- *tmp___0);
    }
#line 601
    urb = (USBURB *)lurb->usercontext;
#line 602
    if (urb) {
#line 603
      urb->status = lurb->status;
#line 604
      urb->actualLength = (unsigned int )lurb->actual_length;
#line 605
      if (urb->callback) {
        {
#line 606
        (*(urb->callback))(urb);
        }
      }
    } else {
      {
#line 609
      free((void *)lurb);
      }
    }
#line 611
    *completed = urb;
#line 588
    if (! ((unsigned long )*completed == (unsigned long )((void *)0))) {
#line 588
      goto while_break;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 613
  return (1);
}
}
#line 618 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbGetCompleteUrbNoIntr(USBDevice *dev , USBURB **completed , int timeout ) 
{ 
  struct timeval to ;
  struct timeval t ;
  int sec ;
  int error ;
  int tmp ;

  {
#line 623
  if (timeout < 0) {
    {
#line 624
    while (1) {
      while_continue: /* CIL Label */ ;
      {
#line 625
      error = usbGetCompleteUrb(dev, completed, timeout);
      }
#line 624
      if (! (error == -4)) {
#line 624
        goto while_break;
      }
    }
    while_break: /* CIL Label */ ;
    }
#line 627
    return (error);
  } else {
    {
#line 629
    gettimeofday((struct timeval */* __restrict  */)(& to), (__timezone_ptr_t )((void *)0));
#line 630
    sec = timeout / 1000;
#line 631
    to.tv_usec += (__suseconds_t )((timeout - 1000 * sec) * 1000);
#line 632
    to.tv_sec += (__time_t )sec;
    }
#line 633
    if (to.tv_usec >= 1000000L) {
#line 634
      to.tv_usec -= 1000000L;
#line 635
      (to.tv_sec) ++;
    }
    {
#line 637
    error = usbGetCompleteUrb(dev, completed, timeout);
    }
    {
#line 638
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 638
      if (! (error == -4)) {
#line 638
        goto while_break___0;
      }
      {
#line 639
      gettimeofday((struct timeval */* __restrict  */)(& t), (__timezone_ptr_t )((void *)0));
      }
#line 640
      if (to.tv_sec == t.tv_sec) {
#line 640
        tmp = to.tv_usec < t.tv_usec;
      } else {
#line 640
        tmp = to.tv_sec < t.tv_sec;
      }
#line 640
      if (tmp) {
#line 641
        error = 0;
#line 642
        goto while_break___0;
      }
      {
#line 644
      timeout = (int )((to.tv_sec - t.tv_sec) * 1000L + (to.tv_usec - t.tv_usec) / 1000L);
#line 646
      error = usbGetCompleteUrb(dev, completed, timeout);
      }
    }
    while_break___0: /* CIL Label */ ;
    }
#line 648
    return (error);
  }
}
}
#line 653 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbCancelUrb(USBDevice *dev , USBURB *urb ) 
{ 


  {
#line 655
  if (dev->fd < 0) {
#line 656
    return (-22);
  } else
#line 655
  if (! urb) {
#line 656
    return (-22);
  } else
#line 655
  if (! urb->priv) {
#line 656
    return (-22);
  } else
#line 655
  if (urb->status != -115) {
#line 656
    return (-22);
  }
  {
#line 657
  ioctl(dev->fd, (unsigned long )((unsigned int )(85 << 8) | 11U), urb->priv);
  }
#line 658
  return (0);
}
}
#line 662 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
static int usbSendBulkMsg_i(USBDevice *dev , USBEndpoint ep , void *data , unsigned int len ,
                            int timeout ) 
{ 
  int error ;
  struct usbdevfs_bulktransfer bulk ;
  int *tmp ;

  {
#line 669
  bulk.ep = (unsigned int )ep;
#line 670
  bulk.len = len;
#line 671
  if (timeout < 0) {
#line 672
    timeout = 0;
  } else
#line 673
  if (timeout == 0) {
#line 674
    timeout = 1;
  }
  {
#line 675
  bulk.timeout = (unsigned int )timeout;
#line 676
  bulk.data = data;
#line 677
  error = ioctl(dev->fd, (unsigned long )(((3U << 30) | (unsigned int )(85 << 8)) | 2U) | (sizeof(struct usbdevfs_bulktransfer ) << 16),
                & bulk);
  }
#line 678
  if (error == -1) {
    {
#line 679
    tmp = __errno_location();
#line 679
    error = - *tmp;
    }
  }
#line 680
  return (error);
}
}
#line 684 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbSendBulkMsg(USBDevice *dev , USBEndpoint ep , void *data_ , unsigned int len ,
                   int timeout ) 
{ 
  int error ;
  uint8_t *data ;
  int pos ;
  int count ;
  int blocksize ;

  {
  {
#line 688
  data = (uint8_t *)data_;
#line 691
  error = usbOpen(dev, 1);
  }
#line 692
  if (error < 0) {
#line 693
    return (error);
  }
#line 694
  pos = 0;
  {
#line 695
  while (1) {
    while_continue: /* CIL Label */ ;
#line 696
    if (len < 16384U) {
#line 696
      blocksize = (int )len;
    } else {
#line 696
      blocksize = 16384;
    }
    {
#line 697
    count = usbSendBulkMsg_i(dev, ep, (void *)(data + pos), (unsigned int )blocksize,
                             timeout);
    }
#line 698
    if (count < 0) {
#line 699
      return (count);
    }
#line 700
    pos += count;
#line 701
    len -= (unsigned int )count;
#line 695
    if (len != 0U) {
#line 695
      if (! (count == blocksize)) {
#line 695
        goto while_break;
      }
    } else {
#line 695
      goto while_break;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 703
  return (pos);
}
}
#line 707 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbSendControlMsg(USBDevice *dev , USBEndpoint ep , uint8_t bRequest , uint8_t bmRequestType ,
                      uint16_t wValue , uint16_t wIndex , uint16_t wLength , void *data ,
                      int timeout ) 
{ 
  int error ;
  struct usbdevfs_ctrltransfer ctrl ;
  int *tmp ;

  {
  {
#line 715
  error = usbOpen(dev, 1);
  }
#line 716
  if (error < 0) {
#line 717
    return (error);
  }
#line 726
  ctrl.bRequest = bRequest;
#line 727
  ctrl.bRequestType = bmRequestType;
#line 728
  ctrl.wValue = wValue;
#line 729
  ctrl.wIndex = wIndex;
#line 730
  ctrl.wLength = wLength;
#line 732
  if (timeout < 0) {
#line 733
    timeout = 0;
  } else
#line 734
  if (timeout == 0) {
#line 735
    timeout = 1;
  }
  {
#line 736
  ctrl.timeout = (__u32 )timeout;
#line 737
  ctrl.data = data;
#line 738
  error = ioctl(dev->fd, (unsigned long )((3U << 30) | (unsigned int )(85 << 8)) | (sizeof(struct usbdevfs_ctrltransfer ) << 16),
                & ctrl);
  }
#line 739
  if (error == -1) {
    {
#line 740
    tmp = __errno_location();
#line 740
    error = - *tmp;
    }
  }
#line 741
  return (error);
}
}
#line 745 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
USBURB *usbNewUrb(void) 
{ 
  URBNode *urbNode ;
  struct usbdevfs_urb *lurb ;
  void *tmp ;
  void *tmp___0 ;

  {
  {
#line 750
  tmp = calloc((size_t )1, sizeof(*urbNode));
#line 750
  urbNode = (URBNode *)tmp;
  }
#line 751
  if (! urbNode) {
#line 752
    return ((USBURB *)((void *)0));
  }
  {
#line 753
  tmp___0 = calloc((size_t )1, sizeof(*lurb));
#line 753
  lurb = (struct usbdevfs_urb *)tmp___0;
  }
#line 754
  if (! lurb) {
    {
#line 755
    free((void *)urbNode);
    }
#line 756
    return ((USBURB *)((void *)0));
  }
#line 758
  urbNode->next = firstURB;
#line 759
  firstURB = urbNode;
#line 760
  urbNode->urb.priv = (void *)lurb;
#line 761
  return (& urbNode->urb);
}
}
#line 765 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
void usbDestroyUrb(USBURB *urb ) 
{ 
  URBNode *urbNode ;
  URBNode **p ;
  struct usbdevfs_urb *lurb ;

  {
#line 770
  if (! urb) {
#line 771
    return;
  }
#line 772
  p = & firstURB;
  {
#line 772
  while (1) {
    while_continue: /* CIL Label */ ;
#line 772
    if (*p) {
#line 772
      if (! ((unsigned long )(& (*p)->urb) != (unsigned long )urb)) {
#line 772
        goto while_break;
      }
    } else {
#line 772
      goto while_break;
    }
#line 772
    p = & (*p)->next;
  }
  while_break: /* CIL Label */ ;
  }
#line 773
  urbNode = *p;
#line 774
  if (! urbNode) {
    {
#line 775
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"BUG:usbDestroyUrb():invalid URB\n");
    }
#line 776
    return;
  }
#line 778
  lurb = (struct usbdevfs_urb *)urb->priv;
#line 779
  urb->priv = (void *)0;
#line 780
  if (lurb) {
#line 781
    lurb->usercontext = (void *)0;
  }
#line 782
  if (urb->status == -115) {
    {
#line 783
    fprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)"BUG:usbDestroyUrb(): destroying pending urb\n");
    }
  } else {
    {
#line 785
    free((void *)lurb);
    }
  }
  {
#line 787
  *p = urbNode->next;
#line 788
  free((void *)urbNode);
  }
#line 789
  return;
}
}
#line 792 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbGetDescriptor(USBDevice *dev , uint8_t type , uint8_t descidx , uint16_t wIndex ,
                     uint16_t wLength , void *data ) 
{ 
  int tmp ;

  {
  {
#line 795
  tmp = usbSendControlMsg(dev, (USBEndpoint )0, (uint8_t )6, (uint8_t )128, (uint16_t )(((int )type << 8) | (int )descidx),
                          wIndex, wLength, data, 1000);
  }
#line 795
  return (tmp);
}
}
#line 801 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbGetFirstLanguageString(USBDevice *dev , unsigned int idx , void *buf , unsigned int bufsize ) 
{ 
  struct __anonstruct_temp_32 temp ;
  int result ;
  uint16_t tmp ;
  int tmp___0 ;

  {
#line 810
  if (idx == 0U) {
#line 811
    return (0);
  }
  {
#line 813
  result = usbGetDescriptor(dev, (uint8_t )3, (uint8_t )0, (uint16_t )0, (uint16_t )4,
                            (void *)(& temp));
  }
#line 814
  if (result != 4) {
#line 815
    return (result);
  }
  {
#line 817
  tmp = getLe16((uint16_t const   *)(& temp.lang));
#line 817
  tmp___0 = usbGetDescriptor(dev, (uint8_t )3, (uint8_t )idx, tmp, (uint16_t )bufsize,
                             buf);
  }
#line 817
  return (tmp___0);
}
}
#line 821 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbResetDevice(USBDevice *dev ) 
{ 
  int error ;
  int *tmp ;
  int tmp___0 ;

  {
  {
#line 825
  error = usbOpen(dev, 1);
  }
#line 826
  if (error < 0) {
#line 827
    return (error);
  }
  {
#line 828
  tmp___0 = ioctl(dev->fd, (unsigned long )((unsigned int )(85 << 8) | 20U), (void *)0);
  }
#line 828
  if (tmp___0 == -1) {
    {
#line 829
    tmp = __errno_location();
    }
#line 829
    return (- *tmp);
  }
#line 830
  return (0);
}
}
#line 833 "/home/june/collector/temp/aes2501-wy-0.1/usb.c"
int usbSetInterface(USBDevice *dev , uint8_t iface , uint8_t altsetting ) 
{ 
  int error ;
  struct usbdevfs_setinterface si ;
  int *tmp ;
  int tmp___0 ;

  {
  {
#line 838
  error = usbOpen(dev, 1);
  }
#line 839
  if (error < 0) {
#line 840
    return (error);
  }
  {
#line 841
  si.interface = (unsigned int )iface;
#line 842
  si.altsetting = (unsigned int )altsetting;
#line 843
  tmp___0 = ioctl(dev->fd, (unsigned long )(((2U << 30) | (unsigned int )(85 << 8)) | 4U) | (sizeof(struct usbdevfs_setinterface ) << 16),
                  & si);
  }
#line 843
  if (tmp___0 == -1) {
    {
#line 844
    tmp = __errno_location();
    }
#line 844
    return (- *tmp);
  }
#line 845
  return (0);
}
}
/* compiler builtin: 
   void __builtin_va_start(__builtin_va_list  ) ;  */
/* compiler builtin: 
   void __builtin_va_end(__builtin_va_list  ) ;  */
#line 717 "/usr/include/stdlib.h"
extern int system(char const   *__command ) ;
#line 237 "/usr/include/stdio.h"
extern int fclose(FILE *__stream ) ;
#line 272
extern FILE *fopen(char const   * __restrict  __filename , char const   * __restrict  __modes ) ;
#line 362
extern int printf(char const   * __restrict  __format  , ...) ;
#line 371
extern int vfprintf(FILE * __restrict  __s , char const   * __restrict  __format ,
                    __gnuc_va_list __arg ) ;
#line 715
extern size_t fwrite(void const   * __restrict  __ptr , size_t __size , size_t __n ,
                     FILE * __restrict  __s ) ;
#line 46 "/usr/include/string.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__nonnull__(1,2), __leaf__)) memcpy)(void * __restrict  __dest ,
                                                                                                 void const   * __restrict  __src ,
                                                                                                 size_t __n ) ;
#line 460 "/usr/include/unistd.h"
extern int usleep(__useconds_t __useconds ) ;
#line 40 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static int debug_level  =    0;
#line 41 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static time_t tstart_sec  =    (time_t )0;
#line 42 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint32_t tstart_usec  =    (uint32_t )0;
#line 45 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void dbg(int level , char const   *format  , ...) 
{ 
  va_list ap ;
  char buf[400] ;

  {
#line 51
  if (level > debug_level) {
#line 52
    return;
  }
  {
#line 53
  snprintf((char */* __restrict  */)(buf), sizeof(buf), (char const   */* __restrict  */)"[aes2501] %s",
           format);
#line 54
  __builtin_va_start(ap, format);
#line 55
  vfprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)(buf),
           ap);
#line 56
  __builtin_va_end(ap);
  }
#line 57
  return;
}
}
#line 62
static void u8tohex(uint8_t x , char *str ) ;
#line 62 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static char const   hdigit[16]  = 
#line 62
  {      (char const   )'0',      (char const   )'1',      (char const   )'2',      (char const   )'3', 
        (char const   )'4',      (char const   )'5',      (char const   )'6',      (char const   )'7', 
        (char const   )'8',      (char const   )'9',      (char const   )'a',      (char const   )'b', 
        (char const   )'c',      (char const   )'d',      (char const   )'e',      (char const   )'f'};
#line 59 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void u8tohex(uint8_t x , char *str ) 
{ 


  {
#line 64
  *(str + 0) = (char )hdigit[((int )x >> 4) & 15];
#line 65
  *(str + 1) = (char )hdigit[(int )x & 15];
#line 66
  *(str + 2) = (char )'\000';
#line 67
  return;
}
}
#line 69 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void u32tohex(uint32_t x , char *str ) 
{ 


  {
  {
#line 72
  u8tohex((uint8_t )(x >> 24), str);
#line 73
  u8tohex((uint8_t )(x >> 16), str + 2);
#line 74
  u8tohex((uint8_t )(x >> 8), str + 4);
#line 75
  u8tohex((uint8_t )x, str + 6);
  }
#line 76
  return;
}
}
#line 78 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
void hexdump(int level , void const   *d_ , unsigned int len ) 
{ 
  uint8_t const   *d ;
  unsigned int ofs ;
  unsigned int c ;
  char line[100] ;
  char *p ;

  {
#line 80
  d = (uint8_t const   *)d_;
#line 84
  if (level > debug_level) {
#line 85
    return;
  }
#line 86
  ofs = 0U;
  {
#line 87
  while (1) {
    while_continue: /* CIL Label */ ;
#line 87
    if (! (ofs < len)) {
#line 87
      goto while_break;
    }
    {
#line 89
    line[0] = (char )' ';
#line 90
    u32tohex(ofs, line + 1);
#line 91
    line[9] = (char )':';
#line 92
    p = line + 10;
#line 93
    c = 0U;
    }
    {
#line 93
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 93
      if (c != 16U) {
#line 93
        if (! (ofs + c < len)) {
#line 93
          goto while_break___0;
        }
      } else {
#line 93
        goto while_break___0;
      }
      {
#line 94
      u8tohex((uint8_t )*(d + (ofs + c)), p);
#line 95
      *(p + 2) = (char )' ';
#line 96
      p += 3;
      }
#line 97
      if (c == 7U) {
#line 98
        *(p + 0) = (char )' ';
#line 99
        p ++;
      }
#line 93
      c ++;
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 102
    *(p + 0) = (char )'\000';
#line 103
    dbg(level, "%s\n", line);
#line 104
    ofs += c;
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 106
  return;
}
}
#line 108 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void get_time(time_t *sec , uint32_t *usec ) 
{ 
  struct timeval tv ;

  {
  {
#line 113
  gettimeofday((struct timeval */* __restrict  */)(& tv), (__timezone_ptr_t )((void *)0));
  }
#line 114
  if (sec) {
#line 115
    *sec = tv.tv_sec;
  }
#line 116
  if (usec) {
#line 117
    *usec = (uint32_t )tv.tv_usec;
  }
#line 118
  return;
}
}
#line 120 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void time2str(char *buf , unsigned int size ) 
{ 
  time_t sec ;
  uint32_t usec ;

  {
  {
#line 126
  get_time(& sec, & usec);
#line 127
  sec -= tstart_sec;
  }
#line 128
  if (usec >= tstart_usec) {
#line 129
    usec -= tstart_usec;
  } else {
#line 131
    usec = (1000000U + usec) - tstart_usec;
#line 132
    sec --;
  }
#line 136
  return;
}
}
#line 138 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void dump(int level , char const   *type , void const   *data , int len , int size ,
                 int max ) 
{ 
  int actual_len ;
  int print_len ;
  char buf[20] ;
  char *tmp ;

  {
#line 145
  if (level > debug_level) {
#line 146
    return;
  }
#line 147
  if (debug_level >= 20) {
#line 148
    max = -1;
  }
  {
#line 150
  time2str(buf, (unsigned int )sizeof(buf));
#line 151
  dbg(level, "%s T=%s len=%d\n", type, buf, len);
  }
#line 153
  if (size >= 0) {
#line 153
    actual_len = size;
  } else {
#line 153
    actual_len = len;
  }
#line 154
  if (max >= 0) {
#line 154
    if (max < actual_len) {
#line 154
      print_len = max;
    } else {
#line 154
      print_len = actual_len;
    }
  } else {
#line 154
    print_len = actual_len;
  }
#line 155
  if (print_len >= 0) {
    {
#line 156
    hexdump(level, data, (unsigned int )print_len);
    }
#line 157
    if (print_len < actual_len) {
      {
#line 158
      dbg(level, " ...\n");
      }
    }
  }
#line 160
  if (len < 0) {
    {
#line 161
    tmp = strerror(- len);
#line 161
    dbg(level, "  ERROR: %s\n", tmp);
    }
  }
  {
#line 162
  dbg(level, "\n");
  }
#line 163
  return;
}
}
#line 182
void aesClose(struct AES *aes ) ;
#line 184 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
struct AES *aesOpen(USBDeviceLocation dl ) 
{ 
  struct AES *aes ;
  USBDevice *usb ;
  void *tmp ;

  {
  {
#line 189
  tmp = calloc((size_t )1, sizeof(*aes));
#line 189
  aes = (struct AES *)tmp;
  }
#line 190
  if (! aes) {
#line 191
    return ((struct AES *)((void *)0));
  }
  {
#line 192
  aes->usb = usbGetDevice(dl);
  }
#line 193
  if (! aes->usb) {
#line 194
    goto rollback;
  }
  {
#line 195
  usb = aes->usb;
#line 196
  aes->epOut = (USBEndpoint )2;
#line 197
  aes->epIn = (USBEndpoint )129;
#line 198
  aes->fingerTh1 = 20U;
#line 199
  aes->fingerTh2 = 0U;
#line 200
  usbClaimInterface(usb, 0U);
#line 201
  usbSetInterface(usb, (uint8_t )0, (uint8_t )0);
  }
#line 202
  return (aes);
  rollback: 
  {
#line 205
  aesClose(aes);
  }
#line 206
  return ((struct AES *)((void *)0));
}
}
#line 209 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
void aesClose(struct AES *aes ) 
{ 


  {
#line 211
  if (! aes) {
#line 212
    return;
  }
#line 213
  if (aes->usb) {
    {
#line 214
    usbReleaseInterface(aes->usb, 0U);
#line 215
    usbFreeDevice(aes->usb);
    }
  }
  {
#line 217
  memset((void *)aes, 0, sizeof(*aes));
#line 218
  free((void *)aes);
  }
#line 219
  return;
}
}
#line 221 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static int aesWrite(struct AES *aes , void const   *data , unsigned int len ) 
{ 
  int res ;

  {
  {
#line 226
  res = usbSendBulkMsg(aes->usb, aes->epOut, (void *)data, len, 1000);
#line 227
  dump(10, "OUT ", data, res, (int )len, -1);
  }
#line 228
  return (res);
}
}
#line 231 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static int aesRead(struct AES *aes , void *data , unsigned int size ) 
{ 
  int res ;

  {
  {
#line 236
  res = usbSendBulkMsg(aes->usb, aes->epIn, data, size, 1000);
#line 237
  dump(10, "IN  ", (void const   *)data, res, -1, 64);
  }
#line 238
  return (res);
}
}
#line 253 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void aesExec(struct AES *aes , uint8_t const   *cmd___3 , AESReplyBuffer *rbuf ) 
{ 
  unsigned int len ;
  int count ;

  {
  {
#line 256
  while (1) {
    while_continue: /* CIL Label */ ;
#line 256
    if (! ((int const   )*(cmd___3 + 0) != 0)) {
#line 256
      goto while_break;
    }
#line 257
    len = (unsigned int )*(cmd___3 + 0);
#line 258
    if (len == 255U) {
      {
#line 260
      usleep(((unsigned int )*(cmd___3 + 1) + 256U * (unsigned int )*(cmd___3 + 2)) * 1000U);
#line 261
      cmd___3 += 3;
      }
    } else
#line 262
    if (len == 254U) {
      {
#line 264
      count = (int )((int const   )*(cmd___3 + 1) + (int const   )(256 * (int )*(cmd___3 + 2)));
#line 265
      rbuf->length = aesRead(aes, (void *)rbuf->buf, (unsigned int )count);
      }
#line 266
      if (count != rbuf->length) {
        {
#line 267
        dbg(1, "Request %d bytes but got %d bytes.\n", count, rbuf->length);
        }
      }
#line 270
      cmd___3 += 3;
#line 271
      rbuf ++;
    } else {
      {
#line 274
      aesWrite(aes, (void const   *)(cmd___3 + 1), len);
#line 275
      cmd___3 += len + 1U;
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 278
  return;
}
}
#line 282
void aesStandby(struct AES *aes ) ;
#line 282 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd[14]  = 
#line 282
  {      (uint8_t const   )255,      (uint8_t const   )32,      (uint8_t const   )((800 >> 8) & 255),      (uint8_t const   )6, 
        (uint8_t const   )172,      (uint8_t const   )1,      (uint8_t const   )173,      (uint8_t const   )26, 
        (uint8_t const   )129,      (uint8_t const   )2,      (uint8_t const   )254,      (uint8_t const   )2, 
        (uint8_t const   )((2 >> 8) & 255),      (uint8_t const   )0};
#line 280 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
void aesStandby(struct AES *aes ) 
{ 
  uint8_t tmp[2] ;
  AESReplyBuffer rbuf[1] ;

  {
  {
#line 289
  rbuf[0].length = 2;
#line 289
  rbuf[0].buf = tmp;
#line 291
  aesExec(aes, cmd, rbuf);
  }
#line 292
  return;
}
}
#line 298
void aesSetup(struct AES *aes ) ;
#line 298 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd1[137]  = 
#line 298
  {      (uint8_t const   )4,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )129, 
        (uint8_t const   )2,      (uint8_t const   )254,      (uint8_t const   )126,      (uint8_t const   )((126 >> 8) & 255), 
        (uint8_t const   )2,      (uint8_t const   )176,      (uint8_t const   )39,      (uint8_t const   )4, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )200, 
        (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2,      (uint8_t const   )255,      (uint8_t const   )0, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )200, 
        (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2,      (uint8_t const   )255,      (uint8_t const   )0, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )200, 
        (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2,      (uint8_t const   )255,      (uint8_t const   )0, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )200, 
        (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2,      (uint8_t const   )255,      (uint8_t const   )0, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )200, 
        (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2,      (uint8_t const   )255,      (uint8_t const   )0, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )100, 
        (uint8_t const   )((100 >> 8) & 255),      (uint8_t const   )42,      (uint8_t const   )128,      (uint8_t const   )1, 
        (uint8_t const   )130,      (uint8_t const   )64,      (uint8_t const   )131,      (uint8_t const   )0, 
        (uint8_t const   )136,      (uint8_t const   )2,      (uint8_t const   )137,      (uint8_t const   )16, 
        (uint8_t const   )138,      (uint8_t const   )5,      (uint8_t const   )140,      (uint8_t const   )0, 
        (uint8_t const   )142,      (uint8_t const   )19,      (uint8_t const   )145,      (uint8_t const   )68, 
        (uint8_t const   )146,      (uint8_t const   )52,      (uint8_t const   )149,      (uint8_t const   )22, 
        (uint8_t const   )150,      (uint8_t const   )22,      (uint8_t const   )151,      (uint8_t const   )24, 
        (uint8_t const   )161,      (uint8_t const   )112,      (uint8_t const   )162,      (uint8_t const   )2, 
        (uint8_t const   )167,      (uint8_t const   )0,      (uint8_t const   )172,      (uint8_t const   )1, 
        (uint8_t const   )173,      (uint8_t const   )26,      (uint8_t const   )128,      (uint8_t const   )4, 
        (uint8_t const   )129,      (uint8_t const   )4,      (uint8_t const   )180,      (uint8_t const   )0, 
        (uint8_t const   )254,      (uint8_t const   )20,      (uint8_t const   )((20 >> 8) & 255),      (uint8_t const   )4, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64, 
        (uint8_t const   )0};
#line 336 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd2[20]  = 
#line 336
  {      (uint8_t const   )255,      (uint8_t const   )100,      (uint8_t const   )((100 >> 8) & 255),      (uint8_t const   )12, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )168,      (uint8_t const   )65, 
        (uint8_t const   )130,      (uint8_t const   )66,      (uint8_t const   )131,      (uint8_t const   )83, 
        (uint8_t const   )128,      (uint8_t const   )4,      (uint8_t const   )129,      (uint8_t const   )2, 
        (uint8_t const   )254,      (uint8_t const   )126,      (uint8_t const   )((126 >> 8) & 255),      (uint8_t const   )0};
#line 343 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd3[26]  = 
#line 343
  {      (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )80, 
        (uint8_t const   )((80 >> 8) & 255),      (uint8_t const   )12,      (uint8_t const   )128,      (uint8_t const   )1, 
        (uint8_t const   )168,      (uint8_t const   )65,      (uint8_t const   )130,      (uint8_t const   )66, 
        (uint8_t const   )131,      (uint8_t const   )83,      (uint8_t const   )128,      (uint8_t const   )4, 
        (uint8_t const   )129,      (uint8_t const   )2,      (uint8_t const   )254,      (uint8_t const   )126, 
        (uint8_t const   )((126 >> 8) & 255),      (uint8_t const   )0};
#line 352 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd4[16]  = 
#line 352
  {      (uint8_t const   )14,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130, 
        (uint8_t const   )64,      (uint8_t const   )176,      (uint8_t const   )39,      (uint8_t const   )148, 
        (uint8_t const   )10,      (uint8_t const   )128,      (uint8_t const   )4,      (uint8_t const   )131, 
        (uint8_t const   )69,      (uint8_t const   )168,      (uint8_t const   )65,      (uint8_t const   )0};
#line 296 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
void aesSetup(struct AES *aes ) 
{ 
  uint8_t tmp[200] ;
  AESReplyBuffer rbuf[2] ;

  {
  {
#line 358
  rbuf[0].length = 126;
#line 358
  rbuf[0].buf = tmp;
#line 358
  rbuf[1].length = 20;
#line 358
  rbuf[1].buf = tmp + 126;
#line 363
  aesExec(aes, cmd1, rbuf);
#line 364
  aesExec(aes, cmd2, rbuf);
  }
  {
#line 365
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 366
    dbg(3, "reg 0xaf = 0x%x\n", (int )*(rbuf[0].buf + 95));
    }
#line 367
    if ((int )*(rbuf[0].buf + 95) != 107) {
#line 368
      goto while_break;
    }
    {
#line 369
    aesExec(aes, cmd3, rbuf);
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 371
  aesExec(aes, cmd4, (AESReplyBuffer *)((void *)0));
#line 372
  aesStandby(aes);
  }
#line 373
  return;
}
}
#line 378
static void aesStartScan(struct AES *aes ) ;
#line 378 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd1___0[55]  = 
#line 378
  {      (uint8_t const   )2,      (uint8_t const   )176,      (uint8_t const   )39,      (uint8_t const   )4, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )4,      (uint8_t const   )128, 
        (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64,      (uint8_t const   )4, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64, 
        (uint8_t const   )255,      (uint8_t const   )50,      (uint8_t const   )((50 >> 8) & 255),      (uint8_t const   )4, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64, 
        (uint8_t const   )4,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130, 
        (uint8_t const   )64,      (uint8_t const   )4,      (uint8_t const   )128,      (uint8_t const   )1, 
        (uint8_t const   )130,      (uint8_t const   )64,      (uint8_t const   )2,      (uint8_t const   )128, 
        (uint8_t const   )2,      (uint8_t const   )2,      (uint8_t const   )128,      (uint8_t const   )2, 
        (uint8_t const   )2,      (uint8_t const   )129,      (uint8_t const   )2,      (uint8_t const   )254, 
        (uint8_t const   )126,      (uint8_t const   )((126 >> 8) & 255),      (uint8_t const   )0};
#line 375 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void aesStartScan(struct AES *aes ) 
{ 
  uint8_t buf[126] ;
  AESReplyBuffer rbuf[1] ;

  {
  {
#line 396
  rbuf[0].length = 126;
#line 396
  rbuf[0].buf = buf;
#line 398
  aesExec(aes, cmd1___0, rbuf);
  }
#line 399
  return;
}
}
#line 406
int aesDetectFinger(struct AES *aes ) ;
#line 406 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd___0[55]  = 
#line 406
  {      (uint8_t const   )4,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130, 
        (uint8_t const   )64,      (uint8_t const   )255,      (uint8_t const   )30,      (uint8_t const   )((30 >> 8) & 255), 
        (uint8_t const   )42,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130, 
        (uint8_t const   )64,      (uint8_t const   )131,      (uint8_t const   )0,      (uint8_t const   )136, 
        (uint8_t const   )2,      (uint8_t const   )137,      (uint8_t const   )16,      (uint8_t const   )138, 
        (uint8_t const   )5,      (uint8_t const   )140,      (uint8_t const   )0,      (uint8_t const   )142, 
        (uint8_t const   )19,      (uint8_t const   )145,      (uint8_t const   )68,      (uint8_t const   )146, 
        (uint8_t const   )52,      (uint8_t const   )149,      (uint8_t const   )22,      (uint8_t const   )150, 
        (uint8_t const   )22,      (uint8_t const   )151,      (uint8_t const   )24,      (uint8_t const   )161, 
        (uint8_t const   )112,      (uint8_t const   )162,      (uint8_t const   )2,      (uint8_t const   )167, 
        (uint8_t const   )0,      (uint8_t const   )172,      (uint8_t const   )1,      (uint8_t const   )173, 
        (uint8_t const   )26,      (uint8_t const   )128,      (uint8_t const   )4,      (uint8_t const   )129, 
        (uint8_t const   )4,      (uint8_t const   )180,      (uint8_t const   )0,      (uint8_t const   )254, 
        (uint8_t const   )20,      (uint8_t const   )((20 >> 8) & 255),      (uint8_t const   )0};
#line 404 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
int aesDetectFinger(struct AES *aes ) 
{ 
  uint8_t buf[20] ;
  AESReplyBuffer rbuf[1] ;
  unsigned int i ;
  unsigned int sum ;

  {
  {
#line 419
  rbuf[0].length = 20;
#line 419
  rbuf[0].buf = buf;
#line 422
  aesExec(aes, cmd___0, rbuf);
#line 425
  sum = 0U;
#line 426
  i = 1U;
  }
  {
#line 426
  while (1) {
    while_continue: /* CIL Label */ ;
#line 426
    if (! (i != 9U)) {
#line 426
      goto while_break;
    }
#line 427
    sum += (unsigned int )(((int )buf[i] & 15) + ((int )buf[i] >> 4));
#line 426
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 429
  dbg(3, "sum = %u\n", sum);
  }
#line 430
  return (sum > aes->fingerTh1);
}
}
#line 436
unsigned int aesReadFingerprint(struct AES *aes , void *raw_ , unsigned int maxstrip ) ;
#line 436 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd1___1[60]  = 
#line 436
  {      (uint8_t const   )4,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130, 
        (uint8_t const   )64,      (uint8_t const   )50,      (uint8_t const   )128,      (uint8_t const   )1, 
        (uint8_t const   )130,      (uint8_t const   )64,      (uint8_t const   )131,      (uint8_t const   )0, 
        (uint8_t const   )136,      (uint8_t const   )2,      (uint8_t const   )140,      (uint8_t const   )124, 
        (uint8_t const   )137,      (uint8_t const   )16,      (uint8_t const   )141,      (uint8_t const   )36, 
        (uint8_t const   )155,      (uint8_t const   )0,      (uint8_t const   )156,      (uint8_t const   )108, 
        (uint8_t const   )157,      (uint8_t const   )9,      (uint8_t const   )158,      (uint8_t const   )84, 
        (uint8_t const   )159,      (uint8_t const   )120,      (uint8_t const   )162,      (uint8_t const   )2, 
        (uint8_t const   )167,      (uint8_t const   )0,      (uint8_t const   )182,      (uint8_t const   )38, 
        (uint8_t const   )183,      (uint8_t const   )26,      (uint8_t const   )128,      (uint8_t const   )4, 
        (uint8_t const   )152,      (uint8_t const   )35,      (uint8_t const   )149,      (uint8_t const   )16, 
        (uint8_t const   )150,      (uint8_t const   )31,      (uint8_t const   )142,      (uint8_t const   )0, 
        (uint8_t const   )145,      (uint8_t const   )112,      (uint8_t const   )146,      (uint8_t const   )32, 
        (uint8_t const   )129,      (uint8_t const   )4,      (uint8_t const   )180,      (uint8_t const   )0, 
        (uint8_t const   )254,      (uint8_t const   )159,      (uint8_t const   )((159 >> 8) & 255),      (uint8_t const   )0};
#line 448 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd2___0[19]  = 
#line 448
  {      (uint8_t const   )14,      (uint8_t const   )152,      (uint8_t const   )35,      (uint8_t const   )149, 
        (uint8_t const   )16,      (uint8_t const   )150,      (uint8_t const   )31,      (uint8_t const   )142, 
        (uint8_t const   )3,      (uint8_t const   )145,      (uint8_t const   )112,      (uint8_t const   )146, 
        (uint8_t const   )32,      (uint8_t const   )129,      (uint8_t const   )4,      (uint8_t const   )254, 
        (uint8_t const   )159,      (uint8_t const   )((159 >> 8) & 255),      (uint8_t const   )0};
#line 454 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd3___0[19]  = 
#line 454
  {      (uint8_t const   )14,      (uint8_t const   )152,      (uint8_t const   )34,      (uint8_t const   )149, 
        (uint8_t const   )0,      (uint8_t const   )150,      (uint8_t const   )47,      (uint8_t const   )142, 
        (uint8_t const   )3,      (uint8_t const   )145,      (uint8_t const   )91,      (uint8_t const   )146, 
        (uint8_t const   )32,      (uint8_t const   )129,      (uint8_t const   )4,      (uint8_t const   )254, 
        (uint8_t const   )169,      (uint8_t const   )((1705 >> 8) & 255),      (uint8_t const   )0};
#line 433 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
unsigned int aesReadFingerprint(struct AES *aes , void *raw_ , unsigned int maxstrip ) 
{ 
  uint8_t buf[1705] ;
  AESReplyBuffer rbuf[1] ;
  uint8_t *raw ;
  unsigned int nstrips ;
  unsigned int sum ;
  int i ;
  uint16_t *histogram ;

  {
  {
#line 461
  rbuf[0].length = 1705;
#line 461
  rbuf[0].buf = buf;
#line 462
  raw = (uint8_t *)raw_;
#line 465
  aesExec(aes, cmd1___1, rbuf);
#line 467
  aesExec(aes, cmd2___0, rbuf);
#line 468
  nstrips = 0U;
  }
  {
#line 469
  while (1) {
    while_continue: /* CIL Label */ ;
    {
#line 477
    aesExec(aes, cmd3___0, rbuf);
#line 478
    memcpy((void */* __restrict  */)raw, (void const   */* __restrict  */)(buf + 1),
           (size_t )1536);
#line 479
    raw += 1536;
#line 481
    sum = 0U;
#line 483
    histogram = (uint16_t *)(((buf + 1) + 1536) + 1);
#line 484
    i = 10;
    }
    {
#line 484
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 484
      if (! (i != 16)) {
#line 484
        goto while_break___0;
      }
#line 487
      sum += (unsigned int )*(histogram + i);
#line 484
      i ++;
    }
    while_break___0: /* CIL Label */ ;
    }
    {
#line 489
    dbg(3, "sum = %u\n", sum);
#line 490
    nstrips ++;
    }
#line 469
    if (sum > aes->fingerTh2) {
#line 469
      if (! (nstrips < maxstrip)) {
#line 469
        goto while_break;
      }
    } else {
#line 469
      goto while_break;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 492
  dbg(3, "nstrips = %u\n", nstrips);
  }
#line 493
  if (nstrips == maxstrip) {
    {
#line 494
    dbg(2, "nstrips == %u, swiping the finger too slowly?\n", maxstrip);
    }
  }
#line 495
  return (nstrips);
}
}
#line 502 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static unsigned int rms2_diff(uint8_t const   *img1 , uint8_t const   *img2 , unsigned int n ) 
{ 
  unsigned int d ;
  unsigned int i ;
  int temp ;

  {
#line 506
  d = 0U;
#line 509
  i = 0U;
  {
#line 509
  while (1) {
    while_continue: /* CIL Label */ ;
#line 509
    if (! (i != n)) {
#line 509
      goto while_break;
    }
#line 510
    temp = (int )((int const   )*(img1 + i) - (int const   )*(img2 + i));
#line 511
    d += (unsigned int )(temp * temp);
#line 509
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 513
  return ((d * 1024U) / n);
}
}
#line 518 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static unsigned int findMovement(uint8_t const   *img1 , uint8_t const   *img2 , unsigned int h ) 
{ 
  unsigned int mindiff ;
  unsigned int shift ;
  unsigned int i ;
  unsigned int d ;
  unsigned int tmp ;

  {
  {
#line 523
  shift = 0U;
#line 524
  mindiff = rms2_diff(img1, img2, 192U * h);
#line 525
  i = 1U;
  }
  {
#line 525
  while (1) {
    while_continue: /* CIL Label */ ;
#line 525
    if (! (i != h)) {
#line 525
      goto while_break;
    }
    {
#line 526
    tmp = rms2_diff(img1 + 192U * i, img2, 192U * (h - i));
#line 526
    d = tmp;
    }
#line 527
    if (d < mindiff) {
#line 528
      mindiff = d;
#line 529
      shift = i;
    }
#line 525
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 532
  dbg(3, " shift = %u, mindiff = %u\n", shift, mindiff);
  }
#line 533
  return (shift);
}
}
#line 536 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static unsigned int assemble(uint8_t const   *raw , uint8_t *img , unsigned int nstrips ,
                             int overlap , unsigned int reverse ) 
{ 
  uint8_t *img2 ;
  unsigned int s ;
  unsigned int r ;
  unsigned int c ;
  unsigned int h ;
  unsigned int o ;
  unsigned int tmp ;

  {
#line 540
  img2 = img;
#line 543
  if (reverse) {
#line 544
    raw += 1536U * (nstrips - 1U);
  }
#line 547
  s = 0U;
  {
#line 547
  while (1) {
    while_continue: /* CIL Label */ ;
#line 547
    if (! (s != nstrips)) {
#line 547
      goto while_break;
    }
#line 548
    c = 0U;
    {
#line 548
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 548
      if (! (c != 192U)) {
#line 548
        goto while_break___0;
      }
#line 549
      r = 0U;
      {
#line 549
      while (1) {
        while_continue___1: /* CIL Label */ ;
#line 549
        if (! (r != 8U)) {
#line 549
          goto while_break___1;
        }
#line 550
        *(img + (192U * (2U * r) + c)) = (uint8_t )((int const   )*(raw + (r + 8U * c)) & 15);
#line 551
        *(img + (192U * (2U * r + 1U) + c)) = (uint8_t )((int const   )*(raw + (r + 8U * c)) >> 4);
#line 549
        r ++;
      }
      while_break___1: /* CIL Label */ ;
      }
#line 548
      c ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 554
    img += 3072;
#line 555
    if (reverse) {
#line 556
      raw -= 1536;
    } else {
#line 558
      raw += 1536;
    }
#line 547
    s ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 561
  if (overlap) {
#line 562
    img = img2;
#line 563
    img2 = img + 3072;
#line 565
    h = 0U;
#line 566
    s = 1U;
    {
#line 566
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 566
      if (! (s != nstrips)) {
#line 566
        goto while_break___2;
      }
      {
#line 567
      tmp = findMovement((uint8_t const   *)img, (uint8_t const   *)img2, 16U);
#line 567
      o = tmp;
#line 568
      img += 192U * o;
#line 569
      memcpy((void */* __restrict  */)img, (void const   */* __restrict  */)img2,
             (size_t )3072);
#line 570
      img2 += 3072;
#line 571
      h += o;
#line 566
      s ++;
      }
    }
    while_break___2: /* CIL Label */ ;
    }
#line 573
    return (h + 16U);
  } else {
#line 575
    return (nstrips * 16U);
  }
}
}
#line 579 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void toPNM(void const   *img_ , unsigned int w , unsigned int h , char const   *fn ) 
{ 
  FILE *f ;
  uint8_t const   *img ;
  unsigned int i ;
  uint8_t temp ;

  {
  {
#line 583
  img = (uint8_t const   *)img_;
#line 587
  f = fopen((char const   */* __restrict  */)fn, (char const   */* __restrict  */)"wb");
#line 588
  fprintf((FILE */* __restrict  */)f, (char const   */* __restrict  */)"P5\n%u %u\n255\n",
          w, h);
#line 589
  i = 0U;
  }
  {
#line 589
  while (1) {
    while_continue: /* CIL Label */ ;
#line 589
    if (! (i != w * h)) {
#line 589
      goto while_break;
    }
    {
#line 590
    temp = (uint8_t )(((int const   )*(img + i) << 4) + 15);
#line 591
    fwrite((void const   */* __restrict  */)(& temp), (size_t )1, (size_t )1, (FILE */* __restrict  */)f);
#line 589
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 593
  fclose(f);
  }
#line 594
  return;
}
}
#line 601 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static USBDeviceLocation deviceLocation  ;
#line 602 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static unsigned int ndevices  ;
#line 604 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static int attach(USBDeviceLocation dl , void *dummy ) 
{ 


  {
#line 607
  deviceLocation = dl;
#line 608
  ndevices = 1U;
#line 609
  return (1);
}
}
#line 612 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void init(void) 
{ 


  {
  {
#line 615
  get_time(& tstart_sec, & tstart_usec);
#line 616
  usbInit((char const   *)((void *)0));
#line 617
  ndevices = 0U;
#line 618
  usbFindDevices((uint16_t )2303, (uint16_t )9600, & attach, (void *)0);
  }
#line 619
  return;
}
}
#line 621 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void cleanup(void) 
{ 


  {
  {
#line 624
  usbCleanup();
  }
#line 625
  return;
}
}
#line 627 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
int main(int argc , char **argv ) 
{ 
  AES *aes ;
  char fp_pnm[7] ;
  char fporig_pnm[11] ;
  char displayCmd[100] ;
  uint8_t *raw ;
  uint8_t *cooked ;
  unsigned int swidth ;
  unsigned int sheight ;
  unsigned int maxstrip ;
  unsigned int nstrips ;
  unsigned int height ;
  unsigned int reverse ;
  int tmp ;
  void *tmp___0 ;
  int tmp___1 ;

  {
  {
#line 630
  fp_pnm[0] = (char )'f';
#line 630
  fp_pnm[1] = (char )'p';
#line 630
  fp_pnm[2] = (char )'.';
#line 630
  fp_pnm[3] = (char )'p';
#line 630
  fp_pnm[4] = (char )'n';
#line 630
  fp_pnm[5] = (char )'m';
#line 630
  fp_pnm[6] = (char )'\000';
#line 631
  fporig_pnm[0] = (char )'f';
#line 631
  fporig_pnm[1] = (char )'p';
#line 631
  fporig_pnm[2] = (char )'o';
#line 631
  fporig_pnm[3] = (char )'r';
#line 631
  fporig_pnm[4] = (char )'i';
#line 631
  fporig_pnm[5] = (char )'g';
#line 631
  fporig_pnm[6] = (char )'.';
#line 631
  fporig_pnm[7] = (char )'p';
#line 631
  fporig_pnm[8] = (char )'n';
#line 631
  fporig_pnm[9] = (char )'m';
#line 631
  fporig_pnm[10] = (char )'\000';
#line 634
  swidth = 192U;
#line 635
  sheight = 16U;
#line 636
  maxstrip = 150U;
#line 638
  reverse = 0U;
#line 640
  printf((char const   */* __restrict  */)"argc=%d ", argc);
  }
#line 641
  if (argc > 1) {
    {
#line 641
    tmp = strcmp((char const   *)*(argv + 1), "-r");
    }
#line 641
    if (tmp == 0) {
      {
#line 642
      reverse = 1U;
#line 643
      printf((char const   */* __restrict  */)"Param=%s\n", *(argv + 1));
      }
    }
  }
  {
#line 645
  printf((char const   */* __restrict  */)"Initializing, please standby...\n");
#line 646
  init();
  }
#line 647
  if (ndevices == 0U) {
    {
#line 648
    printf((char const   */* __restrict  */)"No device found\n");
    }
#line 649
    return (1);
  }
  {
#line 651
  tmp___0 = malloc((size_t )((((3U * maxstrip) * sheight) * swidth) / 2U));
#line 651
  raw = (uint8_t *)tmp___0;
#line 652
  cooked = raw + ((maxstrip * sheight) * swidth) / 2U;
#line 653
  snprintf((char */* __restrict  */)(displayCmd), sizeof(displayCmd), (char const   */* __restrict  */)"display %s %s",
           fp_pnm, fporig_pnm);
#line 654
  aes = aesOpen(deviceLocation);
  }
#line 655
  if (aes) {
    {
#line 656
    printf((char const   */* __restrict  */)"aesSetup()...\n");
#line 657
    aesSetup(aes);
#line 658
    printf((char const   */* __restrict  */)"aesStartScan()...\n");
#line 659
    aesStartScan(aes);
    }
    {
#line 660
    while (1) {
      while_continue: /* CIL Label */ ;
      {
#line 661
      printf((char const   */* __restrict  */)"READY (touch the sensor to stop)\n");
      }
      {
#line 662
      while (1) {
        while_continue___0: /* CIL Label */ ;
        {
#line 662
        tmp___1 = aesDetectFinger(aes);
        }
#line 662
        if (tmp___1) {
#line 662
          goto while_break___0;
        }
      }
      while_break___0: /* CIL Label */ ;
      }
      {
#line 664
      printf((char const   */* __restrict  */)"Scanning...\n");
#line 665
      nstrips = aesReadFingerprint(aes, (void *)raw, maxstrip);
#line 667
      printf((char const   */* __restrict  */)"Assembling...\n");
#line 668
      height = assemble((uint8_t const   *)raw, cooked, nstrips, 1, reverse);
      }
#line 669
      if (height >= 100U) {
        {
#line 672
        toPNM((void const   *)cooked, swidth, height, (char const   *)(fp_pnm));
#line 673
        height = assemble((uint8_t const   *)raw, cooked, nstrips, 0, reverse);
#line 674
        toPNM((void const   *)cooked, swidth, height, (char const   *)(fporig_pnm));
#line 676
        system((char const   *)(displayCmd));
#line 677
        printf((char const   */* __restrict  */)"\n");
        }
      }
    }
    while_break: /* CIL Label */ ;
    }
    {
#line 680
    printf((char const   */* __restrict  */)"Terminating...\n");
#line 681
    aesStandby(aes);
#line 682
    aesClose(aes);
    }
  }
  {
#line 684
  cleanup();
#line 685
  free((void *)raw);
  }
#line 687
  return (0);
}
}
#line 40 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static int debug_level___0  =    0;
#line 41 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static time_t tstart_sec___0  =    (time_t )0;
#line 42 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint32_t tstart_usec___0  =    (uint32_t )0;
#line 45 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void dbg___0(int level , char const   *format  , ...) 
{ 
  va_list ap ;
  char buf[400] ;

  {
#line 51
  if (level > debug_level___0) {
#line 52
    return;
  }
  {
#line 53
  snprintf((char */* __restrict  */)(buf), sizeof(buf), (char const   */* __restrict  */)"[aes2501] %s",
           format);
#line 54
  __builtin_va_start(ap, format);
#line 55
  vfprintf((FILE */* __restrict  */)stderr, (char const   */* __restrict  */)(buf),
           ap);
#line 56
  __builtin_va_end(ap);
  }
#line 57
  return;
}
}
#line 62
static void u8tohex___0(uint8_t x , char *str ) ;
#line 62 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static char const   hdigit___0[16]  = 
#line 62
  {      (char const   )'0',      (char const   )'1',      (char const   )'2',      (char const   )'3', 
        (char const   )'4',      (char const   )'5',      (char const   )'6',      (char const   )'7', 
        (char const   )'8',      (char const   )'9',      (char const   )'a',      (char const   )'b', 
        (char const   )'c',      (char const   )'d',      (char const   )'e',      (char const   )'f'};
#line 59 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void u8tohex___0(uint8_t x , char *str ) 
{ 


  {
#line 64
  *(str + 0) = (char )hdigit___0[((int )x >> 4) & 15];
#line 65
  *(str + 1) = (char )hdigit___0[(int )x & 15];
#line 66
  *(str + 2) = (char )'\000';
#line 67
  return;
}
}
#line 69 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void u32tohex___0(uint32_t x , char *str ) 
{ 


  {
  {
#line 72
  u8tohex___0((uint8_t )(x >> 24), str);
#line 73
  u8tohex___0((uint8_t )(x >> 16), str + 2);
#line 74
  u8tohex___0((uint8_t )(x >> 8), str + 4);
#line 75
  u8tohex___0((uint8_t )x, str + 6);
  }
#line 76
  return;
}
}
#line 108 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void get_time___0(time_t *sec , uint32_t *usec ) 
{ 
  struct timeval tv ;

  {
  {
#line 113
  gettimeofday((struct timeval */* __restrict  */)(& tv), (__timezone_ptr_t )((void *)0));
  }
#line 114
  if (sec) {
#line 115
    *sec = tv.tv_sec;
  }
#line 116
  if (usec) {
#line 117
    *usec = (uint32_t )tv.tv_usec;
  }
#line 118
  return;
}
}
#line 120 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void time2str___0(char *buf , unsigned int size ) 
{ 
  time_t sec ;
  uint32_t usec ;

  {
  {
#line 126
  get_time___0(& sec, & usec);
#line 127
  sec -= tstart_sec___0;
  }
#line 128
  if (usec >= tstart_usec___0) {
#line 129
    usec -= tstart_usec___0;
  } else {
#line 131
    usec = (1000000U + usec) - tstart_usec___0;
#line 132
    sec --;
  }
#line 136
  return;
}
}
#line 138 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void dump___0(int level , char const   *type , void const   *data , int len ,
                     int size , int max ) 
{ 
  int actual_len ;
  int print_len ;
  char buf[20] ;
  char *tmp ;

  {
#line 145
  if (level > debug_level___0) {
#line 146
    return;
  }
#line 147
  if (debug_level___0 >= 20) {
#line 148
    max = -1;
  }
  {
#line 150
  time2str___0(buf, (unsigned int )sizeof(buf));
#line 151
  dbg___0(level, "%s T=%s len=%d\n", type, buf, len);
  }
#line 153
  if (size >= 0) {
#line 153
    actual_len = size;
  } else {
#line 153
    actual_len = len;
  }
#line 154
  if (max >= 0) {
#line 154
    if (max < actual_len) {
#line 154
      print_len = max;
    } else {
#line 154
      print_len = actual_len;
    }
  } else {
#line 154
    print_len = actual_len;
  }
#line 155
  if (print_len >= 0) {
    {
#line 156
    hexdump(level, data, (unsigned int )print_len);
    }
#line 157
    if (print_len < actual_len) {
      {
#line 158
      dbg___0(level, " ...\n");
      }
    }
  }
#line 160
  if (len < 0) {
    {
#line 161
    tmp = strerror(- len);
#line 161
    dbg___0(level, "  ERROR: %s\n", tmp);
    }
  }
  {
#line 162
  dbg___0(level, "\n");
  }
#line 163
  return;
}
}
#line 221 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static int aesWrite___0(struct AES *aes , void const   *data , unsigned int len ) 
{ 
  int res ;

  {
  {
#line 226
  res = usbSendBulkMsg(aes->usb, aes->epOut, (void *)data, len, 1000);
#line 227
  dump___0(10, "OUT ", data, res, (int )len, -1);
  }
#line 228
  return (res);
}
}
#line 231 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static int aesRead___0(struct AES *aes , void *data , unsigned int size ) 
{ 
  int res ;

  {
  {
#line 236
  res = usbSendBulkMsg(aes->usb, aes->epIn, data, size, 1000);
#line 237
  dump___0(10, "IN  ", (void const   *)data, res, -1, 64);
  }
#line 238
  return (res);
}
}
#line 253 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void aesExec___0(struct AES *aes , uint8_t const   *cmd___3 , AESReplyBuffer *rbuf ) 
{ 
  unsigned int len ;
  int count ;

  {
  {
#line 256
  while (1) {
    while_continue: /* CIL Label */ ;
#line 256
    if (! ((int const   )*(cmd___3 + 0) != 0)) {
#line 256
      goto while_break;
    }
#line 257
    len = (unsigned int )*(cmd___3 + 0);
#line 258
    if (len == 255U) {
      {
#line 260
      usleep(((unsigned int )*(cmd___3 + 1) + 256U * (unsigned int )*(cmd___3 + 2)) * 1000U);
#line 261
      cmd___3 += 3;
      }
    } else
#line 262
    if (len == 254U) {
      {
#line 264
      count = (int )((int const   )*(cmd___3 + 1) + (int const   )(256 * (int )*(cmd___3 + 2)));
#line 265
      rbuf->length = aesRead___0(aes, (void *)rbuf->buf, (unsigned int )count);
      }
#line 266
      if (count != rbuf->length) {
        {
#line 267
        dbg___0(1, "Request %d bytes but got %d bytes.\n", count, rbuf->length);
        }
      }
#line 270
      cmd___3 += 3;
#line 271
      rbuf ++;
    } else {
      {
#line 274
      aesWrite___0(aes, (void const   *)(cmd___3 + 1), len);
#line 275
      cmd___3 += len + 1U;
      }
    }
  }
  while_break: /* CIL Label */ ;
  }
#line 278
  return;
}
}
#line 282 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd___1[14]  = 
#line 282
  {      (uint8_t const   )255,      (uint8_t const   )32,      (uint8_t const   )((800 >> 8) & 255),      (uint8_t const   )6, 
        (uint8_t const   )172,      (uint8_t const   )1,      (uint8_t const   )173,      (uint8_t const   )26, 
        (uint8_t const   )129,      (uint8_t const   )2,      (uint8_t const   )254,      (uint8_t const   )2, 
        (uint8_t const   )((2 >> 8) & 255),      (uint8_t const   )0};
#line 298 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd1___2[137]  = 
#line 298
  {      (uint8_t const   )4,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )129, 
        (uint8_t const   )2,      (uint8_t const   )254,      (uint8_t const   )126,      (uint8_t const   )((126 >> 8) & 255), 
        (uint8_t const   )2,      (uint8_t const   )176,      (uint8_t const   )39,      (uint8_t const   )4, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )200, 
        (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2,      (uint8_t const   )255,      (uint8_t const   )0, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )200, 
        (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2,      (uint8_t const   )255,      (uint8_t const   )0, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )200, 
        (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2,      (uint8_t const   )255,      (uint8_t const   )0, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )200, 
        (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2,      (uint8_t const   )255,      (uint8_t const   )0, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )200, 
        (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2,      (uint8_t const   )255,      (uint8_t const   )0, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )100, 
        (uint8_t const   )((100 >> 8) & 255),      (uint8_t const   )42,      (uint8_t const   )128,      (uint8_t const   )1, 
        (uint8_t const   )130,      (uint8_t const   )64,      (uint8_t const   )131,      (uint8_t const   )0, 
        (uint8_t const   )136,      (uint8_t const   )2,      (uint8_t const   )137,      (uint8_t const   )16, 
        (uint8_t const   )138,      (uint8_t const   )5,      (uint8_t const   )140,      (uint8_t const   )0, 
        (uint8_t const   )142,      (uint8_t const   )19,      (uint8_t const   )145,      (uint8_t const   )68, 
        (uint8_t const   )146,      (uint8_t const   )52,      (uint8_t const   )149,      (uint8_t const   )22, 
        (uint8_t const   )150,      (uint8_t const   )22,      (uint8_t const   )151,      (uint8_t const   )24, 
        (uint8_t const   )161,      (uint8_t const   )112,      (uint8_t const   )162,      (uint8_t const   )2, 
        (uint8_t const   )167,      (uint8_t const   )0,      (uint8_t const   )172,      (uint8_t const   )1, 
        (uint8_t const   )173,      (uint8_t const   )26,      (uint8_t const   )128,      (uint8_t const   )4, 
        (uint8_t const   )129,      (uint8_t const   )4,      (uint8_t const   )180,      (uint8_t const   )0, 
        (uint8_t const   )254,      (uint8_t const   )20,      (uint8_t const   )((20 >> 8) & 255),      (uint8_t const   )4, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64, 
        (uint8_t const   )0};
#line 336 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd2___1[20]  = 
#line 336
  {      (uint8_t const   )255,      (uint8_t const   )100,      (uint8_t const   )((100 >> 8) & 255),      (uint8_t const   )12, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )168,      (uint8_t const   )65, 
        (uint8_t const   )130,      (uint8_t const   )66,      (uint8_t const   )131,      (uint8_t const   )83, 
        (uint8_t const   )128,      (uint8_t const   )4,      (uint8_t const   )129,      (uint8_t const   )2, 
        (uint8_t const   )254,      (uint8_t const   )126,      (uint8_t const   )((126 >> 8) & 255),      (uint8_t const   )0};
#line 343 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd3___1[26]  = 
#line 343
  {      (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )255,      (uint8_t const   )80, 
        (uint8_t const   )((80 >> 8) & 255),      (uint8_t const   )12,      (uint8_t const   )128,      (uint8_t const   )1, 
        (uint8_t const   )168,      (uint8_t const   )65,      (uint8_t const   )130,      (uint8_t const   )66, 
        (uint8_t const   )131,      (uint8_t const   )83,      (uint8_t const   )128,      (uint8_t const   )4, 
        (uint8_t const   )129,      (uint8_t const   )2,      (uint8_t const   )254,      (uint8_t const   )126, 
        (uint8_t const   )((126 >> 8) & 255),      (uint8_t const   )0};
#line 352 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd4___0[16]  = 
#line 352
  {      (uint8_t const   )14,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130, 
        (uint8_t const   )64,      (uint8_t const   )176,      (uint8_t const   )39,      (uint8_t const   )148, 
        (uint8_t const   )10,      (uint8_t const   )128,      (uint8_t const   )4,      (uint8_t const   )131, 
        (uint8_t const   )69,      (uint8_t const   )168,      (uint8_t const   )65,      (uint8_t const   )0};
#line 378
static void aesStartScan___0(struct AES *aes ) ;
#line 378 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd1___3[55]  = 
#line 378
  {      (uint8_t const   )2,      (uint8_t const   )176,      (uint8_t const   )39,      (uint8_t const   )4, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64, 
        (uint8_t const   )255,      (uint8_t const   )200,      (uint8_t const   )((200 >> 8) & 255),      (uint8_t const   )2, 
        (uint8_t const   )255,      (uint8_t const   )0,      (uint8_t const   )4,      (uint8_t const   )128, 
        (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64,      (uint8_t const   )4, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64, 
        (uint8_t const   )255,      (uint8_t const   )50,      (uint8_t const   )((50 >> 8) & 255),      (uint8_t const   )4, 
        (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130,      (uint8_t const   )64, 
        (uint8_t const   )4,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130, 
        (uint8_t const   )64,      (uint8_t const   )4,      (uint8_t const   )128,      (uint8_t const   )1, 
        (uint8_t const   )130,      (uint8_t const   )64,      (uint8_t const   )2,      (uint8_t const   )128, 
        (uint8_t const   )2,      (uint8_t const   )2,      (uint8_t const   )128,      (uint8_t const   )2, 
        (uint8_t const   )2,      (uint8_t const   )129,      (uint8_t const   )2,      (uint8_t const   )254, 
        (uint8_t const   )126,      (uint8_t const   )((126 >> 8) & 255),      (uint8_t const   )0};
#line 375 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void aesStartScan___0(struct AES *aes ) 
{ 
  uint8_t buf[126] ;
  AESReplyBuffer rbuf[1] ;

  {
  {
#line 396
  rbuf[0].length = 126;
#line 396
  rbuf[0].buf = buf;
#line 398
  aesExec___0(aes, cmd1___3, rbuf);
  }
#line 399
  return;
}
}
#line 406 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd___2[55]  = 
#line 406
  {      (uint8_t const   )4,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130, 
        (uint8_t const   )64,      (uint8_t const   )255,      (uint8_t const   )30,      (uint8_t const   )((30 >> 8) & 255), 
        (uint8_t const   )42,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130, 
        (uint8_t const   )64,      (uint8_t const   )131,      (uint8_t const   )0,      (uint8_t const   )136, 
        (uint8_t const   )2,      (uint8_t const   )137,      (uint8_t const   )16,      (uint8_t const   )138, 
        (uint8_t const   )5,      (uint8_t const   )140,      (uint8_t const   )0,      (uint8_t const   )142, 
        (uint8_t const   )19,      (uint8_t const   )145,      (uint8_t const   )68,      (uint8_t const   )146, 
        (uint8_t const   )52,      (uint8_t const   )149,      (uint8_t const   )22,      (uint8_t const   )150, 
        (uint8_t const   )22,      (uint8_t const   )151,      (uint8_t const   )24,      (uint8_t const   )161, 
        (uint8_t const   )112,      (uint8_t const   )162,      (uint8_t const   )2,      (uint8_t const   )167, 
        (uint8_t const   )0,      (uint8_t const   )172,      (uint8_t const   )1,      (uint8_t const   )173, 
        (uint8_t const   )26,      (uint8_t const   )128,      (uint8_t const   )4,      (uint8_t const   )129, 
        (uint8_t const   )4,      (uint8_t const   )180,      (uint8_t const   )0,      (uint8_t const   )254, 
        (uint8_t const   )20,      (uint8_t const   )((20 >> 8) & 255),      (uint8_t const   )0};
#line 436 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd1___4[60]  = 
#line 436
  {      (uint8_t const   )4,      (uint8_t const   )128,      (uint8_t const   )1,      (uint8_t const   )130, 
        (uint8_t const   )64,      (uint8_t const   )50,      (uint8_t const   )128,      (uint8_t const   )1, 
        (uint8_t const   )130,      (uint8_t const   )64,      (uint8_t const   )131,      (uint8_t const   )0, 
        (uint8_t const   )136,      (uint8_t const   )2,      (uint8_t const   )140,      (uint8_t const   )124, 
        (uint8_t const   )137,      (uint8_t const   )16,      (uint8_t const   )141,      (uint8_t const   )36, 
        (uint8_t const   )155,      (uint8_t const   )0,      (uint8_t const   )156,      (uint8_t const   )108, 
        (uint8_t const   )157,      (uint8_t const   )9,      (uint8_t const   )158,      (uint8_t const   )84, 
        (uint8_t const   )159,      (uint8_t const   )120,      (uint8_t const   )162,      (uint8_t const   )2, 
        (uint8_t const   )167,      (uint8_t const   )0,      (uint8_t const   )182,      (uint8_t const   )38, 
        (uint8_t const   )183,      (uint8_t const   )26,      (uint8_t const   )128,      (uint8_t const   )4, 
        (uint8_t const   )152,      (uint8_t const   )35,      (uint8_t const   )149,      (uint8_t const   )16, 
        (uint8_t const   )150,      (uint8_t const   )31,      (uint8_t const   )142,      (uint8_t const   )0, 
        (uint8_t const   )145,      (uint8_t const   )112,      (uint8_t const   )146,      (uint8_t const   )32, 
        (uint8_t const   )129,      (uint8_t const   )4,      (uint8_t const   )180,      (uint8_t const   )0, 
        (uint8_t const   )254,      (uint8_t const   )159,      (uint8_t const   )((159 >> 8) & 255),      (uint8_t const   )0};
#line 448 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd2___2[19]  = 
#line 448
  {      (uint8_t const   )14,      (uint8_t const   )152,      (uint8_t const   )35,      (uint8_t const   )149, 
        (uint8_t const   )16,      (uint8_t const   )150,      (uint8_t const   )31,      (uint8_t const   )142, 
        (uint8_t const   )3,      (uint8_t const   )145,      (uint8_t const   )112,      (uint8_t const   )146, 
        (uint8_t const   )32,      (uint8_t const   )129,      (uint8_t const   )4,      (uint8_t const   )254, 
        (uint8_t const   )159,      (uint8_t const   )((159 >> 8) & 255),      (uint8_t const   )0};
#line 454 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static uint8_t const   cmd3___2[19]  = 
#line 454
  {      (uint8_t const   )14,      (uint8_t const   )152,      (uint8_t const   )34,      (uint8_t const   )149, 
        (uint8_t const   )0,      (uint8_t const   )150,      (uint8_t const   )47,      (uint8_t const   )142, 
        (uint8_t const   )3,      (uint8_t const   )145,      (uint8_t const   )91,      (uint8_t const   )146, 
        (uint8_t const   )32,      (uint8_t const   )129,      (uint8_t const   )4,      (uint8_t const   )254, 
        (uint8_t const   )169,      (uint8_t const   )((1705 >> 8) & 255),      (uint8_t const   )0};
#line 502 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static unsigned int rms2_diff___0(uint8_t const   *img1 , uint8_t const   *img2 ,
                                  unsigned int n ) 
{ 
  unsigned int d ;
  unsigned int i ;
  int temp ;

  {
#line 506
  d = 0U;
#line 509
  i = 0U;
  {
#line 509
  while (1) {
    while_continue: /* CIL Label */ ;
#line 509
    if (! (i != n)) {
#line 509
      goto while_break;
    }
#line 510
    temp = (int )((int const   )*(img1 + i) - (int const   )*(img2 + i));
#line 511
    d += (unsigned int )(temp * temp);
#line 509
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 513
  return ((d * 1024U) / n);
}
}
#line 518 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static unsigned int findMovement___0(uint8_t const   *img1 , uint8_t const   *img2 ,
                                     unsigned int h ) 
{ 
  unsigned int mindiff ;
  unsigned int shift ;
  unsigned int i ;
  unsigned int d ;
  unsigned int tmp ;

  {
  {
#line 523
  shift = 0U;
#line 524
  mindiff = rms2_diff___0(img1, img2, 192U * h);
#line 525
  i = 1U;
  }
  {
#line 525
  while (1) {
    while_continue: /* CIL Label */ ;
#line 525
    if (! (i != h)) {
#line 525
      goto while_break;
    }
    {
#line 526
    tmp = rms2_diff___0(img1 + 192U * i, img2, 192U * (h - i));
#line 526
    d = tmp;
    }
#line 527
    if (d < mindiff) {
#line 528
      mindiff = d;
#line 529
      shift = i;
    }
#line 525
    i ++;
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 532
  dbg___0(3, " shift = %u, mindiff = %u\n", shift, mindiff);
  }
#line 533
  return (shift);
}
}
#line 536 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static unsigned int assemble___0(uint8_t const   *raw , uint8_t *img , unsigned int nstrips ,
                                 int overlap , unsigned int reverse ) 
{ 
  uint8_t *img2 ;
  unsigned int s ;
  unsigned int r ;
  unsigned int c ;
  unsigned int h ;
  unsigned int o ;
  unsigned int tmp ;

  {
#line 540
  img2 = img;
#line 543
  if (reverse) {
#line 544
    raw += 1536U * (nstrips - 1U);
  }
#line 547
  s = 0U;
  {
#line 547
  while (1) {
    while_continue: /* CIL Label */ ;
#line 547
    if (! (s != nstrips)) {
#line 547
      goto while_break;
    }
#line 548
    c = 0U;
    {
#line 548
    while (1) {
      while_continue___0: /* CIL Label */ ;
#line 548
      if (! (c != 192U)) {
#line 548
        goto while_break___0;
      }
#line 549
      r = 0U;
      {
#line 549
      while (1) {
        while_continue___1: /* CIL Label */ ;
#line 549
        if (! (r != 8U)) {
#line 549
          goto while_break___1;
        }
#line 550
        *(img + (192U * (2U * r) + c)) = (uint8_t )((int const   )*(raw + (r + 8U * c)) & 15);
#line 551
        *(img + (192U * (2U * r + 1U) + c)) = (uint8_t )((int const   )*(raw + (r + 8U * c)) >> 4);
#line 549
        r ++;
      }
      while_break___1: /* CIL Label */ ;
      }
#line 548
      c ++;
    }
    while_break___0: /* CIL Label */ ;
    }
#line 554
    img += 3072;
#line 555
    if (reverse) {
#line 556
      raw -= 1536;
    } else {
#line 558
      raw += 1536;
    }
#line 547
    s ++;
  }
  while_break: /* CIL Label */ ;
  }
#line 561
  if (overlap) {
#line 562
    img = img2;
#line 563
    img2 = img + 3072;
#line 565
    h = 0U;
#line 566
    s = 1U;
    {
#line 566
    while (1) {
      while_continue___2: /* CIL Label */ ;
#line 566
      if (! (s != nstrips)) {
#line 566
        goto while_break___2;
      }
      {
#line 567
      tmp = findMovement___0((uint8_t const   *)img, (uint8_t const   *)img2, 16U);
#line 567
      o = tmp;
#line 568
      img += 192U * o;
#line 569
      memcpy((void */* __restrict  */)img, (void const   */* __restrict  */)img2,
             (size_t )3072);
#line 570
      img2 += 3072;
#line 571
      h += o;
#line 566
      s ++;
      }
    }
    while_break___2: /* CIL Label */ ;
    }
#line 573
    return (h + 16U);
  } else {
#line 575
    return (nstrips * 16U);
  }
}
}
#line 579 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void toPNM___0(void const   *img_ , unsigned int w , unsigned int h , char const   *fn ) 
{ 
  FILE *f ;
  uint8_t const   *img ;
  unsigned int i ;
  uint8_t temp ;

  {
  {
#line 583
  img = (uint8_t const   *)img_;
#line 587
  f = fopen((char const   */* __restrict  */)fn, (char const   */* __restrict  */)"wb");
#line 588
  fprintf((FILE */* __restrict  */)f, (char const   */* __restrict  */)"P5\n%u %u\n255\n",
          w, h);
#line 589
  i = 0U;
  }
  {
#line 589
  while (1) {
    while_continue: /* CIL Label */ ;
#line 589
    if (! (i != w * h)) {
#line 589
      goto while_break;
    }
    {
#line 590
    temp = (uint8_t )(((int const   )*(img + i) << 4) + 15);
#line 591
    fwrite((void const   */* __restrict  */)(& temp), (size_t )1, (size_t )1, (FILE */* __restrict  */)f);
#line 589
    i ++;
    }
  }
  while_break: /* CIL Label */ ;
  }
  {
#line 593
  fclose(f);
  }
#line 594
  return;
}
}
#line 601 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static USBDeviceLocation deviceLocation___0  ;
#line 602 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static unsigned int ndevices___0  ;
#line 604 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static int attach___0(USBDeviceLocation dl , void *dummy ) 
{ 


  {
#line 607
  deviceLocation___0 = dl;
#line 608
  ndevices___0 = 1U;
#line 609
  return (1);
}
}
#line 612 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void init___0(void) 
{ 


  {
  {
#line 615
  get_time___0(& tstart_sec___0, & tstart_usec___0);
#line 616
  usbInit((char const   *)((void *)0));
#line 617
  ndevices___0 = 0U;
#line 618
  usbFindDevices((uint16_t )2303, (uint16_t )9600, & attach___0, (void *)0);
  }
#line 619
  return;
}
}
#line 621 "/home/june/collector/temp/aes2501-wy-0.1/aes2501.c"
static void cleanup___0(void) 
{ 


  {
  {
#line 624
  usbCleanup();
  }
#line 625
  return;
}
}
